(function(){var p,aP,ax,bg,am,a1,V,U,aD,an,aX,aG,g,ad,aZ,y,x,aE,bc,aT,M,aw,be,f,m,aJ,J,aU,bd,a2,G,av,ac,a9,ai,aq,t,ap,C,ay,Q,aF,at,K,aa,u,a5,al,af,H,aY,aA,O,i,ak,v,a0,bk,a4,aH,D,E,aI,ab,I,a3,aR,aC,d,q,aj,ao,ar,aS,P,ae,bi,w,L,z,bh,S,ba,ah,aM,a6,R,X,r,bj,aK,a8,a7,az,N,F,s,A,h,W,aN,k,aB,aW,aO,aL,T,aV,bb,b,j,Y,B,e,ag,a,Z,l,bf,aQ,c,n,au,o;aK=Math.random;W=Math.round;al=Math.floor;T=Math.sqrt;aW=Math.sin;G=Math.cos;b=Math.tan;M=Math.asin;aZ=Math.acos;aw=Math.atan;a6=Math.pow;ad=Math.abs;aG=Math.PI;K=function(bm){var bn,bo,bl;bl=[];for(bn=0,bo=bm.length-1;0<=bo?bn<=bo:bn>=bo;0<=bo?bn++:bn--){bl.push([bn,bm[bn]])}return bl};J=function(bn){var bm,bl;if(!(bn!=null)||typeof bn!=="object"){return bn}bl=new bn.constructor();for(bm in bn){bl[bm]=J(bn[bm])}return bl};a8=function(bm){var bl;bl=al(aK()*bm.length);return bm[bl]};d=function(bm,bl){return[bm*bl[0],bm*bl[1],bm*bl[2]]};o=function(bm,bl){return[bm[0]*bl[0],bm[1]*bl[1],bm[2]*bl[2]]};y=function(bm,bl){return[bm[0]+bl[0],bm[1]+bl[1],bm[2]+bl[2]]};bb=function(bm,bl){return[bm[0]-bl[0],bm[1]-bl[1],bm[2]-bl[2]]};C=function(bm,bl){return bm[0]*bl[0]+bm[1]*bl[1]+bm[2]*bl[2]};av=function(bm,bl){return[bm[1]*bl[2]-bm[2]*bl[1],bm[2]*bl[0]-bm[0]*bl[2],bm[0]*bl[1]-bm[1]*bl[0]]};I=function(bl){return T(C(bl,bl))};a3=function(bl){return C(bl,bl)};bf=function(bl){return d(1/T(a3(bl)),bl)};aR=function(bm,bl){return d(1/2,y(bm,bl))};l=function(bn,bm,bl){return[(1-bl)*bn[0]+bl*bm[0],(1-bl)*bn[1]+bl*bm[1],(1-bl)*bn[2]+bl*bm[2]]};ar=function(bm,bl){return l(bm,bl,1/3)};az=function(bl){return d(1/a3(bl),bl)};j=function(bn,bm){var bl;bl=bb(bm,bn);return bb(bn,d(C(bl,bn)/a3(bl),bl))};at=function(bm,bl){return T(a3(j(bm,bl)))};aS=function(bp,bo,bn){var bm,bl;bm=bb(bo,bp);bl=bb(bn,bo);return av(bm,bl)};E=function(bs,br,bq){var bw,bv,bu,bp,bo,bn,bt,bm,bl;for(bp=0,bt=bs.length;bp<bt;bp++){bw=bs[bp];for(bo=0,bm=br.length;bo<bm;bo++){bv=br[bo];if(bw===bv){for(bn=0,bl=bq.length;bn<bl;bn++){bu=bq[bn];if(bw===bu){return bw}}}}}return null};be=function(bp){var bn,bm,bo,bl;bn=[0,0,0];for(bo=0,bl=bp.length;bo<bl;bo++){bm=bp[bo];bn=y(bn,bm)}return d(1/bp.length,bn)};aj=function(bp){var bl,bt,br,bq,bn,bs,bo,bm;bl=[0,0,0];bo=bp.slice(-2),bt=bo[0],br=bo[1];for(bn=0,bs=bp.length;bn<bs;bn++){bq=bp[bn];bl=y(bl,aS(bt,br,bq));bm=[br,bq],bt=bm[0],br=bm[1]}return bf(bl)};bd=function(bp){var bl,bt,br,bq,bn,bs,bo,bm;bl=0;bo=bp.slice(0,2),bt=bo[0],br=bo[1];bm=bp.slice(2);for(bn=0,bs=bm.length;bn<bs;bn++){bq=bm[bn];bl+=I(av(bb(br,bt),bb(bq,bt)));br=bq}return bl};X=function(bs){var bq,bm,bl,bp,bt,bu,bo,br,bn;bp=J(bs);bu=bs[0];bp=_.map(bp,function(bv){return bv-bu});bm=aj(bs);bq=bf(be(bs));bl=av(bm,bq);bn=[];for(bo=0,br=bp.length;bo<br;bo++){bt=bp[bo];bn.push([C(bm,bt),C(bl,bt)])}return bn};a2=function(bn){var bm,bl,bo;bl=new Array(bn.length);for(bm=0,bo=bn.length-1;0<=bo?bm<=bo:bm>=bo;0<=bo?bm++:bm--){bl[bm]=bn[bm].slice(0)}return bl};q=function(bm,bl){return[bm[0][0]*bl[0]+bm[0][1]*bl[1]+bm[0][2]*bl[2],bm[1][0]*bl[0]+bm[1][1]*bl[1]+bm[1][2]*bl[2],bm[2][0]*bl[0]+bm[2][1]*bl[1]+bm[2][2]*bl[2]]};aC=function(bl,bm){return[[bl[0][0]*bm[0][0]+bl[0][1]*bm[1][0]+bl[0][2]*bm[2][0],bl[0][0]*bm[0][1]+bl[0][1]*bm[1][1]+bl[0][2]*bm[2][1],bl[0][0]*bm[0][2]+bl[0][1]*bm[1][2]+bl[0][2]*bm[2][2]],[bl[1][0]*bm[0][0]+bl[1][1]*bm[1][0]+bl[1][2]*bm[2][0],bl[1][0]*bm[0][1]+bl[1][1]*bm[1][1]+bl[1][2]*bm[2][1],bl[1][0]*bm[0][2]+bl[1][1]*bm[1][2]+bl[1][2]*bm[2][2]],[bl[2][0]*bm[0][0]+bl[2][1]*bm[1][0]+bl[2][2]*bm[2][0],bl[2][0]*bm[0][1]+bl[2][1]*bm[1][1]+bl[2][2]*bm[2][1],bl[2][0]*bm[0][2]+bl[2][1]*bm[1][2]+bl[2][2]*bm[2][2]]]};u=[[1,0,0],[0,1,0],[0,0,1]];h=function(bp,bn,bo){var bq,bm,bl;bq=[[G(bp),-1*aW(bp),0],[aW(bp),G(bp),0],[0,0,1]];bl=[[G(bn),0,-1*aW(bn)],[0,1,0],[aW(bn),0,G(bn)]];bm=[[1,0,0],[0,G(bo),-1*aW(bo)],[0,aW(bo),G(bo)]];return aC(bm,aC(bl,bq))};aQ=function(bp,by,bw,bt){var bs,bm,bn,bx,bv,bl,bu,bq,br,bo;bp/=2;bx=aW(bp);bs=G(bp);bv=bx*bx;bm=I([by,bw,bt]);if(bm===0){br=[0,0,1],by=br[0],bw=br[1],bt=br[2]}if(bm!==1){bo=bf([by,bw,bt]),by=bo[0],bw=bo[1],bt=bo[2]}if(by===1&&bw===0&&bt===0){bn=[[1,0,0],[0,1-2*bv,2*bx*bs],[0,-2*bx*bs,1-2*bv]]}else{if(by===0&&bw===1&&bt===0){bn=[[1-2*bv,0,-2*bx*bs],[0,1,0],[2*bx*bs,0,1-2*bv]]}else{if(by===0&&bw===0&&bt===1){bn=[[1-2*bv,2*bx*bs,0],[-2*bx*bs,1-2*bv,0],[0,0,1]]}else{bl=by*by;bu=bw*bw;bq=bt*bt;bn=[[1-2*(bu+bq)*bv,2*(by*bw*bv+bt*bx*bs),2*(by*bt*bv-bw*bx*bs)],[2*(bw*by*bv-bt*bx*bs),1-2*(bq+bl)*bv,2*(bw*bt*bv+by*bx*bs)],[2*(bt*by*bv+bw*bx*bs),2*(bt*bw*bv-by*bx*bs),1-2*(bl+bu)*bv]]}}}return bn};w=function(bn,bm,bo,br,bl){var bp,bq;bq=(bm*br-bo)/(1-br);bp=bl*br/(1-br);return[bp*bn[0]/(bn[2]+bq),bp*bn[1]/(bn[2]+bq)]};aI=function(bs,bp,bv,bt,bz,bo,bn,bm){var by,bl,bu,bq,bw,bB,bD,br,bx,bA,bC;bx=(bz*bn-bo)/(1-bn);by=bm*bn/(1-bn);bu=bs-bv;bB=bp-bt;bl=by*by;bA=bx*bx;bq=bu*bu;bD=bB*bB;bw=(2*by*bu*bx+T(4*bl*bq*bA+4*bq*(bl+bq+bD)*(1-bA)))/(2*(bl+bq+bD));br=(by*bB*bx)/(bl+bq+bD)+(bB*T(4*bl*bA+4*(bl+bq+bD)*(1-bA)))/(2*(bl+bq+bD));bC=T(1-bw*bw-br*br);return[bw,br,bC]};aA=function(bn,bm){var bo,bl;bl=av(bn,bm);bo=aZ(C(bn,bm));return aQ(-1*bo,bl[0],bl[1],bl[2])};a5=function(bo){var bm,bq,bp,bn,bl;bm=[];bq=bo.slice(-1)[0];for(bn=0,bl=bo.length;bn<bl;bn++){bp=bo[bn];bm.push([bq,bp]);bq=bp}return bm};c=function(bm){var bs,br,bv,bt,bp,bo,bu,bl,bq,bn;bt=[];bq=K(bm.face);for(bp=0,bu=bq.length;bp<bu;bp++){bn=bq[bp],br=bn[0],bs=bn[1];for(bo=0,bl=bs.length;bo<bl;bo++){bv=bs[bo];bt[bv]=bm.face_colors[br]}}return bt};aM=(function(){function bl(){this.face=new Array();this.xyz=new Array();this.name="null polyhedron"}bl.prototype.data=function(){var bm;bm=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bm+" edges, "+this.xyz.length+" vertices)"};bl.prototype.getEdges=function(){var bw,bs,bu,bt,bn,br,bq,bx,bp,bo,bv,bm;br={};bx=[];bs=_.map(this.face,a5);for(bp=0,bv=bs.length;bp<bv;bp++){bn=bs[bp];for(bo=0,bm=bn.length;bo<bm;bo++){bt=bn[bo];if(bt[0]<bt[1]){bw=bt[0],bu=bt[1]}else{bu=bt[0],bw=bt[1]}br[bw+"~"+bu]=bt}}for(bq in br){bt=br[bq];bx.push(bt)}return bx};bl.prototype.centers=function(){var br,bs,bo,bu,bp,bn,bt,bm,bq;br=[];bq=this.face;for(bp=0,bt=bq.length;bp<bt;bp++){bs=bq[bp];bo=[0,0,0];for(bn=0,bm=bs.length;bn<bm;bn++){bu=bs[bn];bo=y(bo,this.xyz[bu])}br.push(d(1/bs.length,bo))}return br};bl.prototype.normals=function(){var bq,br,bn,bp,bm,bo;br=[];bo=this.face;for(bp=0,bm=bo.length;bp<bm;bp++){bq=bo[bp];br.push(aj((function(){var bu,bs,bt;bt=[];for(bu=0,bs=bq.length;bu<bs;bu++){bn=bq[bu];bt.push(this.xyz[bn])}return bt}).call(this)))}return br};bl.prototype.toOBJ=function(){var by,bx,bn,bz,bB,bv,bu,bt,br,bA,bo,bm,bC,bw,bs,bq,bp;bz="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bz+="group "+this.name+"\n";bz+="#vertices\n";bw=this.xyz;for(bv=0,bA=bw.length;bv<bA;bv++){bB=bw[bv];bz+="v "+bB[0]+" "+bB[1]+" "+bB[2]+"\n"}bz+="#normal vector defs \n";bs=this.face;for(bu=0,bo=bs.length;bu<bo;bu++){by=bs[bu];bn=aj((function(){var bE,bF,bD;bD=[];for(bE=0,bF=by.length;bE<bF;bE++){bB=by[bE];bD.push(this.xyz[bB])}return bD}).call(this));bz+="vn "+bn[0]+" "+bn[1]+" "+bn[2]+"\n"}bz+="#face defs \n";bq=K(this.face);for(bt=0,bm=bq.length;bt<bm;bt++){bp=bq[bt],bx=bp[0],by=bp[1];bz+="f ";for(br=0,bC=by.length;br<bC;br++){bB=by[br];bz+=""+(bB+1)+"//"+(bx+1)+" "}bz+="\n"}return bz};bl.prototype.toX3D=function(){var bq,bB,bw,by,bz,bu,bt,bs,bp,bx,bn,bm,bA,bv,br,bo;bq=0.01;bz='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bv=this.face;for(bu=0,bx=bv.length;bu<bx;bu++){bw=bv[bu];for(bt=0,bn=bw.length;bt<bn;bt++){by=bw[bt];bz+=""+by+" "}bz+="-1\n"}bz+='">\n';bz+='<Color color="';br=c(this);for(bs=0,bm=br.length;bs<bm;bs++){bB=br[bs];bz+=""+bB[0]+" "+bB[1]+" "+bB[2]+" "}bz+='"/>';bz+='<Coordinate point="';bo=this.xyz;for(bp=0,bA=bo.length;bp<bA;bp++){by=bo[bp];bz+=""+(by[0]*bq)+" "+(by[1]*bq)+" "+(by[2]*bq)+" "}bz+='"/>\n';bz+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bz};bl.prototype.toVRML=function(){var bq,bB,bw,by,bz,bu,bt,bs,bp,bx,bn,bm,bA,bv,br,bo;bq=0.01;bz='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bv=this.xyz;for(bu=0,bx=bv.length;bu<bx;bu++){by=bv[bu];bz+=""+(by[0]*bq)+" "+(by[1]*bq)+" "+(by[2]*bq)+","}bz=bz.slice(0,-1);bz+="    ]\n}\ncolor Color\n{\n  color\n  [";br=this.face_colors;for(bt=0,bn=br.length;bt<bn;bt++){bB=br[bt];bz+=""+bB[0]+" "+bB[1]+" "+bB[2]+" ,"}bz=bz.slice(0,-1);bz+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bo=this.face;for(bs=0,bm=bo.length;bs<bm;bs++){bw=bo[bs];for(bp=0,bA=bw.length;bp<bA;bp++){by=bw[bp];bz+=""+by+", "}bz+="-1,"}bz=bz.slice(0,-1);bz+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bz};return bl})();e=function(){var bl;bl=new aM();bl.name="T";bl.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bl.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bl};ao=function(){var bl;bl=new aM();bl.name="O";bl.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bl.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bl};ai=function(){var bl;bl=new aM();bl.name="C";bl.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bl.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bl};a4=function(){var bl;bl=new aM();bl.name="I";bl.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bl.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bl};ap=function(){var bl;bl=new aM();bl.name="D";bl.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bl.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bl};R=function(bp){var by,bx,bl,bn,bv,bu,bw,bs,bq,bo,bm,bt,br;bn=2*aG/bp;by=Math.sin(bn/2);bl=new aM();bl.name="P"+bp;for(bx=0,bw=bp-1;0<=bw?bx<=bw:bx>=bw;0<=bw?bx++:bx--){bl.xyz.push([-G(bx*bn),-aW(bx*bn),-by])}for(bx=0,bs=bp-1;0<=bs?bx<=bs:bx>=bs;0<=bs?bx++:bx--){bl.xyz.push([-G(bx*bn),-aW(bx*bn),by])}bl.face.push((function(){bt=[];for(var bz=bq=bp-1;bq<=0?bz<=0:bz>=0;bq<=0?bz++:bz--){bt.push(bz)}return bt}).apply(this));bl.face.push((function(){br=[];for(var bz=bp,bA=2*bp-1;bp<=bA?bz<=bA:bz>=bA;bp<=bA?bz++:bz--){br.push(bz)}return br}).apply(this));for(bx=0,bm=bp-1;0<=bm?bx<=bm:bx>=bm;0<=bm?bx++:bx--){bl.face.push([bx,(bx+1)%bp,(bx+1)%bp+bp,bx+bp])}bl.xyz=x(bl,1);return bl};aT=function(bq){var bA,bz,by,bm,bl,bo,bw,bv,bx,bt,br,bp,bn,bu,bs;bo=2*aG/bq;bz=T(1-4/(4+2*G(bo/2)-2*G(bo)));bl=T(1-bz*bz);bA=T(bz*bz+a6(bl*G(bo/2),2));bl=-bl/bA;bz=-bz/bA;bm=new aM();bm.name="A"+bq;for(by=0,bx=bq-1;0<=bx?by<=bx:by>=bx;0<=bx?by++:by--){bm.xyz.push([bl*G(by*bo),bl*aW(by*bo),bz])}for(by=0,bt=bq-1;0<=bt?by<=bt:by>=bt;0<=bt?by++:by--){bm.xyz.push([bl*G((by+0.5)*bo),bl*aW((by+0.5)*bo),-bz])}bm.face.push((function(){bu=[];for(var bB=br=bq-1;br<=0?bB<=0:bB>=0;br<=0?bB++:bB--){bu.push(bB)}return bu}).apply(this));bm.face.push((function(){bs=[];for(var bB=bq,bC=2*bq-1;bq<=bC?bB<=bC:bB>=bC;bq<=bC?bB++:bB--){bs.push(bB)}return bs}).apply(this));for(by=0,bn=bq-1;0<=bn?by<=bn:by>=bn;0<=bn?by++:by--){bm.face.push([by,(by+1)%bq,by+bq]);bm.face.push([by,by+bq,(bq+by-1)%bq+bq])}bm.xyz=x(bm,1);return bm};bj=function(bn){var bu,bt,bl,bm,br,bs,bp,bo,bq;bm=2*aG/bn;bu=1;bl=new aM();bl.name="Y"+bn;for(bt=0,bs=bn-1;0<=bs?bt<=bs:bt>=bs;0<=bs?bt++:bt--){bl.xyz.push([-G(bt*bm),-aW(bt*bm),-0.2])}bl.xyz.push([0,0,bu]);bl.face.push((function(){bq=[];for(var bv=bp=bn-1;bp<=0?bv<=0:bv>=0;bp<=0?bv++:bv--){bq.push(bv)}return bq}).apply(this));for(bt=0,bo=bn-1;0<=bo?bt<=bo:bt>=bo;0<=bo?bt++:bt--){bl.face.push([bt,(bt+1)%bn,bn])}bl.xyz=f(bl,3);return bl};ah=(function(){function bl(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bl.prototype.newV=function(bn,bm){if(this.verts[bn]===void 0){this.verts[bn]=0;return this.xyzs[bn]=bm}};bl.prototype.newFlag=function(bm,bo,bn){if(this.flags[bm]===void 0){this.flags[bm]={}}return this.flags[bm][bo]=bn};bl.prototype.topoly=function(){var bn,bs,bv,br,bp,bm,bt,bu,bq,bo;bm=new aM();bn=0;bq=this.verts;for(br in bq){bt=bq[br];bm.xyz[bn]=this.xyzs[br];this.verts[br]=bn;bn++}bn=0;bo=this.flags;for(br in bo){bs=bo[br];bm.face[bn]=[];for(bp in bs){bt=bs[bp];bu=bt;break}bt=bu;bm.face[bn].push(this.verts[bt]);bt=this.flags[br][bt];bv=0;while(bt!==bu){bm.face[bn].push(this.verts[bt]);bt=this.flags[br][bt];bv++;if(bv>1000){console.log("Bad flag spec, have a neverending face:",br,this.flags[br]);break}}bn++}bm.name="unknown polyhedron";return bm};return bl})();ab=function(bv,bB){var bu,bF,bE,bC,bI,bt,bD,bx,bz,bA,by,bs,bp,bq,bn,bl,bH,bJ,bG,bw,br,bo,bm;console.log("Taking kis of "+(bB===0?"":bB)+"-sided faces of "+bv.name+"...");bC=new ah();bw=K(bv.xyz);for(bq=0,bH=bw.length;bq<bH;bq++){br=bw[bq],bD=br[0],bA=br[1];bC.newV("v"+bD,bA)}bz=bv.normals();bF=bv.centers();bt=false;bo=K(bv.face);for(bn=0,bJ=bo.length;bn<bJ;bn++){bm=bo[bn],bD=bm[0],bE=bm[1];bs="v"+bE[bE.length-1];for(bl=0,bG=bE.length;bl<bG;bl++){by=bE[bl];bp="v"+by;if(bE.length===bB||bB===0){bt=true;bu="apex"+bD;bI=""+bD+bs;bC.newV(bu,y(bF[bD],d(0.2,bz[bD])));bC.newFlag(bI,bs,bp);bC.newFlag(bI,bp,bu);bC.newFlag(bI,bu,bs)}else{bC.newFlag(""+bD,bs,bp)}bs=bp}}if(!bt){console.log("No "+bB+"-fold components were found.")}bx=bC.topoly();bx.name="k"+(bB===0?"":bB)+bv.name;return bx};aE=function(bm){var bw,bx,bv,bn,br,bB,bA,by,bt,bs,bz,bl,bu,bq,bp,bo;console.log("Taking ambo of "+bm.name+"...");bn=function(bD,bC){if(bD<bC){return bD+"_"+bC}else{return bC+"_"+bD}};bx=new ah();bu=K(bm.face);for(bt=0,bz=bu.length;bt<bz;bt++){bq=bu[bt],bv=bq[0],bw=bq[1];bp=bw.slice(-2),bB=bp[0],bA=bp[1];for(bs=0,bl=bw.length;bs<bl;bs++){by=bw[bs];if(bB<bA){bx.newV(bn(bB,bA),aR(bm.xyz[bB],bm.xyz[bA]))}bx.newFlag("orig"+bv,bn(bB,bA),bn(bA,by));bx.newFlag("dual"+bA,bn(bA,by),bn(bB,bA));bo=[bA,by],bB=bo[0],bA=bo[1]}}br=bx.topoly();br.name="a"+bm.name;return br};a0=function(bz){var bH,bG,bE,bL,bF,bD,bB,bC,by,bv,bs,bw,bt,bq,bo,bK,bM,bJ,bI,bA,bn,bx,bu,br,bp,bm,bl,bO,bN;console.log("Taking gyro of "+bz.name+"...");bE=new ah();bA=K(bz.xyz);for(bw=0,bK=bA.length;bw<bK;bw++){bx=bA[bw],bF=bx[0],bC=bx[1];bE.newV("v"+bF,bf(bC))}bH=bz.centers();bu=K(bz.face);for(bt=0,bM=bu.length;bt<bM;bt++){br=bu[bt],bF=br[0],bG=br[1];bE.newV("center"+bF,bf(bH[bF]))}bp=K(bz.face);for(bq=0,bJ=bp.length;bq<bJ;bq++){bm=bp[bq],bF=bm[0],bG=bm[1];bl=bG.slice(-2),by=bl[0],bv=bl[1];bO=K(bG);for(bo=0,bI=bO.length;bo<bI;bo++){bN=bO[bo],bD=bN[0],bC=bN[1];bs=bC;bE.newV(by+"~"+bv,ar(bz.xyz[by],bz.xyz[bv]));bL=bF+"f"+by;bE.newFlag(bL,"center"+bF,by+"~"+bv);bE.newFlag(bL,by+"~"+bv,bv+"~"+by);bE.newFlag(bL,bv+"~"+by,"v"+bv);bE.newFlag(bL,"v"+bv,bv+"~"+bs);bE.newFlag(bL,bv+"~"+bs,"center"+bF);bn=[bv,bs],by=bn[0],bv=bn[1]}}bB=bE.topoly();bB.name="g"+bz.name;return bB};r=function(bw){var bC,bA,bE,bB,by,bz,bv,bs,bp,bt,bq,bn,bD,bG,bF,bx,bu,br,bo,bm,bl;console.log("Taking propellor of "+bw.name+"...");bA=new ah();bx=K(bw.xyz);for(bt=0,bD=bx.length;bt<bD;bt++){bu=bx[bt],bB=bu[0],bz=bu[1];bA.newV("v"+bB,bf(bz))}br=K(bw.face);for(bq=0,bG=br.length;bq<bG;bq++){bo=br[bq],bB=bo[0],bC=bo[1];bm=bC.slice(-2),bv=bm[0],bs=bm[1];for(bn=0,bF=bC.length;bn<bF;bn++){bz=bC[bn];bp=""+bz;bA.newV(bv+"~"+bs,ar(bw.xyz[bv],bw.xyz[bs]));bE=""+bB+"f"+bs;bA.newFlag("v"+bB,bv+"~"+bs,bs+"~"+bp);bA.newFlag(bE,bv+"~"+bs,bs+"~"+bv);bA.newFlag(bE,bs+"~"+bv,"v"+bs);bA.newFlag(bE,"v"+bs,bs+"~"+bp);bA.newFlag(bE,bs+"~"+bp,bv+"~"+bs);bl=[bs,bp],bv=bl[0],bs=bl[1]}}by=bA.topoly();by.name="p"+bw.name;return by};s=function(bn){var bl,bm,bo;console.log("Taking reflection of "+bn.name+"...");for(bl=0,bm=bn.xyz.length-1;0<=bm?bl<=bm:bl>=bm;0<=bm?bl++:bl--){bn.xyz[bl]=d(-1,bn.xyz[bl])}for(bl=0,bo=bn.face.length-1;0<=bo?bl<=bo:bl>=bo;0<=bo?bl++:bl--){bn.face[bl]=bn.face[bl].reverse()}bn.name="r"+bn.name;return bn};aF=function(by){var bG,bM,bF,bz,bD,bE,bC,bB,bx,bu,bv,bs,bq,bo,bK,bL,bJ,bI,bH,bm,bA,bw,bt,br,bp,bn,bl;console.log("Taking dual of "+by.name+"...");bD=new ah();bz=[];for(bE=0,bA=by.xyz.length-1;0<=bA?bE<=bA:bE>=bA;0<=bA?bE++:bE--){bz[bE]={}}bw=K(by.face);for(bv=0,bK=bw.length;bv<bK;bv++){bt=bw[bv],bE=bt[0],bF=bt[1];bx=bF[bF.length-1];for(bs=0,bL=bF.length;bs<bL;bs++){bu=bF[bs];bz[bx]["v"+bu]=""+bE;bx=bu}}bG=by.centers();for(bE=0,br=by.face.length-1;0<=br?bE<=br:bE>=br;0<=br?bE++:bE--){bD.newV(""+bE,bG[bE])}bp=K(by.face);for(bq=0,bJ=bp.length;bq<bJ;bq++){bn=bp[bq],bE=bn[0],bF=bn[1];bx=bF[bF.length-1];for(bo=0,bI=bF.length;bo<bI;bo++){bu=bF[bo];bD.newFlag(bx,bz[bu]["v"+bx],""+bE);bx=bu}}bM=bD.topoly();bB=[];bl=bM.face;for(bm=0,bH=bl.length;bm<bH;bm++){bF=bl[bm];bC=E(by.face[bF[0]],by.face[bF[1]],by.face[bF[2]]);bB[bC]=bF}bM.face=bB;if(by.name[0]!=="d"){bM.name="d"+by.name}else{bM.name=by.name.slice(1)}return bM};D=function(by,bE){var bI,bH,bF,bN,bx,bG,bA,bC,bD,bB,bw,bt,bu,br,bp,bn,bM,bO,bL,bK,bJ,bl,bz,bv,bs,bq,bo,bm;console.log("Taking inset of "+(bE===0?"":bE)+"-sided faces of "+by.name+"...");bF=new ah();bz=K(by.xyz);for(bu=0,bM=bz.length;bu<bM;bu++){bv=bz[bu],bG=bv[0],bD=bv[1];bF.newV("v"+bG,bD)}bC=by.normals();bI=by.centers();bs=K(by.face);for(br=0,bO=bs.length;br<bO;br++){bq=bs[br],bG=bq[0],bH=bq[1];if(bH.length===bE||bE===0){for(bp=0,bL=bH.length;bp<bL;bp++){bB=bH[bp];bF.newV("f"+bG+"v"+bB,y(aR(by.xyz[bB],bI[bG]),d(-0.2,bC[bG])))}}}bx=false;bo=K(by.face);for(bn=0,bK=bo.length;bn<bK;bn++){bm=bo[bn],bG=bm[0],bH=bm[1];bw="v"+bH[bH.length-1];for(bl=0,bJ=bH.length;bl<bJ;bl++){bB=bH[bl];bt="v"+bB;if(bH.length===bE||bE===0){bx=true;bN=bG+bw;bF.newFlag(bN,bw,bt);bF.newFlag(bN,bt,"f"+bG+bt);bF.newFlag(bN,"f"+bG+bt,"f"+bG+bw);bF.newFlag(bN,"f"+bG+bw,bw);bF.newFlag("ex"+bG,"f"+bG+bw,"f"+bG+bt)}else{bF.newFlag(bG,bw,bt)}bw=bt}}if(!bx){console.log("No "+bE+"-fold components were found.")}bA=bF.topoly();bA.name="n"+(bE===0?"":bE)+by.name;return bA};aa=function(by,bE){var bI,bH,bF,bx,bG,bA,bC,bD,bB,bw,bt,bu,br,bp,bn,bM,bN,bL,bK,bJ,bl,bz,bv,bs,bq,bo,bm;console.log("Taking extrusion of "+(bE===0?"":bE)+"-sided faces of "+by.name+"...");bF=new ah();bz=K(by.xyz);for(bu=0,bM=bz.length;bu<bM;bu++){bv=bz[bu],bG=bv[0],bD=bv[1];bF.newV("v"+bG,bD)}bC=by.normals();bI=by.centers();bs=K(by.face);for(br=0,bN=bs.length;br<bN;br++){bq=bs[br],bG=bq[0],bH=bq[1];if(bH.length===bE||bE===0){for(bp=0,bL=bH.length;bp<bL;bp++){bB=bH[bp];bF.newV("f"+bG+"v"+bB,y(by.xyz[bB],d(0.3,bC[bG])))}}}bx=false;bo=K(by.face);for(bn=0,bK=bo.length;bn<bK;bn++){bm=bo[bn],bG=bm[0],bH=bm[1];bw="v"+bH[bH.length-1];for(bl=0,bJ=bH.length;bl<bJ;bl++){bB=bH[bl];bt="v"+bB;if(bH.length===bE||bE===0){bx=true;bF.newFlag(bG+bw,bw,bt);bF.newFlag(bG+bw,bt,"f"+bG+bt);bF.newFlag(bG+bw,"f"+bG+bt,"f"+bG+bw);bF.newFlag(bG+bw,"f"+bG+bw,bw);bF.newFlag("ex"+bG,"f"+bG+bw,"f"+bG+bt)}else{bF.newFlag(bG,bw,bt)}bw=bt}}if(!bx){console.log("No "+bE+"-fold components were found.")}bA=bF.topoly();bA.name="x"+(bE===0?"":bE)+by.name;console.log(bA);return bA};aV=function(by){var bJ,bI,bG,bH,bD,bF,bE,bv,bK,bt,bx,bw,bq,bB,bA,bz,bs,bp,bn,bM,bN,bL,bC,bu,br,bo,bm,bl;console.log("Taking stella of "+by.name+"...");bJ=by.centers();bG=new ah();bC=K(by.xyz);for(bs=0,bM=bC.length;bs<bM;bs++){bu=bC[bs],bH=bu[0],bF=bu[1];bG.newV("v"+bH,bF)}br=K(by.face);for(bp=0,bN=br.length;bp<bN;bp++){bo=br[bp],bH=bo[0],bI=bo[1];bv="v"+bI[bI.length-2];bt="v"+bI[bI.length-1];bB=by.xyz[bI[bI.length-2]];bA=by.xyz[bI[bI.length-1]];for(bn=0,bL=bI.length;bn<bL;bn++){bE=bI[bn];bq="v"+bE;bz=by.xyz[bE];bK=bv+"~"+bt;bx=bt+"~"+bv;bw=bt+"~"+bq;bG.newV(bK,aR(aR(bB,bA),bJ[bH]));bG.newFlag("in"+bH,bK,bw);bG.newFlag("f"+bH+bt,bw,bK);bG.newFlag("f"+bH+bt,bK,bt);bG.newFlag("f"+bH+bt,bt,bw);bG.newFlag("f"+bK,bv,bx);bG.newFlag("f"+bK,bx,bK);bG.newFlag("f"+bK,bK,bv);bm=[bt,bq],bv=bm[0],bt=bm[1];bl=[bA,bz],bB=bl[0],bA=bl[1]}}bD=bG.topoly();bD.name="*"+by.name;return bD};Y=function(bo,bn){var bs,bq,bp,bl,bt,bm,br;bs=0.1;bl=a2(bo);for(bm=0,br=bn.length;bm<br;bm++){bp=bn[bm];bt=j(bl[bp[0]],bl[bp[1]]);bq=d(bs*1/2*(1-T(C(bt,bt))),bt);bl[bp[0]]=y(bl[bp[0]],bq);bl[bp[1]]=y(bl[bp[1]],bq)}return bl};a7=function(bp,bo){var bs,bq,bl,bm,bt,bn,br;bl=(function(){var bx,bv,bw,bu;bu=[];for(bx=0,bv=bo.length;bx<bv;bx++){bw=bo[bx],bs=bw[0],bq=bw[1];bu.push(j(bp[bs],bp[bq]))}return bu})();bm=[0,0,0];for(bn=0,br=bl.length;bn<br;bn++){bt=bl[bn];bm=y(bm,bt)}bm=d(1/bo.length,bm);return _.map(bp,function(bu){return bb(bu,bm)})};A=function(bo){var bl,bn,bm;bn=[0,0,0];bl=_.max(_.map(bo,function(bp){return I(bp)}));bm=1/bl;return _.map(bo,function(bp){return[bm*bp[0],bm*bp[1],bm*bp[2]]})};ba=function(br,bo){var bw,bt,bv,bs,bn,bl,bx,bq,bp,bu,bm;bw=0.1;bl=a2(br);for(bq=0,bu=bo.length;bq<bu;bq++){bs=bo[bq];bv=(function(){var bA,by,bz;bz=[];for(bA=0,by=bs.length;bA<by;bA++){bx=bs[bA];bz.push(br[bx])}return bz})();bn=aj(bv);bt=be(bv);if(C(bn,bt)<0){bn=d(-1,bn)}for(bp=0,bm=bs.length;bp<bm;bp++){bx=bs[bp];bl[bx]=y(bl[bx],d(C(d(bw,bn),bb(bt,br[bx])),bn))}}return bl};m=function(br,bq){var bm,bl,bo,bp,bn,bs;console.log("Canonicalizing "+br.name+"...");bl=br.face;bm=br.getEdges();bn=br.xyz;bp=1;for(bo=0;0<=bq?bo<=bq:bo>=bq;0<=bq?bo++:bo--){bs=a2(bn);bn=Y(bn,bm);bn=a7(bn,bm);bn=ba(bn,bl);bp=_.max(_.map(_.zip(bn,bs),function(bu){var bt,bv;bt=bu[0],bv=bu[1];return I(bb(bt,bv))}));if(bp<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bp+"]");return bn};N=function(bo){var bp,bm,bn,bl;bm=bo.centers();for(bn=0,bl=bm.length;bn<bl;bn++){bp=bm[bn];bp=d(1/C(bp,bp),bp)}return bm};F=function(bn){var bB,bv,bo,bw,bl,bu,bA,bz,bx,bs,br,by,bm,bt,bq,bp;bB=[];bt=bn.face;for(bs=0,by=bt.length;bs<by;bs++){bw=bt[bs];bo=[0,0,0];bl=[0,0,0];bv=0;bq=bw.slice(-2),bA=bq[0],bz=bq[1];for(br=0,bm=bw.length;br<bm;br++){bx=bw[br];bo=y(bo,bn.xyz[bx]);bl=y(bl,aS(bn.xyz[bA],bn.xyz[bz],bn.xyz[bx]));bv+=at(bn.xyz[bA],bn.xyz[bz]);bp=[bz,bx],bA=bp[0],bz=bp[1]}bo=d(1/bw.length,bo);bl=bf(bl);bv=bv/bw.length;bu=az(d(C(bo,bl),bl));bB.push(d((1+bv)/2,bu))}return bB};f=function(bp,bm){var bn,bl,bo;bl=aF(bp);console.log("Pseudo-canonicalizing "+bp.name+"...");for(bn=0,bo=bm-1;0<=bo?bn<=bo:bn>=bo;0<=bo?bn++:bn--){bl.xyz=F(bp);bp.xyz=F(bl)}return bp.xyz};x=function(bp,bm){var bn,bl,bo;bl=aF(bp);console.log("Planarizing "+bp.name+"...");for(bn=0,bo=bm-1;0<=bo?bn<=bo:bn>=bo;0<=bo?bn++:bn--){bl.xyz=N(bp);bp.xyz=N(bl)}return bp.xyz};H=function(bN){var bM,bI,bD,bG,bL,bv,bO,bF,bB,bx,bK,br,bH,bC,bt,bu,bw,bE,bJ,bs,bq,bp,bm,bl,bA,by,bo,bz,bn;bw=999;bH=[];bC=[];bt=bN.length;bK=function(bP,bQ){return(bP||bQ)&&!(bP&&bQ)};bM=function(bR,bQ,bP){return(bQ[0]-bR[0])*(bP[1]-bR[1])-(bP[0]-bR[0])*(bQ[1]-bR[1])};bB=function(bR,bQ,bP){return bM(bR,bQ,bP)>0};bx=function(bR,bQ,bP){return bM(bR,bQ,bP)>=0};bD=function(bR,bQ,bP){return bM(bR,bQ,bP)===0};bI=function(bR,bQ,bP){if(bD(bR,bQ,bP)){return false}if(bR[0]!==bQ[0]){return(bR[0]<=bP[0])&&(bP[0]<=bQ[0])||(bR[0]>=bP[0])&&(bP[0]>=bQ[0])}else{return(bR[1]<=bP[1])&&(bP[1]<=bQ[1])||(bR[1]>=bP[1])&&(bP[1]>=bQ[1])}};bF=function(bS,bR,bQ,bP){if(bD(bS,bR,bQ)||bD(bS,bR,bP)||bD(bQ,bP,bS)||bD(bQ,bP,bR)){return false}return bK(bB(bS,bR,bQ),bB(bS,bR,bP))&&bK(bB(bQ,bP,bS),bB(bQ,bP,bR))};bO=function(bS,bR,bQ,bP){if(bF(bS,bR,bQ,bP)){return true}else{if(bI(bS,bR,bQ)||bI(bS,bR,bP)||bI(bQ,bP,bS)||bI(bQ,bP,bR)){return true}else{return false}}};bv=function(bR,bP){var bS,bQ;bQ=(bR+1+bt)%bt;bS=(bR-1+bt)%bt;if(bx(bN[bR],bN[bQ],bN[bS])){return bB(bN[bR],bN[bP],bN[bS])&&bB(bN[bP],bN[bR],bN[bQ])}return !(bx(bN[bR],bN[bP],bN[bQ])&&bx(bN[bP],bN[bR],bN[bS]))};bL=function(bQ,bP){var bS,bR;bS=0;while(true){bR=(bS+1+bt)%bt;if((bS!==bQ)&&(bR!==bQ)&&(bS!==bP)&&(bR!==bP)&&bF(bN[bQ],bN[bP],bN[bS],bN[bR])){return false}bS=(bS+1+bt)%bt;if(bS===0){break}}return true};bG=function(bQ,bP){return bv(bQ,bP)&&bv(bP,bQ)&&bL(bQ,bP)};bq=0;while(true){bp=(bq+1+bt)%bt;bs=(bq-1+bt)%bt;bC[bq]=bG(bs,bp);bq=(bq+1+bt)%bt;if(bq===0){break}}bJ=(function(){bn=[];for(var bQ=0,bP=bt-1;0<=bP?bQ<=bP:bQ>=bP;0<=bP?bQ++:bQ--){bn.push(bQ)}return bn}).apply(this);bE=bt;by=bw;bu=0;while(by>0&&bE>3){by-=1;bp=bu;bA=bw;while(true){bA-=1;br=false;if(bC[bp]){bm=(bp+1+bt)%bt;bl=(bm+1+bt)%bt;bq=(bp-1+bt)%bt;bs=(bq-1+bt)%bt;bH.push([bJ[bq],bJ[bm]]);bC[bq]=bG(bs,bm);bC[bm]=bG(bq,bl);bN=bN.slice(0,(bp+1)||9000000000).concat(bN.slice(bm));bJ=bJ.slice(0,(bp+1)||9000000000).concat(bJ.slice(bm));if(bs>bp){bs-=1}if(bq>bp){bq-=1}if(bm>bp){bm-=1}if(bl>bp){bl-=1}bt--;bu=bm;bE--;br=true}bp=(bp+1+bt)%bt;if(!(bA>0&&!br&&bp!==bu)){break}}}return bH};a=function(bm,bl){if(((bm[0]===bl[0])&&(bm[1]===bl[1])&&(bm[2]===bl[2]))||(bm[0]===bl[1])&&(bm[1]===bl[2])&&(bm[2]===bl[0])||(bm[0]===bl[2])&&(bm[1]===bl[0])&&(bm[2]===bl[1])){return true}else{return false}};t=function(bS,bF){var bC,bT,bE,bD,bA,bG,bQ,bm,bw,bU,bX,bW,bV,bR,bP,bO,bN,bB,bt,bs,br,bq,bp,bo,bn,bl,bM,bL,bK,bJ,bI,bH,bz,by,bx,bv,bu;bA=[];bm=[];bH=(function(){var bZ,bY;bY=[];for(bQ=0,bZ=bS.length-1;0<=bZ?bQ<=bZ:bQ>=bZ;0<=bZ?bQ++:bQ--){bY.push([bQ,(bQ+1)%bS.length])}return bY})();for(bR=0,bB=bH.length;bR<bB;bR++){bz=bH[bR],bW=bz[0],bV=bz[1];bA[bW]=[bV];bm[bV]=[bW]}for(bP=0,bt=bF.length;bP<bt;bP++){bT=bF[bP];bA[bT[0]].push(bT[1]);bA[bT[1]].push(bT[0]);bm[bT[0]].push(bT[1]);bm[bT[1]].push(bT[0])}bU=[];for(bO=0,bs=bF.length;bO<bs;bO++){bT=bF[bO];by=bA[bT[1]];for(bN=0,br=by.length;bN<br;bN++){bE=by[bN];bx=bm[bT[0]];for(bM=0,bq=bx.length;bM<bq;bM++){bD=bx[bM];if(bE===bD){bU.push([bT[0],bT[1],bE])}}}bv=bA[bT[0]];for(bL=0,bp=bv.length;bL<bp;bL++){bE=bv[bL];bu=bm[bT[1]];for(bK=0,bo=bu.length;bK<bo;bK++){bD=bu[bK];if(bE===bD){bU.push([bT[1],bT[0],bE])}}}}bX=[bU.pop()];for(bJ=0,bn=bU.length;bJ<bn;bJ++){bw=bU[bJ];bC=false;for(bI=0,bl=bX.length;bI<bl;bI++){bG=bX[bI];if(a(bw,bG)){bC=true;break}}if(!bC){bX.push(bw)}}return bX};Z=function(bq,bs){var bA,bv,bB,bz,by,bt,bx,bw,bu,bo,bm,bC,bD,br,bp,bn,bl;bs=bs||false;console.log("Triangulating faces of "+bq.name+"...");bt=new aM();bt.xyz=J(bq.xyz);bt.face_colors=[];br=K(bq.face);for(bo=0,bC=br.length;bo<bC;bo++){bp=br[bo],bz=bp[0],bB=bp[1];if(bB.length>3){bA=X((function(){var bG,bE,bF;bF=[];for(bG=0,bE=bB.length;bG<bE;bG++){bu=bB[bG];bF.push(bq.xyz[bu])}return bF})());bv=H(bA);bw=t(bB,bv);bn=K(bw);for(bm=0,bD=bn.length;bm<bD;bm++){bl=bn[bm],by=bl[0],bx=bl[1];bt.face.push([bB[bx[0]],bB[bx[1]],bB[bx[2]]]);if(bs){bt.face_colors.push(bq.face_colors[bz])}}}else{bt.face.push([bB[0],bB[1],bB[2]]);if(bs){bt.face_colors.push(bq.face_colors[bz])}}}bt.name=bq.name;return bt};ag=function(bl){var bq,br,bt,bo,bn,bs,bm,bp;br="";bp=bl.face;for(bo=0,bs=bp.length;bo<bs;bo++){bq=bp[bo];for(bn=0,bm=bq.length;bn<bm;bn++){bt=bq[bn];br+=""+bt+"->"}br+="\n"}return console.log(br)};B=function(){var bs,bp,bo,bn,br,bq,bm,bl;bn=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bp=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(br=0,bm=bp.length;br<bm;br++){bs=bp[br];console.log("Operator "+bs);for(bq=0,bl=bn.length;bq<bl;bq++){bo=bn[bq];console.log(bs+bo+":",af(bs+bo))}}return console.log("===== Done Testing Basic Ops =====")};ac={};bg=500;ax=400;O={};i=J(u);ak=J(u);S=800;z=5;bh=0;L=0.8;n=bg/2;au=ax/2;v=new Date();p=true;aP="rgba(255,255,255,1.0)";am="area";g="fillstroke";a9=0.5;an=false;V=0;U=0;aD=[1,0,0];a1=["dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aB=function(bn,bl){var bo,bm;bo=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bm=new bo();bm.append(bn);return saveAs(bm.getBlob("text/plain;charset="+document.characterSet),bl)};aq=["#ff3333","#33ff33","#3333ff","#ffff33","#ff33ff","#33ffff","#dddddd","#555555","#dd0000","#00dd00","#0000dd"];aN=["#ff8888","#dddddd","#777777","#aa3333","#ff0000","#ffffff","#aaaaaa"];k=["#ff8888","#ffeeee","#88ff88","#dd7777","#ff2222","#22ff22","#ee4422","#aaaaaa"];bk=function(bm){var bl;if(bm[0]==="#"){bm=bm.slice(1)}if(bm.length===3){bl=bm.split("").map(function(bn){return parseInt(bn+bn,16)/255})}else{bl=bm.match(/.{2}/g).map(function(bn){return parseInt(bn,16)/255})}return bl};aX=aN;ae=function(bl){if(bl<aX.length){return bk(aX[bl])}else{return bk(aX[aX.length-1])}};aU=function(bl,bo){var bm,bn;bn=W(100*bl);if(bn in bo){return bo[bn]}else{bm=ae(_.toArray(bo).length);bo[bn]=bm;return bm}};P=function(bl){var bt,bp,bo,br,bs,bm,bq,bn;bl.face_colors=[];bp={};bn=bl.face;for(bm=0,bq=bn.length;bm<bq;bm++){bo=bn[bm];if(am==="area"){br=(function(){var bw,bu,bv;bv=[];for(bw=0,bu=bo.length;bw<bu;bw++){bs=bo[bw];bv.push(bl.xyz[bs])}return bv})();bt=aU(bd(br),bp)}else{bt=ae(bo.length-3)}bl.face_colors.push(bt)}return bl};aL=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];aY=function(bo){var bl,bn,br,bq,bm,bp;bn=bo;for(bq=0,bm=aL.length;bq<bm;bq++){bp=aL[bq],br=bp[0],bl=bp[1];bn=bn.replace(br,bl)}console.log(""+bo+" executed as "+bn);return bn};af=function(bm){var bo,bl,bn;bn=new aM();bo=0;bl=aY(bm);if(bl.search(/([0-9]+)$/)!==-1){bo=1*RegExp.lastParen;bl=bl.slice(0,-RegExp.lastParen.length)}switch(bl.slice(-1)){case"T":bn=e();break;case"O":bn=ao();break;case"C":bn=ai();break;case"I":bn=a4();break;case"D":bn=ap();break;case"P":bn=R(bo);break;case"A":bn=aT(bo);break;case"Y":bn=bj(bo);break;default:return}while(bl!==""){bo=0;if(bl.search(/([0-9]+)$/)!==-1){bo=1*RegExp.lastParen;bl=bl.slice(0,-RegExp.lastParen.length)}switch(bl.slice(-1)){case"d":bn=aF(bn);break;case"k":bn=ab(bn,bo);break;case"a":bn=aE(bn);break;case"g":bn=a0(bn);break;case"p":bn=r(bn);break;case"r":bn=s(bn);break;case"K":bn.xyz=f(bn,bo===0?1:bo);break;case"C":bn.xyz=m(bn,bo===0?1:bo);break;case"A":bn.xyz=x(bn,bo===0?1:bo);break;case"n":bn=D(bn,bo);break;case"x":bn=aa(bn,bo);break;case"l":bn=aV(bn,bo);break;case"z":bn=Z(bn,false)}bl=bl.slice(0,-1)}bn.xyz=a7(bn.xyz,bn.getEdges());bn.xyz=A(bn.xyz);bn=P(bn);return bn};bi=function(){var bl,bq,bp,bo,bn,bm;bm={};bl=/\+/g;bn=/([^&=]+)=?([^&]*)/g;bq=function(br){return decodeURIComponent(br.replace(bl," "))};bo=window.location.search.substring(1);while(bp=bn.exec(bo)){bm[bq(bp[1])]=bq(bp[2])}return bm};aH=function(){var bl;bl=$("#poly");bl.width(bg);bl.height(ax);ac=bl[0].getContext("2d");ac.lineWidth=a9;if(p){return ac.clearRect(0,0,bg,ax)}else{ac.clearRect(0,0,bg,ax);ac.fillStyle=aP;return ac.fillRect(0,0,bg,ax)}};aJ=function(){if(p){return ac.clearRect(0,0,bg,ax)}else{ac.clearRect(0,0,bg,ax);ac.fillStyle=aP;return ac.fillRect(0,0,bg,ax)}};aO=function(bq){var bp,bl,br,bo,bn,bm;bp=bq.centers();br=_.zip(bp,(function(){bm=[];for(var bt=0,bs=bq.face.length-1;0<=bs?bt<=bs:bt>=bs;0<=bs?bt++:bt--){bm.push(bt)}return bm}).apply(this)).sort(function(bt,bs){return bt[0][2]-bs[0][2]}).map(function(bs){return bs[1]});bq.face=(function(){var bu,bs,bt;bt=[];for(bu=0,bs=br.length;bu<bs;bu++){bl=br[bu];bt.push(bq.face[bl])}return bt})();return bq.face_colors=(function(){var bu,bs,bt;bt=[];for(bu=0,bs=br.length;bu<bs;bu++){bl=br[bu];bt.push(bq.face_colors[bl])}return bt})()};Q=function(bu,bC){var bo,bw,bv,bB,br,bs,bA,bt,bz,bx,bp,bm,bD,bE,by,bq,bn,bl;bC||(bC=[3,3,3]);bs=_.map(bu.xyz,function(bF){return bF});bu.xyz=_.map(bu.xyz,function(bF){return q(i,bF)});aO(bu);by=K(bu.face);for(bp=0,bD=by.length;bp<bD;bp++){bq=by[bp],bB=bq[0],bw=bq[1];ac.beginPath();bt=bw[bw.length-1];bn=w(y(bC,bu.xyz[bt]),z,bh,L,S),bz=bn[0],bx=bn[1];ac.moveTo(bz+n,bx+au);for(bm=0,bE=bw.length;bm<bE;bm++){bA=bw[bm];bl=w(y(bC,bu.xyz[bA]),z,bh,L,S),bz=bl[0],bx=bl[1];ac.lineTo(bz+n,bx+au)}bo=bu.face_colors[bB];bv=(function(){var bG,bH,bF;bF=[];for(bG=0,bH=bw.length;bG<bH;bG++){bA=bw[bG];bF.push(bu.xyz[bA])}return bF})();br=C(aj(bv),bf([1,-1,0]));bo=d((br/2+0.5)*0.7+0.3,bo);if(g==="fill"||g==="fillstroke"){ac.fillStyle="rgba("+(W(bo[0]*255))+", "+(W(bo[1]*255))+", "+(W(bo[2]*255))+", "+1+")";ac.fill();ac.strokeStyle="rgba("+(W(bo[0]*255))+", "+(W(bo[1]*255))+", "+(W(bo[2]*255))+", "+1+")";ac.stroke()}if(g==="fillstroke"){ac.fillStyle="rgba("+(W(bo[0]*255))+", "+(W(bo[1]*255))+", "+(W(bo[2]*255))+", "+1+")";ac.fill();ac.strokeStyle="rgba(0,0,0, .3)";ac.stroke()}if(g==="stroke"){ac.strokeStyle="rgba(0,0,0, .8)";ac.stroke()}}return bu.xyz=bs};ay=function(){var bn,bq,bp,bm,bo,br,bl;aJ();bo=K(O);bl=[];for(bp=0,bm=bo.length;bp<bm;bp++){br=bo[bp],bn=br[0],bq=br[1];bl.push(Q(bq,[0+3*bn,0,3]))}return bl};bc=function(){var bm,bn,bq,bp,bl,bo,br;aJ();bm=(2*Math.PI)/180*v.getSeconds()*0.1;bo=K(O);for(bp=0,bl=bo.length;bp<bl;bp++){br=bo[bp],bn=br[0],bq=br[1];Q(bq,[0+3*bn,0,3])}return setTimeout(bc,100)};$(function(){var bm,bl;aH();bl=bi();if("recipe" in bl){bm=[bl.recipe];$("#spec").val(bm)}else{bm=[a8(a1)];$("#spec").val(bm)}O=_.map(bm,function(bn){return af(bn)});ay();$("#spec").change(function(bn){bm=$("#spec").val().split(/\s+/g).slice(0,2);O=_.map(bm,function(bo){return af(bo)});return ay()});$("#poly").mousewheel(function(bp,bq,bo,bn){bp.preventDefault();S*=(10+bq)/10;return ay()});$("#poly").mousedown(function(bn){var bo;bn.preventDefault();an=true;V=bn.clientX-$(this).offset().left;U=bn.clientY-$(this).offset().top;bo=aI(V,U,n,au,z,bh,L,S);if(bo[0]*bo[1]*bo[2]*0===0){aD=bo}return ak=J(i)});$("#poly").mouseup(function(bn){bn.preventDefault();return an=false});$("#poly").mouseleave(function(bn){bn.preventDefault();return an=false});$("#poly").mousemove(function(bq){var bo,bn,bp;bq.preventDefault();if(an){bo=bq.clientX-$(this).offset().left;bn=bq.clientY-$(this).offset().top;bp=aI(bo,bn,n,au,z,bh,L,S);if(bp[0]*bp[1]*bp[2]*0===0&&aD[0]*aD[1]*aD[2]*0===0){i=aC(aA(aD,bp),ak)}return ay()}});$("#strokeonly").click(function(bn){g="stroke";return ay()});$("#fillonly").click(function(bn){g="fill";return ay()});$("#fillandstroke").click(function(bn){g="fillstroke";return ay()});$("#siderot").click(function(bn){i=aQ(aG/2,0,1,0);return ay()});$("#toprot").click(function(bn){i=aQ(aG/2,1,0,0);return ay()});$("#frontrot").click(function(bn){i=h(0,0,0);return ay()});$("#pngsavebutton").click(function(bq){var bp,bo,bn;bp=$("#poly")[0];bn=$("#spec").val().split(/\s+/g)[0];bo="polyhedronisme-"+bn+".png";return bp.toBlob(function(br){return saveAs(br,bo)})});$("#objsavebutton").click(function(bq){var bo,bp,bn;bp=O[0].toOBJ();bn=$("#spec").val().split(/\s+/g)[0];bo="polyhedronisme-"+bn+".obj";return aB(bp,bo)});return $("#x3dsavebutton").click(function(bq){var bo,bn,bp,br;bp=Z(O[0],true);br=bp.toVRML();bn=$("#spec").val().split(/\s+/g)[0];bo="polyhedronisme-"+bn+".wrl";return aB(br,bo)})})}).call(this);