(function(){var o,aO,aw,bf,al,a0,U,T,aC,am,aW,aF,ac,aY,x,w,aD,bb,aS,L,av,bd,f,l,aI,I,aT,bc,a1,F,au,ab,a8,ah,ao,s,an,B,ax,P,aE,ar,J,Z,t,a4,ak,ae,G,aX,az,N,h,aj,u,aZ,bj,a3,aG,C,D,aH,aa,H,a2,aQ,aB,d,p,ai,ap,aq,aR,O,ad,bh,v,K,y,bg,R,a9,ag,aL,a5,Q,W,q,bi,aJ,a7,a6,ay,M,E,r,z,g,V,aM,j,aA,aV,aN,aK,S,aU,ba,b,i,X,A,e,af,a,Y,k,be,aP,c,m,at,n;aJ=Math.random;V=Math.round;ak=Math.floor;S=Math.sqrt;aV=Math.sin;F=Math.cos;b=Math.tan;L=Math.asin;aY=Math.acos;av=Math.atan;a5=Math.pow;ac=Math.abs;aF=Math.PI;J=function(bl){var bm,bn,bk;bk=[];for(bm=0,bn=bl.length-1;0<=bn?bm<=bn:bm>=bn;0<=bn?bm++:bm--){bk.push([bm,bl[bm]])}return bk};I=function(bm){var bl,bk;if(!(bm!=null)||typeof bm!=="object"){return bm}bk=new bm.constructor();for(bl in bm){bk[bl]=I(bm[bl])}return bk};a7=function(bl){var bk;bk=ak(aJ()*bl.length);return bl[bk]};d=function(bl,bk){return[bl*bk[0],bl*bk[1],bl*bk[2]]};n=function(bl,bk){return[bl[0]*bk[0],bl[1]*bk[1],bl[2]*bk[2]]};x=function(bl,bk){return[bl[0]+bk[0],bl[1]+bk[1],bl[2]+bk[2]]};ba=function(bl,bk){return[bl[0]-bk[0],bl[1]-bk[1],bl[2]-bk[2]]};B=function(bl,bk){return bl[0]*bk[0]+bl[1]*bk[1]+bl[2]*bk[2]};au=function(bl,bk){return[bl[1]*bk[2]-bl[2]*bk[1],bl[2]*bk[0]-bl[0]*bk[2],bl[0]*bk[1]-bl[1]*bk[0]]};H=function(bk){return S(B(bk,bk))};a2=function(bk){return B(bk,bk)};be=function(bk){return d(1/S(a2(bk)),bk)};aQ=function(bl,bk){return d(1/2,x(bl,bk))};k=function(bm,bl,bk){return[(1-bk)*bm[0]+bk*bl[0],(1-bk)*bm[1]+bk*bl[1],(1-bk)*bm[2]+bk*bl[2]]};aq=function(bl,bk){return k(bl,bk,1/3)};ay=function(bk){return d(1/a2(bk),bk)};i=function(bm,bl){var bk;bk=ba(bl,bm);return ba(bm,d(B(bk,bm)/a2(bk),bk))};ar=function(bl,bk){return S(a2(i(bl,bk)))};aR=function(bo,bn,bm){var bl,bk;bl=ba(bn,bo);bk=ba(bm,bn);return au(bl,bk)};D=function(br,bq,bp){var bv,bu,bt,bo,bn,bm,bs,bl,bk;for(bo=0,bs=br.length;bo<bs;bo++){bv=br[bo];for(bn=0,bl=bq.length;bn<bl;bn++){bu=bq[bn];if(bv===bu){for(bm=0,bk=bp.length;bm<bk;bm++){bt=bp[bm];if(bv===bt){return bv}}}}}return null};bd=function(bo){var bm,bl,bn,bk;bm=[0,0,0];for(bn=0,bk=bo.length;bn<bk;bn++){bl=bo[bn];bm=x(bm,bl)}return d(1/bo.length,bm)};ai=function(bo){var bk,bs,bq,bp,bm,br,bn,bl;bk=[0,0,0];bn=bo.slice(-2),bs=bn[0],bq=bn[1];for(bm=0,br=bo.length;bm<br;bm++){bp=bo[bm];bk=x(bk,aR(bs,bq,bp));bl=[bq,bp],bs=bl[0],bq=bl[1]}return be(bk)};bc=function(bo){var bk,bs,bq,bp,bm,br,bn,bl;bk=0;bn=bo.slice(0,2),bs=bn[0],bq=bn[1];bl=bo.slice(2);for(bm=0,br=bl.length;bm<br;bm++){bp=bl[bm];bk+=H(au(ba(bq,bs),ba(bp,bs)));bq=bp}return bk};W=function(br){var bp,bl,bk,bo,bs,bt,bn,bq,bm;bo=I(br);bt=br[0];bo=_.map(bo,function(bu){return bu-bt});bl=ai(br);bp=be(bd(br));bk=au(bl,bp);bm=[];for(bn=0,bq=bo.length;bn<bq;bn++){bs=bo[bn];bm.push([B(bl,bs),B(bk,bs)])}return bm};a1=function(bm){var bl,bk,bn;bk=new Array(bm.length);for(bl=0,bn=bm.length-1;0<=bn?bl<=bn:bl>=bn;0<=bn?bl++:bl--){bk[bl]=bm[bl].slice(0)}return bk};p=function(bl,bk){return[bl[0][0]*bk[0]+bl[0][1]*bk[1]+bl[0][2]*bk[2],bl[1][0]*bk[0]+bl[1][1]*bk[1]+bl[1][2]*bk[2],bl[2][0]*bk[0]+bl[2][1]*bk[1]+bl[2][2]*bk[2]]};aB=function(bk,bl){return[[bk[0][0]*bl[0][0]+bk[0][1]*bl[1][0]+bk[0][2]*bl[2][0],bk[0][0]*bl[0][1]+bk[0][1]*bl[1][1]+bk[0][2]*bl[2][1],bk[0][0]*bl[0][2]+bk[0][1]*bl[1][2]+bk[0][2]*bl[2][2]],[bk[1][0]*bl[0][0]+bk[1][1]*bl[1][0]+bk[1][2]*bl[2][0],bk[1][0]*bl[0][1]+bk[1][1]*bl[1][1]+bk[1][2]*bl[2][1],bk[1][0]*bl[0][2]+bk[1][1]*bl[1][2]+bk[1][2]*bl[2][2]],[bk[2][0]*bl[0][0]+bk[2][1]*bl[1][0]+bk[2][2]*bl[2][0],bk[2][0]*bl[0][1]+bk[2][1]*bl[1][1]+bk[2][2]*bl[2][1],bk[2][0]*bl[0][2]+bk[2][1]*bl[1][2]+bk[2][2]*bl[2][2]]]};t=[[1,0,0],[0,1,0],[0,0,1]];g=function(bo,bm,bn){var bp,bl,bk;bp=[[F(bo),-1*aV(bo),0],[aV(bo),F(bo),0],[0,0,1]];bk=[[F(bm),0,-1*aV(bm)],[0,1,0],[aV(bm),0,F(bm)]];bl=[[1,0,0],[0,F(bn),-1*aV(bn)],[0,aV(bn),F(bn)]];return aB(bl,aB(bk,bp))};aP=function(bo,bx,bv,bs){var br,bl,bm,bw,bu,bk,bt,bp,bq,bn;bo/=2;bw=aV(bo);br=F(bo);bu=bw*bw;bl=H([bx,bv,bs]);if(bl===0){bq=[0,0,1],bx=bq[0],bv=bq[1],bs=bq[2]}if(bl!==1){bn=be([bx,bv,bs]),bx=bn[0],bv=bn[1],bs=bn[2]}if(bx===1&&bv===0&&bs===0){bm=[[1,0,0],[0,1-2*bu,2*bw*br],[0,-2*bw*br,1-2*bu]]}else{if(bx===0&&bv===1&&bs===0){bm=[[1-2*bu,0,-2*bw*br],[0,1,0],[2*bw*br,0,1-2*bu]]}else{if(bx===0&&bv===0&&bs===1){bm=[[1-2*bu,2*bw*br,0],[-2*bw*br,1-2*bu,0],[0,0,1]]}else{bk=bx*bx;bt=bv*bv;bp=bs*bs;bm=[[1-2*(bt+bp)*bu,2*(bx*bv*bu+bs*bw*br),2*(bx*bs*bu-bv*bw*br)],[2*(bv*bx*bu-bs*bw*br),1-2*(bp+bk)*bu,2*(bv*bs*bu+bx*bw*br)],[2*(bs*bx*bu+bv*bw*br),2*(bs*bv*bu-bx*bw*br),1-2*(bk+bt)*bu]]}}}return bm};v=function(bm,bl,bn,bq,bk){var bo,bp;bp=(bl*bq-bn)/(1-bq);bo=bk*bq/(1-bq);return[bo*bm[0]/(bm[2]+bp),bo*bm[1]/(bm[2]+bp)]};aH=function(br,bo,bu,bs,by,bn,bm,bl){var bx,bk,bt,bp,bv,bA,bC,bq,bw,bz,bB;bw=(by*bm-bn)/(1-bm);bx=bl*bm/(1-bm);bt=br-bu;bA=bo-bs;bk=bx*bx;bz=bw*bw;bp=bt*bt;bC=bA*bA;bv=(2*bx*bt*bw+S(4*bk*bp*bz+4*bp*(bk+bp+bC)*(1-bz)))/(2*(bk+bp+bC));bq=(bx*bA*bw)/(bk+bp+bC)+(bA*S(4*bk*bz+4*(bk+bp+bC)*(1-bz)))/(2*(bk+bp+bC));bB=S(1-bv*bv-bq*bq);return[bv,bq,bB]};az=function(bm,bl){var bn,bk;bk=au(bm,bl);bn=aY(B(bm,bl));return aP(-1*bn,bk[0],bk[1],bk[2])};a4=function(bn){var bl,bp,bo,bm,bk;bl=[];bp=bn.slice(-1)[0];for(bm=0,bk=bn.length;bm<bk;bm++){bo=bn[bm];bl.push([bp,bo]);bp=bo}return bl};c=function(bl){var br,bq,bu,bs,bo,bn,bt,bk,bp,bm;bs=[];bp=J(bl.face);for(bo=0,bt=bp.length;bo<bt;bo++){bm=bp[bo],bq=bm[0],br=bm[1];for(bn=0,bk=br.length;bn<bk;bn++){bu=br[bn];bs[bu]=bl.face_colors[bq]}}return bs};aL=(function(){function bk(){this.face=new Array();this.xyz=new Array();this.name="null polyhedron"}bk.prototype.data=function(){var bl;bl=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bl+" edges, "+this.xyz.length+" vertices)"};bk.prototype.getEdges=function(){var bv,br,bt,bs,bm,bq,bp,bw,bo,bn,bu,bl;bq={};bw=[];br=_.map(this.face,a4);for(bo=0,bu=br.length;bo<bu;bo++){bm=br[bo];for(bn=0,bl=bm.length;bn<bl;bn++){bs=bm[bn];if(bs[0]<bs[1]){bv=bs[0],bt=bs[1]}else{bt=bs[0],bv=bs[1]}bq[bv+"~"+bt]=bs}}for(bp in bq){bs=bq[bp];bw.push(bs)}return bw};bk.prototype.centers=function(){var bq,br,bn,bt,bo,bm,bs,bl,bp;bq=[];bp=this.face;for(bo=0,bs=bp.length;bo<bs;bo++){br=bp[bo];bn=[0,0,0];for(bm=0,bl=br.length;bm<bl;bm++){bt=br[bm];bn=x(bn,this.xyz[bt])}bq.push(d(1/br.length,bn))}return bq};bk.prototype.normals=function(){var bp,bq,bm,bo,bl,bn;bq=[];bn=this.face;for(bo=0,bl=bn.length;bo<bl;bo++){bp=bn[bo];bq.push(ai((function(){var bt,br,bs;bs=[];for(bt=0,br=bp.length;bt<br;bt++){bm=bp[bt];bs.push(this.xyz[bm])}return bs}).call(this)))}return bq};bk.prototype.toOBJ=function(){var bx,bw,bm,by,bA,bu,bt,bs,bq,bz,bn,bl,bB,bv,br,bp,bo;by="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";by+="group "+this.name+"\n";by+="#vertices\n";bv=this.xyz;for(bu=0,bz=bv.length;bu<bz;bu++){bA=bv[bu];by+="v "+bA[0]+" "+bA[1]+" "+bA[2]+"\n"}by+="#normal vector defs \n";br=this.face;for(bt=0,bn=br.length;bt<bn;bt++){bx=br[bt];bm=ai((function(){var bD,bE,bC;bC=[];for(bD=0,bE=bx.length;bD<bE;bD++){bA=bx[bD];bC.push(this.xyz[bA])}return bC}).call(this));by+="vn "+bm[0]+" "+bm[1]+" "+bm[2]+"\n"}by+="#face defs \n";bp=J(this.face);for(bs=0,bl=bp.length;bs<bl;bs++){bo=bp[bs],bw=bo[0],bx=bo[1];by+="f ";for(bq=0,bB=bx.length;bq<bB;bq++){bA=bx[bq];by+=""+(bA+1)+"//"+(bw+1)+" "}by+="\n"}return by};bk.prototype.toX3D=function(){var bp,bA,bv,bx,by,bt,bs,br,bo,bw,bm,bl,bz,bu,bq,bn;bp=0.01;by='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bu=this.face;for(bt=0,bw=bu.length;bt<bw;bt++){bv=bu[bt];for(bs=0,bm=bv.length;bs<bm;bs++){bx=bv[bs];by+=""+bx+" "}by+="-1\n"}by+='">\n';by+='<Color color="';bq=c(this);for(br=0,bl=bq.length;br<bl;br++){bA=bq[br];by+=""+bA[0]+" "+bA[1]+" "+bA[2]+" "}by+='"/>';by+='<Coordinate point="';bn=this.xyz;for(bo=0,bz=bn.length;bo<bz;bo++){bx=bn[bo];by+=""+(bx[0]*bp)+" "+(bx[1]*bp)+" "+(bx[2]*bp)+" "}by+='"/>\n';by+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return by};bk.prototype.toVRML=function(){var bp,bA,bv,bx,by,bt,bs,br,bo,bw,bm,bl,bz,bu,bq,bn;bp=0.01;by='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bu=this.xyz;for(bt=0,bw=bu.length;bt<bw;bt++){bx=bu[bt];by+=""+(bx[0]*bp)+" "+(bx[1]*bp)+" "+(bx[2]*bp)+","}by=by.slice(0,-1);by+="    ]\n}\ncolor Color\n{\n  color\n  [";bq=this.face_colors;for(bs=0,bm=bq.length;bs<bm;bs++){bA=bq[bs];by+=""+bA[0]+" "+bA[1]+" "+bA[2]+" ,"}by=by.slice(0,-1);by+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bn=this.face;for(br=0,bl=bn.length;br<bl;br++){bv=bn[br];for(bo=0,bz=bv.length;bo<bz;bo++){bx=bv[bo];by+=""+bx+", "}by+="-1,"}by=by.slice(0,-1);by+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return by};return bk})();e=function(){var bk;bk=new aL();bk.name="T";bk.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bk.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bk};ap=function(){var bk;bk=new aL();bk.name="O";bk.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bk.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bk};ah=function(){var bk;bk=new aL();bk.name="C";bk.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bk.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bk};a3=function(){var bk;bk=new aL();bk.name="I";bk.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bk.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bk};an=function(){var bk;bk=new aL();bk.name="D";bk.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bk.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bk};Q=function(bo){var bx,bw,bk,bm,bu,bt,bv,br,bp,bn,bl,bs,bq;bm=2*aF/bo;bx=Math.sin(bm/2);bk=new aL();bk.name="P"+bo;for(bw=0,bv=bo-1;0<=bv?bw<=bv:bw>=bv;0<=bv?bw++:bw--){bk.xyz.push([F(bw*bm),aV(bw*bm),bx])}for(bw=0,br=bo-1;0<=br?bw<=br:bw>=br;0<=br?bw++:bw--){bk.xyz.push([F(bw*bm),aV(bw*bm),-bx])}bk.face.push((function(){bs=[];for(var by=bp=bo-1;bp<=0?by<=0:by>=0;bp<=0?by++:by--){bs.push(by)}return bs}).apply(this));bk.face.push((function(){bq=[];for(var by=bo,bz=2*bo-1;bo<=bz?by<=bz:by>=bz;bo<=bz?by++:by--){bq.push(by)}return bq}).apply(this));for(bw=0,bl=bo-1;0<=bl?bw<=bl:bw>=bl;0<=bl?bw++:bw--){bk.face.push([bw,(bw+1)%bo,(bw+1)%bo+bo,bw+bo])}bk.xyz=w(bk,1);return bk};aS=function(bp){var bz,by,bx,bl,bk,bn,bv,bu,bw,bs,bq,bo,bm,bt,br;bn=2*aF/bp;by=S(1-4/(4+2*F(bn/2)-2*F(bn)));bk=S(1-by*by);bz=S(by*by+a5(bk*F(bn/2),2));bk=bk/bz;by=by/bz;bl=new aL();bl.name="A"+bp;for(bx=0,bw=bp-1;0<=bw?bx<=bw:bx>=bw;0<=bw?bx++:bx--){bl.xyz.push([bk*F(bx*bn),bk*aV(bx*bn),by])}for(bx=0,bs=bp-1;0<=bs?bx<=bs:bx>=bs;0<=bs?bx++:bx--){bl.xyz.push([bk*F((bx+0.5)*bn),bk*aV((bx+0.5)*bn),-by])}bl.face.push((function(){bt=[];for(var bA=bq=bp-1;bq<=0?bA<=0:bA>=0;bq<=0?bA++:bA--){bt.push(bA)}return bt}).apply(this));bl.face.push((function(){br=[];for(var bA=bp,bB=2*bp-1;bp<=bB?bA<=bB:bA>=bB;bp<=bB?bA++:bA--){br.push(bA)}return br}).apply(this));for(bx=0,bm=bp-1;0<=bm?bx<=bm:bx>=bm;0<=bm?bx++:bx--){bl.face.push([bx,(bx+1)%bp,bx+bp]);bl.face.push([bx,bx+bp,(bp+bx-1)%bp+bp])}bl.xyz=w(bl,1);return bl};bi=function(bm){var bt,bs,bk,bl,bq,br,bo,bn,bp;bl=2*aF/bm;bt=1;bk=new aL();bk.name="Y"+bm;for(bs=0,br=bm-1;0<=br?bs<=br:bs>=br;0<=br?bs++:bs--){bk.xyz.push([F(bs*bl),aV(bs*bl),0.2])}bk.xyz.push([0,0,-1*bt]);bk.face.push((function(){bp=[];for(var bu=bo=bm-1;bo<=0?bu<=0:bu>=0;bo<=0?bu++:bu--){bp.push(bu)}return bp}).apply(this));for(bs=0,bn=bm-1;0<=bn?bs<=bn:bs>=bn;0<=bn?bs++:bs--){bk.face.push([bs,(bs+1)%bm,bm])}bk.xyz=f(bk,3);return bk};ag=(function(){function bk(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bk.prototype.newV=function(bm,bl){if(this.verts[bm]===void 0){this.verts[bm]=0;return this.xyzs[bm]=bl}};bk.prototype.newFlag=function(bl,bn,bm){if(this.flags[bl]===void 0){this.flags[bl]={}}return this.flags[bl][bn]=bm};bk.prototype.topoly=function(){var bm,br,bu,bq,bo,bl,bs,bt,bp,bn;bl=new aL();bm=0;bp=this.verts;for(bq in bp){bs=bp[bq];bl.xyz[bm]=this.xyzs[bq];this.verts[bq]=bm;bm++}bm=0;bn=this.flags;for(bq in bn){br=bn[bq];bl.face[bm]=[];for(bo in br){bs=br[bo];bt=bs;break}bs=bt;bl.face[bm].push(this.verts[bs]);bs=this.flags[bq][bs];bu=0;while(bs!==bt){bl.face[bm].push(this.verts[bs]);bs=this.flags[bq][bs];bu++;if(bu>1000){console.log("Bad flag spec, have a neverending face:",bq,this.flags[bq]);break}}bm++}bl.name="unknown polyhedron";return bl};return bk})();aa=function(bu,bA){var bt,bE,bD,bB,bH,bs,bC,bw,by,bz,bx,br,bo,bp,bm,bk,bG,bI,bF,bv,bq,bn,bl;console.log("Taking kis of "+(bA===0?"":bA)+"-sided faces of "+bu.name+"...");bB=new ag();bv=J(bu.xyz);for(bp=0,bG=bv.length;bp<bG;bp++){bq=bv[bp],bC=bq[0],bz=bq[1];bB.newV("v"+bC,bz)}by=bu.normals();bE=bu.centers();bs=false;bn=J(bu.face);for(bm=0,bI=bn.length;bm<bI;bm++){bl=bn[bm],bC=bl[0],bD=bl[1];br="v"+bD[bD.length-1];for(bk=0,bF=bD.length;bk<bF;bk++){bx=bD[bk];bo="v"+bx;if(bD.length===bA||bA===0){bs=true;bt="apex"+bC;bH=""+bC+br;bB.newV(bt,x(bE[bC],d(0.2,by[bC])));bB.newFlag(bH,br,bo);bB.newFlag(bH,bo,bt);bB.newFlag(bH,bt,br)}else{bB.newFlag(""+bC,br,bo)}br=bo}}if(!bs){console.log("No "+bA+"-fold components were found.")}bw=bB.topoly();bw.name="k"+(bA===0?"":bA)+bu.name;return bw};aD=function(bl){var bv,bw,bu,bm,bq,bA,bz,bx,bs,br,by,bk,bt,bp,bo,bn;console.log("Taking ambo of "+bl.name+"...");bm=function(bC,bB){if(bC<bB){return bC+"_"+bB}else{return bB+"_"+bC}};bw=new ag();bt=J(bl.face);for(bs=0,by=bt.length;bs<by;bs++){bp=bt[bs],bu=bp[0],bv=bp[1];bo=bv.slice(-2),bA=bo[0],bz=bo[1];for(br=0,bk=bv.length;br<bk;br++){bx=bv[br];if(bA<bz){bw.newV(bm(bA,bz),aQ(bl.xyz[bA],bl.xyz[bz]))}bw.newFlag("orig"+bu,bm(bA,bz),bm(bz,bx));bw.newFlag("dual"+bz,bm(bz,bx),bm(bA,bz));bn=[bz,bx],bA=bn[0],bz=bn[1]}}bq=bw.topoly();bq.name="a"+bl.name;return bq};aZ=function(by){var bG,bF,bD,bK,bE,bC,bA,bB,bx,bu,br,bv,bs,bp,bn,bJ,bL,bI,bH,bz,bm,bw,bt,bq,bo,bl,bk,bN,bM;console.log("Taking gyro of "+by.name+"...");bD=new ag();bz=J(by.xyz);for(bv=0,bJ=bz.length;bv<bJ;bv++){bw=bz[bv],bE=bw[0],bB=bw[1];bD.newV("v"+bE,be(bB))}bG=by.centers();bt=J(by.face);for(bs=0,bL=bt.length;bs<bL;bs++){bq=bt[bs],bE=bq[0],bF=bq[1];bD.newV("center"+bE,be(bG[bE]))}bo=J(by.face);for(bp=0,bI=bo.length;bp<bI;bp++){bl=bo[bp],bE=bl[0],bF=bl[1];bk=bF.slice(-2),bx=bk[0],bu=bk[1];bN=J(bF);for(bn=0,bH=bN.length;bn<bH;bn++){bM=bN[bn],bC=bM[0],bB=bM[1];br=bB;bD.newV(bx+"~"+bu,aq(by.xyz[bx],by.xyz[bu]));bK=bE+"f"+bx;bD.newFlag(bK,"center"+bE,bx+"~"+bu);bD.newFlag(bK,bx+"~"+bu,bu+"~"+bx);bD.newFlag(bK,bu+"~"+bx,"v"+bu);bD.newFlag(bK,"v"+bu,bu+"~"+br);bD.newFlag(bK,bu+"~"+br,"center"+bE);bm=[bu,br],bx=bm[0],bu=bm[1]}}bA=bD.topoly();bA.name="g"+by.name;return bA};q=function(bv){var bB,bz,bD,bA,bx,by,bu,br,bo,bs,bp,bm,bC,bF,bE,bw,bt,bq,bn,bl,bk;console.log("Taking propellor of "+bv.name+"...");bz=new ag();bw=J(bv.xyz);for(bs=0,bC=bw.length;bs<bC;bs++){bt=bw[bs],bA=bt[0],by=bt[1];bz.newV("v"+bA,be(by))}bq=J(bv.face);for(bp=0,bF=bq.length;bp<bF;bp++){bn=bq[bp],bA=bn[0],bB=bn[1];bl=bB.slice(-2),bu=bl[0],br=bl[1];for(bm=0,bE=bB.length;bm<bE;bm++){by=bB[bm];bo=""+by;bz.newV(bu+"~"+br,aq(bv.xyz[bu],bv.xyz[br]));bD=""+bA+"f"+br;bz.newFlag("v"+bA,bu+"~"+br,br+"~"+bo);bz.newFlag(bD,bu+"~"+br,br+"~"+bu);bz.newFlag(bD,br+"~"+bu,"v"+br);bz.newFlag(bD,"v"+br,br+"~"+bo);bz.newFlag(bD,br+"~"+bo,bu+"~"+br);bk=[br,bo],bu=bk[0],br=bk[1]}}bx=bz.topoly();bx.name="p"+bv.name;return bx};r=function(bm){var bk,bl,bn;console.log("Taking reflection of "+bm.name+"...");for(bk=0,bl=bm.xyz.length-1;0<=bl?bk<=bl:bk>=bl;0<=bl?bk++:bk--){bm.xyz[bk]=d(-1,bm.xyz[bk])}for(bk=0,bn=bm.face.length-1;0<=bn?bk<=bn:bk>=bn;0<=bn?bk++:bk--){bm.face[bk]=bm.face[bk].reverse()}bm.name="r"+bm.name;return bm};aE=function(bx){var bF,bL,bE,by,bC,bD,bB,bA,bw,bt,bu,br,bp,bn,bJ,bK,bI,bH,bG,bl,bz,bv,bs,bq,bo,bm,bk;console.log("Taking dual of "+bx.name+"...");bC=new ag();by=[];for(bD=0,bz=bx.xyz.length-1;0<=bz?bD<=bz:bD>=bz;0<=bz?bD++:bD--){by[bD]={}}bv=J(bx.face);for(bu=0,bJ=bv.length;bu<bJ;bu++){bs=bv[bu],bD=bs[0],bE=bs[1];bw=bE[bE.length-1];for(br=0,bK=bE.length;br<bK;br++){bt=bE[br];by[bw]["v"+bt]=""+bD;bw=bt}}bF=bx.centers();for(bD=0,bq=bx.face.length-1;0<=bq?bD<=bq:bD>=bq;0<=bq?bD++:bD--){bC.newV(""+bD,bF[bD])}bo=J(bx.face);for(bp=0,bI=bo.length;bp<bI;bp++){bm=bo[bp],bD=bm[0],bE=bm[1];bw=bE[bE.length-1];for(bn=0,bH=bE.length;bn<bH;bn++){bt=bE[bn];bC.newFlag(bw,by[bt]["v"+bw],""+bD);bw=bt}}bL=bC.topoly();bA=[];bk=bL.face;for(bl=0,bG=bk.length;bl<bG;bl++){bE=bk[bl];bB=D(bx.face[bE[0]],bx.face[bE[1]],bx.face[bE[2]]);bA[bB]=bE}bL.face=bA;if(bx.name[0]!=="d"){bL.name="d"+bx.name}else{bL.name=bx.name.slice(1)}return bL};C=function(bx,bD){var bH,bG,bE,bM,bw,bF,bz,bB,bC,bA,bv,bs,bt,bq,bo,bm,bL,bN,bK,bJ,bI,bk,by,bu,br,bp,bn,bl;console.log("Taking inset of "+(bD===0?"":bD)+"-sided faces of "+bx.name+"...");bE=new ag();by=J(bx.xyz);for(bt=0,bL=by.length;bt<bL;bt++){bu=by[bt],bF=bu[0],bC=bu[1];bE.newV("v"+bF,bC)}bB=bx.normals();bH=bx.centers();br=J(bx.face);for(bq=0,bN=br.length;bq<bN;bq++){bp=br[bq],bF=bp[0],bG=bp[1];if(bG.length===bD||bD===0){for(bo=0,bK=bG.length;bo<bK;bo++){bA=bG[bo];bE.newV("f"+bF+"v"+bA,x(aQ(bx.xyz[bA],bH[bF]),d(-0.2,bB[bF])))}}}bw=false;bn=J(bx.face);for(bm=0,bJ=bn.length;bm<bJ;bm++){bl=bn[bm],bF=bl[0],bG=bl[1];bv="v"+bG[bG.length-1];for(bk=0,bI=bG.length;bk<bI;bk++){bA=bG[bk];bs="v"+bA;if(bG.length===bD||bD===0){bw=true;bM=bF+bv;bE.newFlag(bM,bv,bs);bE.newFlag(bM,bs,"f"+bF+bs);bE.newFlag(bM,"f"+bF+bs,"f"+bF+bv);bE.newFlag(bM,"f"+bF+bv,bv);bE.newFlag("ex"+bF,"f"+bF+bv,"f"+bF+bs)}else{bE.newFlag(bF,bv,bs)}bv=bs}}if(!bw){console.log("No "+bD+"-fold components were found.")}bz=bE.topoly();bz.name="n"+(bD===0?"":bD)+bx.name;return bz};Z=function(bx,bD){var bH,bG,bE,bw,bF,bz,bB,bC,bA,bv,bs,bt,bq,bo,bm,bL,bM,bK,bJ,bI,bk,by,bu,br,bp,bn,bl;console.log("Taking extrusion of "+(bD===0?"":bD)+"-sided faces of "+bx.name+"...");bE=new ag();by=J(bx.xyz);for(bt=0,bL=by.length;bt<bL;bt++){bu=by[bt],bF=bu[0],bC=bu[1];bE.newV("v"+bF,bC)}bB=bx.normals();bH=bx.centers();br=J(bx.face);for(bq=0,bM=br.length;bq<bM;bq++){bp=br[bq],bF=bp[0],bG=bp[1];if(bG.length===bD||bD===0){for(bo=0,bK=bG.length;bo<bK;bo++){bA=bG[bo];bE.newV("f"+bF+"v"+bA,x(bx.xyz[bA],d(0.3,bB[bF])))}}}bw=false;bn=J(bx.face);for(bm=0,bJ=bn.length;bm<bJ;bm++){bl=bn[bm],bF=bl[0],bG=bl[1];bv="v"+bG[bG.length-1];for(bk=0,bI=bG.length;bk<bI;bk++){bA=bG[bk];bs="v"+bA;if(bG.length===bD||bD===0){bw=true;bE.newFlag(bF+bv,bv,bs);bE.newFlag(bF+bv,bs,"f"+bF+bs);bE.newFlag(bF+bv,"f"+bF+bs,"f"+bF+bv);bE.newFlag(bF+bv,"f"+bF+bv,bv);bE.newFlag("ex"+bF,"f"+bF+bv,"f"+bF+bs)}else{bE.newFlag(bF,bv,bs)}bv=bs}}if(!bw){console.log("No "+bD+"-fold components were found.")}bz=bE.topoly();bz.name="x"+(bD===0?"":bD)+bx.name;console.log(bz);return bz};aU=function(bx){var bI,bH,bF,bG,bC,bE,bD,bu,bJ,bs,bw,bv,bp,bA,bz,by,br,bo,bm,bL,bM,bK,bB,bt,bq,bn,bl,bk;console.log("Taking stella of "+bx.name+"...");bI=bx.centers();bF=new ag();bB=J(bx.xyz);for(br=0,bL=bB.length;br<bL;br++){bt=bB[br],bG=bt[0],bE=bt[1];bF.newV("v"+bG,bE)}bq=J(bx.face);for(bo=0,bM=bq.length;bo<bM;bo++){bn=bq[bo],bG=bn[0],bH=bn[1];bu="v"+bH[bH.length-2];bs="v"+bH[bH.length-1];bA=bx.xyz[bH[bH.length-2]];bz=bx.xyz[bH[bH.length-1]];for(bm=0,bK=bH.length;bm<bK;bm++){bD=bH[bm];bp="v"+bD;by=bx.xyz[bD];bJ=bu+"~"+bs;bw=bs+"~"+bu;bv=bs+"~"+bp;bF.newV(bJ,aQ(aQ(bA,bz),bI[bG]));bF.newFlag("in"+bG,bJ,bv);bF.newFlag("f"+bG+bs,bv,bJ);bF.newFlag("f"+bG+bs,bJ,bs);bF.newFlag("f"+bG+bs,bs,bv);bF.newFlag("f"+bJ,bu,bw);bF.newFlag("f"+bJ,bw,bJ);bF.newFlag("f"+bJ,bJ,bu);bl=[bs,bp],bu=bl[0],bs=bl[1];bk=[bz,by],bA=bk[0],bz=bk[1]}}bC=bF.topoly();bC.name="*"+bx.name;return bC};X=function(bn,bm){var br,bp,bo,bk,bs,bl,bq;br=0.1;bk=a1(bn);for(bl=0,bq=bm.length;bl<bq;bl++){bo=bm[bl];bs=i(bk[bo[0]],bk[bo[1]]);bp=d(br*1/2*(1-S(B(bs,bs))),bs);bk[bo[0]]=x(bk[bo[0]],bp);bk[bo[1]]=x(bk[bo[1]],bp)}return bk};a6=function(bo,bn){var br,bp,bk,bl,bs,bm,bq;bk=(function(){var bw,bu,bv,bt;bt=[];for(bw=0,bu=bn.length;bw<bu;bw++){bv=bn[bw],br=bv[0],bp=bv[1];bt.push(i(bo[br],bo[bp]))}return bt})();bl=[0,0,0];for(bm=0,bq=bk.length;bm<bq;bm++){bs=bk[bm];bl=x(bl,bs)}bl=d(1/bn.length,bl);return _.map(bo,function(bt){return ba(bt,bl)})};z=function(bn){var bk,bm,bl;bm=[0,0,0];bk=_.max(_.map(bn,function(bo){return H(bo)}));bl=1/bk;return _.map(bn,function(bo){return[bl*bo[0],bl*bo[1],bl*bo[2]]})};a9=function(bq,bn){var bv,bs,bu,br,bm,bk,bw,bp,bo,bt,bl;bv=0.1;bk=a1(bq);for(bp=0,bt=bn.length;bp<bt;bp++){br=bn[bp];bu=(function(){var bz,bx,by;by=[];for(bz=0,bx=br.length;bz<bx;bz++){bw=br[bz];by.push(bq[bw])}return by})();bm=ai(bu);bs=bd(bu);if(B(bm,bs)<0){bm=d(-1,bm)}for(bo=0,bl=br.length;bo<bl;bo++){bw=br[bo];bk[bw]=x(bk[bw],d(B(d(bv,bm),ba(bs,bq[bw])),bm))}}return bk};l=function(bq,bp){var bl,bk,bn,bo,bm,br;console.log("Canonicalizing "+bq.name+"...");bk=bq.face;bl=bq.getEdges();bm=bq.xyz;bo=1;for(bn=0;0<=bp?bn<=bp:bn>=bp;0<=bp?bn++:bn--){br=a1(bm);bm=X(bm,bl);bm=a6(bm,bl);bm=a9(bm,bk);bo=_.max(_.map(_.zip(bm,br),function(bt){var bs,bu;bs=bt[0],bu=bt[1];return H(ba(bs,bu))}));if(bo<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bo+"]");return bm};M=function(bn){var bo,bl,bm,bk;bl=bn.centers();for(bm=0,bk=bl.length;bm<bk;bm++){bo=bl[bm];bo=d(1/B(bo,bo),bo)}return bl};E=function(bm){var bA,bu,bn,bv,bk,bt,bz,by,bw,br,bq,bx,bl,bs,bp,bo;bA=[];bs=bm.face;for(br=0,bx=bs.length;br<bx;br++){bv=bs[br];bn=[0,0,0];bk=[0,0,0];bu=0;bp=bv.slice(-2),bz=bp[0],by=bp[1];for(bq=0,bl=bv.length;bq<bl;bq++){bw=bv[bq];bn=x(bn,bm.xyz[bw]);bk=x(bk,aR(bm.xyz[bz],bm.xyz[by],bm.xyz[bw]));bu+=ar(bm.xyz[bz],bm.xyz[by]);bo=[by,bw],bz=bo[0],by=bo[1]}bn=d(1/bv.length,bn);bk=be(bk);bu=bu/bv.length;bt=ay(d(B(bn,bk),bk));bA.push(d((1+bu)/2,bt))}return bA};f=function(bo,bl){var bm,bk,bn;bk=aE(bo);console.log("Pseudo-canonicalizing "+bo.name+"...");for(bm=0,bn=bl-1;0<=bn?bm<=bn:bm>=bn;0<=bn?bm++:bm--){bk.xyz=E(bo);bo.xyz=E(bk)}return bo.xyz};w=function(bo,bl){var bm,bk,bn;bk=aE(bo);console.log("Planarizing "+bo.name+"...");for(bm=0,bn=bl-1;0<=bn?bm<=bn:bm>=bn;0<=bn?bm++:bm--){bk.xyz=M(bo);bo.xyz=M(bk)}return bo.xyz};G=function(bM){var bL,bH,bC,bF,bK,bu,bN,bE,bA,bw,bJ,bq,bG,bB,bs,bt,bv,bD,bI,br,bp,bo,bl,bk,bz,bx,bn,by,bm;bv=999;bG=[];bB=[];bs=bM.length;bJ=function(bO,bP){return(bO||bP)&&!(bO&&bP)};bL=function(bQ,bP,bO){return(bP[0]-bQ[0])*(bO[1]-bQ[1])-(bO[0]-bQ[0])*(bP[1]-bQ[1])};bA=function(bQ,bP,bO){return bL(bQ,bP,bO)>0};bw=function(bQ,bP,bO){return bL(bQ,bP,bO)>=0};bC=function(bQ,bP,bO){return bL(bQ,bP,bO)===0};bH=function(bQ,bP,bO){if(bC(bQ,bP,bO)){return false}if(bQ[0]!==bP[0]){return(bQ[0]<=bO[0])&&(bO[0]<=bP[0])||(bQ[0]>=bO[0])&&(bO[0]>=bP[0])}else{return(bQ[1]<=bO[1])&&(bO[1]<=bP[1])||(bQ[1]>=bO[1])&&(bO[1]>=bP[1])}};bE=function(bR,bQ,bP,bO){if(bC(bR,bQ,bP)||bC(bR,bQ,bO)||bC(bP,bO,bR)||bC(bP,bO,bQ)){return false}return bJ(bA(bR,bQ,bP),bA(bR,bQ,bO))&&bJ(bA(bP,bO,bR),bA(bP,bO,bQ))};bN=function(bR,bQ,bP,bO){if(bE(bR,bQ,bP,bO)){return true}else{if(bH(bR,bQ,bP)||bH(bR,bQ,bO)||bH(bP,bO,bR)||bH(bP,bO,bQ)){return true}else{return false}}};bu=function(bQ,bO){var bR,bP;bP=(bQ+1+bs)%bs;bR=(bQ-1+bs)%bs;if(bw(bM[bQ],bM[bP],bM[bR])){return bA(bM[bQ],bM[bO],bM[bR])&&bA(bM[bO],bM[bQ],bM[bP])}return !(bw(bM[bQ],bM[bO],bM[bP])&&bw(bM[bO],bM[bQ],bM[bR]))};bK=function(bP,bO){var bR,bQ;bR=0;while(true){bQ=(bR+1+bs)%bs;if((bR!==bP)&&(bQ!==bP)&&(bR!==bO)&&(bQ!==bO)&&bE(bM[bP],bM[bO],bM[bR],bM[bQ])){return false}bR=(bR+1+bs)%bs;if(bR===0){break}}return true};bF=function(bP,bO){return bu(bP,bO)&&bu(bO,bP)&&bK(bP,bO)};bp=0;while(true){bo=(bp+1+bs)%bs;br=(bp-1+bs)%bs;bB[bp]=bF(br,bo);bp=(bp+1+bs)%bs;if(bp===0){break}}bI=(function(){bm=[];for(var bP=0,bO=bs-1;0<=bO?bP<=bO:bP>=bO;0<=bO?bP++:bP--){bm.push(bP)}return bm}).apply(this);bD=bs;bx=bv;bt=0;while(bx>0&&bD>3){bx-=1;bo=bt;bz=bv;while(true){bz-=1;bq=false;if(bB[bo]){bl=(bo+1+bs)%bs;bk=(bl+1+bs)%bs;bp=(bo-1+bs)%bs;br=(bp-1+bs)%bs;bG.push([bI[bp],bI[bl]]);bB[bp]=bF(br,bl);bB[bl]=bF(bp,bk);bM=bM.slice(0,(bo+1)||9000000000).concat(bM.slice(bl));bI=bI.slice(0,(bo+1)||9000000000).concat(bI.slice(bl));if(br>bo){br-=1}if(bp>bo){bp-=1}if(bl>bo){bl-=1}if(bk>bo){bk-=1}bs--;bt=bl;bD--;bq=true}bo=(bo+1+bs)%bs;if(!(bz>0&&!bq&&bo!==bt)){break}}}return bG};a=function(bl,bk){if(((bl[0]===bk[0])&&(bl[1]===bk[1])&&(bl[2]===bk[2]))||(bl[0]===bk[1])&&(bl[1]===bk[2])&&(bl[2]===bk[0])||(bl[0]===bk[2])&&(bl[1]===bk[0])&&(bl[2]===bk[1])){return true}else{return false}};s=function(bR,bE){var bB,bS,bD,bC,bz,bF,bP,bl,bv,bT,bW,bV,bU,bQ,bO,bN,bM,bA,bs,br,bq,bp,bo,bn,bm,bk,bL,bK,bJ,bI,bH,bG,by,bx,bw,bu,bt;bz=[];bl=[];bG=(function(){var bY,bX;bX=[];for(bP=0,bY=bR.length-1;0<=bY?bP<=bY:bP>=bY;0<=bY?bP++:bP--){bX.push([bP,(bP+1)%bR.length])}return bX})();for(bQ=0,bA=bG.length;bQ<bA;bQ++){by=bG[bQ],bV=by[0],bU=by[1];bz[bV]=[bU];bl[bU]=[bV]}for(bO=0,bs=bE.length;bO<bs;bO++){bS=bE[bO];bz[bS[0]].push(bS[1]);bz[bS[1]].push(bS[0]);bl[bS[0]].push(bS[1]);bl[bS[1]].push(bS[0])}bT=[];for(bN=0,br=bE.length;bN<br;bN++){bS=bE[bN];bx=bz[bS[1]];for(bM=0,bq=bx.length;bM<bq;bM++){bD=bx[bM];bw=bl[bS[0]];for(bL=0,bp=bw.length;bL<bp;bL++){bC=bw[bL];if(bD===bC){bT.push([bS[0],bS[1],bD])}}}bu=bz[bS[0]];for(bK=0,bo=bu.length;bK<bo;bK++){bD=bu[bK];bt=bl[bS[1]];for(bJ=0,bn=bt.length;bJ<bn;bJ++){bC=bt[bJ];if(bD===bC){bT.push([bS[1],bS[0],bD])}}}}bW=[bT.pop()];for(bI=0,bm=bT.length;bI<bm;bI++){bv=bT[bI];bB=false;for(bH=0,bk=bW.length;bH<bk;bH++){bF=bW[bH];if(a(bv,bF)){bB=true;break}}if(!bB){bW.push(bv)}}return bW};Y=function(bp,br){var bz,bu,bA,by,bx,bs,bw,bv,bt,bn,bl,bB,bC,bq,bo,bm,bk;br=br||false;console.log("Triangulating faces of "+bp.name+"...");bs=new aL();bs.xyz=I(bp.xyz);bs.face_colors=[];bq=J(bp.face);for(bn=0,bB=bq.length;bn<bB;bn++){bo=bq[bn],by=bo[0],bA=bo[1];if(bA.length>3){bz=W((function(){var bF,bD,bE;bE=[];for(bF=0,bD=bA.length;bF<bD;bF++){bt=bA[bF];bE.push(bp.xyz[bt])}return bE})());bu=G(bz);bv=s(bA,bu);bm=J(bv);for(bl=0,bC=bm.length;bl<bC;bl++){bk=bm[bl],bx=bk[0],bw=bk[1];bs.face.push([bA[bw[0]],bA[bw[1]],bA[bw[2]]]);if(br){bs.face_colors.push(bp.face_colors[by])}}}else{bs.face.push([bA[0],bA[1],bA[2]]);if(br){bs.face_colors.push(bp.face_colors[by])}}}bs.name=bp.name;return bs};af=function(bk){var bp,bq,bs,bn,bm,br,bl,bo;bq="";bo=bk.face;for(bn=0,br=bo.length;bn<br;bn++){bp=bo[bn];for(bm=0,bl=bp.length;bm<bl;bm++){bs=bp[bm];bq+=""+bs+"->"}bq+="\n"}return console.log(bq)};A=function(){var br,bo,bn,bm,bq,bp,bl,bk;bm=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bo=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bq=0,bl=bo.length;bq<bl;bq++){br=bo[bq];console.log("Operator "+br);for(bp=0,bk=bm.length;bp<bk;bp++){bn=bm[bp];console.log(br+bn+":",ae(br+bn))}}return console.log("===== Done Testing Basic Ops =====")};ab={};bf=600;aw=300;N={};h=I(t);aj=I(t);R=500;y=5;bg=0;K=0.8;m=bf/2;at=aw/2;u=new Date();o=true;aO="rgba(255,255,255,1.0)";al="area";a8=0.5;am=false;U=0;T=0;aC=[1,0,0];a0=["dakD","opD","lT","lQ5oC","knD","dn6x4Q5bT"];aA=function(bm,bk){var bn,bl;bn=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bl=new bn();bl.append(bm);return saveAs(bl.getBlob("text/plain;charset="+document.characterSet),bk)};ao=["#ff3333","#33ff33","#3333ff","#ffff33","#ff33ff","#33ffff","#dddddd","#555555","#dd0000","#00dd00","#0000dd"];aM=["#ff8888","#dddddd","#777777","#aa3333","#ff0000","#ffffff","#aaaaaa"];j=["#ff8888","#ffeeee","#88ff88","#dd7777","#ff2222","#22ff22","#ee4422","#aaaaaa"];bj=function(bl){var bk;if(bl[0]==="#"){bl=bl.slice(1)}if(bl.length===3){bk=bl.split("").map(function(bm){return parseInt(bm+bm,16)/255})}else{bk=bl.match(/.{2}/g).map(function(bm){return parseInt(bm,16)/255})}return bk};aW=aM;ad=function(bk){if(bk<aW.length){return bj(aW[bk])}else{return bj(aW[aW.length-1])}};aT=function(bk,bn){var bl,bm;bm=V(100*bk);if(bm in bn){return bn[bm]}else{bl=ad(_.toArray(bn).length);bn[bm]=bl;return bl}};O=function(bk){var bs,bo,bn,bq,br,bl,bp,bm;bk.face_colors=[];bo={};bm=bk.face;for(bl=0,bp=bm.length;bl<bp;bl++){bn=bm[bl];if(al==="area"){bq=(function(){var bv,bt,bu;bu=[];for(bv=0,bt=bn.length;bv<bt;bv++){br=bn[bv];bu.push(bk.xyz[br])}return bu})();bs=aT(bc(bq),bo)}else{bs=ad(bn.length-3)}bk.face_colors.push(bs)}return bk};aK=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];aX=function(bn){var bk,bm,bq,bp,bl,bo;bm=bn;for(bp=0,bl=aK.length;bp<bl;bp++){bo=aK[bp],bq=bo[0],bk=bo[1];bm=bm.replace(bq,bk)}console.log(""+bn+" executed as "+bm);return bm};ae=function(bl){var bn,bk,bm;bm=new aL();bn=0;bk=aX(bl);if(bk.search(/([0-9]+)$/)!==-1){bn=1*RegExp.lastParen;bk=bk.slice(0,-RegExp.lastParen.length)}switch(bk.slice(-1)){case"T":bm=e();break;case"O":bm=ap();break;case"C":bm=ah();break;case"I":bm=a3();break;case"D":bm=an();break;case"P":bm=Q(bn);break;case"A":bm=aS(bn);break;case"Y":bm=bi(bn);break;default:return}while(bk!==""){bn=0;if(bk.search(/([0-9]+)$/)!==-1){bn=1*RegExp.lastParen;bk=bk.slice(0,-RegExp.lastParen.length)}switch(bk.slice(-1)){case"d":bm=aE(bm);break;case"k":bm=aa(bm,bn);break;case"a":bm=aD(bm);break;case"g":bm=aZ(bm);break;case"p":bm=q(bm);break;case"r":bm=r(bm);break;case"K":bm.xyz=f(bm,bn===0?1:bn);break;case"C":bm.xyz=l(bm,bn===0?1:bn);break;case"A":bm.xyz=w(bm,bn===0?1:bn);break;case"n":bm=C(bm,bn);break;case"x":bm=Z(bm,bn);break;case"l":bm=aU(bm,bn);break;case"z":bm=Y(bm,false)}bk=bk.slice(0,-1)}bm.xyz=a6(bm.xyz,bm.getEdges());bm.xyz=z(bm.xyz);bm=O(bm);return bm};bh=function(){var bk,bp,bo,bn,bm,bl;bl={};bk=/\+/g;bm=/([^&=]+)=?([^&]*)/g;bp=function(bq){return decodeURIComponent(bq.replace(bk," "))};bn=window.location.search.substring(1);while(bo=bm.exec(bn)){bl[bp(bo[1])]=bp(bo[2])}return bl};aG=function(){var bk;bk=$("#poly");bk.width(bf);bk.height(aw);ab=bk[0].getContext("2d");ab.lineWidth=a8;if(o){return ab.clearRect(0,0,bf,aw)}else{ab.clearRect(0,0,bf,aw);ab.fillStyle=aO;return ab.fillRect(0,0,bf,aw)}};aI=function(){if(o){return ab.clearRect(0,0,bf,aw)}else{ab.clearRect(0,0,bf,aw);ab.fillStyle=aO;return ab.fillRect(0,0,bf,aw)}};aN=function(bp){var bo,bk,bq,bn,bm,bl;bo=bp.centers();bq=_.zip(bo,(function(){bl=[];for(var bs=0,br=bp.face.length-1;0<=br?bs<=br:bs>=br;0<=br?bs++:bs--){bl.push(bs)}return bl}).apply(this)).sort(function(bs,br){return bs[0][2]-br[0][2]}).map(function(br){return br[1]});bp.face=(function(){var bt,br,bs;bs=[];for(bt=0,br=bq.length;bt<br;bt++){bk=bq[bt];bs.push(bp.face[bk])}return bs})();return bp.face_colors=(function(){var bt,br,bs;bs=[];for(bt=0,br=bq.length;bt<br;bt++){bk=bq[bt];bs.push(bp.face_colors[bk])}return bs})()};P=function(bt,bB){var bn,bv,bu,bA,bq,br,bz,bs,by,bw,bo,bl,bC,bD,bx,bp,bm,bk;bB||(bB=[3,3,3]);br=_.map(bt.xyz,function(bE){return bE});bt.xyz=_.map(bt.xyz,function(bE){return p(h,bE)});aN(bt);bx=J(bt.face);for(bo=0,bC=bx.length;bo<bC;bo++){bp=bx[bo],bA=bp[0],bv=bp[1];ab.beginPath();bs=bv[bv.length-1];bm=v(x(bB,bt.xyz[bs]),y,bg,K,R),by=bm[0],bw=bm[1];ab.moveTo(by+m,bw+at);for(bl=0,bD=bv.length;bl<bD;bl++){bz=bv[bl];bk=v(x(bB,bt.xyz[bz]),y,bg,K,R),by=bk[0],bw=bk[1];ab.lineTo(by+m,bw+at)}bn=bt.face_colors[bA];bu=(function(){var bF,bG,bE;bE=[];for(bF=0,bG=bv.length;bF<bG;bF++){bz=bv[bF];bE.push(bt.xyz[bz])}return bE})();bq=B(ai(bu),be([1,-1,0]));bn=d((bq/2+0.5)*0.7+0.3,bn);ab.fillStyle="rgba("+(V(bn[0]*255))+", "+(V(bn[1]*255))+", "+(V(bn[2]*255))+", "+1+")";ab.fill();ab.strokeStyle="rgba(0,0,0, .3)";ab.stroke()}return bt.xyz=br};$(function(){var bl,bk;aG();bk=bh();if("recipe" in bk){bl=[bk.recipe];$("#spec").val(bl)}else{bl=[a7(a0)];$("#spec").val(bl)}N=_.map(bl,function(bm){return ae(bm)});ax();$("#spec").change(function(bm){bl=$("#spec").val().split(/\s+/g).slice(0,2);N=_.map(bl,function(bn){return ae(bn)});window.location.replace("?recipe="+bl[0]);return ax()});$("#poly").mousewheel(function(bo,bp,bn,bm){bo.preventDefault();R*=(10+bp)/10;return ax()});$("#poly").mousedown(function(bm){var bn;bm.preventDefault();am=true;U=bm.clientX-$(this).offset().left;T=bm.clientY-$(this).offset().top;bn=aH(U,T,m,at,y,bg,K,R);if(bn[0]*bn[1]*bn[2]*0===0){aC=bn}return aj=I(h)});$("#poly").mouseup(function(bm){bm.preventDefault();return am=false});$("#poly").mouseleave(function(bm){bm.preventDefault();return am=false});$("#poly").mousemove(function(bp){var bn,bm,bo;bp.preventDefault();if(am){bn=bp.clientX-$(this).offset().left;bm=bp.clientY-$(this).offset().top;bo=aH(bn,bm,m,at,y,bg,K,R);if(bo[0]*bo[1]*bo[2]*0===0&&aC[0]*aC[1]*aC[2]*0===0){h=aB(az(aC,bo),aj)}return ax()}});$("#siderot").click(function(bm){h=aP(aF/2,0,1,0);return ax()});$("#toprot").click(function(bm){h=aP(aF/2,1,0,0);return ax()});$("#frontrot").click(function(bm){h=g(0,0,0);return ax()});$("#pngsavebutton").click(function(bp){var bo,bn,bm;bo=$("#poly")[0];bm=$("#spec").val().split(/\s+/g)[0];bn="polyhedronisme-"+bm+".png";return bo.toBlob(function(bq){return saveAs(bq,bn)})});$("#objsavebutton").click(function(bp){var bn,bo,bm;bo=N[0].toOBJ();bm=$("#spec").val().split(/\s+/g)[0];bn="polyhedronisme-"+bm+".obj";return aA(bo,bn)});return $("#x3dsavebutton").click(function(bp){var bn,bm,bo,bq;bo=Y(N[0],true);bq=bo.toVRML();bm=$("#spec").val().split(/\s+/g)[0];bn="polyhedronisme-"+bm+".wrl";return aA(bq,bn)})});bb=function(){var bl,bm,bp,bo,bk,bn,bq;aI();bl=(2*Math.PI)/180*u.getSeconds()*0.1;bn=J(N);for(bo=0,bk=bn.length;bo<bk;bo++){bq=bn[bo],bm=bq[0],bp=bq[1];P(bp,[0+3*bm,0,3])}return setTimeout(bb,100)};ax=function(){var bm,bp,bo,bl,bn,bq,bk;aI();bn=J(N);bk=[];for(bo=0,bl=bn.length;bo<bl;bo++){bq=bn[bo],bm=bq[0],bp=bq[1];bk.push(P(bp,[0+3*bm,0,3]))}return bk}}).call(this);