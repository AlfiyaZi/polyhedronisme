(function(){var p,aQ,ax,bj,am,a2,V,U,aD,an,aY,aP,aG,g,ae,a0,y,x,aE,be,aU,M,aw,bf,bh,f,m,aJ,K,aV,bg,a3,H,av,ad,ba,ai,aq,t,bp,ap,C,ay,Q,aF,at,ab,u,a6,al,I,aZ,aA,O,i,ak,v,a1,bo,a5,aH,D,E,aI,ac,J,a4,aS,aC,d,q,bn,aj,ao,X,ar,bd,F,aT,P,af,bl,w,L,z,bk,S,bb,ah,aM,a7,R,Y,r,bm,aK,a9,a8,az,N,G,s,A,h,W,aN,k,aB,aX,aO,aL,T,aW,bc,b,j,Z,B,e,ag,a,aa,l,bi,aR,c,n,au,o;aK=Math.random;W=Math.round;al=Math.floor;T=Math.sqrt;aX=Math.sin;H=Math.cos;b=Math.tan;M=Math.asin;a0=Math.acos;aw=Math.atan;a7=Math.pow;ae=Math.abs;aG=Math.PI;K=function(bs){var br,bq;if(!(bs!=null)||typeof bs!=="object"){return bs}bq=new bs.constructor();for(br in bs){bq[br]=K(bs[br])}return bq};a9=function(br){var bq;bq=al(aK()*br.length);return br[bq]};d=function(br,bq){return[br*bq[0],br*bq[1],br*bq[2]]};o=function(br,bq){return[br[0]*bq[0],br[1]*bq[1],br[2]*bq[2]]};y=function(br,bq){return[br[0]+bq[0],br[1]+bq[1],br[2]+bq[2]]};bc=function(br,bq){return[br[0]-bq[0],br[1]-bq[1],br[2]-bq[2]]};C=function(br,bq){return br[0]*bq[0]+br[1]*bq[1]+br[2]*bq[2]};av=function(br,bq){return[br[1]*bq[2]-br[2]*bq[1],br[2]*bq[0]-br[0]*bq[2],br[0]*bq[1]-br[1]*bq[0]]};J=function(bq){return T(C(bq,bq))};a4=function(bq){return C(bq,bq)};bi=function(bq){return d(1/T(a4(bq)),bq)};aS=function(br,bq){return d(1/2,y(br,bq))};l=function(bs,br,bq){return[(1-bq)*bs[0]+bq*br[0],(1-bq)*bs[1]+bq*br[1],(1-bq)*bs[2]+bq*br[2]]};ar=function(br,bq){return l(br,bq,1/3)};az=function(bq){return d(1/a4(bq),bq)};j=function(bs,br){var bq;bq=bc(br,bs);return bc(bs,d(C(bq,bs)/a4(bq),bq))};at=function(br,bq){return T(a4(j(br,bq)))};aT=function(bu,bt,bs){var br,bq;br=bc(bt,bu);bq=bc(bs,bt);return av(br,bq)};E=function(bx,bw,bv){var bB,bA,bz,bu,bt,bs,by,br,bq;for(bu=0,by=bx.length;bu<by;bu++){bB=bx[bu];for(bt=0,br=bw.length;bt<br;bt++){bA=bw[bt];if(bB===bA){for(bs=0,bq=bv.length;bs<bq;bs++){bz=bv[bs];if(bB===bz){return bB}}}}}return null};bh=function(bu){var bs,br,bt,bq;bs=[0,0,0];for(bt=0,bq=bu.length;bt<bq;bt++){br=bu[bt];bs=y(bs,br)}return d(1/bu.length,bs)};aj=function(bu){var bq,by,bw,bv,bs,bx,bt,br;bq=[0,0,0];bt=bu.slice(-2),by=bt[0],bw=bt[1];for(bs=0,bx=bu.length;bs<bx;bs++){bv=bu[bs];bq=y(bq,aT(by,bw,bv));br=[bw,bv],by=br[0],bw=br[1]}return bi(bq)};bg=function(bu){var bq,by,bw,bv,bs,bx,bt,br;bq=0;bt=bu.slice(0,2),by=bt[0],bw=bt[1];br=bu.slice(2);for(bs=0,bx=br.length;bs<bx;bs++){bv=br[bs];bq+=J(av(bc(bw,by),bc(bv,by)));bw=bv}return bq};Y=function(bx){var bv,br,bq,bu,by,bz,bt,bw,bs;bu=K(bx);bz=bx[0];bu=_.map(bu,function(bA){return bA-bz});br=aj(bx);bv=bi(bh(bx));bq=av(br,bv);bs=[];for(bt=0,bw=bu.length;bt<bw;bt++){by=bu[bt];bs.push([C(br,by),C(bq,by)])}return bs};a3=function(bs){var br,bq,bt;bq=new Array(bs.length);for(br=0,bt=bs.length-1;0<=bt?br<=bt:br>=bt;0<=bt?br++:br--){bq[br]=bs[br].slice(0)}return bq};q=function(br,bq){return[br[0][0]*bq[0]+br[0][1]*bq[1]+br[0][2]*bq[2],br[1][0]*bq[0]+br[1][1]*bq[1]+br[1][2]*bq[2],br[2][0]*bq[0]+br[2][1]*bq[1]+br[2][2]*bq[2]]};aC=function(bq,br){return[[bq[0][0]*br[0][0]+bq[0][1]*br[1][0]+bq[0][2]*br[2][0],bq[0][0]*br[0][1]+bq[0][1]*br[1][1]+bq[0][2]*br[2][1],bq[0][0]*br[0][2]+bq[0][1]*br[1][2]+bq[0][2]*br[2][2]],[bq[1][0]*br[0][0]+bq[1][1]*br[1][0]+bq[1][2]*br[2][0],bq[1][0]*br[0][1]+bq[1][1]*br[1][1]+bq[1][2]*br[2][1],bq[1][0]*br[0][2]+bq[1][1]*br[1][2]+bq[1][2]*br[2][2]],[bq[2][0]*br[0][0]+bq[2][1]*br[1][0]+bq[2][2]*br[2][0],bq[2][0]*br[0][1]+bq[2][1]*br[1][1]+bq[2][2]*br[2][1],bq[2][0]*br[0][2]+bq[2][1]*br[1][2]+bq[2][2]*br[2][2]]]};u=[[1,0,0],[0,1,0],[0,0,1]];h=function(bu,bs,bt){var bv,br,bq;bv=[[H(bu),-1*aX(bu),0],[aX(bu),H(bu),0],[0,0,1]];bq=[[H(bs),0,-1*aX(bs)],[0,1,0],[aX(bs),0,H(bs)]];br=[[1,0,0],[0,H(bt),-1*aX(bt)],[0,aX(bt),H(bt)]];return aC(br,aC(bq,bv))};aR=function(bu,bD,bB,by){var bx,br,bs,bC,bA,bq,bz,bv,bw,bt;bu/=2;bC=aX(bu);bx=H(bu);bA=bC*bC;br=J([bD,bB,by]);if(br===0){bw=[0,0,1],bD=bw[0],bB=bw[1],by=bw[2]}if(br!==1){bt=bi([bD,bB,by]),bD=bt[0],bB=bt[1],by=bt[2]}if(bD===1&&bB===0&&by===0){bs=[[1,0,0],[0,1-2*bA,2*bC*bx],[0,-2*bC*bx,1-2*bA]]}else{if(bD===0&&bB===1&&by===0){bs=[[1-2*bA,0,-2*bC*bx],[0,1,0],[2*bC*bx,0,1-2*bA]]}else{if(bD===0&&bB===0&&by===1){bs=[[1-2*bA,2*bC*bx,0],[-2*bC*bx,1-2*bA,0],[0,0,1]]}else{bq=bD*bD;bz=bB*bB;bv=by*by;bs=[[1-2*(bz+bv)*bA,2*(bD*bB*bA+by*bC*bx),2*(bD*by*bA-bB*bC*bx)],[2*(bB*bD*bA-by*bC*bx),1-2*(bv+bq)*bA,2*(bB*by*bA+bD*bC*bx)],[2*(by*bD*bA+bB*bC*bx),2*(by*bB*bA-bD*bC*bx),1-2*(bq+bz)*bA]]}}}return bs};w=function(bs,br,bt,bw,bq){var bu,bv;bv=(br*bw-bt)/(1-bw);bu=bq*bw/(1-bw);return[bu*bs[0]/(bs[2]+bv),bu*bs[1]/(bs[2]+bv)]};aI=function(bx,bu,bA,by,bE,bt,bs,br){var bD,bq,bz,bv,bB,bG,bI,bw,bC,bF,bH;bC=(bE*bs-bt)/(1-bs);bD=br*bs/(1-bs);bz=bx-bA;bG=bu-by;bq=bD*bD;bF=bC*bC;bv=bz*bz;bI=bG*bG;bB=(2*bD*bz*bC+T(4*bq*bv*bF+4*bv*(bq+bv+bI)*(1-bF)))/(2*(bq+bv+bI));bw=(bD*bG*bC)/(bq+bv+bI)+(bG*T(4*bq*bF+4*(bq+bv+bI)*(1-bF)))/(2*(bq+bv+bI));bH=T(1-bB*bB-bw*bw);return[bB,bw,bH]};aA=function(bs,br){var bt,bq;bq=av(bs,br);bt=a0(C(bs,br));return aR(-1*bt,bq[0],bq[1],bq[2])};a6=function(bt){var br,bv,bu,bs,bq;br=[];bv=bt.slice(-1)[0];for(bs=0,bq=bt.length;bs<bq;bs++){bu=bt[bs];br.push([bv,bu]);bv=bu}return br};c=function(bq){var bv,bu,by,bw,bs,bx,br,bt;bw=[];bt=bq.face;for(bu=0,bx=bt.length;bu<bx;bu++){bv=bt[bu];for(bs=0,br=bv.length;bs<br;bs++){by=bv[bs];bw[by]=bq.face_colors[bu]}}return bw};aM=(function(){function bq(bt,br,bs){this.face=br||new Array();this.xyz=bt||new Array();this.name=bs||"null polyhedron"}bq.prototype.data=function(){var br;br=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+br+" edges, "+this.xyz.length+" vertices)"};bq.prototype.getEdges=function(){var bB,bx,bz,by,bs,bw,bv,bC,bu,bt,bA,br;bw={};bC=[];bx=_.map(this.face,a6);for(bu=0,bA=bx.length;bu<bA;bu++){bs=bx[bu];for(bt=0,br=bs.length;bt<br;bt++){by=bs[bt];if(by[0]<by[1]){bB=by[0],bz=by[1]}else{bz=by[0],bB=by[1]}bw[bB+"~"+bz]=by}}for(bv in bw){by=bw[bv];bC.push(by)}return bC};bq.prototype.centers=function(){var bw,bx,bt,bz,bu,bs,by,br,bv;bw=[];bv=this.face;for(bu=0,by=bv.length;bu<by;bu++){bx=bv[bu];bt=[0,0,0];for(bs=0,br=bx.length;bs<br;bs++){bz=bx[bs];bt=y(bt,this.xyz[bz])}bw.push(d(1/bx.length,bt))}return bw};bq.prototype.normals=function(){var bv,bw,bs,bu,br,bt;bw=[];bt=this.face;for(bu=0,br=bt.length;bu<br;bu++){bv=bt[bu];bw.push(aj((function(){var bz,bx,by;by=[];for(bz=0,bx=bv.length;bz<bx;bz++){bs=bv[bz];by.push(this.xyz[bs])}return by}).call(this)))}return bw};bq.prototype.toOBJ=function(){var bB,bA,bs,bC,bE,by,bx,bw,bD,bt,br,bF,bz,bv,bu;bC="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bC+="group "+this.name+"\n";bC+="#vertices\n";bz=this.xyz;for(by=0,bD=bz.length;by<bD;by++){bE=bz[by];bC+="v "+bE[0]+" "+bE[1]+" "+bE[2]+"\n"}bC+="#normal vector defs \n";bv=this.face;for(bx=0,bt=bv.length;bx<bt;bx++){bB=bv[bx];bs=aj((function(){var bH,bI,bG;bG=[];for(bH=0,bI=bB.length;bH<bI;bH++){bE=bB[bH];bG.push(this.xyz[bE])}return bG}).call(this));bC+="vn "+bs[0]+" "+bs[1]+" "+bs[2]+"\n"}bC+="#face defs \n";bu=this.face;for(bA=0,br=bu.length;bA<br;bA++){bB=bu[bA];bC+="f ";for(bw=0,bF=bB.length;bw<bF;bw++){bE=bB[bw];bC+=""+(bE+1)+"//"+(bA+1)+" "}bC+="\n"}return bC};bq.prototype.toX3D=function(){var bv,bG,bB,bD,bE,bz,by,bx,bu,bC,bs,br,bF,bA,bw,bt;bv=0.01;bE='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bA=this.face;for(bz=0,bC=bA.length;bz<bC;bz++){bB=bA[bz];for(by=0,bs=bB.length;by<bs;by++){bD=bB[by];bE+=""+bD+" "}bE+="-1\n"}bE+='">\n';bE+='<Color color="';bw=c(this);for(bx=0,br=bw.length;bx<br;bx++){bG=bw[bx];bE+=""+bG[0]+" "+bG[1]+" "+bG[2]+" "}bE+='"/>';bE+='<Coordinate point="';bt=this.xyz;for(bu=0,bF=bt.length;bu<bF;bu++){bD=bt[bu];bE+=""+(bD[0]*bv)+" "+(bD[1]*bv)+" "+(bD[2]*bv)+" "}bE+='"/>\n';bE+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bE};bq.prototype.toVRML=function(){var bv,bG,bB,bD,bE,bz,by,bx,bu,bC,bs,br,bF,bA,bw,bt;bv=0.01;bE='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bA=this.xyz;for(bz=0,bC=bA.length;bz<bC;bz++){bD=bA[bz];bE+=""+(bD[0]*bv)+" "+(bD[1]*bv)+" "+(bD[2]*bv)+","}bE=bE.slice(0,-1);bE+="    ]\n}\ncolor Color\n{\n  color\n  [";bw=this.face_colors;for(by=0,bs=bw.length;by<bs;by++){bG=bw[by];bE+=""+bG[0]+" "+bG[1]+" "+bG[2]+" ,"}bE=bE.slice(0,-1);bE+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bt=this.face;for(bx=0,br=bt.length;bx<br;bx++){bB=bt[bx];for(bu=0,bF=bB.length;bu<bF;bu++){bD=bB[bu];bE+=""+bD+", "}bE+="-1,"}bE=bE.slice(0,-1);bE+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bE};return bq})();e=function(){var bq;bq=new aM();bq.name="T";bq.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bq.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bq};ao=function(){var bq;bq=new aM();bq.name="O";bq.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bq.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bq};ai=function(){var bq;bq=new aM();bq.name="C";bq.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bq.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bq};a5=function(){var bq;bq=new aM();bq.name="I";bq.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bq.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bq};ap=function(){var bq;bq=new aM();bq.name="D";bq.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bq.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bq};R=function(bu){var bD,bC,bq,bs,bA,bz,bB,bx,bv,bt,br,by,bw;bs=2*aG/bu;bD=Math.sin(bs/2);bq=new aM();bq.name="P"+bu;for(bC=0,bB=bu-1;0<=bB?bC<=bB:bC>=bB;0<=bB?bC++:bC--){bq.xyz.push([-H(bC*bs),-aX(bC*bs),-bD])}for(bC=0,bx=bu-1;0<=bx?bC<=bx:bC>=bx;0<=bx?bC++:bC--){bq.xyz.push([-H(bC*bs),-aX(bC*bs),bD])}bq.face.push((function(){by=[];for(var bE=bv=bu-1;bv<=0?bE<=0:bE>=0;bv<=0?bE++:bE--){by.push(bE)}return by}).apply(this));bq.face.push((function(){bw=[];for(var bE=bu,bF=2*bu-1;bu<=bF?bE<=bF:bE>=bF;bu<=bF?bE++:bE--){bw.push(bE)}return bw}).apply(this));for(bC=0,br=bu-1;0<=br?bC<=br:bC>=br;0<=br?bC++:bC--){bq.face.push([bC,(bC+1)%bu,(bC+1)%bu+bu,bC+bu])}bq=x(bq,1);return bq};aU=function(bv){var bF,bE,bD,br,bq,bt,bB,bA,bC,by,bw,bu,bs,bz,bx;bt=2*aG/bv;bE=T(1-4/(4+2*H(bt/2)-2*H(bt)));bq=T(1-bE*bE);bF=T(bE*bE+a7(bq*H(bt/2),2));bq=-bq/bF;bE=-bE/bF;br=new aM();br.name="A"+bv;for(bD=0,bC=bv-1;0<=bC?bD<=bC:bD>=bC;0<=bC?bD++:bD--){br.xyz.push([bq*H(bD*bt),bq*aX(bD*bt),bE])}for(bD=0,by=bv-1;0<=by?bD<=by:bD>=by;0<=by?bD++:bD--){br.xyz.push([bq*H((bD+0.5)*bt),bq*aX((bD+0.5)*bt),-bE])}br.face.push((function(){bz=[];for(var bG=bw=bv-1;bw<=0?bG<=0:bG>=0;bw<=0?bG++:bG--){bz.push(bG)}return bz}).apply(this));br.face.push((function(){bx=[];for(var bG=bv,bH=2*bv-1;bv<=bH?bG<=bH:bG>=bH;bv<=bH?bG++:bG--){bx.push(bG)}return bx}).apply(this));for(bD=0,bs=bv-1;0<=bs?bD<=bs:bD>=bs;0<=bs?bD++:bD--){br.face.push([bD,(bD+1)%bv,bD+bv]);br.face.push([bD,bD+bv,(bv+bD-1)%bv+bv])}br=x(br,1);return br};bm=function(bs){var bz,by,bq,br,bw,bx,bu,bt,bv;br=2*aG/bs;bz=1;bq=new aM();bq.name="Y"+bs;for(by=0,bx=bs-1;0<=bx?by<=bx:by>=bx;0<=bx?by++:by--){bq.xyz.push([-H(by*br),-aX(by*br),-0.2])}bq.xyz.push([0,0,bz]);bq.face.push((function(){bv=[];for(var bA=bu=bs-1;bu<=0?bA<=0:bA>=0;bu<=0?bA++:bA--){bv.push(bA)}return bv}).apply(this));for(by=0,bt=bs-1;0<=bt?by<=bt:by>=bt;0<=bt?by++:by--){bq.face.push([by,(by+1)%bs,bs])}bq=f(bq,3);return bq};ah=(function(){function bq(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bq.prototype.newV=function(bs,br){if(this.verts[bs]===void 0){this.verts[bs]=0;return this.xyzs[bs]=br}};bq.prototype.newFlag=function(br,bt,bs){if(this.flags[br]===void 0){this.flags[br]={}}return this.flags[br][bt]=bs};bq.prototype.topoly=function(){var bs,bx,bA,bw,bu,br,by,bz,bv,bt;br=new aM();bs=0;bv=this.verts;for(bw in bv){by=bv[bw];br.xyz[bs]=this.xyzs[bw];this.verts[bw]=bs;bs++}bs=0;bt=this.flags;for(bw in bt){bx=bt[bw];br.face[bs]=[];for(bu in bx){by=bx[bu];bz=by;break}by=bz;br.face[bs].push(this.verts[by]);by=this.flags[bw][by];bA=0;while(by!==bz){br.face[bs].push(this.verts[by]);by=this.flags[bw][by];bA++;if(bA>1000){console.log("Bad flag spec, have a neverending face:",bw,this.flags[bw]);break}}bs++}br.name="unknown polyhedron";return br};return bq})();ac=function(bw,bC){var bv,bG,bF,bD,bJ,bu,bE,by,bA,bB,bz,bt,bq,br,bI,bK,bH,bx,bs;bC||(bC=0);console.log("Taking kis of "+(bC===0?"":bC)+"-sided faces of "+bw.name+"...");bD=new ah();bx=bw.xyz;for(bE=0,bI=bx.length;bE<bI;bE++){bB=bx[bE];bD.newV("v"+bE,bB)}bA=bw.normals();bG=bw.centers();bu=false;bs=bw.face;for(bE=0,bK=bs.length;bE<bK;bE++){bF=bs[bE];bt="v"+bF[bF.length-1];for(br=0,bH=bF.length;br<bH;br++){bz=bF[br];bq="v"+bz;if(bF.length===bC||bC===0){bu=true;bv="apex"+bE;bJ=""+bE+bt;bD.newV(bv,y(bG[bE],d(0.2,bA[bE])));bD.newFlag(bJ,bt,bq);bD.newFlag(bJ,bq,bv);bD.newFlag(bJ,bv,bt)}else{bD.newFlag(""+bE,bt,bq)}bt=bq}}if(!bu){console.log("No "+bC+"-fold components were found.")}by=bD.topoly();by.name="k"+(bC===0?"":bC)+bw.name;return by};aE=function(br){var bz,bA,by,bs,bv,bE,bD,bB,bw,bC,bq,bx,bu,bt;console.log("Taking ambo of "+br.name+"...");bs=function(bG,bF){if(bG<bF){return bG+"_"+bF}else{return bF+"_"+bG}};bA=new ah();bx=br.face;for(by=0,bC=bx.length;by<bC;by++){bz=bx[by];bu=bz.slice(-2),bE=bu[0],bD=bu[1];for(bw=0,bq=bz.length;bw<bq;bw++){bB=bz[bw];if(bE<bD){bA.newV(bs(bE,bD),aS(br.xyz[bE],br.xyz[bD]))}bA.newFlag("orig"+by,bs(bE,bD),bs(bD,bB));bA.newFlag("dual"+bD,bs(bD,bB),bs(bE,bD));bt=[bD,bB],bE=bt[0],bD=bt[1]}}bv=bA.topoly();bv.name="a"+br.name;return bv};a1=function(bx){var bF,bE,bC,bI,bD,bB,bz,bA,bw,bu,bs,bH,bK,bJ,bG,by,bv,bt,br,bq;console.log("Taking gyro of "+bx.name+"...");bC=new ah();by=bx.xyz;for(bD=0,bH=by.length;bD<bH;bD++){bA=by[bD];bC.newV("v"+bD,bi(bA))}bF=bx.centers();bv=bx.face;for(bD=0,bK=bv.length;bD<bK;bD++){bE=bv[bD];bC.newV("center"+bD,bi(bF[bD]))}bt=bx.face;for(bD=0,bJ=bt.length;bD<bJ;bD++){bE=bt[bD];br=bE.slice(-2),bw=br[0],bu=br[1];for(bB=0,bG=bE.length;bB<bG;bB++){bA=bE[bB];bs=bA;bC.newV(bw+"~"+bu,ar(bx.xyz[bw],bx.xyz[bu]));bI=bD+"f"+bw;bC.newFlag(bI,"center"+bD,bw+"~"+bu);bC.newFlag(bI,bw+"~"+bu,bu+"~"+bw);bC.newFlag(bI,bu+"~"+bw,"v"+bu);bC.newFlag(bI,"v"+bu,bu+"~"+bs);bC.newFlag(bI,bu+"~"+bs,"center"+bD);bq=[bu,bs],bw=bq[0],bu=bq[1]}}bz=bC.topoly();bz.name="g"+bx.name;return bz};r=function(bx){var bD,bB,bF,bC,bz,bA,bv,bs,br,bt,bE,bH,bG,by,bw,bu,bq;console.log("Taking propellor of "+bx.name+"...");bB=new ah();by=bx.xyz;for(bC=0,bE=by.length;bC<bE;bC++){bA=by[bC];bB.newV("v"+bC,bi(bA))}bw=bx.face;for(bC=0,bH=bw.length;bC<bH;bC++){bD=bw[bC];bu=bD.slice(-2),bv=bu[0],bs=bu[1];for(bt=0,bG=bD.length;bt<bG;bt++){bA=bD[bt];br=""+bA;bB.newV(bv+"~"+bs,ar(bx.xyz[bv],bx.xyz[bs]));bF=""+bC+"f"+bs;bB.newFlag("v"+bC,bv+"~"+bs,bs+"~"+br);bB.newFlag(bF,bv+"~"+bs,bs+"~"+bv);bB.newFlag(bF,bs+"~"+bv,"v"+bs);bB.newFlag(bF,"v"+bs,bs+"~"+br);bB.newFlag(bF,bs+"~"+br,bv+"~"+bs);bq=[bs,br],bv=bq[0],bs=bq[1]}}bz=bB.topoly();bz.name="p"+bx.name;return bz};s=function(bs){var bq,br,bt;console.log("Taking reflection of "+bs.name+"...");for(bq=0,br=bs.xyz.length-1;0<=br?bq<=br:bq>=br;0<=br?bq++:bq--){bs.xyz[bq]=d(-1,bs.xyz[bq])}for(bq=0,bt=bs.face.length-1;0<=bt?bq<=bt:bq>=bt;0<=bt?bq++:bq--){bs.face[bq]=bs.face[bq].reverse()}bs.name="r"+bs.name;return bs};aF=function(bz){var bH,bN,bG,bA,bE,bF,bD,bC,by,bv,bw,bt,br,bK,bM,bL,bJ,bI,bB,bx,bu,bs,bq;console.log("Taking dual of "+bz.name+"...");bE=new ah();bA=[];for(bF=0,bB=bz.xyz.length-1;0<=bB?bF<=bB:bF>=bB;0<=bB?bF++:bF--){bA[bF]={}}bx=bz.face;for(bF=0,bK=bx.length;bF<bK;bF++){bG=bx[bF];by=bG[bG.length-1];for(bw=0,bM=bG.length;bw<bM;bw++){bv=bG[bw];bA[by]["v"+bv]=""+bF;by=bv}}bH=bz.centers();for(bF=0,bu=bz.face.length-1;0<=bu?bF<=bu:bF>=bu;0<=bu?bF++:bF--){bE.newV(""+bF,bH[bF])}bs=bz.face;for(bF=0,bL=bs.length;bF<bL;bF++){bG=bs[bF];by=bG[bG.length-1];for(bt=0,bJ=bG.length;bt<bJ;bt++){bv=bG[bt];bE.newFlag(by,bA[bv]["v"+by],""+bF);by=bv}}bN=bE.topoly();bC=[];bq=bN.face;for(br=0,bI=bq.length;br<bI;br++){bG=bq[br];bD=E(bz.face[bG[0]],bz.face[bG[1]],bz.face[bG[2]]);bC[bD]=bG}bN.face=bC;if(bz.name[0]!=="d"){bN.name="d"+bz.name}else{bN.name=bz.name.slice(1)}return bN};D=function(bx,bD){var bH,bG,bE,bM,bw,bF,bz,bB,bC,bA,bv,bs,bt,bq,bL,bN,bK,bJ,bI,by,bu,br;bD||(bD=0);console.log("Taking inset of "+(bD===0?"":bD)+"-sided faces of "+bx.name+"...");bE=new ah();by=bx.xyz;for(bF=0,bL=by.length;bF<bL;bF++){bC=by[bF];bE.newV("v"+bF,bC)}bB=bx.normals();bH=bx.centers();bu=bx.face;for(bF=0,bN=bu.length;bF<bN;bF++){bG=bu[bF];if(bG.length===bD||bD===0){for(bt=0,bK=bG.length;bt<bK;bt++){bA=bG[bt];bE.newV("f"+bF+"v"+bA,y(aS(bx.xyz[bA],bH[bF]),d(-0.2,bB[bF])))}}}bw=false;br=bx.face;for(bF=0,bJ=br.length;bF<bJ;bF++){bG=br[bF];bv="v"+bG[bG.length-1];for(bq=0,bI=bG.length;bq<bI;bq++){bA=bG[bq];bs="v"+bA;if(bG.length===bD||bD===0){bw=true;bM=bF+bv;bE.newFlag(bM,bv,bs);bE.newFlag(bM,bs,"f"+bF+bs);bE.newFlag(bM,"f"+bF+bs,"f"+bF+bv);bE.newFlag(bM,"f"+bF+bv,bv);bE.newFlag("ex"+bF,"f"+bF+bv,"f"+bF+bs)}else{bE.newFlag(bF,bv,bs)}bv=bs}}if(!bw){console.log("No "+bD+"-fold components were found.")}bz=bE.topoly();bz.name="n"+(bD===0?"":bD)+bx.name;return bz};ab=function(bx,bD){var bH,bG,bE,bw,bF,bz,bB,bC,bA,bv,bs,bt,bq,bL,bM,bK,bJ,bI,by,bu,br;bD||(bD=0);console.log("Taking extrusion of "+(bD===0?"":bD)+"-sided faces of "+bx.name+"...");bE=new ah();by=bx.xyz;for(bF=0,bL=by.length;bF<bL;bF++){bC=by[bF];bE.newV("v"+bF,bC)}bB=bx.normals();bH=bx.centers();bu=bx.face;for(bF=0,bM=bu.length;bF<bM;bF++){bG=bu[bF];if(bG.length===bD||bD===0){for(bt=0,bK=bG.length;bt<bK;bt++){bA=bG[bt];bE.newV("f"+bF+"v"+bA,y(bx.xyz[bA],d(0.3,bB[bF])))}}}bw=false;br=bx.face;for(bF=0,bJ=br.length;bF<bJ;bF++){bG=br[bF];bv="v"+bG[bG.length-1];for(bq=0,bI=bG.length;bq<bI;bq++){bA=bG[bq];bs="v"+bA;if(bG.length===bD||bD===0){bw=true;bE.newFlag(bF+bv,bv,bs);bE.newFlag(bF+bv,bs,"f"+bF+bs);bE.newFlag(bF+bv,"f"+bF+bs,"f"+bF+bv);bE.newFlag(bF+bv,"f"+bF+bv,bv);bE.newFlag("ex"+bF,"f"+bF+bv,"f"+bF+bs)}else{bE.newFlag(bF,bv,bs)}bv=bs}}if(!bw){console.log("No "+bD+"-fold components were found.")}bz=bE.topoly();bz.name="x"+(bD===0?"":bD)+bx.name;console.log(bz);return bz};aW=function(bz){var bK,bJ,bH,bI,bE,bG,bF,bw,bL,bu,by,bx,br,bC,bB,bA,bt,bN,bO,bM,bD,bv,bs,bq;console.log("Taking stella of "+bz.name+"...");bK=bz.centers();bH=new ah();bD=bz.xyz;for(bI=0,bN=bD.length;bI<bN;bI++){bG=bD[bI];bH.newV("v"+bI,bG)}bv=bz.face;for(bI=0,bO=bv.length;bI<bO;bI++){bJ=bv[bI];bw="v"+bJ[bJ.length-2];bu="v"+bJ[bJ.length-1];bC=bz.xyz[bJ[bJ.length-2]];bB=bz.xyz[bJ[bJ.length-1]];for(bt=0,bM=bJ.length;bt<bM;bt++){bF=bJ[bt];br="v"+bF;bA=bz.xyz[bF];bL=bw+"~"+bu;by=bu+"~"+bw;bx=bu+"~"+br;bH.newV(bL,aS(aS(bC,bB),bK[bI]));bH.newFlag("in"+bI,bL,bx);bH.newFlag("f"+bI+bu,bx,bL);bH.newFlag("f"+bI+bu,bL,bu);bH.newFlag("f"+bI+bu,bu,bx);bH.newFlag("f"+bL,bw,by);bH.newFlag("f"+bL,by,bL);bH.newFlag("f"+bL,bL,bw);bs=[bu,br],bw=bs[0],bu=bs[1];bq=[bB,bA],bC=bq[0],bB=bq[1]}}bE=bH.topoly();bE.name="*"+bz.name;return bE};Z=function(bt,bs){var bx,bv,bu,bq,by,br,bw;bx=0.1;bq=a3(bt);for(br=0,bw=bs.length;br<bw;br++){bu=bs[br];by=j(bq[bu[0]],bq[bu[1]]);bv=d(bx*1/2*(1-T(C(by,by))),by);bq[bu[0]]=y(bq[bu[0]],bv);bq[bu[1]]=y(bq[bu[1]],bv)}return bq};a8=function(bu,bt){var bx,bv,bq,br,by,bs,bw;bq=(function(){var bC,bA,bB,bz;bz=[];for(bC=0,bA=bt.length;bC<bA;bC++){bB=bt[bC],bx=bB[0],bv=bB[1];bz.push(j(bu[bx],bu[bv]))}return bz})();br=[0,0,0];for(bs=0,bw=bq.length;bs<bw;bs++){by=bq[bs];br=y(br,by)}br=d(1/bt.length,br);return _.map(bu,function(bz){return bc(bz,br)})};A=function(bt){var bq,bs,br;bs=[0,0,0];bq=_.max(_.map(bt,function(bu){return J(bu)}));br=1/bq;return _.map(bt,function(bu){return[br*bu[0],br*bu[1],br*bu[2]]})};bb=function(bw,bt){var bB,by,bA,bx,bs,bq,bC,bv,bu,bz,br;bB=0.1;bq=a3(bw);for(bv=0,bz=bt.length;bv<bz;bv++){bx=bt[bv];bA=(function(){var bF,bD,bE;bE=[];for(bF=0,bD=bx.length;bF<bD;bF++){bC=bx[bF];bE.push(bw[bC])}return bE})();bs=aj(bA);by=bh(bA);if(C(bs,by)<0){bs=d(-1,bs)}for(bu=0,br=bx.length;bu<br;bu++){bC=bx[bu];bq[bC]=y(bq[bC],d(C(d(bB,bs),bc(by,bw[bC])),bs))}}return bq};m=function(br,bx){var bu,bs,bv,bw,bq,bt,by;bx||(bx=1);console.log("Canonicalizing "+br.name+"...");bs=br.face;bu=br.getEdges();bq=br.xyz;bw=1;for(bv=0;0<=bx?bv<=bx:bv>=bx;0<=bx?bv++:bv--){by=a3(bq);bq=Z(bq,bu);bq=a8(bq,bu);bq=bb(bq,bs);bw=_.max(_.map(_.zip(bq,by),function(bA){var bz,bB;bz=bA[0],bB=bA[1];return J(bc(bz,bB))}));if(bw<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bw+"]");bt=new aM(bq,br.face,br.name);console.log("canonicalize",bt);return bt};N=function(bt){var bu,br,bs,bq;br=bt.centers();for(bs=0,bq=br.length;bs<bq;bs++){bu=br[bs];bu=d(1/C(bu,bu),bu)}return br};G=function(bs){var bG,bA,bt,bB,bq,bz,bF,bE,bC,bx,bw,bD,br,by,bv,bu;bG=[];by=bs.face;for(bx=0,bD=by.length;bx<bD;bx++){bB=by[bx];bt=[0,0,0];bq=[0,0,0];bA=0;bv=bB.slice(-2),bF=bv[0],bE=bv[1];for(bw=0,br=bB.length;bw<br;bw++){bC=bB[bw];bt=y(bt,bs.xyz[bC]);bq=y(bq,aT(bs.xyz[bF],bs.xyz[bE],bs.xyz[bC]));bA+=at(bs.xyz[bF],bs.xyz[bE]);bu=[bE,bC],bF=bu[0],bE=bu[1]}bt=d(1/bB.length,bt);bq=bi(bq);bA=bA/bB.length;bz=az(d(C(bt,bq),bq));bG.push(d((1+bA)/2,bz))}return bG};f=function(bu,br){var bs,bq,bt;br||(br=1);bq=aF(bu);console.log("Pseudo-canonicalizing "+bu.name+"...");for(bs=0,bt=br-1;0<=bt?bs<=bt:bs>=bt;0<=bt?bs++:bs--){bq.xyz=G(bu);bu.xyz=G(bq)}return new aM(bu.xyz,bu.face,bu.name)};x=function(bu,br){var bs,bq,bt;br||(br=1);bq=aF(bu);console.log("Planarizing "+bu.name+"...");for(bs=0,bt=br-1;0<=bt?bs<=bt:bs>=bt;0<=bt?bs++:bs--){bq.xyz=N(bu);bu.xyz=N(bq)}return new aM(bu.xyz,bu.face,bu.name)};I=function(bS){var bR,bN,bI,bL,bQ,bA,bT,bK,bG,bC,bP,bw,bM,bH,by,bz,bB,bJ,bO,bx,bv,bu,br,bq,bF,bD,bt,bE,bs;bB=999;bM=[];bH=[];by=bS.length;bP=function(bU,bV){return(bU||bV)&&!(bU&&bV)};bR=function(bW,bV,bU){return(bV[0]-bW[0])*(bU[1]-bW[1])-(bU[0]-bW[0])*(bV[1]-bW[1])};bG=function(bW,bV,bU){return bR(bW,bV,bU)>0};bC=function(bW,bV,bU){return bR(bW,bV,bU)>=0};bI=function(bW,bV,bU){return bR(bW,bV,bU)===0};bN=function(bW,bV,bU){if(bI(bW,bV,bU)){return false}if(bW[0]!==bV[0]){return(bW[0]<=bU[0])&&(bU[0]<=bV[0])||(bW[0]>=bU[0])&&(bU[0]>=bV[0])}else{return(bW[1]<=bU[1])&&(bU[1]<=bV[1])||(bW[1]>=bU[1])&&(bU[1]>=bV[1])}};bK=function(bX,bW,bV,bU){if(bI(bX,bW,bV)||bI(bX,bW,bU)||bI(bV,bU,bX)||bI(bV,bU,bW)){return false}return bP(bG(bX,bW,bV),bG(bX,bW,bU))&&bP(bG(bV,bU,bX),bG(bV,bU,bW))};bT=function(bX,bW,bV,bU){if(bK(bX,bW,bV,bU)){return true}else{if(bN(bX,bW,bV)||bN(bX,bW,bU)||bN(bV,bU,bX)||bN(bV,bU,bW)){return true}else{return false}}};bA=function(bW,bU){var bX,bV;bV=(bW+1+by)%by;bX=(bW-1+by)%by;if(bC(bS[bW],bS[bV],bS[bX])){return bG(bS[bW],bS[bU],bS[bX])&&bG(bS[bU],bS[bW],bS[bV])}return !(bC(bS[bW],bS[bU],bS[bV])&&bC(bS[bU],bS[bW],bS[bX]))};bQ=function(bV,bU){var bX,bW;bX=0;while(true){bW=(bX+1+by)%by;if((bX!==bV)&&(bW!==bV)&&(bX!==bU)&&(bW!==bU)&&bK(bS[bV],bS[bU],bS[bX],bS[bW])){return false}bX=(bX+1+by)%by;if(bX===0){break}}return true};bL=function(bV,bU){return bA(bV,bU)&&bA(bU,bV)&&bQ(bV,bU)};bv=0;while(true){bu=(bv+1+by)%by;bx=(bv-1+by)%by;bH[bv]=bL(bx,bu);bv=(bv+1+by)%by;if(bv===0){break}}bO=(function(){bs=[];for(var bV=0,bU=by-1;0<=bU?bV<=bU:bV>=bU;0<=bU?bV++:bV--){bs.push(bV)}return bs}).apply(this);bJ=by;bD=bB;bz=0;while(bD>0&&bJ>3){bD-=1;bu=bz;bF=bB;while(true){bF-=1;bw=false;if(bH[bu]){br=(bu+1+by)%by;bq=(br+1+by)%by;bv=(bu-1+by)%by;bx=(bv-1+by)%by;bM.push([bO[bv],bO[br]]);bH[bv]=bL(bx,br);bH[br]=bL(bv,bq);bS=bS.slice(0,bu+1||9000000000).concat(bS.slice(br));bO=bO.slice(0,bu+1||9000000000).concat(bO.slice(br));if(bx>bu){bx-=1}if(bv>bu){bv-=1}if(br>bu){br-=1}if(bq>bu){bq-=1}by--;bz=br;bJ--;bw=true}bu=(bu+1+by)%by;if(!(bF>0&&!bw&&bu!==bz)){break}}}return bM};a=function(br,bq){if(((br[0]===bq[0])&&(br[1]===bq[1])&&(br[2]===bq[2]))||(br[0]===bq[1])&&(br[1]===bq[2])&&(br[2]===bq[0])||(br[0]===bq[2])&&(br[1]===bq[0])&&(br[2]===bq[1])){return true}else{return false}};t=function(bX,bK){var bH,bY,bJ,bI,bF,bL,bV,br,bB,bZ,b2,b1,b0,bW,bU,bT,bS,bG,by,bx,bw,bv,bu,bt,bs,bq,bR,bQ,bP,bO,bN,bM,bE,bD,bC,bA,bz;bF=[];br=[];bM=(function(){var b4,b3;b3=[];for(bV=0,b4=bX.length-1;0<=b4?bV<=b4:bV>=b4;0<=b4?bV++:bV--){b3.push([bV,(bV+1)%bX.length])}return b3})();for(bW=0,bG=bM.length;bW<bG;bW++){bE=bM[bW],b1=bE[0],b0=bE[1];bF[b1]=[b0];br[b0]=[b1]}for(bU=0,by=bK.length;bU<by;bU++){bY=bK[bU];bF[bY[0]].push(bY[1]);bF[bY[1]].push(bY[0]);br[bY[0]].push(bY[1]);br[bY[1]].push(bY[0])}bZ=[];for(bT=0,bx=bK.length;bT<bx;bT++){bY=bK[bT];bD=bF[bY[1]];for(bS=0,bw=bD.length;bS<bw;bS++){bJ=bD[bS];bC=br[bY[0]];for(bR=0,bv=bC.length;bR<bv;bR++){bI=bC[bR];if(bJ===bI){bZ.push([bY[0],bY[1],bJ])}}}bA=bF[bY[0]];for(bQ=0,bu=bA.length;bQ<bu;bQ++){bJ=bA[bQ];bz=br[bY[1]];for(bP=0,bt=bz.length;bP<bt;bP++){bI=bz[bP];if(bJ===bI){bZ.push([bY[1],bY[0],bJ])}}}}b2=[bZ.pop()];for(bO=0,bs=bZ.length;bO<bs;bO++){bB=bZ[bO];bH=false;for(bN=0,bq=b2.length;bN<bq;bN++){bL=b2[bN];if(a(bB,bL)){bH=true;break}}if(!bH){b2.push(bB)}}return b2};aa=function(bs,bq){var bu,bt,bz,by,bw,bv,bD,bC,bB,bA,br,bx;bq=bq||false;console.log("Triangulating faces of "+bs.name+"...");bv=new aM();bv.xyz=K(bs.xyz);bv.face_colors=[];bx=bs.face;for(by=0,bA=bx.length;by<bA;by++){bz=bx[by];if(bz.length>3){bu=Y((function(){var bG,bE,bF;bF=[];for(bG=0,bE=bz.length;bG<bE;bG++){bB=bz[bG];bF.push(bs.xyz[bB])}return bF})());bt=I(bu);bC=t(bz,bt);for(bw=0,br=bC.length;bw<br;bw++){bD=bC[bw];bv.face.push([bz[bD[0]],bz[bD[1]],bz[bD[2]]]);if(bq){bv.face_colors.push(bs.face_colors[by])}}}else{bv.face.push([bz[0],bz[1],bz[2]]);if(bq){bv.face_colors.push(bs.face_colors[by])}}}bv.name=bs.name;return bv};ag=function(bq){var bv,bw,by,bt,bs,bx,br,bu;bw="";bu=bq.face;for(bt=0,bx=bu.length;bt<bx;bt++){bv=bu[bt];for(bs=0,br=bv.length;bs<br;bs++){by=bv[bs];bw+=""+by+"->"}bw+="\n"}return console.log(bw)};B=function(){var bx,bu,bt,bs,bw,bv,br,bq;bs=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bu=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bw=0,br=bu.length;bw<br;bw++){bx=bu[bw];console.log("Operator "+bx);for(bv=0,bq=bs.length;bv<bq;bv++){bt=bs[bv];console.log(bx+bt+":",generatePoly(bx+bt))}}return console.log("===== Done Testing Basic Ops =====")};aP='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.]+  { return parseFloat(digits.join(""), 10); }';bd=PEG.buildParser(aP);bp=function(br,bq){return br.apply(this,bq||[])};bf={T:e,O:ao,C:ai,I:a5,D:ap,P:R,A:aU,Y:bm};F={d:aF,k:ac,a:aE,g:a1,p:r,r:s,n:D,x:ab,l:aW,z:aa,K:f,C:m,A:x};aL=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];aZ=function(bt){var bq,bs,bw,bv,br,bu;bs=bt;for(bv=0,br=aL.length;bv<br;bv++){bu=aL[bv],bw=bu[0],bq=bu[1];bs=bs.replace(bw,bq)}console.log(""+bt+" executed as "+bs);return bs};bn=function(bw){var br,by,bt,bA,bu,bz,bv,bq,bs,bx;bv=aZ(bw);bz=bd.parse(bv).reverse();bt=bz.shift();by=bf[bt.op];br=bt.args;bq=bp(by,br);console.log("base",bq);for(bs=0,bx=bz.length;bs<bx;bs++){bt=bz[bs];bu=F[bt.op];bA=[bq].concat(bt.args);console.log(bA);bq=bp(bu,bA)}console.log("final",bq);bq.xyz=a8(bq.xyz,bq.getEdges());bq.xyz=A(bq.xyz);bq=P(bq);return bq};X=function(br){var bt,bq,bs;bs=new aM();bt=0;console.log(bd.parse(br).reverse());bq=aZ(br);if(bq.search(/([0-9]+)$/)!==-1){bt=1*RegExp.lastParen;bq=bq.slice(0,-RegExp.lastParen.length)}switch(bq.slice(-1)){case"T":bs=e();break;case"O":bs=ao();break;case"C":bs=ai();break;case"I":bs=a5();break;case"D":bs=ap();break;case"P":bs=R(bt);break;case"A":bs=aU(bt);break;case"Y":bs=bm(bt);break;default:return}while(bq!==""){bt=void 0;if(bq.search(/([0-9]+)$/)!==-1){bt=1*RegExp.lastParen;bq=bq.slice(0,-RegExp.lastParen.length)}switch(bq.slice(-1)){case"d":bs=aF(bs);break;case"k":bs=ac(bs,bt);break;case"a":bs=aE(bs);break;case"g":bs=a1(bs);break;case"p":bs=r(bs);break;case"r":bs=s(bs);break;case"K":bs=f(bs,bt);break;case"C":bs=m(bs,bt);break;case"A":bs=x(bs,bt);break;case"n":bs=D(bs,bt);break;case"x":bs=ab(bs,bt);break;case"l":bs=aW(bs,bt);break;case"z":bs=aa(bs)}bq=bq.slice(0,-1)}bs.xyz=a8(bs.xyz,bs.getEdges());bs.xyz=A(bs.xyz);bs=P(bs);return bs};ad={};bj=500;ax=400;O={};i=K(u);ak=K(u);S=800;z=5;bk=0;L=0.8;n=bj/2;au=ax/2;v=new Date();p=true;aQ="rgba(255,255,255,1.0)";am="area";g="fillstroke";ba=0.5;an=false;V=0;U=0;aD=[1,0,0];a2=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aB=function(bs,bq){var bt,br;bt=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;br=new bt();br.append(bs);return saveAs(br.getBlob("text/plain;charset="+document.characterSet),bq)};aq=["#ff3333","#33ff33","#3333ff","#ffff33","#ff33ff","#33ffff","#dddddd","#555555","#dd0000","#00dd00","#0000dd"];aN=["#ff8888","#dddddd","#777777","#aa3333","#ff0000","#ffffff","#aaaaaa"];k=["#ff8888","#ffeeee","#88ff88","#dd7777","#ff2222","#22ff22","#ee4422","#aaaaaa"];bo=function(br){var bq;if(br[0]==="#"){br=br.slice(1)}if(br.length===3){bq=br.split("").map(function(bs){return parseInt(bs+bs,16)/255})}else{bq=br.match(/.{2}/g).map(function(bs){return parseInt(bs,16)/255})}return bq};aY=aN;af=function(bq){if(bq<aY.length){return bo(aY[bq])}else{return bo(aY[aY.length-1])}};aV=function(bq,bt){var br,bs;bs=W(100*bq);if(bs in bt){return bt[bs]}else{br=af(_.toArray(bt).length);bt[bs]=br;return br}};P=function(bq){var by,bu,bt,bw,bx,br,bv,bs;bq.face_colors=[];bu={};bs=bq.face;for(br=0,bv=bs.length;br<bv;br++){bt=bs[br];if(am==="area"){bw=(function(){var bB,bz,bA;bA=[];for(bB=0,bz=bt.length;bB<bz;bB++){bx=bt[bB];bA.push(bq.xyz[bx])}return bA})();by=aV(bg(bw),bu)}else{by=af(bt.length-3)}bq.face_colors.push(by)}return bq};bl=function(){var bq,bv,bu,bt,bs,br;br={};bq=/\+/g;bs=/([^&=]+)=?([^&]*)/g;bv=function(bw){return decodeURIComponent(bw.replace(bq," "))};bt=window.location.search.substring(1);while(bu=bs.exec(bt)){br[bv(bu[1])]=bv(bu[2])}return br};aH=function(){var bq;bq=$("#poly");bq.width(bj);bq.height(ax);ad=bq[0].getContext("2d");ad.lineWidth=ba;if(p){return ad.clearRect(0,0,bj,ax)}else{ad.clearRect(0,0,bj,ax);ad.fillStyle=aQ;return ad.fillRect(0,0,bj,ax)}};aJ=function(){if(p){return ad.clearRect(0,0,bj,ax)}else{ad.clearRect(0,0,bj,ax);ad.fillStyle=aQ;return ad.fillRect(0,0,bj,ax)}};aO=function(bq){var br,bz,by,bA,bu,bs,bx,bv,bw,bt;br=bq.centers();by=bq.normals();bu=[0,0,(z*L-bk)/(1-L)];bA=function(bC,bB){return -C(bc(bu,bC[0]),bC[1])*C(bc(bB[0],bC[0]),bC[1])};bs=function(bC,bB){return bC[0][2]-bB[0][2]};bx=_.zip(br,by,(function(){bt=[];for(var bC=0,bB=bq.face.length-1;0<=bB?bC<=bB:bC>=bB;0<=bB?bC++:bC--){bt.push(bC)}return bt}).apply(this)).sort(bs).map(function(bB){return bB[2]});bq.face=(function(){var bD,bB,bC;bC=[];for(bD=0,bB=bx.length;bD<bB;bD++){bz=bx[bD];bC.push(bq.face[bz])}return bC})();return bq.face_colors=(function(){var bD,bB,bC;bC=[];for(bD=0,bB=bx.length;bD<bB;bD++){bz=bx[bD];bC.push(bq.face_colors[bz])}return bC})()};Q=function(bx,bF){var br,bz,by,bE,bt,bv,bD,bw,bC,bA,bs,bG,bH,bB,bu,bq;bF||(bF=[3,3,3]);bv=_.map(bx.xyz,function(bI){return bI});bx.xyz=_.map(bx.xyz,function(bI){return q(i,bI)});aO(bx);bB=bx.face;for(bE=0,bG=bB.length;bE<bG;bE++){bz=bB[bE];ad.beginPath();bw=bz[bz.length-1];bu=w(y(bF,bx.xyz[bw]),z,bk,L,S),bC=bu[0],bA=bu[1];ad.moveTo(bC+n,bA+au);for(bs=0,bH=bz.length;bs<bH;bs++){bD=bz[bs];bq=w(y(bF,bx.xyz[bD]),z,bk,L,S),bC=bq[0],bA=bq[1];ad.lineTo(bC+n,bA+au)}br=bx.face_colors[bE];by=(function(){var bJ,bK,bI;bI=[];for(bJ=0,bK=bz.length;bJ<bK;bJ++){bD=bz[bJ];bI.push(bx.xyz[bD])}return bI})();bt=C(aj(by),bi([1,-1,0]));br=d((bt/2+0.5)*0.7+0.3,br);if(g==="fill"||g==="fillstroke"){ad.fillStyle="rgba("+(W(br[0]*255))+", "+(W(br[1]*255))+", "+(W(br[2]*255))+", "+1+")";ad.fill();ad.strokeStyle="rgba("+(W(br[0]*255))+", "+(W(br[1]*255))+", "+(W(br[2]*255))+", "+1+")";ad.stroke()}if(g==="fillstroke"){ad.fillStyle="rgba("+(W(br[0]*255))+", "+(W(br[1]*255))+", "+(W(br[2]*255))+", "+1+")";ad.fill();ad.strokeStyle="rgba(0,0,0, .3)";ad.stroke()}if(g==="stroke"){ad.strokeStyle="rgba(0,0,0, .8)";ad.stroke()}}return bx.xyz=bv};ay=function(){var bs,bt,br,bq;aJ();bq=[];for(bs=0,br=O.length;bs<br;bs++){bt=O[bs];bq.push(Q(bt,[0+3*bs,0,3]))}return bq};be=function(){var br,bs,bt,bq;aJ();br=(2*Math.PI)/180*v.getSeconds()*0.1;for(bs=0,bq=O.length;bs<bq;bs++){bt=O[bs];Q(bt,[0+3*bs,0,3])}return setTimeout(be,100)};$(function(){var br,bq;aH();bq=bl();if("recipe" in bq){br=[bq.recipe];$("#spec").val(br)}else{br=[a9(a2)];$("#spec").val(br)}O=_.map(br,function(bs){return bn(bs)});ay();$("#spec").change(function(bs){br=$("#spec").val().split(/\s+/g).slice(0,2);O=_.map(br,function(bt){return bn(bt)});return ay()});$("#poly").mousewheel(function(bu,bv,bt,bs){bu.preventDefault();S*=(10+bv)/10;return ay()});$("#poly").mousedown(function(bs){var bt;bs.preventDefault();an=true;V=bs.clientX-$(this).offset().left;U=bs.clientY-($(this).offset().top-$(window).scrollTop());bt=aI(V,U,n,au,z,bk,L,S);if(bt[0]*bt[1]*bt[2]*0===0){aD=bt}return ak=K(i)});$("#poly").mouseup(function(bs){bs.preventDefault();return an=false});$("#poly").mouseleave(function(bs){bs.preventDefault();return an=false});$("#poly").mousemove(function(bv){var bt,bs,bu;bv.preventDefault();if(an){bt=bv.clientX-$(this).offset().left;bs=bv.clientY-($(this).offset().top-$(window).scrollTop());bu=aI(bt,bs,n,au,z,bk,L,S);if(bu[0]*bu[1]*bu[2]*0===0&&aD[0]*aD[1]*aD[2]*0===0){i=aC(aA(aD,bu),ak)}return ay()}});$("#strokeonly").click(function(bs){g="stroke";return ay()});$("#fillonly").click(function(bs){g="fill";return ay()});$("#fillandstroke").click(function(bs){g="fillstroke";return ay()});$("#siderot").click(function(bs){i=aR(aG/2,0,1,0);return ay()});$("#toprot").click(function(bs){i=aR(aG/2,1,0,0);return ay()});$("#frontrot").click(function(bs){i=h(0,0,0);return ay()});$("#pngsavebutton").click(function(bv){var bu,bt,bs;bu=$("#poly")[0];bs=$("#spec").val().split(/\s+/g)[0];bt="polyhedronisme-"+bs+".png";return bu.toBlob(function(bw){return saveAs(bw,bt)})});$("#objsavebutton").click(function(bv){var bt,bu,bs;bu=O[0].toOBJ();bs=$("#spec").val().split(/\s+/g)[0];bt="polyhedronisme-"+bs+".obj";return aB(bu,bt)});return $("#x3dsavebutton").click(function(bv){var bt,bs,bu,bw;bu=aa(O[0],true);bw=bu.toVRML();bs=$("#spec").val().split(/\s+/g)[0];bt="polyhedronisme-"+bs+".wrl";return aB(bw,bt)})})}).call(this);