(function(){var p,aP,aw,bh,al,a0,V,U,aC,am,aW,aO,aF,g,ad,aY,y,x,aD,bc,aT,M,av,bd,bf,f,m,aI,K,be,a1,H,au,ac,a8,ah,ap,t,bn,ao,C,ax,Q,aE,ar,aa,u,a4,ak,I,aX,az,O,i,aj,v,aZ,bm,a3,aG,D,E,aH,ab,J,a2,aR,aB,d,q,bl,ai,an,aq,bb,F,aS,P,ae,bj,w,L,z,bi,S,a9,ag,aL,a5,R,X,r,bk,aJ,a7,a6,ay,N,G,s,A,h,W,aM,k,aA,aV,aN,aK,T,aU,ba,b,j,Y,B,e,af,a,Z,l,bg,aQ,c,n,at,o;aJ=Math.random;W=Math.round;ak=Math.floor;T=Math.sqrt;aV=Math.sin;H=Math.cos;b=Math.tan;M=Math.asin;aY=Math.acos;av=Math.atan;a5=Math.pow;ad=Math.abs;aF=Math.PI;K=function(bq){var bp,bo;if(!(bq!=null)||typeof bq!=="object"){return bq}bo=new bq.constructor();for(bp in bq){bo[bp]=K(bq[bp])}return bo};a7=function(bp){var bo;bo=ak(aJ()*bp.length);return bp[bo]};d=function(bp,bo){return[bp*bo[0],bp*bo[1],bp*bo[2]]};o=function(bp,bo){return[bp[0]*bo[0],bp[1]*bo[1],bp[2]*bo[2]]};y=function(bp,bo){return[bp[0]+bo[0],bp[1]+bo[1],bp[2]+bo[2]]};ba=function(bp,bo){return[bp[0]-bo[0],bp[1]-bo[1],bp[2]-bo[2]]};C=function(bp,bo){return bp[0]*bo[0]+bp[1]*bo[1]+bp[2]*bo[2]};au=function(bp,bo){return[bp[1]*bo[2]-bp[2]*bo[1],bp[2]*bo[0]-bp[0]*bo[2],bp[0]*bo[1]-bp[1]*bo[0]]};J=function(bo){return T(C(bo,bo))};a2=function(bo){return C(bo,bo)};bg=function(bo){return d(1/T(a2(bo)),bo)};aR=function(bp,bo){return d(1/2,y(bp,bo))};l=function(bq,bp,bo){return[(1-bo)*bq[0]+bo*bp[0],(1-bo)*bq[1]+bo*bp[1],(1-bo)*bq[2]+bo*bp[2]]};aq=function(bp,bo){return l(bp,bo,1/3)};ay=function(bo){return d(1/a2(bo),bo)};j=function(bq,bp){var bo;bo=ba(bp,bq);return ba(bq,d(C(bo,bq)/a2(bo),bo))};ar=function(bp,bo){return T(a2(j(bp,bo)))};aS=function(bs,br,bq){var bp,bo;bp=ba(br,bs);bo=ba(bq,br);return au(bp,bo)};E=function(bv,bu,bt){var bz,by,bx,bs,br,bq,bw,bp,bo;for(bs=0,bw=bv.length;bs<bw;bs++){bz=bv[bs];for(br=0,bp=bu.length;br<bp;br++){by=bu[br];if(bz===by){for(bq=0,bo=bt.length;bq<bo;bq++){bx=bt[bq];if(bz===bx){return bz}}}}}return null};bf=function(bs){var bq,bp,br,bo;bq=[0,0,0];for(br=0,bo=bs.length;br<bo;br++){bp=bs[br];bq=y(bq,bp)}return d(1/bs.length,bq)};ai=function(bs){var bo,bw,bu,bt,bq,bv,br,bp;bo=[0,0,0];br=bs.slice(-2),bw=br[0],bu=br[1];for(bq=0,bv=bs.length;bq<bv;bq++){bt=bs[bq];bo=y(bo,aS(bw,bu,bt));bp=[bu,bt],bw=bp[0],bu=bp[1]}return bg(bo)};be=function(bs){var bo,bw,bu,bt,bq,bv,br,bp;bo=0;br=bs.slice(0,2),bw=br[0],bu=br[1];bp=bs.slice(2);for(bq=0,bv=bp.length;bq<bv;bq++){bt=bp[bq];bo+=J(au(ba(bu,bw),ba(bt,bw)));bu=bt}return bo};X=function(bv){var bt,bp,bo,bs,bw,bx,br,bu,bq;bs=K(bv);bx=bv[0];bs=_.map(bs,function(by){return by-bx});bp=ai(bv);bt=bg(bf(bv));bo=au(bp,bt);bq=[];for(br=0,bu=bs.length;br<bu;br++){bw=bs[br];bq.push([C(bp,bw),C(bo,bw)])}return bq};a1=function(bq){var bp,bo,br;bo=new Array(bq.length);for(bp=0,br=bq.length-1;0<=br?bp<=br:bp>=br;0<=br?bp++:bp--){bo[bp]=bq[bp].slice(0)}return bo};q=function(bp,bo){return[bp[0][0]*bo[0]+bp[0][1]*bo[1]+bp[0][2]*bo[2],bp[1][0]*bo[0]+bp[1][1]*bo[1]+bp[1][2]*bo[2],bp[2][0]*bo[0]+bp[2][1]*bo[1]+bp[2][2]*bo[2]]};aB=function(bo,bp){return[[bo[0][0]*bp[0][0]+bo[0][1]*bp[1][0]+bo[0][2]*bp[2][0],bo[0][0]*bp[0][1]+bo[0][1]*bp[1][1]+bo[0][2]*bp[2][1],bo[0][0]*bp[0][2]+bo[0][1]*bp[1][2]+bo[0][2]*bp[2][2]],[bo[1][0]*bp[0][0]+bo[1][1]*bp[1][0]+bo[1][2]*bp[2][0],bo[1][0]*bp[0][1]+bo[1][1]*bp[1][1]+bo[1][2]*bp[2][1],bo[1][0]*bp[0][2]+bo[1][1]*bp[1][2]+bo[1][2]*bp[2][2]],[bo[2][0]*bp[0][0]+bo[2][1]*bp[1][0]+bo[2][2]*bp[2][0],bo[2][0]*bp[0][1]+bo[2][1]*bp[1][1]+bo[2][2]*bp[2][1],bo[2][0]*bp[0][2]+bo[2][1]*bp[1][2]+bo[2][2]*bp[2][2]]]};u=[[1,0,0],[0,1,0],[0,0,1]];h=function(bs,bq,br){var bt,bp,bo;bt=[[H(bs),-1*aV(bs),0],[aV(bs),H(bs),0],[0,0,1]];bo=[[H(bq),0,-1*aV(bq)],[0,1,0],[aV(bq),0,H(bq)]];bp=[[1,0,0],[0,H(br),-1*aV(br)],[0,aV(br),H(br)]];return aB(bp,aB(bo,bt))};aQ=function(bs,bB,bz,bw){var bv,bp,bq,bA,by,bo,bx,bt,bu,br;bs/=2;bA=aV(bs);bv=H(bs);by=bA*bA;bp=J([bB,bz,bw]);if(bp===0){bu=[0,0,1],bB=bu[0],bz=bu[1],bw=bu[2]}if(bp!==1){br=bg([bB,bz,bw]),bB=br[0],bz=br[1],bw=br[2]}if(bB===1&&bz===0&&bw===0){bq=[[1,0,0],[0,1-2*by,2*bA*bv],[0,-2*bA*bv,1-2*by]]}else{if(bB===0&&bz===1&&bw===0){bq=[[1-2*by,0,-2*bA*bv],[0,1,0],[2*bA*bv,0,1-2*by]]}else{if(bB===0&&bz===0&&bw===1){bq=[[1-2*by,2*bA*bv,0],[-2*bA*bv,1-2*by,0],[0,0,1]]}else{bo=bB*bB;bx=bz*bz;bt=bw*bw;bq=[[1-2*(bx+bt)*by,2*(bB*bz*by+bw*bA*bv),2*(bB*bw*by-bz*bA*bv)],[2*(bz*bB*by-bw*bA*bv),1-2*(bt+bo)*by,2*(bz*bw*by+bB*bA*bv)],[2*(bw*bB*by+bz*bA*bv),2*(bw*bz*by-bB*bA*bv),1-2*(bo+bx)*by]]}}}return bq};w=function(bq,bp,br,bu,bo){var bs,bt;bt=(bp*bu-br)/(1-bu);bs=bo*bu/(1-bu);return[bs*bq[0]/(bq[2]+bt),bs*bq[1]/(bq[2]+bt)]};aH=function(bv,bs,by,bw,bC,br,bq,bp){var bB,bo,bx,bt,bz,bE,bG,bu,bA,bD,bF;bA=(bC*bq-br)/(1-bq);bB=bp*bq/(1-bq);bx=bv-by;bE=bs-bw;bo=bB*bB;bD=bA*bA;bt=bx*bx;bG=bE*bE;bz=(2*bB*bx*bA+T(4*bo*bt*bD+4*bt*(bo+bt+bG)*(1-bD)))/(2*(bo+bt+bG));bu=(bB*bE*bA)/(bo+bt+bG)+(bE*T(4*bo*bD+4*(bo+bt+bG)*(1-bD)))/(2*(bo+bt+bG));bF=T(1-bz*bz-bu*bu);return[bz,bu,bF]};az=function(bq,bp){var br,bo;bo=au(bq,bp);br=aY(C(bq,bp));return aQ(-1*br,bo[0],bo[1],bo[2])};a4=function(br){var bp,bt,bs,bq,bo;bp=[];bt=br.slice(-1)[0];for(bq=0,bo=br.length;bq<bo;bq++){bs=br[bq];bp.push([bt,bs]);bt=bs}return bp};c=function(bo){var bt,bs,bw,bu,bq,bv,bp,br;bu=[];br=bo.face;for(bs=0,bv=br.length;bs<bv;bs++){bt=br[bs];for(bq=0,bp=bt.length;bq<bp;bq++){bw=bt[bq];bu[bw]=bo.face_class[bs]}}return bu};ap=["#ff3333","#33ff33","#3333ff","#ffff33","#ff33ff","#33ffff","#dddddd","#555555","#dd0000","#00dd00","#0000dd"];aM=["#ff7777","#dddddd","#889999","fff0e5","#aa3333","#ff0000","#ffffff","#aaaaaa"];k=["#ff8888","#ffeeee","#88ff88","#dd7777","#ff2222","#22ff22","#ee4422","#aaaaaa"];bm=function(bp){var bo;if(bp[0]==="#"){bp=bp.slice(1)}if(bp.length===3){bo=bp.split("").map(function(bq){return parseInt(bq+bq,16)/255})}else{bo=bp.match(/.{2}/g).map(function(bq){return parseInt(bq,16)/255})}return bo};aW=aM;ae=function(bo){if(bo<aW.length){return bm(aW[bo])}else{return bm(aW[aW.length-1])}};P=function(bo){var bx,bp,bt,bs,bv,bw,bq,bu,br;bo.face_class=[];bt={};bp=function(by,bB){var bz,bA;bA=W(100*by);if(bA in bB){return bB[bA]}else{bz=_.toArray(bB).length;bB[bA]=bz;return bz}};br=bo.face;for(bq=0,bu=br.length;bq<bu;bq++){bs=br[bq];if(al==="area"){bv=(function(){var bA,by,bz;bz=[];for(bA=0,by=bs.length;bA<by;bA++){bw=bs[bA];bz.push(bo.xyz[bw])}return bz})();bx=bp(be(bv),bt)}else{bx=bs.length-3}bo.face_class.push(bx)}console.log(_.toArray(bt).length+" face classes");return bo};aN=function(bo){var bp,bx,bw,by,bs,bq,bv,bt,bu,br;bp=bo.centers();bw=bo.normals();bs=[0,0,(z*L-bi)/(1-L)];by=function(bA,bz){return -C(ba(bs,bA[0]),bA[1])*C(ba(bz[0],bA[0]),bA[1])};bq=function(bA,bz){return bA[0][2]-bz[0][2]};bv=_.zip(bp,bw,(function(){br=[];for(var bA=0,bz=bo.face.length-1;0<=bz?bA<=bz:bA>=bz;0<=bz?bA++:bA--){br.push(bA)}return br}).apply(this)).sort(bq).map(function(bz){return bz[2]});bo.face=(function(){var bB,bz,bA;bA=[];for(bB=0,bz=bv.length;bB<bz;bB++){bx=bv[bB];bA.push(bo.face[bx])}return bA})();return bo.face_class=(function(){var bB,bz,bA;bA=[];for(bB=0,bz=bv.length;bB<bz;bB++){bx=bv[bB];bA.push(bo.face_class[bx])}return bA})()};aL=(function(){function bo(br,bp,bq){this.face=bp||new Array();this.xyz=br||new Array();this.name=bq||"null polyhedron"}bo.prototype.data=function(){var bp;bp=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bp+" edges, "+this.xyz.length+" vertices)"};bo.prototype.getEdges=function(){var bz,bv,bx,bw,bq,bu,bt,bA,bs,br,by,bp;bu={};bA=[];bv=_.map(this.face,a4);for(bs=0,by=bv.length;bs<by;bs++){bq=bv[bs];for(br=0,bp=bq.length;br<bp;br++){bw=bq[br];if(bw[0]<bw[1]){bz=bw[0],bx=bw[1]}else{bx=bw[0],bz=bw[1]}bu[bz+"~"+bx]=bw}}for(bt in bu){bw=bu[bt];bA.push(bw)}return bA};bo.prototype.centers=function(){var bu,bv,br,bx,bs,bq,bw,bp,bt;bu=[];bt=this.face;for(bs=0,bw=bt.length;bs<bw;bs++){bv=bt[bs];br=[0,0,0];for(bq=0,bp=bv.length;bq<bp;bq++){bx=bv[bq];br=y(br,this.xyz[bx])}bu.push(d(1/bv.length,br))}return bu};bo.prototype.normals=function(){var bt,bu,bq,bs,bp,br;bu=[];br=this.face;for(bs=0,bp=br.length;bs<bp;bs++){bt=br[bs];bu.push(ai((function(){var bx,bv,bw;bw=[];for(bx=0,bv=bt.length;bx<bv;bx++){bq=bt[bx];bw.push(this.xyz[bq])}return bw}).call(this)))}return bu};bo.prototype.toOBJ=function(){var bz,by,bq,bA,bC,bw,bv,bu,bB,br,bp,bD,bx,bt,bs;bA="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bA+="group "+this.name+"\n";bA+="#vertices\n";bx=this.xyz;for(bw=0,bB=bx.length;bw<bB;bw++){bC=bx[bw];bA+="v "+bC[0]+" "+bC[1]+" "+bC[2]+"\n"}bA+="#normal vector defs \n";bt=this.face;for(bv=0,br=bt.length;bv<br;bv++){bz=bt[bv];bq=ai((function(){var bF,bG,bE;bE=[];for(bF=0,bG=bz.length;bF<bG;bF++){bC=bz[bF];bE.push(this.xyz[bC])}return bE}).call(this));bA+="vn "+bq[0]+" "+bq[1]+" "+bq[2]+"\n"}bA+="#face defs \n";bs=this.face;for(by=0,bp=bs.length;by<bp;by++){bz=bs[by];bA+="f ";for(bu=0,bD=bz.length;bu<bD;bu++){bC=bz[bu];bA+=""+(bC+1)+"//"+(by+1)+" "}bA+="\n"}return bA};bo.prototype.toX3D=function(){var bt,bC,bF,bz,bB,bD,bx,bw,bv,bs,bA,bq,bp,bE,by,bu,br;bt=0.01;bD='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';by=this.face;for(bx=0,bA=by.length;bx<bA;bx++){bz=by[bx];for(bw=0,bq=bz.length;bw<bq;bw++){bB=bz[bw];bD+=""+bB+" "}bD+="-1\n"}bD+='">\n';bD+='<Color color="';bu=c(this);for(bv=0,bp=bu.length;bv<bp;bv++){bC=bu[bv];bF=ae(bC);bD+=""+bF[0]+" "+bF[1]+" "+bF[2]+" "}bD+='"/>';bD+='<Coordinate point="';br=this.xyz;for(bs=0,bE=br.length;bs<bE;bs++){bB=br[bs];bD+=""+(bB[0]*bt)+" "+(bB[1]*bt)+" "+(bB[2]*bt)+" "}bD+='"/>\n';bD+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bD};bo.prototype.toVRML=function(){var bt,bC,bF,bz,bB,bD,bx,bw,bv,bs,bA,bq,bp,bE,by,bu,br;bt=0.01;bD='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';by=this.xyz;for(bx=0,bA=by.length;bx<bA;bx++){bB=by[bx];bD+=""+(bB[0]*bt)+" "+(bB[1]*bt)+" "+(bB[2]*bt)+","}bD=bD.slice(0,-1);bD+="    ]\n}\ncolor Color\n{\n  color\n  [";bu=this.face_class;for(bw=0,bq=bu.length;bw<bq;bw++){bC=bu[bw];bF=ae(bC);bD+=""+bF[0]+" "+bF[1]+" "+bF[2]+" ,"}bD=bD.slice(0,-1);bD+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";br=this.face;for(bv=0,bp=br.length;bv<bp;bv++){bz=br[bv];for(bs=0,bE=bz.length;bs<bE;bs++){bB=bz[bs];bD+=""+bB+", "}bD+="-1,"}bD=bD.slice(0,-1);bD+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bD};return bo})();e=function(){var bo;bo=new aL();bo.name="T";bo.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bo.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bo};an=function(){var bo;bo=new aL();bo.name="O";bo.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bo.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bo};ah=function(){var bo;bo=new aL();bo.name="C";bo.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bo.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bo};a3=function(){var bo;bo=new aL();bo.name="I";bo.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bo.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bo};ao=function(){var bo;bo=new aL();bo.name="D";bo.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bo.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bo};R=function(bs){var bB,bA,bo,bq,by,bx,bz,bv,bt,br,bp,bw,bu;bq=2*aF/bs;bB=Math.sin(bq/2);bo=new aL();bo.name="P"+bs;for(bA=0,bz=bs-1;0<=bz?bA<=bz:bA>=bz;0<=bz?bA++:bA--){bo.xyz.push([-H(bA*bq),-aV(bA*bq),-bB])}for(bA=0,bv=bs-1;0<=bv?bA<=bv:bA>=bv;0<=bv?bA++:bA--){bo.xyz.push([-H(bA*bq),-aV(bA*bq),bB])}bo.face.push((function(){bw=[];for(var bC=bt=bs-1;bt<=0?bC<=0:bC>=0;bt<=0?bC++:bC--){bw.push(bC)}return bw}).apply(this));bo.face.push((function(){bu=[];for(var bC=bs,bD=2*bs-1;bs<=bD?bC<=bD:bC>=bD;bs<=bD?bC++:bC--){bu.push(bC)}return bu}).apply(this));for(bA=0,bp=bs-1;0<=bp?bA<=bp:bA>=bp;0<=bp?bA++:bA--){bo.face.push([bA,(bA+1)%bs,(bA+1)%bs+bs,bA+bs])}bo=x(bo,1);return bo};aT=function(bt){var bD,bC,bB,bp,bo,br,bz,by,bA,bw,bu,bs,bq,bx,bv;br=2*aF/bt;bC=T(1-4/(4+2*H(br/2)-2*H(br)));bo=T(1-bC*bC);bD=T(bC*bC+a5(bo*H(br/2),2));bo=-bo/bD;bC=-bC/bD;bp=new aL();bp.name="A"+bt;for(bB=0,bA=bt-1;0<=bA?bB<=bA:bB>=bA;0<=bA?bB++:bB--){bp.xyz.push([bo*H(bB*br),bo*aV(bB*br),bC])}for(bB=0,bw=bt-1;0<=bw?bB<=bw:bB>=bw;0<=bw?bB++:bB--){bp.xyz.push([bo*H((bB+0.5)*br),bo*aV((bB+0.5)*br),-bC])}bp.face.push((function(){bx=[];for(var bE=bu=bt-1;bu<=0?bE<=0:bE>=0;bu<=0?bE++:bE--){bx.push(bE)}return bx}).apply(this));bp.face.push((function(){bv=[];for(var bE=bt,bF=2*bt-1;bt<=bF?bE<=bF:bE>=bF;bt<=bF?bE++:bE--){bv.push(bE)}return bv}).apply(this));for(bB=0,bq=bt-1;0<=bq?bB<=bq:bB>=bq;0<=bq?bB++:bB--){bp.face.push([bB,(bB+1)%bt,bB+bt]);bp.face.push([bB,bB+bt,(bt+bB-1)%bt+bt])}bp=x(bp,1);return bp};bk=function(bq){var bx,bw,bo,bp,bu,bv,bs,br,bt;bp=2*aF/bq;bx=1;bo=new aL();bo.name="Y"+bq;for(bw=0,bv=bq-1;0<=bv?bw<=bv:bw>=bv;0<=bv?bw++:bw--){bo.xyz.push([-H(bw*bp),-aV(bw*bp),-0.2])}bo.xyz.push([0,0,bx]);bo.face.push((function(){bt=[];for(var by=bs=bq-1;bs<=0?by<=0:by>=0;bs<=0?by++:by--){bt.push(by)}return bt}).apply(this));for(bw=0,br=bq-1;0<=br?bw<=br:bw>=br;0<=br?bw++:bw--){bo.face.push([bw,(bw+1)%bq,bq])}bo=f(bo,3);return bo};ag=(function(){function bo(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bo.prototype.newV=function(bq,bp){if(this.verts[bq]===void 0){this.verts[bq]=0;return this.xyzs[bq]=bp}};bo.prototype.newFlag=function(bp,br,bq){if(this.flags[bp]===void 0){this.flags[bp]={}}return this.flags[bp][br]=bq};bo.prototype.topoly=function(){var bq,bv,by,bu,bs,bp,bw,bx,bt,br;bp=new aL();bq=0;bt=this.verts;for(bu in bt){bw=bt[bu];bp.xyz[bq]=this.xyzs[bu];this.verts[bu]=bq;bq++}bq=0;br=this.flags;for(bu in br){bv=br[bu];bp.face[bq]=[];for(bs in bv){bw=bv[bs];bx=bw;break}bw=bx;bp.face[bq].push(this.verts[bw]);bw=this.flags[bu][bw];by=0;while(bw!==bx){bp.face[bq].push(this.verts[bw]);bw=this.flags[bu][bw];by++;if(by>1000){console.log("Bad flag spec, have a neverending face:",bu,this.flags[bu]);break}}bq++}bp.name="unknown polyhedron";return bp};return bo})();ab=function(bv,bB,bu){var bt,bF,bE,bC,bI,bs,bD,bx,bz,bA,by,br,bo,bp,bH,bJ,bG,bw,bq;bB||(bB=0);bu||(bu=0.1);console.log("Taking kis of "+(bB===0?"":bB)+"-sided faces of "+bv.name+"...");bC=new ag();bw=bv.xyz;for(bD=0,bH=bw.length;bD<bH;bD++){bA=bw[bD];bC.newV("v"+bD,bA)}bz=bv.normals();bF=bv.centers();bs=false;bq=bv.face;for(bD=0,bJ=bq.length;bD<bJ;bD++){bE=bq[bD];br="v"+bE[bE.length-1];for(bp=0,bG=bE.length;bp<bG;bp++){by=bE[bp];bo="v"+by;if(bE.length===bB||bB===0){bs=true;bt="apex"+bD;bI=""+bD+br;bC.newV(bt,y(bF[bD],d(bu,bz[bD])));bC.newFlag(bI,br,bo);bC.newFlag(bI,bo,bt);bC.newFlag(bI,bt,br)}else{bC.newFlag(""+bD,br,bo)}br=bo}}if(!bs){console.log("No "+bB+"-fold components were found.")}bx=bC.topoly();bx.name="k"+(bB===0?"":bB)+bv.name;return bx};aD=function(bp){var bx,by,bw,bq,bt,bC,bB,bz,bu,bA,bo,bv,bs,br;console.log("Taking ambo of "+bp.name+"...");bq=function(bE,bD){if(bE<bD){return bE+"_"+bD}else{return bD+"_"+bE}};by=new ag();bv=bp.face;for(bw=0,bA=bv.length;bw<bA;bw++){bx=bv[bw];bs=bx.slice(-2),bC=bs[0],bB=bs[1];for(bu=0,bo=bx.length;bu<bo;bu++){bz=bx[bu];if(bC<bB){by.newV(bq(bC,bB),aR(bp.xyz[bC],bp.xyz[bB]))}by.newFlag("orig"+bw,bq(bC,bB),bq(bB,bz));by.newFlag("dual"+bB,bq(bB,bz),bq(bC,bB));br=[bB,bz],bC=br[0],bB=br[1]}}bt=by.topoly();bt.name="a"+bp.name;return bt};aZ=function(bv){var bD,bC,bA,bG,bB,bz,bx,by,bu,bs,bq,bF,bI,bH,bE,bw,bt,br,bp,bo;console.log("Taking gyro of "+bv.name+"...");bA=new ag();bw=bv.xyz;for(bB=0,bF=bw.length;bB<bF;bB++){by=bw[bB];bA.newV("v"+bB,bg(by))}bD=bv.centers();bt=bv.face;for(bB=0,bI=bt.length;bB<bI;bB++){bC=bt[bB];bA.newV("center"+bB,bg(bD[bB]))}br=bv.face;for(bB=0,bH=br.length;bB<bH;bB++){bC=br[bB];bp=bC.slice(-2),bu=bp[0],bs=bp[1];for(bz=0,bE=bC.length;bz<bE;bz++){by=bC[bz];bq=by;bA.newV(bu+"~"+bs,aq(bv.xyz[bu],bv.xyz[bs]));bG=bB+"f"+bu;bA.newFlag(bG,"center"+bB,bu+"~"+bs);bA.newFlag(bG,bu+"~"+bs,bs+"~"+bu);bA.newFlag(bG,bs+"~"+bu,"v"+bs);bA.newFlag(bG,"v"+bs,bs+"~"+bq);bA.newFlag(bG,bs+"~"+bq,"center"+bB);bo=[bs,bq],bu=bo[0],bs=bo[1]}}bx=bA.topoly();bx.name="g"+bv.name;return bx};r=function(bv){var bB,bz,bD,bA,bx,by,bt,bq,bp,br,bC,bF,bE,bw,bu,bs,bo;console.log("Taking propellor of "+bv.name+"...");bz=new ag();bw=bv.xyz;for(bA=0,bC=bw.length;bA<bC;bA++){by=bw[bA];bz.newV("v"+bA,bg(by))}bu=bv.face;for(bA=0,bF=bu.length;bA<bF;bA++){bB=bu[bA];bs=bB.slice(-2),bt=bs[0],bq=bs[1];for(br=0,bE=bB.length;br<bE;br++){by=bB[br];bp=""+by;bz.newV(bt+"~"+bq,aq(bv.xyz[bt],bv.xyz[bq]));bD=""+bA+"f"+bq;bz.newFlag("v"+bA,bt+"~"+bq,bq+"~"+bp);bz.newFlag(bD,bt+"~"+bq,bq+"~"+bt);bz.newFlag(bD,bq+"~"+bt,"v"+bq);bz.newFlag(bD,"v"+bq,bq+"~"+bp);bz.newFlag(bD,bq+"~"+bp,bt+"~"+bq);bo=[bq,bp],bt=bo[0],bq=bo[1]}}bx=bz.topoly();bx.name="p"+bv.name;return bx};s=function(bq){var bo,bp,br;console.log("Taking reflection of "+bq.name+"...");for(bo=0,bp=bq.xyz.length-1;0<=bp?bo<=bp:bo>=bp;0<=bp?bo++:bo--){bq.xyz[bo]=d(-1,bq.xyz[bo])}for(bo=0,br=bq.face.length-1;0<=br?bo<=br:bo>=br;0<=br?bo++:bo--){bq.face[bo]=bq.face[bo].reverse()}bq.name="r"+bq.name;return bq};aE=function(bx){var bF,bL,bE,by,bC,bD,bB,bA,bw,bt,bu,br,bp,bI,bK,bJ,bH,bG,bz,bv,bs,bq,bo;console.log("Taking dual of "+bx.name+"...");bC=new ag();by=[];for(bD=0,bz=bx.xyz.length-1;0<=bz?bD<=bz:bD>=bz;0<=bz?bD++:bD--){by[bD]={}}bv=bx.face;for(bD=0,bI=bv.length;bD<bI;bD++){bE=bv[bD];bw=bE[bE.length-1];for(bu=0,bK=bE.length;bu<bK;bu++){bt=bE[bu];by[bw]["v"+bt]=""+bD;bw=bt}}bF=bx.centers();for(bD=0,bs=bx.face.length-1;0<=bs?bD<=bs:bD>=bs;0<=bs?bD++:bD--){bC.newV(""+bD,bF[bD])}bq=bx.face;for(bD=0,bJ=bq.length;bD<bJ;bD++){bE=bq[bD];bw=bE[bE.length-1];for(br=0,bH=bE.length;br<bH;br++){bt=bE[br];bC.newFlag(bw,by[bt]["v"+bw],""+bD);bw=bt}}bL=bC.topoly();bA=[];bo=bL.face;for(bp=0,bG=bo.length;bp<bG;bp++){bE=bo[bp];bB=E(bx.face[bE[0]],bx.face[bE[1]],bx.face[bE[2]]);bA[bB]=bE}bL.face=bA;if(bx.name[0]!=="d"){bL.name="d"+bx.name}else{bL.name=bx.name.slice(1)}return bL};D=function(bv,bC,bw,bD){var bH,bG,bE,bM,bu,bF,by,bA,bB,bz,bt,bq,br,bo,bL,bN,bK,bJ,bI,bx,bs,bp;bC||(bC=0);bw||(bw=0.5);bD||(bD=-0.2);console.log("Taking inset of "+(bC===0?"":bC)+"-sided faces of "+bv.name+"...");bE=new ag();bx=bv.xyz;for(bF=0,bL=bx.length;bF<bL;bF++){bB=bx[bF];bE.newV("v"+bF,bB)}bA=bv.normals();bH=bv.centers();bs=bv.face;for(bF=0,bN=bs.length;bF<bN;bF++){bG=bs[bF];if(bG.length===bC||bC===0){for(br=0,bK=bG.length;br<bK;br++){bz=bG[br];bE.newV("f"+bF+"v"+bz,y(l(bv.xyz[bz],bH[bF],bw),d(bD,bA[bF])))}}}bu=false;bp=bv.face;for(bF=0,bJ=bp.length;bF<bJ;bF++){bG=bp[bF];bt="v"+bG[bG.length-1];for(bo=0,bI=bG.length;bo<bI;bo++){bz=bG[bo];bq="v"+bz;if(bG.length===bC||bC===0){bu=true;bM=bF+bt;bE.newFlag(bM,bt,bq);bE.newFlag(bM,bq,"f"+bF+bq);bE.newFlag(bM,"f"+bF+bq,"f"+bF+bt);bE.newFlag(bM,"f"+bF+bt,bt);bE.newFlag("ex"+bF,"f"+bF+bt,"f"+bF+bq)}else{bE.newFlag(bF,bt,bq)}bt=bq}}if(!bu){console.log("No "+bC+"-fold components were found.")}by=bE.topoly();by.name="n"+(bC===0?"":bC)+bv.name;return by};aa=function(bv,bB){var bF,bE,bC,bu,bD,bx,bz,bA,by,bt,bq,br,bo,bJ,bK,bI,bH,bG,bw,bs,bp;bB||(bB=0);console.log("Taking extrusion of "+(bB===0?"":bB)+"-sided faces of "+bv.name+"...");bC=new ag();bw=bv.xyz;for(bD=0,bJ=bw.length;bD<bJ;bD++){bA=bw[bD];bC.newV("v"+bD,bA)}bz=bv.normals();bF=bv.centers();bs=bv.face;for(bD=0,bK=bs.length;bD<bK;bD++){bE=bs[bD];if(bE.length===bB||bB===0){for(br=0,bI=bE.length;br<bI;br++){by=bE[br];bC.newV("f"+bD+"v"+by,y(bv.xyz[by],d(0.3,bz[bD])))}}}bu=false;bp=bv.face;for(bD=0,bH=bp.length;bD<bH;bD++){bE=bp[bD];bt="v"+bE[bE.length-1];for(bo=0,bG=bE.length;bo<bG;bo++){by=bE[bo];bq="v"+by;if(bE.length===bB||bB===0){bu=true;bC.newFlag(bD+bt,bt,bq);bC.newFlag(bD+bt,bq,"f"+bD+bq);bC.newFlag(bD+bt,"f"+bD+bq,"f"+bD+bt);bC.newFlag(bD+bt,"f"+bD+bt,bt);bC.newFlag("ex"+bD,"f"+bD+bt,"f"+bD+bq)}else{bC.newFlag(bD,bt,bq)}bt=bq}}if(!bu){console.log("No "+bB+"-fold components were found.")}bx=bC.topoly();bx.name="x"+(bB===0?"":bB)+bv.name;return bx};aU=function(bx){var bI,bH,bF,bG,bC,bE,bD,bu,bJ,bs,bw,bv,bp,bA,bz,by,br,bL,bM,bK,bB,bt,bq,bo;console.log("Taking stella of "+bx.name+"...");bI=bx.centers();bF=new ag();bB=bx.xyz;for(bG=0,bL=bB.length;bG<bL;bG++){bE=bB[bG];bF.newV("v"+bG,bE)}bt=bx.face;for(bG=0,bM=bt.length;bG<bM;bG++){bH=bt[bG];bu="v"+bH[bH.length-2];bs="v"+bH[bH.length-1];bA=bx.xyz[bH[bH.length-2]];bz=bx.xyz[bH[bH.length-1]];for(br=0,bK=bH.length;br<bK;br++){bD=bH[br];bp="v"+bD;by=bx.xyz[bD];bJ=bu+"~"+bs;bw=bs+"~"+bu;bv=bs+"~"+bp;bF.newV(bJ,aR(aR(bA,bz),bI[bG]));bF.newFlag("in"+bG,bJ,bv);bF.newFlag("f"+bG+bs,bv,bJ);bF.newFlag("f"+bG+bs,bJ,bs);bF.newFlag("f"+bG+bs,bs,bv);bF.newFlag("f"+bJ,bu,bw);bF.newFlag("f"+bJ,bw,bJ);bF.newFlag("f"+bJ,bJ,bu);bq=[bs,bp],bu=bq[0],bs=bq[1];bo=[bz,by],bA=bo[0],bz=bo[1]}}bC=bF.topoly();bC.name="*"+bx.name;return bC};Y=function(br,bq){var bv,bt,bs,bo,bw,bp,bu;bv=0.1;bo=a1(br);for(bp=0,bu=bq.length;bp<bu;bp++){bs=bq[bp];bw=j(bo[bs[0]],bo[bs[1]]);bt=d(bv*1/2*(1-T(C(bw,bw))),bw);bo[bs[0]]=y(bo[bs[0]],bt);bo[bs[1]]=y(bo[bs[1]],bt)}return bo};a6=function(bs,br){var bv,bt,bo,bp,bw,bq,bu;bo=(function(){var bA,by,bz,bx;bx=[];for(bA=0,by=br.length;bA<by;bA++){bz=br[bA],bv=bz[0],bt=bz[1];bx.push(j(bs[bv],bs[bt]))}return bx})();bp=[0,0,0];for(bq=0,bu=bo.length;bq<bu;bq++){bw=bo[bq];bp=y(bp,bw)}bp=d(1/br.length,bp);return _.map(bs,function(bx){return ba(bx,bp)})};A=function(br){var bo,bq,bp;bq=[0,0,0];bo=_.max(_.map(br,function(bs){return J(bs)}));bp=1/bo;return _.map(br,function(bs){return[bp*bs[0],bp*bs[1],bp*bs[2]]})};a9=function(bu,br){var bz,bw,by,bv,bq,bo,bA,bt,bs,bx,bp;bz=0.1;bo=a1(bu);for(bt=0,bx=br.length;bt<bx;bt++){bv=br[bt];by=(function(){var bD,bB,bC;bC=[];for(bD=0,bB=bv.length;bD<bB;bD++){bA=bv[bD];bC.push(bu[bA])}return bC})();bq=ai(by);bw=bf(by);if(C(bq,bw)<0){bq=d(-1,bq)}for(bs=0,bp=bv.length;bs<bp;bs++){bA=bv[bs];bo[bA]=y(bo[bA],d(C(d(bz,bq),ba(bw,bu[bA])),bq))}}return bo};m=function(bp,bv){var bs,bq,bt,bu,bo,br,bw;bv||(bv=1);console.log("Canonicalizing "+bp.name+"...");bq=bp.face;bs=bp.getEdges();bo=bp.xyz;bu=1;for(bt=0;0<=bv?bt<=bv:bt>=bv;0<=bv?bt++:bt--){bw=a1(bo);bo=Y(bo,bs);bo=a6(bo,bs);bo=a9(bo,bq);bu=_.max(_.map(_.zip(bo,bw),function(by){var bx,bz;bx=by[0],bz=by[1];return J(ba(bx,bz))}));if(bu<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bu+"]");br=new aL(bo,bp.face,bp.name);console.log("canonicalize",br);return br};N=function(br){var bs,bp,bq,bo;bp=br.centers();for(bq=0,bo=bp.length;bq<bo;bq++){bs=bp[bq];bs=d(1/C(bs,bs),bs)}return bp};G=function(bq){var bE,by,br,bz,bo,bx,bD,bC,bA,bv,bu,bB,bp,bw,bt,bs;bE=[];bw=bq.face;for(bv=0,bB=bw.length;bv<bB;bv++){bz=bw[bv];br=[0,0,0];bo=[0,0,0];by=0;bt=bz.slice(-2),bD=bt[0],bC=bt[1];for(bu=0,bp=bz.length;bu<bp;bu++){bA=bz[bu];br=y(br,bq.xyz[bA]);bo=y(bo,aS(bq.xyz[bD],bq.xyz[bC],bq.xyz[bA]));by+=ar(bq.xyz[bD],bq.xyz[bC]);bs=[bC,bA],bD=bs[0],bC=bs[1]}br=d(1/bz.length,br);bo=bg(bo);by=by/bz.length;bx=ay(d(C(br,bo),bo));bE.push(d((1+by)/2,bx))}return bE};f=function(bs,bp){var bq,bo,br;bp||(bp=1);bo=aE(bs);console.log("Pseudo-canonicalizing "+bs.name+"...");for(bq=0,br=bp-1;0<=br?bq<=br:bq>=br;0<=br?bq++:bq--){bo.xyz=G(bs);bs.xyz=G(bo)}return new aL(bs.xyz,bs.face,bs.name)};x=function(bs,bp){var bq,bo,br;bp||(bp=1);bo=aE(bs);console.log("Planarizing "+bs.name+"...");for(bq=0,br=bp-1;0<=br?bq<=br:bq>=br;0<=br?bq++:bq--){bo.xyz=N(bs);bs.xyz=N(bo)}return new aL(bs.xyz,bs.face,bs.name)};I=function(bQ){var bP,bL,bG,bJ,bO,by,bR,bI,bE,bA,bN,bu,bK,bF,bw,bx,bz,bH,bM,bv,bt,bs,bp,bo,bD,bB,br,bC,bq;bz=999;bK=[];bF=[];bw=bQ.length;bN=function(bS,bT){return(bS||bT)&&!(bS&&bT)};bP=function(bU,bT,bS){return(bT[0]-bU[0])*(bS[1]-bU[1])-(bS[0]-bU[0])*(bT[1]-bU[1])};bE=function(bU,bT,bS){return bP(bU,bT,bS)>0};bA=function(bU,bT,bS){return bP(bU,bT,bS)>=0};bG=function(bU,bT,bS){return bP(bU,bT,bS)===0};bL=function(bU,bT,bS){if(bG(bU,bT,bS)){return false}if(bU[0]!==bT[0]){return(bU[0]<=bS[0])&&(bS[0]<=bT[0])||(bU[0]>=bS[0])&&(bS[0]>=bT[0])}else{return(bU[1]<=bS[1])&&(bS[1]<=bT[1])||(bU[1]>=bS[1])&&(bS[1]>=bT[1])}};bI=function(bV,bU,bT,bS){if(bG(bV,bU,bT)||bG(bV,bU,bS)||bG(bT,bS,bV)||bG(bT,bS,bU)){return false}return bN(bE(bV,bU,bT),bE(bV,bU,bS))&&bN(bE(bT,bS,bV),bE(bT,bS,bU))};bR=function(bV,bU,bT,bS){if(bI(bV,bU,bT,bS)){return true}else{if(bL(bV,bU,bT)||bL(bV,bU,bS)||bL(bT,bS,bV)||bL(bT,bS,bU)){return true}else{return false}}};by=function(bU,bS){var bV,bT;bT=(bU+1+bw)%bw;bV=(bU-1+bw)%bw;if(bA(bQ[bU],bQ[bT],bQ[bV])){return bE(bQ[bU],bQ[bS],bQ[bV])&&bE(bQ[bS],bQ[bU],bQ[bT])}return !(bA(bQ[bU],bQ[bS],bQ[bT])&&bA(bQ[bS],bQ[bU],bQ[bV]))};bO=function(bT,bS){var bV,bU;bV=0;while(true){bU=(bV+1+bw)%bw;if((bV!==bT)&&(bU!==bT)&&(bV!==bS)&&(bU!==bS)&&bI(bQ[bT],bQ[bS],bQ[bV],bQ[bU])){return false}bV=(bV+1+bw)%bw;if(bV===0){break}}return true};bJ=function(bT,bS){return by(bT,bS)&&by(bS,bT)&&bO(bT,bS)};bt=0;while(true){bs=(bt+1+bw)%bw;bv=(bt-1+bw)%bw;bF[bt]=bJ(bv,bs);bt=(bt+1+bw)%bw;if(bt===0){break}}bM=(function(){bq=[];for(var bT=0,bS=bw-1;0<=bS?bT<=bS:bT>=bS;0<=bS?bT++:bT--){bq.push(bT)}return bq}).apply(this);bH=bw;bB=bz;bx=0;while(bB>0&&bH>3){bB-=1;bs=bx;bD=bz;while(true){bD-=1;bu=false;if(bF[bs]){bp=(bs+1+bw)%bw;bo=(bp+1+bw)%bw;bt=(bs-1+bw)%bw;bv=(bt-1+bw)%bw;bK.push([bM[bt],bM[bp]]);bF[bt]=bJ(bv,bp);bF[bp]=bJ(bt,bo);bQ=bQ.slice(0,bs+1||9000000000).concat(bQ.slice(bp));bM=bM.slice(0,bs+1||9000000000).concat(bM.slice(bp));if(bv>bs){bv-=1}if(bt>bs){bt-=1}if(bp>bs){bp-=1}if(bo>bs){bo-=1}bw--;bx=bp;bH--;bu=true}bs=(bs+1+bw)%bw;if(!(bD>0&&!bu&&bs!==bx)){break}}}return bK};a=function(bp,bo){if(((bp[0]===bo[0])&&(bp[1]===bo[1])&&(bp[2]===bo[2]))||(bp[0]===bo[1])&&(bp[1]===bo[2])&&(bp[2]===bo[0])||(bp[0]===bo[2])&&(bp[1]===bo[0])&&(bp[2]===bo[1])){return true}else{return false}};t=function(bV,bI){var bF,bW,bH,bG,bD,bJ,bT,bp,bz,bX,b0,bZ,bY,bU,bS,bR,bQ,bE,bw,bv,bu,bt,bs,br,bq,bo,bP,bO,bN,bM,bL,bK,bC,bB,bA,by,bx;bD=[];bp=[];bK=(function(){var b2,b1;b1=[];for(bT=0,b2=bV.length-1;0<=b2?bT<=b2:bT>=b2;0<=b2?bT++:bT--){b1.push([bT,(bT+1)%bV.length])}return b1})();for(bU=0,bE=bK.length;bU<bE;bU++){bC=bK[bU],bZ=bC[0],bY=bC[1];bD[bZ]=[bY];bp[bY]=[bZ]}for(bS=0,bw=bI.length;bS<bw;bS++){bW=bI[bS];bD[bW[0]].push(bW[1]);bD[bW[1]].push(bW[0]);bp[bW[0]].push(bW[1]);bp[bW[1]].push(bW[0])}bX=[];for(bR=0,bv=bI.length;bR<bv;bR++){bW=bI[bR];bB=bD[bW[1]];for(bQ=0,bu=bB.length;bQ<bu;bQ++){bH=bB[bQ];bA=bp[bW[0]];for(bP=0,bt=bA.length;bP<bt;bP++){bG=bA[bP];if(bH===bG){bX.push([bW[0],bW[1],bH])}}}by=bD[bW[0]];for(bO=0,bs=by.length;bO<bs;bO++){bH=by[bO];bx=bp[bW[1]];for(bN=0,br=bx.length;bN<br;bN++){bG=bx[bN];if(bH===bG){bX.push([bW[1],bW[0],bH])}}}}b0=[bX.pop()];for(bM=0,bq=bX.length;bM<bq;bM++){bz=bX[bM];bF=false;for(bL=0,bo=b0.length;bL<bo;bL++){bJ=b0[bL];if(a(bz,bJ)){bF=true;break}}if(!bF){b0.push(bz)}}return b0};Z=function(bq,bo){var bs,br,bx,bw,bu,bt,bB,bA,bz,by,bp,bv;bo=bo||false;console.log("Triangulating faces of "+bq.name+"...");bt=new aL();bt.xyz=K(bq.xyz);bt.face_colors=[];bv=bq.face;for(bw=0,by=bv.length;bw<by;bw++){bx=bv[bw];if(bx.length>3){bs=X((function(){var bE,bC,bD;bD=[];for(bE=0,bC=bx.length;bE<bC;bE++){bz=bx[bE];bD.push(bq.xyz[bz])}return bD})());br=I(bs);bA=t(bx,br);for(bu=0,bp=bA.length;bu<bp;bu++){bB=bA[bu];bt.face.push([bx[bB[0]],bx[bB[1]],bx[bB[2]]]);if(bo){bt.face_colors.push(bq.face_colors[bw])}}}else{bt.face.push([bx[0],bx[1],bx[2]]);if(bo){bt.face_colors.push(bq.face_colors[bw])}}}bt.name=bq.name;return bt};af=function(bo){var bt,bu,bw,br,bq,bv,bp,bs;bu="";bs=bo.face;for(br=0,bv=bs.length;br<bv;br++){bt=bs[br];for(bq=0,bp=bt.length;bq<bp;bq++){bw=bt[bq];bu+=""+bw+"->"}bu+="\n"}return console.log(bu)};B=function(){var bv,bs,br,bq,bu,bt,bp,bo;bq=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bs=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bu=0,bp=bs.length;bu<bp;bu++){bv=bs[bu];console.log("Operator "+bv);for(bt=0,bo=bq.length;bt<bo;bt++){br=bq[bt];console.log(bv+br+":",generatePoly(bv+br))}}return console.log("===== Done Testing Basic Ops =====")};aO='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(""), 10); }';bb=PEG.buildParser(aO);bn=function(bp,bo){return bp.apply(this,bo||[])};bd={T:e,O:an,C:ah,I:a3,D:ao,P:R,A:aT,Y:bk};F={d:aE,k:ab,a:aD,g:aZ,p:r,r:s,n:D,x:aa,l:aU,z:Z,K:f,C:m,A:x};aK=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];aX=function(br){var bo,bq,bu,bt,bp,bs;bq=br;for(bt=0,bp=aK.length;bt<bp;bt++){bs=aK[bt],bu=bs[0],bo=bs[1];bq=bq.replace(bu,bo)}console.log(""+br+" executed as "+bq);return bq};bl=function(bu){var bp,bw,br,by,bs,bx,bt,bo,bq,bv;bt=aX(bu);bx=bb.parse(bt).reverse();br=bx.shift();bw=bd[br.op];bp=br.args;bo=bn(bw,bp);for(bq=0,bv=bx.length;bq<bv;bq++){br=bx[bq];bs=F[br.op];by=[bo].concat(br.args);bo=bn(bs,by)}bo.xyz=a6(bo.xyz,bo.getEdges());bo.xyz=A(bo.xyz);bo=P(bo);return bo};ac={};bh=500;aw=400;O={};i=K(u);aj=K(u);S=800;z=5;bi=0;L=0.8;n=bh/2;at=aw/2;v=new Date();p=true;aP="rgba(255,255,255,1.0)";al="area";g="fillstroke";a8=0.5;am=false;V=0;U=0;aC=[1,0,0];a0=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aA=function(bq,bo){var br,bp;br=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bp=new br();bp.append(bq);return saveAs(bp.getBlob("text/plain;charset="+document.characterSet),bo)};bj=function(){var bo,bt,bs,br,bq,bp;bp={};bo=/\+/g;bq=/([^&=]+)=?([^&]*)/g;bt=function(bu){return decodeURIComponent(bu.replace(bo," "))};br=window.location.search.substring(1);while(bs=bq.exec(br)){bp[bt(bs[1])]=bt(bs[2])}return bp};aG=function(){var bo;bo=$("#poly");bo.width(bh);bo.height(aw);ac=bo[0].getContext("2d");ac.lineWidth=a8;if(p){return ac.clearRect(0,0,bh,aw)}else{ac.clearRect(0,0,bh,aw);ac.fillStyle=aP;return ac.fillRect(0,0,bh,aw)}};aI=function(){if(p){return ac.clearRect(0,0,bh,aw)}else{ac.clearRect(0,0,bh,aw);ac.fillStyle=aP;return ac.fillRect(0,0,bh,aw)}};Q=function(bv,bD){var bp,bx,bw,bC,br,bt,bB,bu,bA,by,bq,bE,bF,bz,bs,bo;bD||(bD=[3,3,3]);bt=_.map(bv.xyz,function(bG){return bG});bv.xyz=_.map(bv.xyz,function(bG){return q(i,bG)});aN(bv);bz=bv.face;for(bC=0,bE=bz.length;bC<bE;bC++){bx=bz[bC];ac.beginPath();bu=bx[bx.length-1];bs=w(y(bD,bv.xyz[bu]),z,bi,L,S),bA=bs[0],by=bs[1];ac.moveTo(bA+n,by+at);for(bq=0,bF=bx.length;bq<bF;bq++){bB=bx[bq];bo=w(y(bD,bv.xyz[bB]),z,bi,L,S),bA=bo[0],by=bo[1];ac.lineTo(bA+n,by+at)}bp=ae(bv.face_class[bC]);bw=(function(){var bH,bI,bG;bG=[];for(bH=0,bI=bx.length;bH<bI;bH++){bB=bx[bH];bG.push(bv.xyz[bB])}return bG})();br=C(ai(bw),bg([1,-1,0]));bp=d((br/2+0.5)*0.7+0.3,bp);if(g==="fill"||g==="fillstroke"){ac.fillStyle="rgba("+(W(bp[0]*255))+", "+(W(bp[1]*255))+", "+(W(bp[2]*255))+", "+1+")";ac.fill();ac.strokeStyle="rgba("+(W(bp[0]*255))+", "+(W(bp[1]*255))+", "+(W(bp[2]*255))+", "+1+")";ac.stroke()}if(g==="fillstroke"){ac.fillStyle="rgba("+(W(bp[0]*255))+", "+(W(bp[1]*255))+", "+(W(bp[2]*255))+", "+1+")";ac.fill();ac.strokeStyle="rgba(0,0,0, .3)";ac.stroke()}if(g==="stroke"){ac.strokeStyle="rgba(0,0,0, .8)";ac.stroke()}}return bv.xyz=bt};ax=function(){var bq,br,bp,bo;aI();bo=[];for(bq=0,bp=O.length;bq<bp;bq++){br=O[bq];bo.push(Q(br,[0+3*bq,0,3]))}return bo};bc=function(){var bp,bq,br,bo;aI();bp=(2*Math.PI)/180*v.getSeconds()*0.1;for(bq=0,bo=O.length;bq<bo;bq++){br=O[bq];Q(br,[0+3*bq,0,3])}return setTimeout(bc,100)};$(function(){var bp,bo;aG();bo=bj();if("recipe" in bo){bp=[bo.recipe];$("#spec").val(bp)}else{bp=[a7(a0)];$("#spec").val(bp)}$("#palette").val(aW.reduce(function(bq,br){return bq+" "+br}));O=_.map(bp,function(bq){return bl(bq)});ax();$("#spec").change(function(bq){bp=$("#spec").val().split(/\s+/g).slice(0,2);O=_.map(bp,function(br){return bl(br)});return ax()});$("#palette").change(function(bq){aW=$(this).val().split(/\s+/g);return ax()});$("#poly").mousewheel(function(bs,bt,br,bq){bs.preventDefault();S*=(10+bt)/10;return ax()});$("#poly").mousedown(function(bq){var br;bq.preventDefault();am=true;V=bq.clientX-$(this).offset().left;U=bq.clientY-($(this).offset().top-$(window).scrollTop());br=aH(V,U,n,at,z,bi,L,S);if(br[0]*br[1]*br[2]*0===0){aC=br}return aj=K(i)});$("#poly").mouseup(function(bq){bq.preventDefault();return am=false});$("#poly").mouseleave(function(bq){bq.preventDefault();return am=false});$("#poly").mousemove(function(bt){var br,bq,bs;bt.preventDefault();if(am){br=bt.clientX-$(this).offset().left;bq=bt.clientY-($(this).offset().top-$(window).scrollTop());bs=aH(br,bq,n,at,z,bi,L,S);if(bs[0]*bs[1]*bs[2]*0===0&&aC[0]*aC[1]*aC[2]*0===0){i=aB(az(aC,bs),aj)}return ax()}});$("#strokeonly").click(function(bq){g="stroke";return ax()});$("#fillonly").click(function(bq){g="fill";return ax()});$("#fillandstroke").click(function(bq){g="fillstroke";return ax()});$("#siderot").click(function(bq){i=aQ(aF/2,0,1,0);return ax()});$("#toprot").click(function(bq){i=aQ(aF/2,1,0,0);return ax()});$("#frontrot").click(function(bq){i=h(0,0,0);return ax()});$("#pngsavebutton").click(function(bt){var bs,br,bq;bs=$("#poly")[0];bq=$("#spec").val().split(/\s+/g)[0];br="polyhedronisme-"+bq+".png";return bs.toBlob(function(bu){return saveAs(bu,br)})});$("#objsavebutton").click(function(bt){var br,bs,bq;bs=O[0].toOBJ();bq=$("#spec").val().split(/\s+/g)[0];br="polyhedronisme-"+bq+".obj";return aA(bs,br)});return $("#x3dsavebutton").click(function(bt){var br,bq,bs,bu;bs=Z(O[0],true);bu=bs.toVRML();bq=$("#spec").val().split(/\s+/g)[0];br="polyhedronisme-"+bq+".wrl";return aA(bu,br)})})}).call(this);