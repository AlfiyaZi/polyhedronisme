(function(){var p,aO,aw,bf,al,a0,U,T,aC,am,aW,aF,g,ac,aY,y,x,aD,bb,aS,L,av,bd,f,m,aI,J,aT,bc,a1,G,au,ab,a8,ah,ao,t,an,C,ax,P,aE,ar,Z,u,a4,ak,ae,H,aX,az,N,i,aj,v,aZ,bj,a3,aG,D,E,aH,aa,I,a2,aQ,aB,d,q,ai,ap,aq,aR,O,ad,bh,w,K,z,bg,R,a9,ag,aL,a5,Q,W,r,bi,aJ,a7,a6,ay,M,F,s,A,h,V,aM,k,aA,aV,aN,aK,S,aU,ba,b,j,X,B,e,af,a,Y,l,be,aP,c,n,at,o;aJ=Math.random;V=Math.round;ak=Math.floor;S=Math.sqrt;aV=Math.sin;G=Math.cos;b=Math.tan;L=Math.asin;aY=Math.acos;av=Math.atan;a5=Math.pow;ac=Math.abs;aF=Math.PI;J=function(bm){var bl,bk;if(!(bm!=null)||typeof bm!=="object"){return bm}bk=new bm.constructor();for(bl in bm){bk[bl]=J(bm[bl])}return bk};a7=function(bl){var bk;bk=ak(aJ()*bl.length);return bl[bk]};d=function(bl,bk){return[bl*bk[0],bl*bk[1],bl*bk[2]]};o=function(bl,bk){return[bl[0]*bk[0],bl[1]*bk[1],bl[2]*bk[2]]};y=function(bl,bk){return[bl[0]+bk[0],bl[1]+bk[1],bl[2]+bk[2]]};ba=function(bl,bk){return[bl[0]-bk[0],bl[1]-bk[1],bl[2]-bk[2]]};C=function(bl,bk){return bl[0]*bk[0]+bl[1]*bk[1]+bl[2]*bk[2]};au=function(bl,bk){return[bl[1]*bk[2]-bl[2]*bk[1],bl[2]*bk[0]-bl[0]*bk[2],bl[0]*bk[1]-bl[1]*bk[0]]};I=function(bk){return S(C(bk,bk))};a2=function(bk){return C(bk,bk)};be=function(bk){return d(1/S(a2(bk)),bk)};aQ=function(bl,bk){return d(1/2,y(bl,bk))};l=function(bm,bl,bk){return[(1-bk)*bm[0]+bk*bl[0],(1-bk)*bm[1]+bk*bl[1],(1-bk)*bm[2]+bk*bl[2]]};aq=function(bl,bk){return l(bl,bk,1/3)};ay=function(bk){return d(1/a2(bk),bk)};j=function(bm,bl){var bk;bk=ba(bl,bm);return ba(bm,d(C(bk,bm)/a2(bk),bk))};ar=function(bl,bk){return S(a2(j(bl,bk)))};aR=function(bo,bn,bm){var bl,bk;bl=ba(bn,bo);bk=ba(bm,bn);return au(bl,bk)};E=function(br,bq,bp){var bv,bu,bt,bo,bn,bm,bs,bl,bk;for(bo=0,bs=br.length;bo<bs;bo++){bv=br[bo];for(bn=0,bl=bq.length;bn<bl;bn++){bu=bq[bn];if(bv===bu){for(bm=0,bk=bp.length;bm<bk;bm++){bt=bp[bm];if(bv===bt){return bv}}}}}return null};bd=function(bo){var bm,bl,bn,bk;bm=[0,0,0];for(bn=0,bk=bo.length;bn<bk;bn++){bl=bo[bn];bm=y(bm,bl)}return d(1/bo.length,bm)};ai=function(bo){var bk,bs,bq,bp,bm,br,bn,bl;bk=[0,0,0];bn=bo.slice(-2),bs=bn[0],bq=bn[1];for(bm=0,br=bo.length;bm<br;bm++){bp=bo[bm];bk=y(bk,aR(bs,bq,bp));bl=[bq,bp],bs=bl[0],bq=bl[1]}return be(bk)};bc=function(bo){var bk,bs,bq,bp,bm,br,bn,bl;bk=0;bn=bo.slice(0,2),bs=bn[0],bq=bn[1];bl=bo.slice(2);for(bm=0,br=bl.length;bm<br;bm++){bp=bl[bm];bk+=I(au(ba(bq,bs),ba(bp,bs)));bq=bp}return bk};W=function(br){var bp,bl,bk,bo,bs,bt,bn,bq,bm;bo=J(br);bt=br[0];bo=_.map(bo,function(bu){return bu-bt});bl=ai(br);bp=be(bd(br));bk=au(bl,bp);bm=[];for(bn=0,bq=bo.length;bn<bq;bn++){bs=bo[bn];bm.push([C(bl,bs),C(bk,bs)])}return bm};a1=function(bm){var bl,bk,bn;bk=new Array(bm.length);for(bl=0,bn=bm.length-1;0<=bn?bl<=bn:bl>=bn;0<=bn?bl++:bl--){bk[bl]=bm[bl].slice(0)}return bk};q=function(bl,bk){return[bl[0][0]*bk[0]+bl[0][1]*bk[1]+bl[0][2]*bk[2],bl[1][0]*bk[0]+bl[1][1]*bk[1]+bl[1][2]*bk[2],bl[2][0]*bk[0]+bl[2][1]*bk[1]+bl[2][2]*bk[2]]};aB=function(bk,bl){return[[bk[0][0]*bl[0][0]+bk[0][1]*bl[1][0]+bk[0][2]*bl[2][0],bk[0][0]*bl[0][1]+bk[0][1]*bl[1][1]+bk[0][2]*bl[2][1],bk[0][0]*bl[0][2]+bk[0][1]*bl[1][2]+bk[0][2]*bl[2][2]],[bk[1][0]*bl[0][0]+bk[1][1]*bl[1][0]+bk[1][2]*bl[2][0],bk[1][0]*bl[0][1]+bk[1][1]*bl[1][1]+bk[1][2]*bl[2][1],bk[1][0]*bl[0][2]+bk[1][1]*bl[1][2]+bk[1][2]*bl[2][2]],[bk[2][0]*bl[0][0]+bk[2][1]*bl[1][0]+bk[2][2]*bl[2][0],bk[2][0]*bl[0][1]+bk[2][1]*bl[1][1]+bk[2][2]*bl[2][1],bk[2][0]*bl[0][2]+bk[2][1]*bl[1][2]+bk[2][2]*bl[2][2]]]};u=[[1,0,0],[0,1,0],[0,0,1]];h=function(bo,bm,bn){var bp,bl,bk;bp=[[G(bo),-1*aV(bo),0],[aV(bo),G(bo),0],[0,0,1]];bk=[[G(bm),0,-1*aV(bm)],[0,1,0],[aV(bm),0,G(bm)]];bl=[[1,0,0],[0,G(bn),-1*aV(bn)],[0,aV(bn),G(bn)]];return aB(bl,aB(bk,bp))};aP=function(bo,bx,bv,bs){var br,bl,bm,bw,bu,bk,bt,bp,bq,bn;bo/=2;bw=aV(bo);br=G(bo);bu=bw*bw;bl=I([bx,bv,bs]);if(bl===0){bq=[0,0,1],bx=bq[0],bv=bq[1],bs=bq[2]}if(bl!==1){bn=be([bx,bv,bs]),bx=bn[0],bv=bn[1],bs=bn[2]}if(bx===1&&bv===0&&bs===0){bm=[[1,0,0],[0,1-2*bu,2*bw*br],[0,-2*bw*br,1-2*bu]]}else{if(bx===0&&bv===1&&bs===0){bm=[[1-2*bu,0,-2*bw*br],[0,1,0],[2*bw*br,0,1-2*bu]]}else{if(bx===0&&bv===0&&bs===1){bm=[[1-2*bu,2*bw*br,0],[-2*bw*br,1-2*bu,0],[0,0,1]]}else{bk=bx*bx;bt=bv*bv;bp=bs*bs;bm=[[1-2*(bt+bp)*bu,2*(bx*bv*bu+bs*bw*br),2*(bx*bs*bu-bv*bw*br)],[2*(bv*bx*bu-bs*bw*br),1-2*(bp+bk)*bu,2*(bv*bs*bu+bx*bw*br)],[2*(bs*bx*bu+bv*bw*br),2*(bs*bv*bu-bx*bw*br),1-2*(bk+bt)*bu]]}}}return bm};w=function(bm,bl,bn,bq,bk){var bo,bp;bp=(bl*bq-bn)/(1-bq);bo=bk*bq/(1-bq);return[bo*bm[0]/(bm[2]+bp),bo*bm[1]/(bm[2]+bp)]};aH=function(br,bo,bu,bs,by,bn,bm,bl){var bx,bk,bt,bp,bv,bA,bC,bq,bw,bz,bB;bw=(by*bm-bn)/(1-bm);bx=bl*bm/(1-bm);bt=br-bu;bA=bo-bs;bk=bx*bx;bz=bw*bw;bp=bt*bt;bC=bA*bA;bv=(2*bx*bt*bw+S(4*bk*bp*bz+4*bp*(bk+bp+bC)*(1-bz)))/(2*(bk+bp+bC));bq=(bx*bA*bw)/(bk+bp+bC)+(bA*S(4*bk*bz+4*(bk+bp+bC)*(1-bz)))/(2*(bk+bp+bC));bB=S(1-bv*bv-bq*bq);return[bv,bq,bB]};az=function(bm,bl){var bn,bk;bk=au(bm,bl);bn=aY(C(bm,bl));return aP(-1*bn,bk[0],bk[1],bk[2])};a4=function(bn){var bl,bp,bo,bm,bk;bl=[];bp=bn.slice(-1)[0];for(bm=0,bk=bn.length;bm<bk;bm++){bo=bn[bm];bl.push([bp,bo]);bp=bo}return bl};c=function(bk){var bp,bo,bs,bq,bm,br,bl,bn;bq=[];bn=bk.face;for(bo=0,br=bn.length;bo<br;bo++){bp=bn[bo];for(bm=0,bl=bp.length;bm<bl;bm++){bs=bp[bm];bq[bs]=bk.face_colors[bo]}}return bq};aL=(function(){function bk(){this.face=new Array();this.xyz=new Array();this.name="null polyhedron"}bk.prototype.data=function(){var bl;bl=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bl+" edges, "+this.xyz.length+" vertices)"};bk.prototype.getEdges=function(){var bv,br,bt,bs,bm,bq,bp,bw,bo,bn,bu,bl;bq={};bw=[];br=_.map(this.face,a4);for(bo=0,bu=br.length;bo<bu;bo++){bm=br[bo];for(bn=0,bl=bm.length;bn<bl;bn++){bs=bm[bn];if(bs[0]<bs[1]){bv=bs[0],bt=bs[1]}else{bt=bs[0],bv=bs[1]}bq[bv+"~"+bt]=bs}}for(bp in bq){bs=bq[bp];bw.push(bs)}return bw};bk.prototype.centers=function(){var bq,br,bn,bt,bo,bm,bs,bl,bp;bq=[];bp=this.face;for(bo=0,bs=bp.length;bo<bs;bo++){br=bp[bo];bn=[0,0,0];for(bm=0,bl=br.length;bm<bl;bm++){bt=br[bm];bn=y(bn,this.xyz[bt])}bq.push(d(1/br.length,bn))}return bq};bk.prototype.normals=function(){var bp,bq,bm,bo,bl,bn;bq=[];bn=this.face;for(bo=0,bl=bn.length;bo<bl;bo++){bp=bn[bo];bq.push(ai((function(){var bt,br,bs;bs=[];for(bt=0,br=bp.length;bt<br;bt++){bm=bp[bt];bs.push(this.xyz[bm])}return bs}).call(this)))}return bq};bk.prototype.toOBJ=function(){var bv,bu,bm,bw,by,bs,br,bq,bx,bn,bl,bz,bt,bp,bo;bw="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bw+="group "+this.name+"\n";bw+="#vertices\n";bt=this.xyz;for(bs=0,bx=bt.length;bs<bx;bs++){by=bt[bs];bw+="v "+by[0]+" "+by[1]+" "+by[2]+"\n"}bw+="#normal vector defs \n";bp=this.face;for(br=0,bn=bp.length;br<bn;br++){bv=bp[br];bm=ai((function(){var bB,bC,bA;bA=[];for(bB=0,bC=bv.length;bB<bC;bB++){by=bv[bB];bA.push(this.xyz[by])}return bA}).call(this));bw+="vn "+bm[0]+" "+bm[1]+" "+bm[2]+"\n"}bw+="#face defs \n";bo=this.face;for(bu=0,bl=bo.length;bu<bl;bu++){bv=bo[bu];bw+="f ";for(bq=0,bz=bv.length;bq<bz;bq++){by=bv[bq];bw+=""+(by+1)+"//"+(bu+1)+" "}bw+="\n"}return bw};bk.prototype.toX3D=function(){var bp,bA,bv,bx,by,bt,bs,br,bo,bw,bm,bl,bz,bu,bq,bn;bp=0.01;by='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bu=this.face;for(bt=0,bw=bu.length;bt<bw;bt++){bv=bu[bt];for(bs=0,bm=bv.length;bs<bm;bs++){bx=bv[bs];by+=""+bx+" "}by+="-1\n"}by+='">\n';by+='<Color color="';bq=c(this);for(br=0,bl=bq.length;br<bl;br++){bA=bq[br];by+=""+bA[0]+" "+bA[1]+" "+bA[2]+" "}by+='"/>';by+='<Coordinate point="';bn=this.xyz;for(bo=0,bz=bn.length;bo<bz;bo++){bx=bn[bo];by+=""+(bx[0]*bp)+" "+(bx[1]*bp)+" "+(bx[2]*bp)+" "}by+='"/>\n';by+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return by};bk.prototype.toVRML=function(){var bp,bA,bv,bx,by,bt,bs,br,bo,bw,bm,bl,bz,bu,bq,bn;bp=0.01;by='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bu=this.xyz;for(bt=0,bw=bu.length;bt<bw;bt++){bx=bu[bt];by+=""+(bx[0]*bp)+" "+(bx[1]*bp)+" "+(bx[2]*bp)+","}by=by.slice(0,-1);by+="    ]\n}\ncolor Color\n{\n  color\n  [";bq=this.face_colors;for(bs=0,bm=bq.length;bs<bm;bs++){bA=bq[bs];by+=""+bA[0]+" "+bA[1]+" "+bA[2]+" ,"}by=by.slice(0,-1);by+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bn=this.face;for(br=0,bl=bn.length;br<bl;br++){bv=bn[br];for(bo=0,bz=bv.length;bo<bz;bo++){bx=bv[bo];by+=""+bx+", "}by+="-1,"}by=by.slice(0,-1);by+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return by};return bk})();e=function(){var bk;bk=new aL();bk.name="T";bk.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bk.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bk};ap=function(){var bk;bk=new aL();bk.name="O";bk.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bk.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bk};ah=function(){var bk;bk=new aL();bk.name="C";bk.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bk.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bk};a3=function(){var bk;bk=new aL();bk.name="I";bk.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bk.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bk};an=function(){var bk;bk=new aL();bk.name="D";bk.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bk.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bk};Q=function(bo){var bx,bw,bk,bm,bu,bt,bv,br,bp,bn,bl,bs,bq;bm=2*aF/bo;bx=Math.sin(bm/2);bk=new aL();bk.name="P"+bo;for(bw=0,bv=bo-1;0<=bv?bw<=bv:bw>=bv;0<=bv?bw++:bw--){bk.xyz.push([-G(bw*bm),-aV(bw*bm),-bx])}for(bw=0,br=bo-1;0<=br?bw<=br:bw>=br;0<=br?bw++:bw--){bk.xyz.push([-G(bw*bm),-aV(bw*bm),bx])}bk.face.push((function(){bs=[];for(var by=bp=bo-1;bp<=0?by<=0:by>=0;bp<=0?by++:by--){bs.push(by)}return bs}).apply(this));bk.face.push((function(){bq=[];for(var by=bo,bz=2*bo-1;bo<=bz?by<=bz:by>=bz;bo<=bz?by++:by--){bq.push(by)}return bq}).apply(this));for(bw=0,bl=bo-1;0<=bl?bw<=bl:bw>=bl;0<=bl?bw++:bw--){bk.face.push([bw,(bw+1)%bo,(bw+1)%bo+bo,bw+bo])}bk.xyz=x(bk,1);return bk};aS=function(bp){var bz,by,bx,bl,bk,bn,bv,bu,bw,bs,bq,bo,bm,bt,br;bn=2*aF/bp;by=S(1-4/(4+2*G(bn/2)-2*G(bn)));bk=S(1-by*by);bz=S(by*by+a5(bk*G(bn/2),2));bk=-bk/bz;by=-by/bz;bl=new aL();bl.name="A"+bp;for(bx=0,bw=bp-1;0<=bw?bx<=bw:bx>=bw;0<=bw?bx++:bx--){bl.xyz.push([bk*G(bx*bn),bk*aV(bx*bn),by])}for(bx=0,bs=bp-1;0<=bs?bx<=bs:bx>=bs;0<=bs?bx++:bx--){bl.xyz.push([bk*G((bx+0.5)*bn),bk*aV((bx+0.5)*bn),-by])}bl.face.push((function(){bt=[];for(var bA=bq=bp-1;bq<=0?bA<=0:bA>=0;bq<=0?bA++:bA--){bt.push(bA)}return bt}).apply(this));bl.face.push((function(){br=[];for(var bA=bp,bB=2*bp-1;bp<=bB?bA<=bB:bA>=bB;bp<=bB?bA++:bA--){br.push(bA)}return br}).apply(this));for(bx=0,bm=bp-1;0<=bm?bx<=bm:bx>=bm;0<=bm?bx++:bx--){bl.face.push([bx,(bx+1)%bp,bx+bp]);bl.face.push([bx,bx+bp,(bp+bx-1)%bp+bp])}bl.xyz=x(bl,1);return bl};bi=function(bm){var bt,bs,bk,bl,bq,br,bo,bn,bp;bl=2*aF/bm;bt=1;bk=new aL();bk.name="Y"+bm;for(bs=0,br=bm-1;0<=br?bs<=br:bs>=br;0<=br?bs++:bs--){bk.xyz.push([-G(bs*bl),-aV(bs*bl),-0.2])}bk.xyz.push([0,0,bt]);bk.face.push((function(){bp=[];for(var bu=bo=bm-1;bo<=0?bu<=0:bu>=0;bo<=0?bu++:bu--){bp.push(bu)}return bp}).apply(this));for(bs=0,bn=bm-1;0<=bn?bs<=bn:bs>=bn;0<=bn?bs++:bs--){bk.face.push([bs,(bs+1)%bm,bm])}bk.xyz=f(bk,3);return bk};ag=(function(){function bk(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bk.prototype.newV=function(bm,bl){if(this.verts[bm]===void 0){this.verts[bm]=0;return this.xyzs[bm]=bl}};bk.prototype.newFlag=function(bl,bn,bm){if(this.flags[bl]===void 0){this.flags[bl]={}}return this.flags[bl][bn]=bm};bk.prototype.topoly=function(){var bm,br,bu,bq,bo,bl,bs,bt,bp,bn;bl=new aL();bm=0;bp=this.verts;for(bq in bp){bs=bp[bq];bl.xyz[bm]=this.xyzs[bq];this.verts[bq]=bm;bm++}bm=0;bn=this.flags;for(bq in bn){br=bn[bq];bl.face[bm]=[];for(bo in br){bs=br[bo];bt=bs;break}bs=bt;bl.face[bm].push(this.verts[bs]);bs=this.flags[bq][bs];bu=0;while(bs!==bt){bl.face[bm].push(this.verts[bs]);bs=this.flags[bq][bs];bu++;if(bu>1000){console.log("Bad flag spec, have a neverending face:",bq,this.flags[bq]);break}}bm++}bl.name="unknown polyhedron";return bl};return bk})();aa=function(bq,bw){var bp,bA,bz,bx,bD,bo,by,bs,bu,bv,bt,bn,bk,bl,bC,bE,bB,br,bm;console.log("Taking kis of "+(bw===0?"":bw)+"-sided faces of "+bq.name+"...");bx=new ag();br=bq.xyz;for(by=0,bC=br.length;by<bC;by++){bv=br[by];bx.newV("v"+by,bv)}bu=bq.normals();bA=bq.centers();bo=false;bm=bq.face;for(by=0,bE=bm.length;by<bE;by++){bz=bm[by];bn="v"+bz[bz.length-1];for(bl=0,bB=bz.length;bl<bB;bl++){bt=bz[bl];bk="v"+bt;if(bz.length===bw||bw===0){bo=true;bp="apex"+by;bD=""+by+bn;bx.newV(bp,y(bA[by],d(0.2,bu[by])));bx.newFlag(bD,bn,bk);bx.newFlag(bD,bk,bp);bx.newFlag(bD,bp,bn)}else{bx.newFlag(""+by,bn,bk)}bn=bk}}if(!bo){console.log("No "+bw+"-fold components were found.")}bs=bx.topoly();bs.name="k"+(bw===0?"":bw)+bq.name;return bs};aD=function(bl){var bt,bu,bs,bm,bp,by,bx,bv,bq,bw,bk,br,bo,bn;console.log("Taking ambo of "+bl.name+"...");bm=function(bA,bz){if(bA<bz){return bA+"_"+bz}else{return bz+"_"+bA}};bu=new ag();br=bl.face;for(bs=0,bw=br.length;bs<bw;bs++){bt=br[bs];bo=bt.slice(-2),by=bo[0],bx=bo[1];for(bq=0,bk=bt.length;bq<bk;bq++){bv=bt[bq];if(by<bx){bu.newV(bm(by,bx),aQ(bl.xyz[by],bl.xyz[bx]))}bu.newFlag("orig"+bs,bm(by,bx),bm(bx,bv));bu.newFlag("dual"+bx,bm(bx,bv),bm(by,bx));bn=[bx,bv],by=bn[0],bx=bn[1]}}bp=bu.topoly();bp.name="a"+bl.name;return bp};aZ=function(br){var bz,by,bw,bC,bx,bv,bt,bu,bq,bo,bm,bB,bE,bD,bA,bs,bp,bn,bl,bk;console.log("Taking gyro of "+br.name+"...");bw=new ag();bs=br.xyz;for(bx=0,bB=bs.length;bx<bB;bx++){bu=bs[bx];bw.newV("v"+bx,be(bu))}bz=br.centers();bp=br.face;for(bx=0,bE=bp.length;bx<bE;bx++){by=bp[bx];bw.newV("center"+bx,be(bz[bx]))}bn=br.face;for(bx=0,bD=bn.length;bx<bD;bx++){by=bn[bx];bl=by.slice(-2),bq=bl[0],bo=bl[1];for(bv=0,bA=by.length;bv<bA;bv++){bu=by[bv];bm=bu;bw.newV(bq+"~"+bo,aq(br.xyz[bq],br.xyz[bo]));bC=bx+"f"+bq;bw.newFlag(bC,"center"+bx,bq+"~"+bo);bw.newFlag(bC,bq+"~"+bo,bo+"~"+bq);bw.newFlag(bC,bo+"~"+bq,"v"+bo);bw.newFlag(bC,"v"+bo,bo+"~"+bm);bw.newFlag(bC,bo+"~"+bm,"center"+bx);bk=[bo,bm],bq=bk[0],bo=bk[1]}}bt=bw.topoly();bt.name="g"+br.name;return bt};r=function(br){var bx,bv,bz,bw,bt,bu,bp,bm,bl,bn,by,bB,bA,bs,bq,bo,bk;console.log("Taking propellor of "+br.name+"...");bv=new ag();bs=br.xyz;for(bw=0,by=bs.length;bw<by;bw++){bu=bs[bw];bv.newV("v"+bw,be(bu))}bq=br.face;for(bw=0,bB=bq.length;bw<bB;bw++){bx=bq[bw];bo=bx.slice(-2),bp=bo[0],bm=bo[1];for(bn=0,bA=bx.length;bn<bA;bn++){bu=bx[bn];bl=""+bu;bv.newV(bp+"~"+bm,aq(br.xyz[bp],br.xyz[bm]));bz=""+bw+"f"+bm;bv.newFlag("v"+bw,bp+"~"+bm,bm+"~"+bl);bv.newFlag(bz,bp+"~"+bm,bm+"~"+bp);bv.newFlag(bz,bm+"~"+bp,"v"+bm);bv.newFlag(bz,"v"+bm,bm+"~"+bl);bv.newFlag(bz,bm+"~"+bl,bp+"~"+bm);bk=[bm,bl],bp=bk[0],bm=bk[1]}}bt=bv.topoly();bt.name="p"+br.name;return bt};s=function(bm){var bk,bl,bn;console.log("Taking reflection of "+bm.name+"...");for(bk=0,bl=bm.xyz.length-1;0<=bl?bk<=bl:bk>=bl;0<=bl?bk++:bk--){bm.xyz[bk]=d(-1,bm.xyz[bk])}for(bk=0,bn=bm.face.length-1;0<=bn?bk<=bn:bk>=bn;0<=bn?bk++:bk--){bm.face[bk]=bm.face[bk].reverse()}bm.name="r"+bm.name;return bm};aE=function(bt){var bB,bH,bA,bu,by,bz,bx,bw,bs,bp,bq,bn,bl,bE,bG,bF,bD,bC,bv,br,bo,bm,bk;console.log("Taking dual of "+bt.name+"...");by=new ag();bu=[];for(bz=0,bv=bt.xyz.length-1;0<=bv?bz<=bv:bz>=bv;0<=bv?bz++:bz--){bu[bz]={}}br=bt.face;for(bz=0,bE=br.length;bz<bE;bz++){bA=br[bz];bs=bA[bA.length-1];for(bq=0,bG=bA.length;bq<bG;bq++){bp=bA[bq];bu[bs]["v"+bp]=""+bz;bs=bp}}bB=bt.centers();for(bz=0,bo=bt.face.length-1;0<=bo?bz<=bo:bz>=bo;0<=bo?bz++:bz--){by.newV(""+bz,bB[bz])}bm=bt.face;for(bz=0,bF=bm.length;bz<bF;bz++){bA=bm[bz];bs=bA[bA.length-1];for(bn=0,bD=bA.length;bn<bD;bn++){bp=bA[bn];by.newFlag(bs,bu[bp]["v"+bs],""+bz);bs=bp}}bH=by.topoly();bw=[];bk=bH.face;for(bl=0,bC=bk.length;bl<bC;bl++){bA=bk[bl];bx=E(bt.face[bA[0]],bt.face[bA[1]],bt.face[bA[2]]);bw[bx]=bA}bH.face=bw;if(bt.name[0]!=="d"){bH.name="d"+bt.name}else{bH.name=bt.name.slice(1)}return bH};D=function(br,bx){var bB,bA,by,bG,bq,bz,bt,bv,bw,bu,bp,bm,bn,bk,bF,bH,bE,bD,bC,bs,bo,bl;console.log("Taking inset of "+(bx===0?"":bx)+"-sided faces of "+br.name+"...");by=new ag();bs=br.xyz;for(bz=0,bF=bs.length;bz<bF;bz++){bw=bs[bz];by.newV("v"+bz,bw)}bv=br.normals();bB=br.centers();bo=br.face;for(bz=0,bH=bo.length;bz<bH;bz++){bA=bo[bz];if(bA.length===bx||bx===0){for(bn=0,bE=bA.length;bn<bE;bn++){bu=bA[bn];by.newV("f"+bz+"v"+bu,y(aQ(br.xyz[bu],bB[bz]),d(-0.2,bv[bz])))}}}bq=false;bl=br.face;for(bz=0,bD=bl.length;bz<bD;bz++){bA=bl[bz];bp="v"+bA[bA.length-1];for(bk=0,bC=bA.length;bk<bC;bk++){bu=bA[bk];bm="v"+bu;if(bA.length===bx||bx===0){bq=true;bG=bz+bp;by.newFlag(bG,bp,bm);by.newFlag(bG,bm,"f"+bz+bm);by.newFlag(bG,"f"+bz+bm,"f"+bz+bp);by.newFlag(bG,"f"+bz+bp,bp);by.newFlag("ex"+bz,"f"+bz+bp,"f"+bz+bm)}else{by.newFlag(bz,bp,bm)}bp=bm}}if(!bq){console.log("No "+bx+"-fold components were found.")}bt=by.topoly();bt.name="n"+(bx===0?"":bx)+br.name;return bt};Z=function(br,bx){var bB,bA,by,bq,bz,bt,bv,bw,bu,bp,bm,bn,bk,bF,bG,bE,bD,bC,bs,bo,bl;console.log("Taking extrusion of "+(bx===0?"":bx)+"-sided faces of "+br.name+"...");by=new ag();bs=br.xyz;for(bz=0,bF=bs.length;bz<bF;bz++){bw=bs[bz];by.newV("v"+bz,bw)}bv=br.normals();bB=br.centers();bo=br.face;for(bz=0,bG=bo.length;bz<bG;bz++){bA=bo[bz];if(bA.length===bx||bx===0){for(bn=0,bE=bA.length;bn<bE;bn++){bu=bA[bn];by.newV("f"+bz+"v"+bu,y(br.xyz[bu],d(0.3,bv[bz])))}}}bq=false;bl=br.face;for(bz=0,bD=bl.length;bz<bD;bz++){bA=bl[bz];bp="v"+bA[bA.length-1];for(bk=0,bC=bA.length;bk<bC;bk++){bu=bA[bk];bm="v"+bu;if(bA.length===bx||bx===0){bq=true;by.newFlag(bz+bp,bp,bm);by.newFlag(bz+bp,bm,"f"+bz+bm);by.newFlag(bz+bp,"f"+bz+bm,"f"+bz+bp);by.newFlag(bz+bp,"f"+bz+bp,bp);by.newFlag("ex"+bz,"f"+bz+bp,"f"+bz+bm)}else{by.newFlag(bz,bp,bm)}bp=bm}}if(!bq){console.log("No "+bx+"-fold components were found.")}bt=by.topoly();bt.name="x"+(bx===0?"":bx)+br.name;console.log(bt);return bt};aU=function(bt){var bE,bD,bB,bC,by,bA,bz,bq,bF,bo,bs,br,bl,bw,bv,bu,bn,bH,bI,bG,bx,bp,bm,bk;console.log("Taking stella of "+bt.name+"...");bE=bt.centers();bB=new ag();bx=bt.xyz;for(bC=0,bH=bx.length;bC<bH;bC++){bA=bx[bC];bB.newV("v"+bC,bA)}bp=bt.face;for(bC=0,bI=bp.length;bC<bI;bC++){bD=bp[bC];bq="v"+bD[bD.length-2];bo="v"+bD[bD.length-1];bw=bt.xyz[bD[bD.length-2]];bv=bt.xyz[bD[bD.length-1]];for(bn=0,bG=bD.length;bn<bG;bn++){bz=bD[bn];bl="v"+bz;bu=bt.xyz[bz];bF=bq+"~"+bo;bs=bo+"~"+bq;br=bo+"~"+bl;bB.newV(bF,aQ(aQ(bw,bv),bE[bC]));bB.newFlag("in"+bC,bF,br);bB.newFlag("f"+bC+bo,br,bF);bB.newFlag("f"+bC+bo,bF,bo);bB.newFlag("f"+bC+bo,bo,br);bB.newFlag("f"+bF,bq,bs);bB.newFlag("f"+bF,bs,bF);bB.newFlag("f"+bF,bF,bq);bm=[bo,bl],bq=bm[0],bo=bm[1];bk=[bv,bu],bw=bk[0],bv=bk[1]}}by=bB.topoly();by.name="*"+bt.name;return by};X=function(bn,bm){var br,bp,bo,bk,bs,bl,bq;br=0.1;bk=a1(bn);for(bl=0,bq=bm.length;bl<bq;bl++){bo=bm[bl];bs=j(bk[bo[0]],bk[bo[1]]);bp=d(br*1/2*(1-S(C(bs,bs))),bs);bk[bo[0]]=y(bk[bo[0]],bp);bk[bo[1]]=y(bk[bo[1]],bp)}return bk};a6=function(bo,bn){var br,bp,bk,bl,bs,bm,bq;bk=(function(){var bw,bu,bv,bt;bt=[];for(bw=0,bu=bn.length;bw<bu;bw++){bv=bn[bw],br=bv[0],bp=bv[1];bt.push(j(bo[br],bo[bp]))}return bt})();bl=[0,0,0];for(bm=0,bq=bk.length;bm<bq;bm++){bs=bk[bm];bl=y(bl,bs)}bl=d(1/bn.length,bl);return _.map(bo,function(bt){return ba(bt,bl)})};A=function(bn){var bk,bm,bl;bm=[0,0,0];bk=_.max(_.map(bn,function(bo){return I(bo)}));bl=1/bk;return _.map(bn,function(bo){return[bl*bo[0],bl*bo[1],bl*bo[2]]})};a9=function(bq,bn){var bv,bs,bu,br,bm,bk,bw,bp,bo,bt,bl;bv=0.1;bk=a1(bq);for(bp=0,bt=bn.length;bp<bt;bp++){br=bn[bp];bu=(function(){var bz,bx,by;by=[];for(bz=0,bx=br.length;bz<bx;bz++){bw=br[bz];by.push(bq[bw])}return by})();bm=ai(bu);bs=bd(bu);if(C(bm,bs)<0){bm=d(-1,bm)}for(bo=0,bl=br.length;bo<bl;bo++){bw=br[bo];bk[bw]=y(bk[bw],d(C(d(bv,bm),ba(bs,bq[bw])),bm))}}return bk};m=function(bq,bp){var bl,bk,bn,bo,bm,br;console.log("Canonicalizing "+bq.name+"...");bk=bq.face;bl=bq.getEdges();bm=bq.xyz;bo=1;for(bn=0;0<=bp?bn<=bp:bn>=bp;0<=bp?bn++:bn--){br=a1(bm);bm=X(bm,bl);bm=a6(bm,bl);bm=a9(bm,bk);bo=_.max(_.map(_.zip(bm,br),function(bt){var bs,bu;bs=bt[0],bu=bt[1];return I(ba(bs,bu))}));if(bo<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bo+"]");return bm};M=function(bn){var bo,bl,bm,bk;bl=bn.centers();for(bm=0,bk=bl.length;bm<bk;bm++){bo=bl[bm];bo=d(1/C(bo,bo),bo)}return bl};F=function(bm){var bA,bu,bn,bv,bk,bt,bz,by,bw,br,bq,bx,bl,bs,bp,bo;bA=[];bs=bm.face;for(br=0,bx=bs.length;br<bx;br++){bv=bs[br];bn=[0,0,0];bk=[0,0,0];bu=0;bp=bv.slice(-2),bz=bp[0],by=bp[1];for(bq=0,bl=bv.length;bq<bl;bq++){bw=bv[bq];bn=y(bn,bm.xyz[bw]);bk=y(bk,aR(bm.xyz[bz],bm.xyz[by],bm.xyz[bw]));bu+=ar(bm.xyz[bz],bm.xyz[by]);bo=[by,bw],bz=bo[0],by=bo[1]}bn=d(1/bv.length,bn);bk=be(bk);bu=bu/bv.length;bt=ay(d(C(bn,bk),bk));bA.push(d((1+bu)/2,bt))}return bA};f=function(bo,bl){var bm,bk,bn;bk=aE(bo);console.log("Pseudo-canonicalizing "+bo.name+"...");for(bm=0,bn=bl-1;0<=bn?bm<=bn:bm>=bn;0<=bn?bm++:bm--){bk.xyz=F(bo);bo.xyz=F(bk)}return bo.xyz};x=function(bo,bl){var bm,bk,bn;bk=aE(bo);console.log("Planarizing "+bo.name+"...");for(bm=0,bn=bl-1;0<=bn?bm<=bn:bm>=bn;0<=bn?bm++:bm--){bk.xyz=M(bo);bo.xyz=M(bk)}return bo.xyz};H=function(bM){var bL,bH,bC,bF,bK,bu,bN,bE,bA,bw,bJ,bq,bG,bB,bs,bt,bv,bD,bI,br,bp,bo,bl,bk,bz,bx,bn,by,bm;bv=999;bG=[];bB=[];bs=bM.length;bJ=function(bO,bP){return(bO||bP)&&!(bO&&bP)};bL=function(bQ,bP,bO){return(bP[0]-bQ[0])*(bO[1]-bQ[1])-(bO[0]-bQ[0])*(bP[1]-bQ[1])};bA=function(bQ,bP,bO){return bL(bQ,bP,bO)>0};bw=function(bQ,bP,bO){return bL(bQ,bP,bO)>=0};bC=function(bQ,bP,bO){return bL(bQ,bP,bO)===0};bH=function(bQ,bP,bO){if(bC(bQ,bP,bO)){return false}if(bQ[0]!==bP[0]){return(bQ[0]<=bO[0])&&(bO[0]<=bP[0])||(bQ[0]>=bO[0])&&(bO[0]>=bP[0])}else{return(bQ[1]<=bO[1])&&(bO[1]<=bP[1])||(bQ[1]>=bO[1])&&(bO[1]>=bP[1])}};bE=function(bR,bQ,bP,bO){if(bC(bR,bQ,bP)||bC(bR,bQ,bO)||bC(bP,bO,bR)||bC(bP,bO,bQ)){return false}return bJ(bA(bR,bQ,bP),bA(bR,bQ,bO))&&bJ(bA(bP,bO,bR),bA(bP,bO,bQ))};bN=function(bR,bQ,bP,bO){if(bE(bR,bQ,bP,bO)){return true}else{if(bH(bR,bQ,bP)||bH(bR,bQ,bO)||bH(bP,bO,bR)||bH(bP,bO,bQ)){return true}else{return false}}};bu=function(bQ,bO){var bR,bP;bP=(bQ+1+bs)%bs;bR=(bQ-1+bs)%bs;if(bw(bM[bQ],bM[bP],bM[bR])){return bA(bM[bQ],bM[bO],bM[bR])&&bA(bM[bO],bM[bQ],bM[bP])}return !(bw(bM[bQ],bM[bO],bM[bP])&&bw(bM[bO],bM[bQ],bM[bR]))};bK=function(bP,bO){var bR,bQ;bR=0;while(true){bQ=(bR+1+bs)%bs;if((bR!==bP)&&(bQ!==bP)&&(bR!==bO)&&(bQ!==bO)&&bE(bM[bP],bM[bO],bM[bR],bM[bQ])){return false}bR=(bR+1+bs)%bs;if(bR===0){break}}return true};bF=function(bP,bO){return bu(bP,bO)&&bu(bO,bP)&&bK(bP,bO)};bp=0;while(true){bo=(bp+1+bs)%bs;br=(bp-1+bs)%bs;bB[bp]=bF(br,bo);bp=(bp+1+bs)%bs;if(bp===0){break}}bI=(function(){bm=[];for(var bP=0,bO=bs-1;0<=bO?bP<=bO:bP>=bO;0<=bO?bP++:bP--){bm.push(bP)}return bm}).apply(this);bD=bs;bx=bv;bt=0;while(bx>0&&bD>3){bx-=1;bo=bt;bz=bv;while(true){bz-=1;bq=false;if(bB[bo]){bl=(bo+1+bs)%bs;bk=(bl+1+bs)%bs;bp=(bo-1+bs)%bs;br=(bp-1+bs)%bs;bG.push([bI[bp],bI[bl]]);bB[bp]=bF(br,bl);bB[bl]=bF(bp,bk);bM=bM.slice(0,bo+1||9000000000).concat(bM.slice(bl));bI=bI.slice(0,bo+1||9000000000).concat(bI.slice(bl));if(br>bo){br-=1}if(bp>bo){bp-=1}if(bl>bo){bl-=1}if(bk>bo){bk-=1}bs--;bt=bl;bD--;bq=true}bo=(bo+1+bs)%bs;if(!(bz>0&&!bq&&bo!==bt)){break}}}return bG};a=function(bl,bk){if(((bl[0]===bk[0])&&(bl[1]===bk[1])&&(bl[2]===bk[2]))||(bl[0]===bk[1])&&(bl[1]===bk[2])&&(bl[2]===bk[0])||(bl[0]===bk[2])&&(bl[1]===bk[0])&&(bl[2]===bk[1])){return true}else{return false}};t=function(bR,bE){var bB,bS,bD,bC,bz,bF,bP,bl,bv,bT,bW,bV,bU,bQ,bO,bN,bM,bA,bs,br,bq,bp,bo,bn,bm,bk,bL,bK,bJ,bI,bH,bG,by,bx,bw,bu,bt;bz=[];bl=[];bG=(function(){var bY,bX;bX=[];for(bP=0,bY=bR.length-1;0<=bY?bP<=bY:bP>=bY;0<=bY?bP++:bP--){bX.push([bP,(bP+1)%bR.length])}return bX})();for(bQ=0,bA=bG.length;bQ<bA;bQ++){by=bG[bQ],bV=by[0],bU=by[1];bz[bV]=[bU];bl[bU]=[bV]}for(bO=0,bs=bE.length;bO<bs;bO++){bS=bE[bO];bz[bS[0]].push(bS[1]);bz[bS[1]].push(bS[0]);bl[bS[0]].push(bS[1]);bl[bS[1]].push(bS[0])}bT=[];for(bN=0,br=bE.length;bN<br;bN++){bS=bE[bN];bx=bz[bS[1]];for(bM=0,bq=bx.length;bM<bq;bM++){bD=bx[bM];bw=bl[bS[0]];for(bL=0,bp=bw.length;bL<bp;bL++){bC=bw[bL];if(bD===bC){bT.push([bS[0],bS[1],bD])}}}bu=bz[bS[0]];for(bK=0,bo=bu.length;bK<bo;bK++){bD=bu[bK];bt=bl[bS[1]];for(bJ=0,bn=bt.length;bJ<bn;bJ++){bC=bt[bJ];if(bD===bC){bT.push([bS[1],bS[0],bD])}}}}bW=[bT.pop()];for(bI=0,bm=bT.length;bI<bm;bI++){bv=bT[bI];bB=false;for(bH=0,bk=bW.length;bH<bk;bH++){bF=bW[bH];if(a(bv,bF)){bB=true;break}}if(!bB){bW.push(bv)}}return bW};Y=function(bm,bk){var bo,bn,bt,bs,bq,bp,bx,bw,bv,bu,bl,br;bk=bk||false;console.log("Triangulating faces of "+bm.name+"...");bp=new aL();bp.xyz=J(bm.xyz);bp.face_colors=[];br=bm.face;for(bs=0,bu=br.length;bs<bu;bs++){bt=br[bs];if(bt.length>3){bo=W((function(){var bA,by,bz;bz=[];for(bA=0,by=bt.length;bA<by;bA++){bv=bt[bA];bz.push(bm.xyz[bv])}return bz})());bn=H(bo);bw=t(bt,bn);for(bq=0,bl=bw.length;bq<bl;bq++){bx=bw[bq];bp.face.push([bt[bx[0]],bt[bx[1]],bt[bx[2]]]);if(bk){bp.face_colors.push(bm.face_colors[bs])}}}else{bp.face.push([bt[0],bt[1],bt[2]]);if(bk){bp.face_colors.push(bm.face_colors[bs])}}}bp.name=bm.name;return bp};af=function(bk){var bp,bq,bs,bn,bm,br,bl,bo;bq="";bo=bk.face;for(bn=0,br=bo.length;bn<br;bn++){bp=bo[bn];for(bm=0,bl=bp.length;bm<bl;bm++){bs=bp[bm];bq+=""+bs+"->"}bq+="\n"}return console.log(bq)};B=function(){var br,bo,bn,bm,bq,bp,bl,bk;bm=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bo=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bq=0,bl=bo.length;bq<bl;bq++){br=bo[bq];console.log("Operator "+br);for(bp=0,bk=bm.length;bp<bk;bp++){bn=bm[bp];console.log(br+bn+":",ae(br+bn))}}return console.log("===== Done Testing Basic Ops =====")};ab={};bf=500;aw=400;N={};i=J(u);aj=J(u);R=800;z=5;bg=0;K=0.8;n=bf/2;at=aw/2;v=new Date();p=true;aO="rgba(255,255,255,1.0)";al="area";g="fillstroke";a8=0.5;am=false;U=0;T=0;aC=[1,0,0];a0=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aA=function(bm,bk){var bn,bl;bn=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bl=new bn();bl.append(bm);return saveAs(bl.getBlob("text/plain;charset="+document.characterSet),bk)};ao=["#ff3333","#33ff33","#3333ff","#ffff33","#ff33ff","#33ffff","#dddddd","#555555","#dd0000","#00dd00","#0000dd"];aM=["#ff8888","#dddddd","#777777","#aa3333","#ff0000","#ffffff","#aaaaaa"];k=["#ff8888","#ffeeee","#88ff88","#dd7777","#ff2222","#22ff22","#ee4422","#aaaaaa"];bj=function(bl){var bk;if(bl[0]==="#"){bl=bl.slice(1)}if(bl.length===3){bk=bl.split("").map(function(bm){return parseInt(bm+bm,16)/255})}else{bk=bl.match(/.{2}/g).map(function(bm){return parseInt(bm,16)/255})}return bk};aW=aM;ad=function(bk){if(bk<aW.length){return bj(aW[bk])}else{return bj(aW[aW.length-1])}};aT=function(bk,bn){var bl,bm;bm=V(100*bk);if(bm in bn){return bn[bm]}else{bl=ad(_.toArray(bn).length);bn[bm]=bl;return bl}};O=function(bk){var bs,bo,bn,bq,br,bl,bp,bm;bk.face_colors=[];bo={};bm=bk.face;for(bl=0,bp=bm.length;bl<bp;bl++){bn=bm[bl];if(al==="area"){bq=(function(){var bv,bt,bu;bu=[];for(bv=0,bt=bn.length;bv<bt;bv++){br=bn[bv];bu.push(bk.xyz[br])}return bu})();bs=aT(bc(bq),bo)}else{bs=ad(bn.length-3)}bk.face_colors.push(bs)}return bk};aK=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];aX=function(bn){var bk,bm,bq,bp,bl,bo;bm=bn;for(bp=0,bl=aK.length;bp<bl;bp++){bo=aK[bp],bq=bo[0],bk=bo[1];bm=bm.replace(bq,bk)}console.log(""+bn+" executed as "+bm);return bm};ae=function(bl){var bn,bk,bm;bm=new aL();bn=0;bk=aX(bl);if(bk.search(/([0-9]+)$/)!==-1){bn=1*RegExp.lastParen;bk=bk.slice(0,-RegExp.lastParen.length)}switch(bk.slice(-1)){case"T":bm=e();break;case"O":bm=ap();break;case"C":bm=ah();break;case"I":bm=a3();break;case"D":bm=an();break;case"P":bm=Q(bn);break;case"A":bm=aS(bn);break;case"Y":bm=bi(bn);break;default:return}while(bk!==""){bn=0;if(bk.search(/([0-9]+)$/)!==-1){bn=1*RegExp.lastParen;bk=bk.slice(0,-RegExp.lastParen.length)}switch(bk.slice(-1)){case"d":bm=aE(bm);break;case"k":bm=aa(bm,bn);break;case"a":bm=aD(bm);break;case"g":bm=aZ(bm);break;case"p":bm=r(bm);break;case"r":bm=s(bm);break;case"K":bm.xyz=f(bm,bn===0?1:bn);break;case"C":bm.xyz=m(bm,bn===0?1:bn);break;case"A":bm.xyz=x(bm,bn===0?1:bn);break;case"n":bm=D(bm,bn);break;case"x":bm=Z(bm,bn);break;case"l":bm=aU(bm,bn);break;case"z":bm=Y(bm,false)}bk=bk.slice(0,-1)}bm.xyz=a6(bm.xyz,bm.getEdges());bm.xyz=A(bm.xyz);bm=O(bm);return bm};bh=function(){var bk,bp,bo,bn,bm,bl;bl={};bk=/\+/g;bm=/([^&=]+)=?([^&]*)/g;bp=function(bq){return decodeURIComponent(bq.replace(bk," "))};bn=window.location.search.substring(1);while(bo=bm.exec(bn)){bl[bp(bo[1])]=bp(bo[2])}return bl};aG=function(){var bk;bk=$("#poly");bk.width(bf);bk.height(aw);ab=bk[0].getContext("2d");ab.lineWidth=a8;if(p){return ab.clearRect(0,0,bf,aw)}else{ab.clearRect(0,0,bf,aw);ab.fillStyle=aO;return ab.fillRect(0,0,bf,aw)}};aI=function(){if(p){return ab.clearRect(0,0,bf,aw)}else{ab.clearRect(0,0,bf,aw);ab.fillStyle=aO;return ab.fillRect(0,0,bf,aw)}};aN=function(bk){var bl,bt,bs,bu,bo,bm,br,bp,bq,bn;bl=bk.centers();bs=bk.normals();bo=[0,0,(z*K-bg)/(1-K)];bu=function(bw,bv){return -C(ba(bo,bw[0]),bw[1])*C(ba(bv[0],bw[0]),bw[1])};bm=function(bw,bv){return bw[0][2]-bv[0][2]};br=_.zip(bl,bs,(function(){bn=[];for(var bw=0,bv=bk.face.length-1;0<=bv?bw<=bv:bw>=bv;0<=bv?bw++:bw--){bn.push(bw)}return bn}).apply(this)).sort(bm).map(function(bv){return bv[2]});bk.face=(function(){var bx,bv,bw;bw=[];for(bx=0,bv=br.length;bx<bv;bx++){bt=br[bx];bw.push(bk.face[bt])}return bw})();return bk.face_colors=(function(){var bx,bv,bw;bw=[];for(bx=0,bv=br.length;bx<bv;bx++){bt=br[bx];bw.push(bk.face_colors[bt])}return bw})()};P=function(br,bz){var bl,bt,bs,by,bn,bp,bx,bq,bw,bu,bm,bA,bB,bv,bo,bk;bz||(bz=[3,3,3]);bp=_.map(br.xyz,function(bC){return bC});br.xyz=_.map(br.xyz,function(bC){return q(i,bC)});aN(br);bv=br.face;for(by=0,bA=bv.length;by<bA;by++){bt=bv[by];ab.beginPath();bq=bt[bt.length-1];bo=w(y(bz,br.xyz[bq]),z,bg,K,R),bw=bo[0],bu=bo[1];ab.moveTo(bw+n,bu+at);for(bm=0,bB=bt.length;bm<bB;bm++){bx=bt[bm];bk=w(y(bz,br.xyz[bx]),z,bg,K,R),bw=bk[0],bu=bk[1];ab.lineTo(bw+n,bu+at)}bl=br.face_colors[by];bs=(function(){var bD,bE,bC;bC=[];for(bD=0,bE=bt.length;bD<bE;bD++){bx=bt[bD];bC.push(br.xyz[bx])}return bC})();bn=C(ai(bs),be([1,-1,0]));bl=d((bn/2+0.5)*0.7+0.3,bl);if(g==="fill"||g==="fillstroke"){ab.fillStyle="rgba("+(V(bl[0]*255))+", "+(V(bl[1]*255))+", "+(V(bl[2]*255))+", "+1+")";ab.fill();ab.strokeStyle="rgba("+(V(bl[0]*255))+", "+(V(bl[1]*255))+", "+(V(bl[2]*255))+", "+1+")";ab.stroke()}if(g==="fillstroke"){ab.fillStyle="rgba("+(V(bl[0]*255))+", "+(V(bl[1]*255))+", "+(V(bl[2]*255))+", "+1+")";ab.fill();ab.strokeStyle="rgba(0,0,0, .3)";ab.stroke()}if(g==="stroke"){ab.strokeStyle="rgba(0,0,0, .8)";ab.stroke()}}return br.xyz=bp};ax=function(){var bm,bn,bl,bk;aI();bk=[];for(bm=0,bl=N.length;bm<bl;bm++){bn=N[bm];bk.push(P(bn,[0+3*bm,0,3]))}return bk};bb=function(){var bl,bm,bn,bk;aI();bl=(2*Math.PI)/180*v.getSeconds()*0.1;for(bm=0,bk=N.length;bm<bk;bm++){bn=N[bm];P(bn,[0+3*bm,0,3])}return setTimeout(bb,100)};$(function(){var bl,bk;aG();bk=bh();if("recipe" in bk){bl=[bk.recipe];$("#spec").val(bl)}else{bl=[a7(a0)];$("#spec").val(bl)}N=_.map(bl,function(bm){return ae(bm)});ax();$("#spec").change(function(bm){bl=$("#spec").val().split(/\s+/g).slice(0,2);N=_.map(bl,function(bn){return ae(bn)});return ax()});$("#poly").mousewheel(function(bo,bp,bn,bm){bo.preventDefault();R*=(10+bp)/10;return ax()});$("#poly").mousedown(function(bm){var bn;bm.preventDefault();am=true;U=bm.clientX-$(this).offset().left;T=bm.clientY-($(this).offset().top-$(window).scrollTop());console.log(U,T);bn=aH(U,T,n,at,z,bg,K,R);if(bn[0]*bn[1]*bn[2]*0===0){aC=bn}return aj=J(i)});$("#poly").mouseup(function(bm){bm.preventDefault();return am=false});$("#poly").mouseleave(function(bm){bm.preventDefault();return am=false});$("#poly").mousemove(function(bp){var bn,bm,bo;bp.preventDefault();if(am){bn=bp.clientX-$(this).offset().left;bm=bp.clientY-$(this).offset().top;bo=aH(bn,bm,n,at,z,bg,K,R);if(bo[0]*bo[1]*bo[2]*0===0&&aC[0]*aC[1]*aC[2]*0===0){i=aB(az(aC,bo),aj)}return ax()}});$("#strokeonly").click(function(bm){g="stroke";return ax()});$("#fillonly").click(function(bm){g="fill";return ax()});$("#fillandstroke").click(function(bm){g="fillstroke";return ax()});$("#siderot").click(function(bm){i=aP(aF/2,0,1,0);return ax()});$("#toprot").click(function(bm){i=aP(aF/2,1,0,0);return ax()});$("#frontrot").click(function(bm){i=h(0,0,0);return ax()});$("#pngsavebutton").click(function(bp){var bo,bn,bm;bo=$("#poly")[0];bm=$("#spec").val().split(/\s+/g)[0];bn="polyhedronisme-"+bm+".png";return bo.toBlob(function(bq){return saveAs(bq,bn)})});$("#objsavebutton").click(function(bp){var bn,bo,bm;bo=N[0].toOBJ();bm=$("#spec").val().split(/\s+/g)[0];bn="polyhedronisme-"+bm+".obj";return aA(bo,bn)});return $("#x3dsavebutton").click(function(bp){var bn,bm,bo,bq;bo=Y(N[0],true);bq=bo.toVRML();bm=$("#spec").val().split(/\s+/g)[0];bn="polyhedronisme-"+bm+".wrl";return aA(bq,bn)})})}).call(this);