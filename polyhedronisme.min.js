(function(){var q,aS,ay,bk,an,a3,S,X,W,aF,ao,aZ,aR,aI,h,af,a1,z,y,aG,bf,aW,N,ax,bg,bi,g,n,aL,L,bh,a4,I,aw,ae,bb,aj,u,bq,aq,D,aA,R,aH,au,ac,v,az,a7,am,J,a0,aC,P,j,al,w,a2,bp,a6,aJ,E,F,aK,ad,e,m,K,a5,aU,aE,d,r,bo,ak,ap,at,be,G,aV,Q,ag,bm,x,M,A,bl,U,bc,ai,aO,a8,T,Z,s,bn,aM,ba,a9,aB,O,H,t,B,i,Y,aP,aD,ar,aY,aQ,aN,V,aX,bd,b,k,aa,C,f,ah,a,ab,l,bj,aT,c,o,av,p;aM=Math.random;Y=Math.round;am=Math.floor;V=Math.sqrt;aY=Math.sin;I=Math.cos;b=Math.tan;N=Math.asin;a1=Math.acos;ax=Math.atan;a8=Math.pow;af=Math.abs;aI=Math.PI;S=Math.LN10;e=Math.log;a8=Math.pow;m=function(br){return e(br)/S};ar=function(bt,bs){var br;br=a8(10,m(bt)-am(m(bt)));return""+(Y(br*(bs-1)))};L=function(bt){var bs,br;if(!(bt!=null)||typeof bt!=="object"){return bt}br=new bt.constructor();for(bs in bt){br[bs]=L(bt[bs])}return br};ba=function(bs){var br;br=am(aM()*bs.length);return bs[br]};d=function(bs,br){return[bs*br[0],bs*br[1],bs*br[2]]};p=function(bs,br){return[bs[0]*br[0],bs[1]*br[1],bs[2]*br[2]]};z=function(bs,br){return[bs[0]+br[0],bs[1]+br[1],bs[2]+br[2]]};bd=function(bs,br){return[bs[0]-br[0],bs[1]-br[1],bs[2]-br[2]]};D=function(bs,br){return bs[0]*br[0]+bs[1]*br[1]+bs[2]*br[2]};aw=function(bs,br){return[bs[1]*br[2]-bs[2]*br[1],bs[2]*br[0]-bs[0]*br[2],bs[0]*br[1]-bs[1]*br[0]]};K=function(br){return V(D(br,br))};a5=function(br){return D(br,br)};bj=function(br){return d(1/V(a5(br)),br)};aU=function(bs,br){return d(1/2,z(bs,br))};l=function(bt,bs,br){return[(1-br)*bt[0]+br*bs[0],(1-br)*bt[1]+br*bs[1],(1-br)*bt[2]+br*bs[2]]};at=function(bs,br){return l(bs,br,1/3)};aB=function(br){return d(1/a5(br),br)};k=function(bt,bs){var br;br=bd(bs,bt);return bd(bt,d(D(br,bt)/a5(br),br))};au=function(bs,br){return V(a5(k(bs,br)))};aV=function(bv,bu,bt){var bs,br;bs=bd(bu,bv);br=bd(bt,bu);return aw(bs,br)};F=function(by,bx,bw){var bC,bB,bA,bv,bu,bt,bz,bs,br;for(bv=0,bz=by.length;bv<bz;bv++){bC=by[bv];for(bu=0,bs=bx.length;bu<bs;bu++){bB=bx[bu];if(bC===bB){for(bt=0,br=bw.length;bt<br;bt++){bA=bw[bt];if(bC===bA){return bC}}}}}return null};bi=function(bv){var bt,bs,bu,br;bt=[0,0,0];for(bu=0,br=bv.length;bu<br;bu++){bs=bv[bu];bt=z(bt,bs)}return d(1/bv.length,bt)};ak=function(bv){var br,bz,bx,bw,bt,by,bu,bs;br=[0,0,0];bu=bv.slice(-2),bz=bu[0],bx=bu[1];for(bt=0,by=bv.length;bt<by;bt++){bw=bv[bt];br=z(br,aV(bz,bx,bw));bs=[bx,bw],bz=bs[0],bx=bs[1]}return bj(br)};bh=function(bv){var br,bz,bx,bw,bt,by,bu,bs;br=0;bu=bv.slice(0,2),bz=bu[0],bx=bu[1];bs=bv.slice(2);for(bt=0,by=bs.length;bt<by;bt++){bw=bs[bt];br+=K(aw(bd(bx,bz),bd(bw,bz)));bx=bw}return br};az=function(bA){var bz,bG,bF,bD,bB,bE,bx,bw,bv,bC,bs,br,by,bu,bt;bz=[];by=bA.slice(0,2),bF=by[0],bD=by[1];bu=bA.slice(2);for(bx=0,bC=bu.length;bx<bC;bx++){bB=bu[bx];bz.push(K(aw(bd(bD,bF),bd(bB,bF))));bD=bB}bz.sort(function(bI,bH){return bI-bH});bG="";for(bw=0,bs=bz.length;bw<bs;bw++){bE=bz[bw];bG+=ar(bE,2)}bt=bz.reverse();for(bv=0,br=bt.length;bv<br;bv++){bE=bt[bv];bG+=ar(bE,2)}return bG};Z=function(by){var bw,bs,br,bv,bz,bA,bu,bx,bt;bv=L(by);bA=by[0];bv=_.map(bv,function(bB){return bB-bA});bs=ak(by);bw=bj(bi(by));br=aw(bs,bw);bt=[];for(bu=0,bx=bv.length;bu<bx;bu++){bz=bv[bu];bt.push([D(bs,bz),D(br,bz)])}return bt};a4=function(bt){var bs,br,bu;br=new Array(bt.length);for(bs=0,bu=bt.length-1;0<=bu?bs<=bu:bs>=bu;0<=bu?bs++:bs--){br[bs]=bt[bs].slice(0)}return br};r=function(bs,br){return[bs[0][0]*br[0]+bs[0][1]*br[1]+bs[0][2]*br[2],bs[1][0]*br[0]+bs[1][1]*br[1]+bs[1][2]*br[2],bs[2][0]*br[0]+bs[2][1]*br[1]+bs[2][2]*br[2]]};aE=function(br,bs){return[[br[0][0]*bs[0][0]+br[0][1]*bs[1][0]+br[0][2]*bs[2][0],br[0][0]*bs[0][1]+br[0][1]*bs[1][1]+br[0][2]*bs[2][1],br[0][0]*bs[0][2]+br[0][1]*bs[1][2]+br[0][2]*bs[2][2]],[br[1][0]*bs[0][0]+br[1][1]*bs[1][0]+br[1][2]*bs[2][0],br[1][0]*bs[0][1]+br[1][1]*bs[1][1]+br[1][2]*bs[2][1],br[1][0]*bs[0][2]+br[1][1]*bs[1][2]+br[1][2]*bs[2][2]],[br[2][0]*bs[0][0]+br[2][1]*bs[1][0]+br[2][2]*bs[2][0],br[2][0]*bs[0][1]+br[2][1]*bs[1][1]+br[2][2]*bs[2][1],br[2][0]*bs[0][2]+br[2][1]*bs[1][2]+br[2][2]*bs[2][2]]]};v=[[1,0,0],[0,1,0],[0,0,1]];i=function(bv,bt,bu){var bw,bs,br;bw=[[I(bv),-1*aY(bv),0],[aY(bv),I(bv),0],[0,0,1]];br=[[I(bt),0,-1*aY(bt)],[0,1,0],[aY(bt),0,I(bt)]];bs=[[1,0,0],[0,I(bu),-1*aY(bu)],[0,aY(bu),I(bu)]];return aE(bs,aE(br,bw))};aT=function(bv,bE,bC,bz){var by,bs,bt,bD,bB,br,bA,bw,bx,bu;bv/=2;bD=aY(bv);by=I(bv);bB=bD*bD;bs=K([bE,bC,bz]);if(bs===0){bx=[0,0,1],bE=bx[0],bC=bx[1],bz=bx[2]}if(bs!==1){bu=bj([bE,bC,bz]),bE=bu[0],bC=bu[1],bz=bu[2]}if(bE===1&&bC===0&&bz===0){bt=[[1,0,0],[0,1-2*bB,2*bD*by],[0,-2*bD*by,1-2*bB]]}else{if(bE===0&&bC===1&&bz===0){bt=[[1-2*bB,0,-2*bD*by],[0,1,0],[2*bD*by,0,1-2*bB]]}else{if(bE===0&&bC===0&&bz===1){bt=[[1-2*bB,2*bD*by,0],[-2*bD*by,1-2*bB,0],[0,0,1]]}else{br=bE*bE;bA=bC*bC;bw=bz*bz;bt=[[1-2*(bA+bw)*bB,2*(bE*bC*bB+bz*bD*by),2*(bE*bz*bB-bC*bD*by)],[2*(bC*bE*bB-bz*bD*by),1-2*(bw+br)*bB,2*(bC*bz*bB+bE*bD*by)],[2*(bz*bE*bB+bC*bD*by),2*(bz*bC*bB-bE*bD*by),1-2*(br+bA)*bB]]}}}return bt};x=function(bt,bs,bu,bx,br){var bv,bw;bw=(bs*bx-bu)/(1-bx);bv=br*bx/(1-bx);return[bv*bt[0]/(bt[2]+bw),bv*bt[1]/(bt[2]+bw)]};aK=function(by,bv,bB,bz,bF,bu,bt,bs){var bE,br,bA,bw,bC,bH,bJ,bx,bD,bG,bI;bD=(bF*bt-bu)/(1-bt);bE=bs*bt/(1-bt);bA=by-bB;bH=bv-bz;br=bE*bE;bG=bD*bD;bw=bA*bA;bJ=bH*bH;bC=(2*bE*bA*bD+V(4*br*bw*bG+4*bw*(br+bw+bJ)*(1-bG)))/(2*(br+bw+bJ));bx=(bE*bH*bD)/(br+bw+bJ)+(bH*V(4*br*bG+4*(br+bw+bJ)*(1-bG)))/(2*(br+bw+bJ));bI=V(1-bC*bC-bx*bx);return[bC,bx,bI]};aC=function(bt,bs){var bu,br;br=aw(bt,bs);bu=a1(D(bt,bs));return aT(-1*bu,br[0],br[1],br[2])};a7=function(bu){var bs,bw,bv,bt,br;bs=[];bw=bu.slice(-1)[0];for(bt=0,br=bu.length;bt<br;bt++){bv=bu[bt];bs.push([bw,bv]);bw=bv}return bs};c=function(br){var bw,bv,bz,bx,bt,by,bs,bu;bx=[];bu=br.face;for(bv=0,by=bu.length;bv<by;bv++){bw=bu[bv];for(bt=0,bs=bw.length;bt<bs;bt++){bz=bw[bt];bx[bz]=br.face_class[bv]}}return bx};aP=["#ff7777","#dddddd","#889999","#fff0e5","#aa3333","#ff0000","#ffffff","#aaaaaa"];bp=function(bs){var br;if(bs[0]==="#"){bs=bs.slice(1)}if(bs.length===3){br=bs.split("").map(function(bt){return parseInt(bt+bt,16)/255})}else{br=bs.match(/.{2}/g).map(function(bt){return parseInt(bt,16)/255})}return br};aZ=aP;ag=function(br){if(br<aZ.length){return bp(aZ[br])}else{return bp(aZ[aZ.length-1])}};Q=function(br){var bA,bs,bw,bv,by,bz,bt,bx,bu;br.face_class=[];bw={};bs=function(bB,bE){var bC,bD;bD=Y(100*bB);if(bD in bE){return bE[bD]}else{bC=_.toArray(bE).length;bE[bD]=bC;return bC}};bu=br.face;for(bt=0,bx=bu.length;bt<bx;bt++){bv=bu[bt];if(an==="area"){by=(function(){var bD,bB,bC;bC=[];for(bD=0,bB=bv.length;bD<bB;bD++){bz=bv[bD];bC.push(br.xyz[bz])}return bC})();bA=bs(bh(by),bw)}else{if(an==="signature"){by=(function(){var bD,bB,bC;bC=[];for(bD=0,bB=bv.length;bD<bB;bD++){bz=bv[bD];bC.push(br.xyz[bz])}return bC})();bA=bs(az(by),bw)}else{bA=bv.length-3}}br.face_class.push(bA)}console.log(_.toArray(bw).length+" face classes");return br};aQ=function(br){var bs,bA,bz,bB,bv,bt,by,bw,bx,bu;bs=br.centers();bz=br.normals();bv=[0,0,(A*M-bl)/(1-M)];bB=function(bD,bC){return -D(bd(bv,bD[0]),bD[1])*D(bd(bC[0],bD[0]),bD[1])};bt=function(bD,bC){return bD[0][2]-bC[0][2]};by=_.zip(bs,bz,(function(){bu=[];for(var bD=0,bC=br.face.length-1;0<=bC?bD<=bC:bD>=bC;0<=bC?bD++:bD--){bu.push(bD)}return bu}).apply(this)).sort(bt).map(function(bC){return bC[2]});br.face=(function(){var bE,bC,bD;bD=[];for(bE=0,bC=by.length;bE<bC;bE++){bA=by[bE];bD.push(br.face[bA])}return bD})();return br.face_class=(function(){var bE,bC,bD;bD=[];for(bE=0,bC=by.length;bE<bC;bE++){bA=by[bE];bD.push(br.face_class[bA])}return bD})()};aO=(function(){function br(bu,bs,bt){this.face=bs||new Array();this.xyz=bu||new Array();this.name=bt||"null polyhedron"}br.prototype.data=function(){var bs;bs=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bs+" edges, "+this.xyz.length+" vertices)"};br.prototype.edges=function(){var bC,by,bA,bz,bt,bx,bw,bD,bv,bu,bB,bs;bx={};bD=[];by=_.map(this.face,a7);for(bv=0,bB=by.length;bv<bB;bv++){bt=by[bv];for(bu=0,bs=bt.length;bu<bs;bu++){bz=bt[bu];if(bz[0]<bz[1]){bC=bz[0],bA=bz[1]}else{bA=bz[0],bC=bz[1]}bx[bC+"~"+bA]=bz}}for(bw in bx){bz=bx[bw];bD.push(bz)}return bD};br.prototype.centers=function(){var bx,by,bu,bA,bv,bt,bz,bs,bw;bx=[];bw=this.face;for(bv=0,bz=bw.length;bv<bz;bv++){by=bw[bv];bu=[0,0,0];for(bt=0,bs=by.length;bt<bs;bt++){bA=by[bt];bu=z(bu,this.xyz[bA])}bx.push(d(1/by.length,bu))}return bx};br.prototype.normals=function(){var bw,bx,bt,bv,bs,bu;bx=[];bu=this.face;for(bv=0,bs=bu.length;bv<bs;bv++){bw=bu[bv];bx.push(ak((function(){var bA,by,bz;bz=[];for(bA=0,by=bw.length;bA<by;bA++){bt=bw[bA];bz.push(this.xyz[bt])}return bz}).call(this)))}return bx};br.prototype.toOBJ=function(){var bC,bB,bt,bD,bF,bz,by,bx,bE,bu,bs,bG,bA,bw,bv;bD="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bD+="group "+this.name+"\n";bD+="#vertices\n";bA=this.xyz;for(bz=0,bE=bA.length;bz<bE;bz++){bF=bA[bz];bD+="v "+bF[0]+" "+bF[1]+" "+bF[2]+"\n"}bD+="#normal vector defs \n";bw=this.face;for(by=0,bu=bw.length;by<bu;by++){bC=bw[by];bt=ak((function(){var bI,bJ,bH;bH=[];for(bI=0,bJ=bC.length;bI<bJ;bI++){bF=bC[bI];bH.push(this.xyz[bF])}return bH}).call(this));bD+="vn "+bt[0]+" "+bt[1]+" "+bt[2]+"\n"}bD+="#face defs \n";bv=this.face;for(bB=0,bs=bv.length;bB<bs;bB++){bC=bv[bB];bD+="f ";for(bx=0,bG=bC.length;bx<bG;bx++){bF=bC[bx];bD+=""+(bF+1)+"//"+(bB+1)+" "}bD+="\n"}return bD};br.prototype.toX3D=function(){var bw,bF,bI,bC,bE,bG,bA,bz,by,bv,bD,bt,bs,bH,bB,bx,bu;bw=0.01;bG='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bB=this.face;for(bA=0,bD=bB.length;bA<bD;bA++){bC=bB[bA];for(bz=0,bt=bC.length;bz<bt;bz++){bE=bC[bz];bG+=""+bE+" "}bG+="-1\n"}bG+='">\n';bG+='<Color color="';bx=c(this);for(by=0,bs=bx.length;by<bs;by++){bF=bx[by];bI=ag(bF);bG+=""+bI[0]+" "+bI[1]+" "+bI[2]+" "}bG+='"/>';bG+='<Coordinate point="';bu=this.xyz;for(bv=0,bH=bu.length;bv<bH;bv++){bE=bu[bv];bG+=""+(bE[0]*bw)+" "+(bE[1]*bw)+" "+(bE[2]*bw)+" "}bG+='"/>\n';bG+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bG};br.prototype.toVRML=function(){var bw,bF,bI,bC,bE,bG,bA,bz,by,bv,bD,bt,bs,bH,bB,bx,bu;bw=0.01;bG='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bB=this.xyz;for(bA=0,bD=bB.length;bA<bD;bA++){bE=bB[bA];bG+=""+(bE[0]*bw)+" "+(bE[1]*bw)+" "+(bE[2]*bw)+","}bG=bG.slice(0,-1);bG+="    ]\n}\ncolor Color\n{\n  color\n  [";bx=this.face_class;for(bz=0,bt=bx.length;bz<bt;bz++){bF=bx[bz];bI=ag(bF);bG+=""+bI[0]+" "+bI[1]+" "+bI[2]+" ,"}bG=bG.slice(0,-1);bG+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bu=this.face;for(by=0,bs=bu.length;by<bs;by++){bC=bu[by];for(bv=0,bH=bC.length;bv<bH;bv++){bE=bC[bv];bG+=""+bE+", "}bG+="-1,"}bG=bG.slice(0,-1);bG+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bG};return br})();f=function(){var br;br=new aO();br.name="T";br.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];br.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return br};ap=function(){var br;br=new aO();br.name="O";br.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];br.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return br};aj=function(){var br;br=new aO();br.name="C";br.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];br.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return br};a6=function(){var br;br=new aO();br.name="I";br.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];br.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return br};aq=function(){var br;br=new aO();br.name="D";br.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];br.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return br};T=function(bv){var bE,bD,br,bt,bB,bA,bC,by,bw,bu,bs,bz,bx;bt=2*aI/bv;bE=Math.sin(bt/2);br=new aO();br.name="P"+bv;for(bD=0,bC=bv-1;0<=bC?bD<=bC:bD>=bC;0<=bC?bD++:bD--){br.xyz.push([-I(bD*bt),-aY(bD*bt),-bE])}for(bD=0,by=bv-1;0<=by?bD<=by:bD>=by;0<=by?bD++:bD--){br.xyz.push([-I(bD*bt),-aY(bD*bt),bE])}br.face.push((function(){bz=[];for(var bF=bw=bv-1;bw<=0?bF<=0:bF>=0;bw<=0?bF++:bF--){bz.push(bF)}return bz}).apply(this));br.face.push((function(){bx=[];for(var bF=bv,bG=2*bv-1;bv<=bG?bF<=bG:bF>=bG;bv<=bG?bF++:bF--){bx.push(bF)}return bx}).apply(this));for(bD=0,bs=bv-1;0<=bs?bD<=bs:bD>=bs;0<=bs?bD++:bD--){br.face.push([bD,(bD+1)%bv,(bD+1)%bv+bv,bD+bv])}br=y(br,1);return br};aW=function(bw){var bG,bF,bE,bs,br,bu,bC,bB,bD,bz,bx,bv,bt,bA,by;bu=2*aI/bw;bF=V(1-4/(4+2*I(bu/2)-2*I(bu)));br=V(1-bF*bF);bG=V(bF*bF+a8(br*I(bu/2),2));br=-br/bG;bF=-bF/bG;bs=new aO();bs.name="A"+bw;for(bE=0,bD=bw-1;0<=bD?bE<=bD:bE>=bD;0<=bD?bE++:bE--){bs.xyz.push([br*I(bE*bu),br*aY(bE*bu),bF])}for(bE=0,bz=bw-1;0<=bz?bE<=bz:bE>=bz;0<=bz?bE++:bE--){bs.xyz.push([br*I((bE+0.5)*bu),br*aY((bE+0.5)*bu),-bF])}bs.face.push((function(){bA=[];for(var bH=bx=bw-1;bx<=0?bH<=0:bH>=0;bx<=0?bH++:bH--){bA.push(bH)}return bA}).apply(this));bs.face.push((function(){by=[];for(var bH=bw,bI=2*bw-1;bw<=bI?bH<=bI:bH>=bI;bw<=bI?bH++:bH--){by.push(bH)}return by}).apply(this));for(bE=0,bt=bw-1;0<=bt?bE<=bt:bE>=bt;0<=bt?bE++:bE--){bs.face.push([bE,(bE+1)%bw,bE+bw]);bs.face.push([bE,bE+bw,(bw+bE-1)%bw+bw])}bs=y(bs,1);return bs};bn=function(bt){var bA,bz,br,bs,bx,by,bv,bu,bw;bs=2*aI/bt;bA=1;br=new aO();br.name="Y"+bt;for(bz=0,by=bt-1;0<=by?bz<=by:bz>=by;0<=by?bz++:bz--){br.xyz.push([-I(bz*bs),-aY(bz*bs),-0.2])}br.xyz.push([0,0,bA]);br.face.push((function(){bw=[];for(var bB=bv=bt-1;bv<=0?bB<=0:bB>=0;bv<=0?bB++:bB--){bw.push(bB)}return bw}).apply(this));for(bz=0,bu=bt-1;0<=bu?bz<=bu:bz>=bu;0<=bu?bz++:bz--){br.face.push([bz,(bz+1)%bt,bt])}br=g(br,3);return br};ai=(function(){function br(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}br.prototype.newV=function(bt,bs){if(this.verts[bt]===void 0){this.verts[bt]=0;return this.xyzs[bt]=bs}};br.prototype.newFlag=function(bs,bu,bt){if(this.flags[bs]===void 0){this.flags[bs]={}}return this.flags[bs][bu]=bt};br.prototype.topoly=function(){var bt,by,bB,bx,bv,bs,bz,bA,bw,bu;bs=new aO();bt=0;bw=this.verts;for(bx in bw){bz=bw[bx];bs.xyz[bt]=this.xyzs[bx];this.verts[bx]=bt;bt++}bt=0;bu=this.flags;for(bx in bu){by=bu[bx];bs.face[bt]=[];for(bv in by){bz=by[bv];bA=bz;break}bz=bA;bs.face[bt].push(this.verts[bz]);bz=this.flags[bx][bz];bB=0;while(bz!==bA){bs.face[bt].push(this.verts[bz]);bz=this.flags[bx][bz];bB++;if(bB>1000){console.log("Bad flag spec, have a neverending face:",bx,this.flags[bx]);break}}bt++}bs.name="unknown polyhedron";return bs};return br})();ad=function(by,bE,bx){var bw,bI,bH,bF,bL,bv,bG,bA,bC,bD,bB,bu,br,bs,bK,bM,bJ,bz,bt;bE||(bE=0);bx||(bx=0.1);console.log("Taking kis of "+(bE===0?"":bE)+"-sided faces of "+by.name+"...");bF=new ai();bz=by.xyz;for(bG=0,bK=bz.length;bG<bK;bG++){bD=bz[bG];bF.newV("v"+bG,bD)}bC=by.normals();bI=by.centers();bv=false;bt=by.face;for(bG=0,bM=bt.length;bG<bM;bG++){bH=bt[bG];bu="v"+bH[bH.length-1];for(bs=0,bJ=bH.length;bs<bJ;bs++){bB=bH[bs];br="v"+bB;if(bH.length===bE||bE===0){bv=true;bw="apex"+bG;bL=""+bG+bu;bF.newV(bw,z(bI[bG],d(bx,bC[bG])));bF.newFlag(bL,bu,br);bF.newFlag(bL,br,bw);bF.newFlag(bL,bw,bu)}else{bF.newFlag(""+bG,bu,br)}bu=br}}if(!bv){console.log("No "+bE+"-fold components were found.")}bA=bF.topoly();bA.name="k"+(bE===0?"":bE)+by.name;return bA};aG=function(bs){var bA,bB,bz,bt,bw,bF,bE,bC,bx,bD,br,by,bv,bu;console.log("Taking ambo of "+bs.name+"...");bt=function(bH,bG){if(bH<bG){return bH+"_"+bG}else{return bG+"_"+bH}};bB=new ai();by=bs.face;for(bz=0,bD=by.length;bz<bD;bz++){bA=by[bz];bv=bA.slice(-2),bF=bv[0],bE=bv[1];for(bx=0,br=bA.length;bx<br;bx++){bC=bA[bx];if(bF<bE){bB.newV(bt(bF,bE),aU(bs.xyz[bF],bs.xyz[bE]))}bB.newFlag("orig"+bz,bt(bF,bE),bt(bE,bC));bB.newFlag("dual"+bE,bt(bE,bC),bt(bF,bE));bu=[bE,bC],bF=bu[0],bE=bu[1]}}bw=bB.topoly();bw.name="a"+bs.name;return bw};a2=function(by){var bG,bF,bD,bJ,bE,bC,bA,bB,bx,bv,bt,bI,bL,bK,bH,bz,bw,bu,bs,br;console.log("Taking gyro of "+by.name+"...");bD=new ai();bz=by.xyz;for(bE=0,bI=bz.length;bE<bI;bE++){bB=bz[bE];bD.newV("v"+bE,bj(bB))}bG=by.centers();bw=by.face;for(bE=0,bL=bw.length;bE<bL;bE++){bF=bw[bE];bD.newV("center"+bE,bj(bG[bE]))}bu=by.face;for(bE=0,bK=bu.length;bE<bK;bE++){bF=bu[bE];bs=bF.slice(-2),bx=bs[0],bv=bs[1];for(bC=0,bH=bF.length;bC<bH;bC++){bB=bF[bC];bt=bB;bD.newV(bx+"~"+bv,at(by.xyz[bx],by.xyz[bv]));bJ=bE+"f"+bx;bD.newFlag(bJ,"center"+bE,bx+"~"+bv);bD.newFlag(bJ,bx+"~"+bv,bv+"~"+bx);bD.newFlag(bJ,bv+"~"+bx,"v"+bv);bD.newFlag(bJ,"v"+bv,bv+"~"+bt);bD.newFlag(bJ,bv+"~"+bt,"center"+bE);br=[bv,bt],bx=br[0],bv=br[1]}}bA=bD.topoly();bA.name="g"+by.name;return bA};s=function(by){var bE,bC,bG,bD,bA,bB,bw,bt,bs,bu,bF,bI,bH,bz,bx,bv,br;console.log("Taking propellor of "+by.name+"...");bC=new ai();bz=by.xyz;for(bD=0,bF=bz.length;bD<bF;bD++){bB=bz[bD];bC.newV("v"+bD,bj(bB))}bx=by.face;for(bD=0,bI=bx.length;bD<bI;bD++){bE=bx[bD];bv=bE.slice(-2),bw=bv[0],bt=bv[1];for(bu=0,bH=bE.length;bu<bH;bu++){bB=bE[bu];bs=""+bB;bC.newV(bw+"~"+bt,at(by.xyz[bw],by.xyz[bt]));bG=""+bD+"f"+bt;bC.newFlag("v"+bD,bw+"~"+bt,bt+"~"+bs);bC.newFlag(bG,bw+"~"+bt,bt+"~"+bw);bC.newFlag(bG,bt+"~"+bw,"v"+bt);bC.newFlag(bG,"v"+bt,bt+"~"+bs);bC.newFlag(bG,bt+"~"+bs,bw+"~"+bt);br=[bt,bs],bw=br[0],bt=br[1]}}bA=bC.topoly();bA.name="p"+by.name;return bA};t=function(bt){var br,bs,bu;console.log("Taking reflection of "+bt.name+"...");for(br=0,bs=bt.xyz.length-1;0<=bs?br<=bs:br>=bs;0<=bs?br++:br--){bt.xyz[br]=d(-1,bt.xyz[br])}for(br=0,bu=bt.face.length-1;0<=bu?br<=bu:br>=bu;0<=bu?br++:br--){bt.face[br]=bt.face[br].reverse()}bt.name="r"+bt.name;return bt};aH=function(bA){var bI,bO,bH,bB,bF,bG,bE,bD,bz,bw,bx,bu,bs,bL,bN,bM,bK,bJ,bC,by,bv,bt,br;console.log("Taking dual of "+bA.name+"...");bF=new ai();bB=[];for(bG=0,bC=bA.xyz.length-1;0<=bC?bG<=bC:bG>=bC;0<=bC?bG++:bG--){bB[bG]={}}by=bA.face;for(bG=0,bL=by.length;bG<bL;bG++){bH=by[bG];bz=bH[bH.length-1];for(bx=0,bN=bH.length;bx<bN;bx++){bw=bH[bx];bB[bz]["v"+bw]=""+bG;bz=bw}}bI=bA.centers();for(bG=0,bv=bA.face.length-1;0<=bv?bG<=bv:bG>=bv;0<=bv?bG++:bG--){bF.newV(""+bG,bI[bG])}bt=bA.face;for(bG=0,bM=bt.length;bG<bM;bG++){bH=bt[bG];bz=bH[bH.length-1];for(bu=0,bK=bH.length;bu<bK;bu++){bw=bH[bu];bF.newFlag(bz,bB[bw]["v"+bz],""+bG);bz=bw}}bO=bF.topoly();bD=[];br=bO.face;for(bs=0,bJ=br.length;bs<bJ;bs++){bH=br[bs];bE=F(bA.face[bH[0]],bA.face[bH[1]],bA.face[bH[2]]);bD[bE]=bH}bO.face=bD;if(bA.name[0]!=="d"){bO.name="d"+bA.name}else{bO.name=bA.name.slice(1)}return bO};E=function(by,bF,bz,bG){var bK,bJ,bH,bP,bx,bI,bB,bD,bE,bC,bw,bt,bu,br,bO,bQ,bN,bM,bL,bA,bv,bs;bF||(bF=0);bz||(bz=0.5);bG||(bG=-0.2);console.log("Taking inset of "+(bF===0?"":bF)+"-sided faces of "+by.name+"...");bH=new ai();bA=by.xyz;for(bI=0,bO=bA.length;bI<bO;bI++){bE=bA[bI];bH.newV("v"+bI,bE)}bD=by.normals();bK=by.centers();bv=by.face;for(bI=0,bQ=bv.length;bI<bQ;bI++){bJ=bv[bI];if(bJ.length===bF||bF===0){for(bu=0,bN=bJ.length;bu<bN;bu++){bC=bJ[bu];bH.newV("f"+bI+"v"+bC,z(l(by.xyz[bC],bK[bI],bz),d(bG,bD[bI])))}}}bx=false;bs=by.face;for(bI=0,bM=bs.length;bI<bM;bI++){bJ=bs[bI];bw="v"+bJ[bJ.length-1];for(br=0,bL=bJ.length;br<bL;br++){bC=bJ[br];bt="v"+bC;if(bJ.length===bF||bF===0){bx=true;bP=bI+bw;bH.newFlag(bP,bw,bt);bH.newFlag(bP,bt,"f"+bI+bt);bH.newFlag(bP,"f"+bI+bt,"f"+bI+bw);bH.newFlag(bP,"f"+bI+bw,bw);bH.newFlag("ex"+bI,"f"+bI+bw,"f"+bI+bt)}else{bH.newFlag(bI,bw,bt)}bw=bt}}if(!bx){console.log("No "+bF+"-fold components were found.")}bB=bH.topoly();bB.name="n"+(bF===0?"":bF)+by.name;return bB};ac=function(by,bE){var bI,bH,bF,bx,bG,bA,bC,bD,bB,bw,bt,bu,br,bM,bN,bL,bK,bJ,bz,bv,bs;bE||(bE=0);console.log("Taking extrusion of "+(bE===0?"":bE)+"-sided faces of "+by.name+"...");bF=new ai();bz=by.xyz;for(bG=0,bM=bz.length;bG<bM;bG++){bD=bz[bG];bF.newV("v"+bG,bD)}bC=by.normals();bI=by.centers();bv=by.face;for(bG=0,bN=bv.length;bG<bN;bG++){bH=bv[bG];if(bH.length===bE||bE===0){for(bu=0,bL=bH.length;bu<bL;bu++){bB=bH[bu];bF.newV("f"+bG+"v"+bB,z(by.xyz[bB],d(0.3,bC[bG])))}}}bx=false;bs=by.face;for(bG=0,bK=bs.length;bG<bK;bG++){bH=bs[bG];bw="v"+bH[bH.length-1];for(br=0,bJ=bH.length;br<bJ;br++){bB=bH[br];bt="v"+bB;if(bH.length===bE||bE===0){bx=true;bF.newFlag(bG+bw,bw,bt);bF.newFlag(bG+bw,bt,"f"+bG+bt);bF.newFlag(bG+bw,"f"+bG+bt,"f"+bG+bw);bF.newFlag(bG+bw,"f"+bG+bw,bw);bF.newFlag("ex"+bG,"f"+bG+bw,"f"+bG+bt)}else{bF.newFlag(bG,bw,bt)}bw=bt}}if(!bx){console.log("No "+bE+"-fold components were found.")}bA=bF.topoly();bA.name="x"+(bE===0?"":bE)+by.name;return bA};aX=function(bA){var bL,bK,bI,bJ,bF,bH,bG,bx,bM,bv,bz,by,bs,bD,bC,bB,bu,bO,bP,bN,bE,bw,bt,br;console.log("Taking stella of "+bA.name+"...");bL=bA.centers();bI=new ai();bE=bA.xyz;for(bJ=0,bO=bE.length;bJ<bO;bJ++){bH=bE[bJ];bI.newV("v"+bJ,bH)}bw=bA.face;for(bJ=0,bP=bw.length;bJ<bP;bJ++){bK=bw[bJ];bx="v"+bK[bK.length-2];bv="v"+bK[bK.length-1];bD=bA.xyz[bK[bK.length-2]];bC=bA.xyz[bK[bK.length-1]];for(bu=0,bN=bK.length;bu<bN;bu++){bG=bK[bu];bs="v"+bG;bB=bA.xyz[bG];bM=bx+"~"+bv;bz=bv+"~"+bx;by=bv+"~"+bs;bI.newV(bM,aU(aU(bD,bC),bL[bJ]));bI.newFlag("in"+bJ,bM,by);bI.newFlag("f"+bJ+bv,by,bM);bI.newFlag("f"+bJ+bv,bM,bv);bI.newFlag("f"+bJ+bv,bv,by);bI.newFlag("f"+bM,bx,bz);bI.newFlag("f"+bM,bz,bM);bI.newFlag("f"+bM,bM,bx);bt=[bv,bs],bx=bt[0],bv=bt[1];br=[bC,bB],bD=br[0],bC=br[1]}}bF=bI.topoly();bF.name="l"+bA.name;return bF};aa=function(bu,bt){var by,bw,bv,br,bz,bs,bx;by=0.1;br=a4(bu);for(bs=0,bx=bt.length;bs<bx;bs++){bv=bt[bs];bz=k(br[bv[0]],br[bv[1]]);bw=d(by*1/2*(1-V(D(bz,bz))),bz);br[bv[0]]=z(br[bv[0]],bw);br[bv[1]]=z(br[bv[1]],bw)}return br};a9=function(bv,bu){var by,bw,br,bs,bz,bt,bx;br=(function(){var bD,bB,bC,bA;bA=[];for(bD=0,bB=bu.length;bD<bB;bD++){bC=bu[bD],by=bC[0],bw=bC[1];bA.push(k(bv[by],bv[bw]))}return bA})();bs=[0,0,0];for(bt=0,bx=br.length;bt<bx;bt++){bz=br[bt];bs=z(bs,bz)}bs=d(1/bu.length,bs);return _.map(bv,function(bA){return bd(bA,bs)})};B=function(bu){var br,bt,bs;bt=[0,0,0];br=_.max(_.map(bu,function(bv){return K(bv)}));bs=1/br;return _.map(bu,function(bv){return[bs*bv[0],bs*bv[1],bs*bv[2]]})};bc=function(bx,bu){var bC,bz,bB,by,bt,br,bD,bw,bv,bA,bs;bC=0.1;br=a4(bx);for(bw=0,bA=bu.length;bw<bA;bw++){by=bu[bw];bB=(function(){var bG,bE,bF;bF=[];for(bG=0,bE=by.length;bG<bE;bG++){bD=by[bG];bF.push(bx[bD])}return bF})();bt=ak(bB);bz=bi(bB);if(D(bt,bz)<0){bt=d(-1,bt)}for(bv=0,bs=by.length;bv<bs;bv++){bD=by[bv];br[bD]=z(br[bD],d(D(d(bC,bt),bd(bz,bx[bD])),bt))}}return br};n=function(bs,by){var bv,bt,bw,bx,br,bu,bz;by||(by=1);console.log("Canonicalizing "+bs.name+"...");bt=bs.face;bv=bs.edges();br=bs.xyz;bx=1;for(bw=0;0<=by?bw<=by:bw>=by;0<=by?bw++:bw--){bz=a4(br);br=aa(br,bv);br=a9(br,bv);br=bc(br,bt);bx=_.max(_.map(_.zip(br,bz),function(bB){var bA,bC;bA=bB[0],bC=bB[1];return K(bd(bA,bC))}));if(bx<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bx+"]");bu=new aO(br,bs.face,bs.name);console.log("canonicalize",bu);return bu};O=function(bu){var bv,bs,bt,br;bs=bu.centers();for(bt=0,br=bs.length;bt<br;bt++){bv=bs[bt];bv=d(1/D(bv,bv),bv)}return bs};H=function(bt){var bH,bB,bu,bC,br,bA,bG,bF,bD,by,bx,bE,bs,bz,bw,bv;bH=[];bz=bt.face;for(by=0,bE=bz.length;by<bE;by++){bC=bz[by];bu=[0,0,0];br=[0,0,0];bB=0;bw=bC.slice(-2),bG=bw[0],bF=bw[1];for(bx=0,bs=bC.length;bx<bs;bx++){bD=bC[bx];bu=z(bu,bt.xyz[bD]);br=z(br,aV(bt.xyz[bG],bt.xyz[bF],bt.xyz[bD]));bB+=au(bt.xyz[bG],bt.xyz[bF]);bv=[bF,bD],bG=bv[0],bF=bv[1]}bu=d(1/bC.length,bu);br=bj(br);bB=bB/bC.length;bA=aB(d(D(bu,br),br));bH.push(d((1+bB)/2,bA))}return bH};g=function(bv,bs){var bt,br,bu;bs||(bs=1);br=aH(bv);console.log("Pseudo-canonicalizing "+bv.name+"...");for(bt=0,bu=bs-1;0<=bu?bt<=bu:bt>=bu;0<=bu?bt++:bt--){br.xyz=H(bv);bv.xyz=H(br)}return new aO(bv.xyz,bv.face,bv.name)};y=function(bv,bs){var bt,br,bu;bs||(bs=1);br=aH(bv);console.log("Planarizing "+bv.name+"...");for(bt=0,bu=bs-1;0<=bu?bt<=bu:bt>=bu;0<=bu?bt++:bt--){br.xyz=O(bv);bv.xyz=O(br)}return new aO(bv.xyz,bv.face,bv.name)};J=function(bT){var bS,bO,bJ,bM,bR,bB,bU,bL,bH,bD,bQ,bx,bN,bI,bz,bA,bC,bK,bP,by,bw,bv,bs,br,bG,bE,bu,bF,bt;bC=999;bN=[];bI=[];bz=bT.length;bQ=function(bV,bW){return(bV||bW)&&!(bV&&bW)};bS=function(bX,bW,bV){return(bW[0]-bX[0])*(bV[1]-bX[1])-(bV[0]-bX[0])*(bW[1]-bX[1])};bH=function(bX,bW,bV){return bS(bX,bW,bV)>0};bD=function(bX,bW,bV){return bS(bX,bW,bV)>=0};bJ=function(bX,bW,bV){return bS(bX,bW,bV)===0};bO=function(bX,bW,bV){if(bJ(bX,bW,bV)){return false}if(bX[0]!==bW[0]){return(bX[0]<=bV[0])&&(bV[0]<=bW[0])||(bX[0]>=bV[0])&&(bV[0]>=bW[0])}else{return(bX[1]<=bV[1])&&(bV[1]<=bW[1])||(bX[1]>=bV[1])&&(bV[1]>=bW[1])}};bL=function(bY,bX,bW,bV){if(bJ(bY,bX,bW)||bJ(bY,bX,bV)||bJ(bW,bV,bY)||bJ(bW,bV,bX)){return false}return bQ(bH(bY,bX,bW),bH(bY,bX,bV))&&bQ(bH(bW,bV,bY),bH(bW,bV,bX))};bU=function(bY,bX,bW,bV){if(bL(bY,bX,bW,bV)){return true}else{if(bO(bY,bX,bW)||bO(bY,bX,bV)||bO(bW,bV,bY)||bO(bW,bV,bX)){return true}else{return false}}};bB=function(bX,bV){var bY,bW;bW=(bX+1+bz)%bz;bY=(bX-1+bz)%bz;if(bD(bT[bX],bT[bW],bT[bY])){return bH(bT[bX],bT[bV],bT[bY])&&bH(bT[bV],bT[bX],bT[bW])}return !(bD(bT[bX],bT[bV],bT[bW])&&bD(bT[bV],bT[bX],bT[bY]))};bR=function(bW,bV){var bY,bX;bY=0;while(true){bX=(bY+1+bz)%bz;if((bY!==bW)&&(bX!==bW)&&(bY!==bV)&&(bX!==bV)&&bL(bT[bW],bT[bV],bT[bY],bT[bX])){return false}bY=(bY+1+bz)%bz;if(bY===0){break}}return true};bM=function(bW,bV){return bB(bW,bV)&&bB(bV,bW)&&bR(bW,bV)};bw=0;while(true){bv=(bw+1+bz)%bz;by=(bw-1+bz)%bz;bI[bw]=bM(by,bv);bw=(bw+1+bz)%bz;if(bw===0){break}}bP=(function(){bt=[];for(var bW=0,bV=bz-1;0<=bV?bW<=bV:bW>=bV;0<=bV?bW++:bW--){bt.push(bW)}return bt}).apply(this);bK=bz;bE=bC;bA=0;while(bE>0&&bK>3){bE-=1;bv=bA;bG=bC;while(true){bG-=1;bx=false;if(bI[bv]){bs=(bv+1+bz)%bz;br=(bs+1+bz)%bz;bw=(bv-1+bz)%bz;by=(bw-1+bz)%bz;bN.push([bP[bw],bP[bs]]);bI[bw]=bM(by,bs);bI[bs]=bM(bw,br);bT=bT.slice(0,bv+1||9000000000).concat(bT.slice(bs));bP=bP.slice(0,bv+1||9000000000).concat(bP.slice(bs));if(by>bv){by-=1}if(bw>bv){bw-=1}if(bs>bv){bs-=1}if(br>bv){br-=1}bz--;bA=bs;bK--;bx=true}bv=(bv+1+bz)%bz;if(!(bG>0&&!bx&&bv!==bA)){break}}}return bN};a=function(bs,br){if(((bs[0]===br[0])&&(bs[1]===br[1])&&(bs[2]===br[2]))||(bs[0]===br[1])&&(bs[1]===br[2])&&(bs[2]===br[0])||(bs[0]===br[2])&&(bs[1]===br[0])&&(bs[2]===br[1])){return true}else{return false}};u=function(bY,bL){var bI,bZ,bK,bJ,bG,bM,bW,bs,bC,b0,b3,b2,b1,bX,bV,bU,bT,bH,bz,by,bx,bw,bv,bu,bt,br,bS,bR,bQ,bP,bO,bN,bF,bE,bD,bB,bA;bG=[];bs=[];bN=(function(){var b5,b4;b4=[];for(bW=0,b5=bY.length-1;0<=b5?bW<=b5:bW>=b5;0<=b5?bW++:bW--){b4.push([bW,(bW+1)%bY.length])}return b4})();for(bX=0,bH=bN.length;bX<bH;bX++){bF=bN[bX],b2=bF[0],b1=bF[1];bG[b2]=[b1];bs[b1]=[b2]}for(bV=0,bz=bL.length;bV<bz;bV++){bZ=bL[bV];bG[bZ[0]].push(bZ[1]);bG[bZ[1]].push(bZ[0]);bs[bZ[0]].push(bZ[1]);bs[bZ[1]].push(bZ[0])}b0=[];for(bU=0,by=bL.length;bU<by;bU++){bZ=bL[bU];bE=bG[bZ[1]];for(bT=0,bx=bE.length;bT<bx;bT++){bK=bE[bT];bD=bs[bZ[0]];for(bS=0,bw=bD.length;bS<bw;bS++){bJ=bD[bS];if(bK===bJ){b0.push([bZ[0],bZ[1],bK])}}}bB=bG[bZ[0]];for(bR=0,bv=bB.length;bR<bv;bR++){bK=bB[bR];bA=bs[bZ[1]];for(bQ=0,bu=bA.length;bQ<bu;bQ++){bJ=bA[bQ];if(bK===bJ){b0.push([bZ[1],bZ[0],bK])}}}}b3=[b0.pop()];for(bP=0,bt=b0.length;bP<bt;bP++){bC=b0[bP];bI=false;for(bO=0,br=b3.length;bO<br;bO++){bM=b3[bO];if(a(bC,bM)){bI=true;break}}if(!bI){b3.push(bC)}}return b3};ab=function(bt,br){var bv,bu,bA,bz,bx,bw,bE,bD,bC,bB,bs,by;br=br||false;console.log("Triangulating faces of "+bt.name+"...");bw=new aO();bw.xyz=L(bt.xyz);bw.face_class=[];by=bt.face;for(bz=0,bB=by.length;bz<bB;bz++){bA=by[bz];if(bA.length>3){bv=Z((function(){var bH,bF,bG;bG=[];for(bH=0,bF=bA.length;bH<bF;bH++){bC=bA[bH];bG.push(bt.xyz[bC])}return bG})());bu=J(bv);bD=u(bA,bu);for(bx=0,bs=bD.length;bx<bs;bx++){bE=bD[bx];bw.face.push([bA[bE[0]],bA[bE[1]],bA[bE[2]]]);if(br){bw.face_class.push(bt.face_class[bz])}}}else{bw.face.push([bA[0],bA[1],bA[2]]);if(br){bw.face_class.push(bt.face_class[bz])}}}bw.name=bt.name;return bw};ah=function(br){var bw,bx,bz,bu,bt,by,bs,bv;bx="";bv=br.face;for(bu=0,by=bv.length;bu<by;bu++){bw=bv[bu];for(bt=0,bs=bw.length;bt<bs;bt++){bz=bw[bt];bx+=""+bz+"->"}bx+="\n"}return console.log(bx)};C=function(){var by,bv,bu,bt,bx,bw,bs,br;bt=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bv=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bx=0,bs=bv.length;bx<bs;bx++){by=bv[bx];console.log("Operator "+by);for(bw=0,br=bt.length;bw<br;bw++){bu=bt[bw];console.log(by+bu+":",generatePoly(by+bu))}}return console.log("===== Done Testing Basic Ops =====")};aR='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(""), 10); }';be=PEG.buildParser(aR);bq=function(bs,br){return bs.apply(this,br||[])};bg={T:f,O:ap,C:aj,I:a6,D:aq,P:T,A:aW,Y:bn};G={d:aH,k:ad,a:aG,g:a2,p:s,r:t,n:E,x:ac,l:aX,z:ab,K:g,C:n,A:y};aN=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];a0=function(bu){var br,bt,bx,bw,bs,bv;bt=bu;for(bw=0,bs=aN.length;bw<bs;bw++){bv=aN[bw],bx=bv[0],br=bv[1];bt=bt.replace(bx,br)}console.log(""+bu+" executed as "+bt);return bt};bo=function(bx){var bs,bz,bu,bB,bv,bA,bw,br,bt,by;bw=a0(bx);bA=be.parse(bw).reverse();bu=bA.shift();bz=bg[bu.op];bs=bu.args;br=bq(bz,bs);for(bt=0,by=bA.length;bt<by;bt++){bu=bA[bt];bv=G[bu.op];bB=[br].concat(bu.args);br=bq(bv,bB)}br.xyz=a9(br.xyz,br.edges());br.xyz=B(br.xyz);br=Q(br);return br};ae={};bk=500;ay=400;P={};j=L(v);al=L(v);U=800;A=5;bl=0;M=0.8;o=bk/2;av=ay/2;w=new Date();q=true;aS="rgba(255,255,255,1.0)";an="signature";h="fillstroke";bb=0.5;ao=false;X=0;W=0;aF=[1,0,0];a3=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aD=function(bt,br){var bu,bs;bu=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bs=new bu();bs.append(bt);return saveAs(bs.getBlob("text/plain;charset="+document.characterSet),br)};bm=function(){var br,bw,bv,bu,bt,bs;bs={};br=/\+/g;bt=/([^&=]+)=?([^&]*)/g;bw=function(bx){return decodeURIComponent(bx.replace(br," "))};bu=window.location.search.substring(1);while(bv=bt.exec(bu)){bs[bw(bv[1])]=bw(bv[2])}return bs};aJ=function(){var br;br=$("#poly");br.width(bk);br.height(ay);ae=br[0].getContext("2d");ae.lineWidth=bb;if(q){return ae.clearRect(0,0,bk,ay)}else{ae.clearRect(0,0,bk,ay);ae.fillStyle=aS;return ae.fillRect(0,0,bk,ay)}};aL=function(){if(q){return ae.clearRect(0,0,bk,ay)}else{ae.clearRect(0,0,bk,ay);ae.fillStyle=aS;return ae.fillRect(0,0,bk,ay)}};R=function(by,bG){var bs,bA,bz,bF,bu,bw,bE,bx,bD,bB,bt,bH,bI,bC,bv,br;bG||(bG=[3,3,3]);bw=_.map(by.xyz,function(bJ){return bJ});by.xyz=_.map(by.xyz,function(bJ){return r(j,bJ)});aQ(by);bC=by.face;for(bF=0,bH=bC.length;bF<bH;bF++){bA=bC[bF];ae.beginPath();bx=bA[bA.length-1];bv=x(z(bG,by.xyz[bx]),A,bl,M,U),bD=bv[0],bB=bv[1];ae.moveTo(bD+o,bB+av);for(bt=0,bI=bA.length;bt<bI;bt++){bE=bA[bt];br=x(z(bG,by.xyz[bE]),A,bl,M,U),bD=br[0],bB=br[1];ae.lineTo(bD+o,bB+av)}bs=ag(by.face_class[bF]);bz=(function(){var bK,bL,bJ;bJ=[];for(bK=0,bL=bA.length;bK<bL;bK++){bE=bA[bK];bJ.push(by.xyz[bE])}return bJ})();bu=D(ak(bz),bj([1,-1,0]));bs=d((bu/2+0.5)*0.7+0.3,bs);if(h==="fill"||h==="fillstroke"){ae.fillStyle="rgba("+(Y(bs[0]*255))+", "+(Y(bs[1]*255))+", "+(Y(bs[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba("+(Y(bs[0]*255))+", "+(Y(bs[1]*255))+", "+(Y(bs[2]*255))+", "+1+")";ae.stroke()}if(h==="fillstroke"){ae.fillStyle="rgba("+(Y(bs[0]*255))+", "+(Y(bs[1]*255))+", "+(Y(bs[2]*255))+", "+1+")";ae.fill();ae.strokeStyle="rgba(0,0,0, .3)";ae.stroke()}if(h==="stroke"){ae.strokeStyle="rgba(0,0,0, .8)";ae.stroke()}}return by.xyz=bw};aA=function(){var bt,bu,bs,br;aL();br=[];for(bt=0,bs=P.length;bt<bs;bt++){bu=P[bt];br.push(R(bu,[0+3*bt,0,3]))}return br};bf=function(){var bs,bt,bu,br;aL();bs=(2*Math.PI)/180*w.getSeconds()*0.1;for(bt=0,br=P.length;bt<br;bt++){bu=P[bt];R(bu,[0+3*bt,0,3])}return setTimeout(bf,100)};$(function(){var bs,br;aJ();br=bm();if("recipe" in br){bs=[br.recipe];$("#spec").val(bs)}else{bs=[ba(a3)];$("#spec").val(bs)}$("#palette").val(aZ.reduce(function(bt,bu){return bt+" "+bu}));P=_.map(bs,function(bt){return bo(bt)});aA();$("#spec").change(function(bt){bs=$("#spec").val().split(/\s+/g).slice(0,2);P=_.map(bs,function(bu){return bo(bu)});return aA()});$("#palette").change(function(bt){aZ=$(this).val().split(/\s+/g);return aA()});$("#poly").mousewheel(function(bv,bw,bu,bt){bv.preventDefault();U*=(10+bw)/10;return aA()});$("#poly").mousedown(function(bt){var bu;bt.preventDefault();ao=true;X=bt.clientX-$(this).offset().left;W=bt.clientY-($(this).offset().top-$(window).scrollTop());bu=aK(X,W,o,av,A,bl,M,U);if(bu[0]*bu[1]*bu[2]*0===0){aF=bu}return al=L(j)});$("#poly").mouseup(function(bt){bt.preventDefault();return ao=false});$("#poly").mouseleave(function(bt){bt.preventDefault();return ao=false});$("#poly").mousemove(function(bw){var bu,bt,bv;bw.preventDefault();if(ao){bu=bw.clientX-$(this).offset().left;bt=bw.clientY-($(this).offset().top-$(window).scrollTop());bv=aK(bu,bt,o,av,A,bl,M,U);if(bv[0]*bv[1]*bv[2]*0===0&&aF[0]*aF[1]*aF[2]*0===0){j=aE(aC(aF,bv),al)}return aA()}});$("#strokeonly").click(function(bt){h="stroke";return aA()});$("#fillonly").click(function(bt){h="fill";return aA()});$("#fillandstroke").click(function(bt){h="fillstroke";return aA()});$("#siderot").click(function(bt){j=aT(aI/2,0,1,0);return aA()});$("#toprot").click(function(bt){j=aT(aI/2,1,0,0);return aA()});$("#frontrot").click(function(bt){j=i(0,0,0);return aA()});$("#pngsavebutton").click(function(bw){var bv,bu,bt;bv=$("#poly")[0];bt=$("#spec").val().split(/\s+/g)[0];bu="polyhedronisme-"+bt.replace(/\([^\)]+\)/g,"")+".png";return bv.toBlob(function(bx){return saveAs(bx,bu)})});$("#objsavebutton").click(function(bw){var bu,bv,bt;bv=P[0].toOBJ();bt=$("#spec").val().split(/\s+/g)[0];bu="polyhedronisme-"+bt.replace(/\([^\)]+\)/g,"")+".obj";return aD(bv,bu)});return $("#x3dsavebutton").click(function(bw){var bu,bt,bv,bx;bv=ab(P[0],true);bx=bv.toVRML();bt=$("#spec").val().split(/\s+/g)[0];bu="polyhedronisme-"+bt.replace(/\([^\)]+\)/g,"")+".wrl";return aD(bx,bu)})})}).call(this);