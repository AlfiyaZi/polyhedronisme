(function(){var a7,u,aZ,aD,bu,at,bb,W,ab,aa,aL,au,a6,aY,aO,i,bp,aE,aj,a9,D,C,aM,bn,a3,R,aC,bo,br,h,q,aR,k,P,bq,bc,M,aB,ai,bj,an,y,bA,aw,H,aG,V,aN,az,ag,z,aF,bf,aq,N,a8,s,aI,T,m,ap,A,ba,bz,be,ar,aP,I,J,j,aQ,ah,f,p,O,bd,a1,aK,e,v,by,ao,av,ay,bm,K,a2,U,ak,bw,B,Q,E,bv,Y,bk,bs,am,aV,bg,X,ad,w,bx,aS,bi,bh,aH,S,L,x,F,l,ac,aW,aJ,ax,a5,aX,aU,Z,a4,bl,c,n,ae,G,g,b,al,a,af,o,aT,bt,a0,d,r,aA,t;aS=Math.random;ac=Math.round;aq=Math.floor;Z=Math.sqrt;a5=Math.sin;M=Math.cos;c=Math.tan;R=Math.asin;a9=Math.acos;aC=Math.atan;bg=Math.pow;aj=Math.abs;aO=Math.PI;W=Math.LN10;f=Math.log;bg=Math.pow;p=function(bB){return f(bB)/W};ax=function(bD,bC){var bB;bB=bg(10,p(bD)-aq(p(bD)));return""+(ac(bB*(bC-1)))};P=function(bD){var bC,bB;if(!(bD!=null)||typeof bD!=="object"){return bD}bB=new bD.constructor();for(bC in bD){bB[bC]=P(bD[bC])}return bB};bi=function(bC){var bB;bB=aq(aS()*bC.length);return bC[bB]};e=function(bC,bB){return[bC*bB[0],bC*bB[1],bC*bB[2]]};t=function(bC,bB){return[bC[0]*bB[0],bC[1]*bB[1],bC[2]*bB[2]]};D=function(bC,bB){return[bC[0]+bB[0],bC[1]+bB[1],bC[2]+bB[2]]};bl=function(bC,bB){return[bC[0]-bB[0],bC[1]-bB[1],bC[2]-bB[2]]};H=function(bC,bB){return bC[0]*bB[0]+bC[1]*bB[1]+bC[2]*bB[2]};aB=function(bC,bB){return[bC[1]*bB[2]-bC[2]*bB[1],bC[2]*bB[0]-bC[0]*bB[2],bC[0]*bB[1]-bC[1]*bB[0]]};O=function(bB){return Z(H(bB,bB))};bd=function(bB){return H(bB,bB)};bt=function(bB){return e(1/Z(bd(bB)),bB)};a1=function(bC,bB){return e(1/2,D(bC,bB))};o=function(bD,bC,bB){return[(1-bB)*bD[0]+bB*bC[0],(1-bB)*bD[1]+bB*bC[1],(1-bB)*bD[2]+bB*bC[2]]};ay=function(bC,bB){return o(bC,bB,1/3)};aH=function(bB){return e(1/bd(bB),bB)};n=function(bD,bC){var bB;bB=bl(bC,bD);return bl(bD,e(H(bB,bD)/bd(bB),bB))};az=function(bC,bB){return Z(bd(n(bC,bB)))};a2=function(bF,bE,bD){var bC,bB;bC=bl(bE,bF);bB=bl(bD,bE);return aB(bC,bB)};J=function(bI,bH,bG){var bM,bL,bK,bF,bE,bD,bJ,bC,bB;for(bF=0,bJ=bI.length;bF<bJ;bF++){bM=bI[bF];for(bE=0,bC=bH.length;bE<bC;bE++){bL=bH[bE];if(bM===bL){for(bD=0,bB=bG.length;bD<bB;bD++){bK=bG[bD];if(bM===bK){return bM}}}}}return null};br=function(bF){var bD,bC,bE,bB;bD=[0,0,0];for(bE=0,bB=bF.length;bE<bB;bE++){bC=bF[bE];bD=D(bD,bC)}return e(1/bF.length,bD)};ao=function(bF){var bB,bJ,bH,bG,bD,bI,bE,bC;bB=[0,0,0];bE=bF.slice(-2),bJ=bE[0],bH=bE[1];for(bD=0,bI=bF.length;bD<bI;bD++){bG=bF[bD];bB=D(bB,a2(bJ,bH,bG));bC=[bH,bG],bJ=bC[0],bH=bC[1]}return bt(bB)};bq=function(bF){var bB,bJ,bH,bG,bD,bI,bE,bC;bB=0;bE=bF.slice(0,2),bJ=bE[0],bH=bE[1];bC=bF.slice(2);for(bD=0,bI=bC.length;bD<bI;bD++){bG=bC[bD];bB+=O(aB(bl(bH,bJ),bl(bG,bJ)));bH=bG}return bB};aF=function(bK){var bJ,bQ,bP,bN,bL,bO,bH,bG,bF,bM,bC,bB,bI,bE,bD;bJ=[];bI=bK.slice(0,2),bP=bI[0],bN=bI[1];bE=bK.slice(2);for(bH=0,bM=bE.length;bH<bM;bH++){bL=bE[bH];bJ.push(O(aB(bl(bN,bP),bl(bL,bP))));bN=bL}bJ.sort(function(bS,bR){return bS-bR});bQ="";for(bG=0,bC=bJ.length;bG<bC;bG++){bO=bJ[bG];bQ+=ax(bO,2)}bD=bJ.reverse();for(bF=0,bB=bD.length;bF<bB;bF++){bO=bD[bF];bQ+=ax(bO,2)}return bQ};ad=function(bI){var bG,bC,bB,bF,bJ,bK,bE,bH,bD;bF=P(bI);bK=bI[0];bF=_.map(bF,function(bL){return bL-bK});bC=ao(bI);bG=bt(br(bI));bB=aB(bC,bG);bD=[];for(bE=0,bH=bF.length;bE<bH;bE++){bJ=bF[bE];bD.push([H(bC,bJ),H(bB,bJ)])}return bD};bc=function(bD){var bC,bB,bE;bB=new Array(bD.length);for(bC=0,bE=bD.length-1;0<=bE?bC<=bE:bC>=bE;0<=bE?bC++:bC--){bB[bC]=bD[bC].slice(0)}return bB};v=function(bC,bB){return[bC[0][0]*bB[0]+bC[0][1]*bB[1]+bC[0][2]*bB[2],bC[1][0]*bB[0]+bC[1][1]*bB[1]+bC[1][2]*bB[2],bC[2][0]*bB[0]+bC[2][1]*bB[1]+bC[2][2]*bB[2]]};aK=function(bB,bC){return[[bB[0][0]*bC[0][0]+bB[0][1]*bC[1][0]+bB[0][2]*bC[2][0],bB[0][0]*bC[0][1]+bB[0][1]*bC[1][1]+bB[0][2]*bC[2][1],bB[0][0]*bC[0][2]+bB[0][1]*bC[1][2]+bB[0][2]*bC[2][2]],[bB[1][0]*bC[0][0]+bB[1][1]*bC[1][0]+bB[1][2]*bC[2][0],bB[1][0]*bC[0][1]+bB[1][1]*bC[1][1]+bB[1][2]*bC[2][1],bB[1][0]*bC[0][2]+bB[1][1]*bC[1][2]+bB[1][2]*bC[2][2]],[bB[2][0]*bC[0][0]+bB[2][1]*bC[1][0]+bB[2][2]*bC[2][0],bB[2][0]*bC[0][1]+bB[2][1]*bC[1][1]+bB[2][2]*bC[2][1],bB[2][0]*bC[0][2]+bB[2][1]*bC[1][2]+bB[2][2]*bC[2][2]]]};z=[[1,0,0],[0,1,0],[0,0,1]];l=function(bF,bD,bE){var bG,bC,bB;bG=[[M(bF),-1*a5(bF),0],[a5(bF),M(bF),0],[0,0,1]];bB=[[M(bD),0,-1*a5(bD)],[0,1,0],[a5(bD),0,M(bD)]];bC=[[1,0,0],[0,M(bE),-1*a5(bE)],[0,a5(bE),M(bE)]];return aK(bC,aK(bB,bG))};a0=function(bF,bO,bM,bJ){var bI,bC,bD,bN,bL,bB,bK,bG,bH,bE;bF/=2;bN=a5(bF);bI=M(bF);bL=bN*bN;bC=O([bO,bM,bJ]);if(bC===0){bH=[0,0,1],bO=bH[0],bM=bH[1],bJ=bH[2]}if(bC!==1){bE=bt([bO,bM,bJ]),bO=bE[0],bM=bE[1],bJ=bE[2]}if(bO===1&&bM===0&&bJ===0){bD=[[1,0,0],[0,1-2*bL,2*bN*bI],[0,-2*bN*bI,1-2*bL]]}else{if(bO===0&&bM===1&&bJ===0){bD=[[1-2*bL,0,-2*bN*bI],[0,1,0],[2*bN*bI,0,1-2*bL]]}else{if(bO===0&&bM===0&&bJ===1){bD=[[1-2*bL,2*bN*bI,0],[-2*bN*bI,1-2*bL,0],[0,0,1]]}else{bB=bO*bO;bK=bM*bM;bG=bJ*bJ;bD=[[1-2*(bK+bG)*bL,2*(bO*bM*bL+bJ*bN*bI),2*(bO*bJ*bL-bM*bN*bI)],[2*(bM*bO*bL-bJ*bN*bI),1-2*(bG+bB)*bL,2*(bM*bJ*bL+bO*bN*bI)],[2*(bJ*bO*bL+bM*bN*bI),2*(bJ*bM*bL-bO*bN*bI),1-2*(bB+bK)*bL]]}}}return bD};B=function(bD,bC,bE,bH,bB){var bF,bG;bG=(bC*bH-bE)/(1-bH);bF=bB*bH/(1-bH);return[bF*bD[0]/(bD[2]+bG),bF*bD[1]/(bD[2]+bG)]};aQ=function(bI,bF,bL,bJ,bP,bE,bD,bC){var bO,bB,bK,bG,bM,bR,bT,bH,bN,bQ,bS;bN=(bP*bD-bE)/(1-bD);bO=bC*bD/(1-bD);bK=bI-bL;bR=bF-bJ;bB=bO*bO;bQ=bN*bN;bG=bK*bK;bT=bR*bR;bM=(2*bO*bK*bN+Z(4*bB*bG*bQ+4*bG*(bB+bG+bT)*(1-bQ)))/(2*(bB+bG+bT));bH=(bO*bR*bN)/(bB+bG+bT)+(bR*Z(4*bB*bQ+4*(bB+bG+bT)*(1-bQ)))/(2*(bB+bG+bT));bS=Z(1-bM*bM-bH*bH);return[bM,bH,bS]};aI=function(bD,bC){var bE,bB;bB=aB(bD,bC);bE=a9(H(bD,bC));return a0(-1*bE,bB[0],bB[1],bB[2])};bf=function(bE){var bC,bG,bF,bD,bB;bC=[];bG=bE.slice(-1)[0];for(bD=0,bB=bE.length;bD<bB;bD++){bF=bE[bD];bC.push([bG,bF]);bG=bF}return bC};d=function(bB){var bG,bF,bJ,bH,bD,bI,bC,bE;bH=[];bE=bB.face;for(bF=0,bI=bE.length;bF<bI;bF++){bG=bE[bF];for(bD=0,bC=bG.length;bD<bC;bD++){bJ=bG[bD];bH[bJ]=bB.face_class[bF]}}return bH};aW=["#ff7777","#dddddd","#889999","#fff0e5","#aa3333","#ff0000","#ffffff","#aaaaaa"];bz=function(bC){var bB;if(bC[0]==="#"){bC=bC.slice(1)}if(bC.length===3){bB=bC.split("").map(function(bD){return parseInt(bD+bD,16)/255})}else{bB=bC.match(/.{2}/g).map(function(bD){return parseInt(bD,16)/255})}return bB};a6=aW;ak=function(bB){if(bB<a6.length){return bz(a6[bB])}else{return bz(a6[a6.length-1])}};U=function(bB){var bK,bC,bG,bF,bI,bJ,bD,bH,bE;bB.face_class=[];bG={};bC=function(bL,bO){var bM,bN;bN=ac(100*bL);if(bN in bO){return bO[bN]}else{bM=_.toArray(bO).length;bO[bN]=bM;return bM}};bE=bB.face;for(bD=0,bH=bE.length;bD<bH;bD++){bF=bE[bD];if(at==="area"){bI=(function(){var bN,bL,bM;bM=[];for(bN=0,bL=bF.length;bN<bL;bN++){bJ=bF[bN];bM.push(bB.xyz[bJ])}return bM})();bK=bC(bq(bI),bG)}else{if(at==="signature"){bI=(function(){var bN,bL,bM;bM=[];for(bN=0,bL=bF.length;bN<bL;bN++){bJ=bF[bN];bM.push(bB.xyz[bJ])}return bM})();bK=bC(aF(bI),bG)}else{bK=bF.length-3}}bB.face_class.push(bK)}console.log(_.toArray(bG).length+" face classes");return bB};aX=function(bB){var bC,bK,bJ,bF,bD,bI,bG,bH,bE;bC=bB.centers();bJ=bB.normals();bF=[0,0,(E*Q-bv)/(1-Q)];bD=function(bM,bL){return bM[0][2]-bL[0][2]};bI=_.zip(bC,bJ,(function(){bE=[];for(var bM=0,bL=bB.face.length-1;0<=bL?bM<=bL:bM>=bL;0<=bL?bM++:bM--){bE.push(bM)}return bE}).apply(this)).sort(bD).map(function(bL){return bL[2]});bB.face=(function(){var bN,bL,bM;bM=[];for(bN=0,bL=bI.length;bN<bL;bN++){bK=bI[bN];bM.push(bB.face[bK])}return bM})();return bB.face_class=(function(){var bN,bL,bM;bM=[];for(bN=0,bL=bI.length;bN<bL;bN++){bK=bI[bN];bM.push(bB.face_class[bK])}return bM})()};aV=(function(){function bB(bE,bC,bD){this.face=bC||new Array();this.xyz=bE||new Array();this.name=bD||"null polyhedron"}bB.prototype.data=function(){var bC;bC=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bC+" edges, "+this.xyz.length+" vertices)"};bB.prototype.edges=function(){var bM,bI,bK,bJ,bD,bH,bG,bN,bF,bE,bL,bC;bH={};bN=[];bI=_.map(this.face,bf);for(bF=0,bL=bI.length;bF<bL;bF++){bD=bI[bF];for(bE=0,bC=bD.length;bE<bC;bE++){bJ=bD[bE];if(bJ[0]<bJ[1]){bM=bJ[0],bK=bJ[1]}else{bK=bJ[0],bM=bJ[1]}bH[bM+"~"+bK]=bJ}}for(bG in bH){bJ=bH[bG];bN.push(bJ)}return bN};bB.prototype.centers=function(){var bH,bI,bE,bK,bF,bD,bJ,bC,bG;bH=[];bG=this.face;for(bF=0,bJ=bG.length;bF<bJ;bF++){bI=bG[bF];bE=[0,0,0];for(bD=0,bC=bI.length;bD<bC;bD++){bK=bI[bD];bE=D(bE,this.xyz[bK])}bH.push(e(1/bI.length,bE))}return bH};bB.prototype.normals=function(){var bG,bH,bD,bF,bC,bE;bH=[];bE=this.face;for(bF=0,bC=bE.length;bF<bC;bF++){bG=bE[bF];bH.push(ao((function(){var bK,bI,bJ;bJ=[];for(bK=0,bI=bG.length;bK<bI;bK++){bD=bG[bK];bJ.push(this.xyz[bD])}return bJ}).call(this)))}return bH};bB.prototype.toOBJ=function(){var bM,bL,bD,bN,bP,bJ,bI,bH,bO,bE,bC,bQ,bK,bG,bF;bN="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bN+="group "+this.name+"\n";bN+="#vertices\n";bK=this.xyz;for(bJ=0,bO=bK.length;bJ<bO;bJ++){bP=bK[bJ];bN+="v "+bP[0]+" "+bP[1]+" "+bP[2]+"\n"}bN+="#normal vector defs \n";bG=this.face;for(bI=0,bE=bG.length;bI<bE;bI++){bM=bG[bI];bD=ao((function(){var bS,bT,bR;bR=[];for(bS=0,bT=bM.length;bS<bT;bS++){bP=bM[bS];bR.push(this.xyz[bP])}return bR}).call(this));bN+="vn "+bD[0]+" "+bD[1]+" "+bD[2]+"\n"}bN+="#face defs \n";bF=this.face;for(bL=0,bC=bF.length;bL<bC;bL++){bM=bF[bL];bN+="f ";for(bH=0,bQ=bM.length;bH<bQ;bH++){bP=bM[bH];bN+=""+(bP+1)+"//"+(bL+1)+" "}bN+="\n"}return bN};bB.prototype.toX3D=function(){var bG,bP,bS,bM,bO,bQ,bK,bJ,bI,bF,bN,bD,bC,bR,bL,bH,bE;bG=0.01;bQ='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bL=this.face;for(bK=0,bN=bL.length;bK<bN;bK++){bM=bL[bK];for(bJ=0,bD=bM.length;bJ<bD;bJ++){bO=bM[bJ];bQ+=""+bO+" "}bQ+="-1\n"}bQ+='">\n';bQ+='<Color color="';bH=d(this);for(bI=0,bC=bH.length;bI<bC;bI++){bP=bH[bI];bS=ak(bP);bQ+=""+bS[0]+" "+bS[1]+" "+bS[2]+" "}bQ+='"/>';bQ+='<Coordinate point="';bE=this.xyz;for(bF=0,bR=bE.length;bF<bR;bF++){bO=bE[bF];bQ+=""+(bO[0]*bG)+" "+(bO[1]*bG)+" "+(bO[2]*bG)+" "}bQ+='"/>\n';bQ+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bQ};bB.prototype.toVRML=function(){var bG,bP,bS,bM,bO,bQ,bK,bJ,bI,bF,bN,bD,bC,bR,bL,bH,bE;bG=0.01;bQ='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bL=this.xyz;for(bK=0,bN=bL.length;bK<bN;bK++){bO=bL[bK];bQ+=""+(bO[0]*bG)+" "+(bO[1]*bG)+" "+(bO[2]*bG)+","}bQ=bQ.slice(0,-1);bQ+="    ]\n}\ncolor Color\n{\n  color\n  [";bH=this.face_class;for(bJ=0,bD=bH.length;bJ<bD;bJ++){bP=bH[bJ];bS=ak(bP);bQ+=""+bS[0]+" "+bS[1]+" "+bS[2]+" ,"}bQ=bQ.slice(0,-1);bQ+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bE=this.face;for(bI=0,bC=bE.length;bI<bC;bI++){bM=bE[bI];for(bF=0,bR=bM.length;bF<bR;bF++){bO=bM[bF];bQ+=""+bO+", "}bQ+="-1,"}bQ=bQ.slice(0,-1);bQ+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bQ};return bB})();g=function(){var bB;bB=new aV();bB.name="T";bB.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bB.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bB};av=function(){var bB;bB=new aV();bB.name="O";bB.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bB.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bB};an=function(){var bB;bB=new aV();bB.name="C";bB.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bB.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bB};be=function(){var bB;bB=new aV();bB.name="I";bB.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bB.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bB};aw=function(){var bB;bB=new aV();bB.name="D";bB.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bB.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bB};X=function(bF){var bO,bN,bB,bD,bL,bK,bM,bI,bG,bE,bC,bJ,bH;bD=2*aO/bF;bO=Math.sin(bD/2);bB=new aV();bB.name="P"+bF;for(bN=0,bM=bF-1;0<=bM?bN<=bM:bN>=bM;0<=bM?bN++:bN--){bB.xyz.push([-M(bN*bD),-a5(bN*bD),-bO])}for(bN=0,bI=bF-1;0<=bI?bN<=bI:bN>=bI;0<=bI?bN++:bN--){bB.xyz.push([-M(bN*bD),-a5(bN*bD),bO])}bB.face.push((function(){bJ=[];for(var bP=bG=bF-1;bG<=0?bP<=0:bP>=0;bG<=0?bP++:bP--){bJ.push(bP)}return bJ}).apply(this));bB.face.push((function(){bH=[];for(var bP=bF,bQ=2*bF-1;bF<=bQ?bP<=bQ:bP>=bQ;bF<=bQ?bP++:bP--){bH.push(bP)}return bH}).apply(this));for(bN=0,bC=bF-1;0<=bC?bN<=bC:bN>=bC;0<=bC?bN++:bN--){bB.face.push([bN,(bN+1)%bF,(bN+1)%bF+bF,bN+bF])}bB=C(bB,1);return bB};a3=function(bG){var bQ,bP,bO,bC,bB,bE,bM,bL,bN,bJ,bH,bF,bD,bK,bI;bE=2*aO/bG;bP=Z(1-4/(4+2*M(bE/2)-2*M(bE)));bB=Z(1-bP*bP);bQ=Z(bP*bP+bg(bB*M(bE/2),2));bB=-bB/bQ;bP=-bP/bQ;bC=new aV();bC.name="A"+bG;for(bO=0,bN=bG-1;0<=bN?bO<=bN:bO>=bN;0<=bN?bO++:bO--){bC.xyz.push([bB*M(bO*bE),bB*a5(bO*bE),bP])}for(bO=0,bJ=bG-1;0<=bJ?bO<=bJ:bO>=bJ;0<=bJ?bO++:bO--){bC.xyz.push([bB*M((bO+0.5)*bE),bB*a5((bO+0.5)*bE),-bP])}bC.face.push((function(){bK=[];for(var bR=bH=bG-1;bH<=0?bR<=0:bR>=0;bH<=0?bR++:bR--){bK.push(bR)}return bK}).apply(this));bC.face.push((function(){bI=[];for(var bR=bG,bS=2*bG-1;bG<=bS?bR<=bS:bR>=bS;bG<=bS?bR++:bR--){bI.push(bR)}return bI}).apply(this));for(bO=0,bD=bG-1;0<=bD?bO<=bD:bO>=bD;0<=bD?bO++:bO--){bC.face.push([bO,(bO+1)%bG,bO+bG]);bC.face.push([bO,bO+bG,(bG+bO-1)%bG+bG])}bC=C(bC,1);return bC};bx=function(bD){var bK,bJ,bB,bC,bH,bI,bF,bE,bG;bC=2*aO/bD;bK=1;bB=new aV();bB.name="Y"+bD;for(bJ=0,bI=bD-1;0<=bI?bJ<=bI:bJ>=bI;0<=bI?bJ++:bJ--){bB.xyz.push([-M(bJ*bC),-a5(bJ*bC),-0.2])}bB.xyz.push([0,0,bK]);bB.face.push((function(){bG=[];for(var bL=bF=bD-1;bF<=0?bL<=0:bL>=0;bF<=0?bL++:bL--){bG.push(bL)}return bG}).apply(this));for(bJ=0,bE=bD-1;0<=bE?bJ<=bE:bJ>=bE;0<=bE?bJ++:bJ--){bB.face.push([bJ,(bJ+1)%bD,bD])}bB=h(bB,3);return bB};am=(function(){function bB(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bB.prototype.newV=function(bD,bC){if(this.verts[bD]===void 0){this.verts[bD]=0;return this.xyzs[bD]=bC}};bB.prototype.newFlag=function(bC,bE,bD){if(this.flags[bC]===void 0){this.flags[bC]={}}return this.flags[bC][bE]=bD};bB.prototype.topoly=function(){var bD,bI,bL,bH,bF,bC,bJ,bK,bG,bE;bC=new aV();bD=0;bG=this.verts;for(bH in bG){bJ=bG[bH];bC.xyz[bD]=this.xyzs[bH];this.verts[bH]=bD;bD++}bD=0;bE=this.flags;for(bH in bE){bI=bE[bH];bC.face[bD]=[];for(bF in bI){bJ=bI[bF];bK=bJ;break}bJ=bK;bC.face[bD].push(this.verts[bJ]);bJ=this.flags[bH][bJ];bL=0;while(bJ!==bK){bC.face[bD].push(this.verts[bJ]);bJ=this.flags[bH][bJ];bL++;if(bL>1000){console.log("Bad flag spec, have a neverending face:",bH,this.flags[bH]);break}}bD++}bC.name="unknown polyhedron";return bC};return bB})();ah=function(bI,bO,bH){var bG,bS,bR,bP,bV,bF,bQ,bK,bM,bN,bL,bE,bB,bC,bU,bW,bT,bJ,bD;bO||(bO=0);bH||(bH=0.1);console.log("Taking kis of "+(bO===0?"":bO)+"-sided faces of "+bI.name+"...");bP=new am();bJ=bI.xyz;for(bQ=0,bU=bJ.length;bQ<bU;bQ++){bN=bJ[bQ];bP.newV("v"+bQ,bN)}bM=bI.normals();bS=bI.centers();bF=false;bD=bI.face;for(bQ=0,bW=bD.length;bQ<bW;bQ++){bR=bD[bQ];bE="v"+bR[bR.length-1];for(bC=0,bT=bR.length;bC<bT;bC++){bL=bR[bC];bB="v"+bL;if(bR.length===bO||bO===0){bF=true;bG="apex"+bQ;bV=""+bQ+bE;bP.newV(bG,D(bS[bQ],e(bH,bM[bQ])));bP.newFlag(bV,bE,bB);bP.newFlag(bV,bB,bG);bP.newFlag(bV,bG,bE)}else{bP.newFlag(""+bQ,bE,bB)}bE=bB}}if(!bF){console.log("No "+bO+"-fold components were found.")}bK=bP.topoly();bK.name="k"+(bO===0?"":bO)+bI.name;return bK};aM=function(bC){var bK,bL,bJ,bD,bG,bP,bO,bM,bH,bN,bB,bI,bF,bE;console.log("Taking ambo of "+bC.name+"...");bD=function(bR,bQ){if(bR<bQ){return bR+"_"+bQ}else{return bQ+"_"+bR}};bL=new am();bI=bC.face;for(bJ=0,bN=bI.length;bJ<bN;bJ++){bK=bI[bJ];bF=bK.slice(-2),bP=bF[0],bO=bF[1];for(bH=0,bB=bK.length;bH<bB;bH++){bM=bK[bH];if(bP<bO){bL.newV(bD(bP,bO),a1(bC.xyz[bP],bC.xyz[bO]))}bL.newFlag("orig"+bJ,bD(bP,bO),bD(bO,bM));bL.newFlag("dual"+bO,bD(bO,bM),bD(bP,bO));bE=[bO,bM],bP=bE[0],bO=bE[1]}}bG=bL.topoly();bG.name="a"+bC.name;return bG};ba=function(bI){var bQ,bP,bN,bT,bO,bM,bK,bL,bH,bF,bD,bS,bV,bU,bR,bJ,bG,bE,bC,bB;console.log("Taking gyro of "+bI.name+"...");bN=new am();bJ=bI.xyz;for(bO=0,bS=bJ.length;bO<bS;bO++){bL=bJ[bO];bN.newV("v"+bO,bt(bL))}bQ=bI.centers();bG=bI.face;for(bO=0,bV=bG.length;bO<bV;bO++){bP=bG[bO];bN.newV("center"+bO,bt(bQ[bO]))}bE=bI.face;for(bO=0,bU=bE.length;bO<bU;bO++){bP=bE[bO];bC=bP.slice(-2),bH=bC[0],bF=bC[1];for(bM=0,bR=bP.length;bM<bR;bM++){bL=bP[bM];bD=bL;bN.newV(bH+"~"+bF,ay(bI.xyz[bH],bI.xyz[bF]));bT=bO+"f"+bH;bN.newFlag(bT,"center"+bO,bH+"~"+bF);bN.newFlag(bT,bH+"~"+bF,bF+"~"+bH);bN.newFlag(bT,bF+"~"+bH,"v"+bF);bN.newFlag(bT,"v"+bF,bF+"~"+bD);bN.newFlag(bT,bF+"~"+bD,"center"+bO);bB=[bF,bD],bH=bB[0],bF=bB[1]}}bK=bN.topoly();bK.name="g"+bI.name;return bK};w=function(bI){var bO,bM,bQ,bN,bK,bL,bG,bD,bC,bE,bP,bS,bR,bJ,bH,bF,bB;console.log("Taking propellor of "+bI.name+"...");bM=new am();bJ=bI.xyz;for(bN=0,bP=bJ.length;bN<bP;bN++){bL=bJ[bN];bM.newV("v"+bN,bt(bL))}bH=bI.face;for(bN=0,bS=bH.length;bN<bS;bN++){bO=bH[bN];bF=bO.slice(-2),bG=bF[0],bD=bF[1];for(bE=0,bR=bO.length;bE<bR;bE++){bL=bO[bE];bC=""+bL;bM.newV(bG+"~"+bD,ay(bI.xyz[bG],bI.xyz[bD]));bQ=""+bN+"f"+bD;bM.newFlag("v"+bN,bG+"~"+bD,bD+"~"+bC);bM.newFlag(bQ,bG+"~"+bD,bD+"~"+bG);bM.newFlag(bQ,bD+"~"+bG,"v"+bD);bM.newFlag(bQ,"v"+bD,bD+"~"+bC);bM.newFlag(bQ,bD+"~"+bC,bG+"~"+bD);bB=[bD,bC],bG=bB[0],bD=bB[1]}}bK=bM.topoly();bK.name="p"+bI.name;return bK};x=function(bD){var bB,bC,bE;console.log("Taking reflection of "+bD.name+"...");for(bB=0,bC=bD.xyz.length-1;0<=bC?bB<=bC:bB>=bC;0<=bC?bB++:bB--){bD.xyz[bB]=e(-1,bD.xyz[bB])}for(bB=0,bE=bD.face.length-1;0<=bE?bB<=bE:bB>=bE;0<=bE?bB++:bB--){bD.face[bB]=bD.face[bB].reverse()}bD.name="r"+bD.name;return bD};aN=function(bK){var bS,bY,bR,bL,bP,bQ,bO,bN,bJ,bG,bH,bE,bC,bV,bX,bW,bU,bT,bM,bI,bF,bD,bB;console.log("Taking dual of "+bK.name+"...");bP=new am();bL=[];for(bQ=0,bM=bK.xyz.length-1;0<=bM?bQ<=bM:bQ>=bM;0<=bM?bQ++:bQ--){bL[bQ]={}}bI=bK.face;for(bQ=0,bV=bI.length;bQ<bV;bQ++){bR=bI[bQ];bJ=bR[bR.length-1];for(bH=0,bX=bR.length;bH<bX;bH++){bG=bR[bH];bL[bJ]["v"+bG]=""+bQ;bJ=bG}}bS=bK.centers();for(bQ=0,bF=bK.face.length-1;0<=bF?bQ<=bF:bQ>=bF;0<=bF?bQ++:bQ--){bP.newV(""+bQ,bS[bQ])}bD=bK.face;for(bQ=0,bW=bD.length;bQ<bW;bQ++){bR=bD[bQ];bJ=bR[bR.length-1];for(bE=0,bU=bR.length;bE<bU;bE++){bG=bR[bE];bP.newFlag(bJ,bL[bG]["v"+bJ],""+bQ);bJ=bG}}bY=bP.topoly();bN=[];bB=bY.face;for(bC=0,bT=bB.length;bC<bT;bC++){bR=bB[bC];bO=J(bK.face[bR[0]],bK.face[bR[1]],bK.face[bR[2]]);bN[bO]=bR}bY.face=bN;if(bK.name[0]!=="d"){bY.name="d"+bK.name}else{bY.name=bK.name.slice(1)}return bY};I=function(bI,bP,bJ,bQ){var bU,bT,bR,bZ,bH,bS,bL,bN,bO,bM,bG,bD,bE,bB,bY,b0,bX,bW,bV,bK,bF,bC;bP||(bP=0);bJ||(bJ=0.5);bQ||(bQ=-0.2);console.log("Taking inset of "+(bP===0?"":bP)+"-sided faces of "+bI.name+"...");bR=new am();bK=bI.xyz;for(bS=0,bY=bK.length;bS<bY;bS++){bO=bK[bS];bR.newV("v"+bS,bO)}bN=bI.normals();bU=bI.centers();bF=bI.face;for(bS=0,b0=bF.length;bS<b0;bS++){bT=bF[bS];if(bT.length===bP||bP===0){for(bE=0,bX=bT.length;bE<bX;bE++){bM=bT[bE];bR.newV("f"+bS+"v"+bM,D(o(bI.xyz[bM],bU[bS],bJ),e(bQ,bN[bS])))}}}bH=false;bC=bI.face;for(bS=0,bW=bC.length;bS<bW;bS++){bT=bC[bS];bG="v"+bT[bT.length-1];for(bB=0,bV=bT.length;bB<bV;bB++){bM=bT[bB];bD="v"+bM;if(bT.length===bP||bP===0){bH=true;bZ=bS+bG;bR.newFlag(bZ,bG,bD);bR.newFlag(bZ,bD,"f"+bS+bD);bR.newFlag(bZ,"f"+bS+bD,"f"+bS+bG);bR.newFlag(bZ,"f"+bS+bG,bG);bR.newFlag("ex"+bS,"f"+bS+bG,"f"+bS+bD)}else{bR.newFlag(bS,bG,bD)}bG=bD}}if(!bH){console.log("No "+bP+"-fold components were found.")}bL=bR.topoly();bL.name="n"+(bP===0?"":bP)+bI.name;return bL};ag=function(bI,bO){var bS,bR,bP,bH,bQ,bK,bM,bN,bL,bG,bD,bE,bB,bW,bX,bV,bU,bT,bJ,bF,bC;bO||(bO=0);console.log("Taking extrusion of "+(bO===0?"":bO)+"-sided faces of "+bI.name+"...");bP=new am();bJ=bI.xyz;for(bQ=0,bW=bJ.length;bQ<bW;bQ++){bN=bJ[bQ];bP.newV("v"+bQ,bN)}bM=bI.normals();bS=bI.centers();bF=bI.face;for(bQ=0,bX=bF.length;bQ<bX;bQ++){bR=bF[bQ];if(bR.length===bO||bO===0){for(bE=0,bV=bR.length;bE<bV;bE++){bL=bR[bE];bP.newV("f"+bQ+"v"+bL,D(bI.xyz[bL],e(0.3,bM[bQ])))}}}bH=false;bC=bI.face;for(bQ=0,bU=bC.length;bQ<bU;bQ++){bR=bC[bQ];bG="v"+bR[bR.length-1];for(bB=0,bT=bR.length;bB<bT;bB++){bL=bR[bB];bD="v"+bL;if(bR.length===bO||bO===0){bH=true;bP.newFlag(bQ+bG,bG,bD);bP.newFlag(bQ+bG,bD,"f"+bQ+bD);bP.newFlag(bQ+bG,"f"+bQ+bD,"f"+bQ+bG);bP.newFlag(bQ+bG,"f"+bQ+bG,bG);bP.newFlag("ex"+bQ,"f"+bQ+bG,"f"+bQ+bD)}else{bP.newFlag(bQ,bG,bD)}bG=bD}}if(!bH){console.log("No "+bO+"-fold components were found.")}bK=bP.topoly();bK.name="x"+(bO===0?"":bO)+bI.name;return bK};a4=function(bK){var bV,bU,bS,bT,bP,bR,bQ,bH,bW,bF,bJ,bI,bC,bN,bM,bL,bE,bY,bZ,bX,bO,bG,bD,bB;console.log("Taking stella of "+bK.name+"...");bV=bK.centers();bS=new am();bO=bK.xyz;for(bT=0,bY=bO.length;bT<bY;bT++){bR=bO[bT];bS.newV("v"+bT,bR)}bG=bK.face;for(bT=0,bZ=bG.length;bT<bZ;bT++){bU=bG[bT];bH="v"+bU[bU.length-2];bF="v"+bU[bU.length-1];bN=bK.xyz[bU[bU.length-2]];bM=bK.xyz[bU[bU.length-1]];for(bE=0,bX=bU.length;bE<bX;bE++){bQ=bU[bE];bC="v"+bQ;bL=bK.xyz[bQ];bW=bH+"~"+bF;bJ=bF+"~"+bH;bI=bF+"~"+bC;bS.newV(bW,a1(a1(bN,bM),bV[bT]));bS.newFlag("in"+bT,bW,bI);bS.newFlag("f"+bT+bF,bI,bW);bS.newFlag("f"+bT+bF,bW,bF);bS.newFlag("f"+bT+bF,bF,bI);bS.newFlag("f"+bW,bH,bJ);bS.newFlag("f"+bW,bJ,bW);bS.newFlag("f"+bW,bW,bH);bD=[bF,bC],bH=bD[0],bF=bD[1];bB=[bM,bL],bN=bB[0],bM=bB[1]}}bP=bS.topoly();bP.name="l"+bK.name;return bP};ae=function(bE,bD){var bI,bG,bF,bB,bJ,bC,bH;bI=0.1;bB=bc(bE);for(bC=0,bH=bD.length;bC<bH;bC++){bF=bD[bC];bJ=n(bB[bF[0]],bB[bF[1]]);bG=e(bI*1/2*(1-Z(H(bJ,bJ))),bJ);bB[bF[0]]=D(bB[bF[0]],bG);bB[bF[1]]=D(bB[bF[1]],bG)}return bB};bh=function(bF,bE){var bI,bG,bB,bC,bJ,bD,bH;bB=(function(){var bN,bL,bM,bK;bK=[];for(bN=0,bL=bE.length;bN<bL;bN++){bM=bE[bN],bI=bM[0],bG=bM[1];bK.push(n(bF[bI],bF[bG]))}return bK})();bC=[0,0,0];for(bD=0,bH=bB.length;bD<bH;bD++){bJ=bB[bD];bC=D(bC,bJ)}bC=e(1/bE.length,bC);return _.map(bF,function(bK){return bl(bK,bC)})};F=function(bE){var bB,bD,bC;bD=[0,0,0];bB=_.max(_.map(bE,function(bF){return O(bF)}));bC=1/bB;return _.map(bE,function(bF){return[bC*bF[0],bC*bF[1],bC*bF[2]]})};bk=function(bH,bE){var bM,bJ,bL,bI,bD,bB,bN,bG,bF,bK,bC;bM=0.1;bB=bc(bH);for(bG=0,bK=bE.length;bG<bK;bG++){bI=bE[bG];bL=(function(){var bQ,bO,bP;bP=[];for(bQ=0,bO=bI.length;bQ<bO;bQ++){bN=bI[bQ];bP.push(bH[bN])}return bP})();bD=ao(bL);bJ=br(bL);if(H(bD,bJ)<0){bD=e(-1,bD)}for(bF=0,bC=bI.length;bF<bC;bF++){bN=bI[bF];bB[bN]=D(bB[bN],e(H(e(bM,bD),bl(bJ,bH[bN])),bD))}}return bB};q=function(bC,bI){var bF,bD,bG,bH,bB,bE,bJ;bI||(bI=1);console.log("Canonicalizing "+bC.name+"...");bD=bC.face;bF=bC.edges();bB=bC.xyz;bH=1;for(bG=0;0<=bI?bG<=bI:bG>=bI;0<=bI?bG++:bG--){bJ=bc(bB);bB=ae(bB,bF);bB=bh(bB,bF);bB=bk(bB,bD);bH=_.max(_.map(_.zip(bB,bJ),function(bL){var bK,bM;bK=bL[0],bM=bL[1];return O(bl(bK,bM))}));if(bH<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bH+"]");bE=new aV(bB,bC.face,bC.name);console.log("canonicalize",bE);return bE};S=function(bE){var bF,bC,bD,bB;bC=bE.centers();for(bD=0,bB=bC.length;bD<bB;bD++){bF=bC[bD];bF=e(1/H(bF,bF),bF)}return bC};L=function(bD){var bR,bL,bE,bM,bB,bK,bQ,bP,bN,bI,bH,bO,bC,bJ,bG,bF;bR=[];bJ=bD.face;for(bI=0,bO=bJ.length;bI<bO;bI++){bM=bJ[bI];bE=[0,0,0];bB=[0,0,0];bL=0;bG=bM.slice(-2),bQ=bG[0],bP=bG[1];for(bH=0,bC=bM.length;bH<bC;bH++){bN=bM[bH];bE=D(bE,bD.xyz[bN]);bB=D(bB,a2(bD.xyz[bQ],bD.xyz[bP],bD.xyz[bN]));bL+=az(bD.xyz[bQ],bD.xyz[bP]);bF=[bP,bN],bQ=bF[0],bP=bF[1]}bE=e(1/bM.length,bE);bB=bt(bB);bL=bL/bM.length;bK=aH(e(H(bE,bB),bB));bR.push(e((1+bL)/2,bK))}return bR};h=function(bF,bC){var bD,bB,bE;bC||(bC=1);bB=aN(bF);console.log("Pseudo-canonicalizing "+bF.name+"...");for(bD=0,bE=bC-1;0<=bE?bD<=bE:bD>=bE;0<=bE?bD++:bD--){bB.xyz=L(bF);bF.xyz=L(bB)}return new aV(bF.xyz,bF.face,bF.name)};C=function(bF,bC){var bD,bB,bE;bC||(bC=1);bB=aN(bF);console.log("Planarizing "+bF.name+"...");for(bD=0,bE=bC-1;0<=bE?bD<=bE:bD>=bE;0<=bE?bD++:bD--){bB.xyz=S(bF);bF.xyz=S(bB)}return new aV(bF.xyz,bF.face,bF.name)};N=function(b3){var b2,bY,bT,bW,b1,bL,b4,bV,bR,bN,b0,bH,bX,bS,bJ,bK,bM,bU,bZ,bI,bG,bF,bC,bB,bQ,bO,bE,bP,bD;bM=999;bX=[];bS=[];bJ=b3.length;b0=function(b5,b6){return(b5||b6)&&!(b5&&b6)};b2=function(b7,b6,b5){return(b6[0]-b7[0])*(b5[1]-b7[1])-(b5[0]-b7[0])*(b6[1]-b7[1])};bR=function(b7,b6,b5){return b2(b7,b6,b5)>0};bN=function(b7,b6,b5){return b2(b7,b6,b5)>=0};bT=function(b7,b6,b5){return b2(b7,b6,b5)===0};bY=function(b7,b6,b5){if(bT(b7,b6,b5)){return false}if(b7[0]!==b6[0]){return(b7[0]<=b5[0])&&(b5[0]<=b6[0])||(b7[0]>=b5[0])&&(b5[0]>=b6[0])}else{return(b7[1]<=b5[1])&&(b5[1]<=b6[1])||(b7[1]>=b5[1])&&(b5[1]>=b6[1])}};bV=function(b8,b7,b6,b5){if(bT(b8,b7,b6)||bT(b8,b7,b5)||bT(b6,b5,b8)||bT(b6,b5,b7)){return false}return b0(bR(b8,b7,b6),bR(b8,b7,b5))&&b0(bR(b6,b5,b8),bR(b6,b5,b7))};b4=function(b8,b7,b6,b5){if(bV(b8,b7,b6,b5)){return true}else{if(bY(b8,b7,b6)||bY(b8,b7,b5)||bY(b6,b5,b8)||bY(b6,b5,b7)){return true}else{return false}}};bL=function(b7,b5){var b8,b6;b6=(b7+1+bJ)%bJ;b8=(b7-1+bJ)%bJ;if(bN(b3[b7],b3[b6],b3[b8])){return bR(b3[b7],b3[b5],b3[b8])&&bR(b3[b5],b3[b7],b3[b6])}return !(bN(b3[b7],b3[b5],b3[b6])&&bN(b3[b5],b3[b7],b3[b8]))};b1=function(b6,b5){var b8,b7;b8=0;while(true){b7=(b8+1+bJ)%bJ;if((b8!==b6)&&(b7!==b6)&&(b8!==b5)&&(b7!==b5)&&bV(b3[b6],b3[b5],b3[b8],b3[b7])){return false}b8=(b8+1+bJ)%bJ;if(b8===0){break}}return true};bW=function(b6,b5){return bL(b6,b5)&&bL(b5,b6)&&b1(b6,b5)};bG=0;while(true){bF=(bG+1+bJ)%bJ;bI=(bG-1+bJ)%bJ;bS[bG]=bW(bI,bF);bG=(bG+1+bJ)%bJ;if(bG===0){break}}bZ=(function(){bD=[];for(var b6=0,b5=bJ-1;0<=b5?b6<=b5:b6>=b5;0<=b5?b6++:b6--){bD.push(b6)}return bD}).apply(this);bU=bJ;bO=bM;bK=0;while(bO>0&&bU>3){bO-=1;bF=bK;bQ=bM;while(true){bQ-=1;bH=false;if(bS[bF]){bC=(bF+1+bJ)%bJ;bB=(bC+1+bJ)%bJ;bG=(bF-1+bJ)%bJ;bI=(bG-1+bJ)%bJ;bX.push([bZ[bG],bZ[bC]]);bS[bG]=bW(bI,bC);bS[bC]=bW(bG,bB);b3=b3.slice(0,bF+1||9000000000).concat(b3.slice(bC));bZ=bZ.slice(0,bF+1||9000000000).concat(bZ.slice(bC));if(bI>bF){bI-=1}if(bG>bF){bG-=1}if(bC>bF){bC-=1}if(bB>bF){bB-=1}bJ--;bK=bC;bU--;bH=true}bF=(bF+1+bJ)%bJ;if(!(bQ>0&&!bH&&bF!==bK)){break}}}return bX};a=function(bC,bB){if(((bC[0]===bB[0])&&(bC[1]===bB[1])&&(bC[2]===bB[2]))||(bC[0]===bB[1])&&(bC[1]===bB[2])&&(bC[2]===bB[0])||(bC[0]===bB[2])&&(bC[1]===bB[0])&&(bC[2]===bB[1])){return true}else{return false}};y=function(b8,bV){var bS,b9,bU,bT,bQ,bW,b6,bC,bM,ca,cd,cc,cb,b7,b5,b4,b3,bR,bJ,bI,bH,bG,bF,bE,bD,bB,b2,b1,b0,bZ,bY,bX,bP,bO,bN,bL,bK;bQ=[];bC=[];bX=(function(){var cf,ce;ce=[];for(b6=0,cf=b8.length-1;0<=cf?b6<=cf:b6>=cf;0<=cf?b6++:b6--){ce.push([b6,(b6+1)%b8.length])}return ce})();for(b7=0,bR=bX.length;b7<bR;b7++){bP=bX[b7],cc=bP[0],cb=bP[1];bQ[cc]=[cb];bC[cb]=[cc]}for(b5=0,bJ=bV.length;b5<bJ;b5++){b9=bV[b5];bQ[b9[0]].push(b9[1]);bQ[b9[1]].push(b9[0]);bC[b9[0]].push(b9[1]);bC[b9[1]].push(b9[0])}ca=[];for(b4=0,bI=bV.length;b4<bI;b4++){b9=bV[b4];bO=bQ[b9[1]];for(b3=0,bH=bO.length;b3<bH;b3++){bU=bO[b3];bN=bC[b9[0]];for(b2=0,bG=bN.length;b2<bG;b2++){bT=bN[b2];if(bU===bT){ca.push([b9[0],b9[1],bU])}}}bL=bQ[b9[0]];for(b1=0,bF=bL.length;b1<bF;b1++){bU=bL[b1];bK=bC[b9[1]];for(b0=0,bE=bK.length;b0<bE;b0++){bT=bK[b0];if(bU===bT){ca.push([b9[1],b9[0],bU])}}}}cd=[ca.pop()];for(bZ=0,bD=ca.length;bZ<bD;bZ++){bM=ca[bZ];bS=false;for(bY=0,bB=cd.length;bY<bB;bY++){bW=cd[bY];if(a(bM,bW)){bS=true;break}}if(!bS){cd.push(bM)}}return cd};af=function(bD,bB){var bF,bE,bK,bJ,bH,bG,bO,bN,bM,bL,bC,bI;bB=bB||false;console.log("Triangulating faces of "+bD.name+"...");bG=new aV();bG.xyz=P(bD.xyz);bG.face_class=[];bI=bD.face;for(bJ=0,bL=bI.length;bJ<bL;bJ++){bK=bI[bJ];if(bK.length>3){bF=ad((function(){var bR,bP,bQ;bQ=[];for(bR=0,bP=bK.length;bR<bP;bR++){bM=bK[bR];bQ.push(bD.xyz[bM])}return bQ})());bE=N(bF);bN=y(bK,bE);for(bH=0,bC=bN.length;bH<bC;bH++){bO=bN[bH];bG.face.push([bK[bO[0]],bK[bO[1]],bK[bO[2]]]);if(bB){bG.face_class.push(bD.face_class[bJ])}}}else{bG.face.push([bK[0],bK[1],bK[2]]);if(bB){bG.face_class.push(bD.face_class[bJ])}}}bG.name=bD.name;return bG};al=function(bB){var bG,bH,bJ,bE,bD,bI,bC,bF;bH="";bF=bB.face;for(bE=0,bI=bF.length;bE<bI;bE++){bG=bF[bE];for(bD=0,bC=bG.length;bD<bC;bD++){bJ=bG[bD];bH+=""+bJ+"->"}bH+="\n"}return console.log(bH)};G=function(){var bI,bF,bE,bD,bH,bG,bC,bB;bD=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bF=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bH=0,bC=bF.length;bH<bC;bH++){bI=bF[bH];console.log("Operator "+bI);for(bG=0,bB=bD.length;bG<bB;bG++){bE=bD[bG];console.log(bI+bE+":",generatePoly(bI+bE))}}return console.log("===== Done Testing Basic Ops =====")};aY='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(""), 10); }';bm=PEG.buildParser(aY);bA=function(bC,bB){return bC.apply(this,bB||[])};bo={T:g,O:av,C:an,I:be,D:aw,P:X,A:a3,Y:bx};K={d:aN,k:ah,a:aM,g:ba,p:w,r:x,n:I,x:ag,l:a4,z:af,K:h,C:q,A:C};aU=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];a8=function(bE){var bB,bD,bH,bG,bC,bF;bD=bE;for(bG=0,bC=aU.length;bG<bC;bG++){bF=aU[bG],bH=bF[0],bB=bF[1];bD=bD.replace(bH,bB)}console.log(""+bE+" executed as "+bD);return bD};by=function(bH){var bC,bJ,bE,bL,bF,bK,bG,bB,bD,bI;bG=a8(bH);bK=bm.parse(bG).reverse();bE=bK.shift();bJ=bo[bE.op];bC=bE.args;bB=bA(bJ,bC);for(bD=0,bI=bK.length;bD<bI;bD++){bE=bK[bD];bF=K[bE.op];bL=[bB].concat(bE.args);bB=bA(bF,bL)}bB.xyz=bh(bB.xyz,bB.edges());bB.xyz=F(bB.xyz);bB=U(bB);return bB};ai={};bu=500;aD=400;T={};m=P(z);ap=P(z);Y=800;E=5;bv=0;Q=0.8;r=bu/2;aA=aD/2;A=new Date();u=true;aZ="rgba(255,255,255,1.0)";at="signature";i="fillstroke";bj=0.5;au=false;ab=0;aa=0;aL=[1,0,0];bb=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aJ=function(bD,bB){var bE,bC;bE=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bC=new bE();bC.append(bD);return saveAs(bC.getBlob("text/plain;charset="+document.characterSet),bB)};bw=function(){var bB,bG,bF,bE,bD,bC;bC={};bB=/\+/g;bD=/([^&=]+)=?([^&]*)/g;bG=function(bH){return decodeURIComponent(bH.replace(bB," "))};bE=window.location.search.substring(1);while(bF=bD.exec(bE)){bC[bG(bF[1])]=bG(bF[2])}return bC};aP=function(){var bB;bB=$("#poly");bB.width(bu);bB.height(aD);ai=bB[0].getContext("2d");ai.lineWidth=bj;if(u){return ai.clearRect(0,0,bu,aD)}else{ai.clearRect(0,0,bu,aD);ai.fillStyle=aZ;return ai.fillRect(0,0,bu,aD)}};aR=function(){if(u){return ai.clearRect(0,0,bu,aD)}else{ai.clearRect(0,0,bu,aD);ai.fillStyle=aZ;return ai.fillRect(0,0,bu,aD)}};V=function(bI,bQ){var bC,bK,bJ,bP,bE,bG,bO,bH,bN,bL,bD,bR,bS,bM,bF,bB;bQ||(bQ=[3,3,3]);bG=_.map(bI.xyz,function(bT){return bT});bI.xyz=_.map(bI.xyz,function(bT){return v(m,bT)});aX(bI);bM=bI.face;for(bP=0,bR=bM.length;bP<bR;bP++){bK=bM[bP];ai.beginPath();bH=bK[bK.length-1];bF=B(D(bQ,bI.xyz[bH]),E,bv,Q,Y),bN=bF[0],bL=bF[1];ai.moveTo(bN+r,bL+aA);for(bD=0,bS=bK.length;bD<bS;bD++){bO=bK[bD];bB=B(D(bQ,bI.xyz[bO]),E,bv,Q,Y),bN=bB[0],bL=bB[1];ai.lineTo(bN+r,bL+aA)}bC=ak(bI.face_class[bP]);bJ=(function(){var bU,bV,bT;bT=[];for(bU=0,bV=bK.length;bU<bV;bU++){bO=bK[bU];bT.push(bI.xyz[bO])}return bT})();bE=H(ao(bJ),bt([1,-1,0]));bC=e((bE/2+0.5)*0.7+0.3,bC);if(i==="fill"||i==="fillstroke"){ai.fillStyle="rgba("+(ac(bC[0]*255))+", "+(ac(bC[1]*255))+", "+(ac(bC[2]*255))+", "+1+")";ai.fill();ai.strokeStyle="rgba("+(ac(bC[0]*255))+", "+(ac(bC[1]*255))+", "+(ac(bC[2]*255))+", "+1+")";ai.stroke()}if(i==="fillstroke"){ai.fillStyle="rgba("+(ac(bC[0]*255))+", "+(ac(bC[1]*255))+", "+(ac(bC[2]*255))+", "+1+")";ai.fill();ai.strokeStyle="rgba(0,0,0, .3)";ai.stroke()}if(i==="stroke"){ai.strokeStyle="rgba(0,0,0, .8)";ai.stroke()}}return bI.xyz=bG};aG=function(){var bD,bE,bC,bB;aR();bB=[];for(bD=0,bC=T.length;bD<bC;bD++){bE=T[bD];bB.push(V(bE,[0+3*bD,0,3]))}return bB};bn=function(){var bC,bD,bE,bB;aR();bC=(2*Math.PI)/180*A.getSeconds()*0.1;for(bD=0,bB=T.length;bD<bB;bD++){bE=T[bD];V(bE,[0+3*bD,0,3])}return setTimeout(bn,100)};$(function(){var bC,bB;aP();bB=bw();if("recipe" in bB){bC=[bB.recipe];$("#spec").val(bC)}else{bC=[bi(bb)];$("#spec").val(bC)}$("#palette").val(a6.reduce(function(bD,bE){return bD+" "+bE}));T=_.map(bC,function(bD){return by(bD)});aG();$("#spec").change(function(bD){bC=$("#spec").val().split(/\s+/g).slice(0,2);T=_.map(bC,function(bE){return by(bE)});return aG()});$("#palette").change(function(bD){a6=$(this).val().split(/\s+/g);return aG()});$("#poly").mousewheel(function(bF,bG,bE,bD){bF.preventDefault();Y*=(10+bG)/10;return aG()});$("#poly").mousedown(function(bD){var bE;bD.preventDefault();au=true;ab=bD.clientX-$(this).offset().left;aa=bD.clientY-($(this).offset().top-$(window).scrollTop());bE=aQ(ab,aa,r,aA,E,bv,Q,Y);if(bE[0]*bE[1]*bE[2]*0===0){aL=bE}return ap=P(m)});$("#poly").mouseup(function(bD){bD.preventDefault();return au=false});$("#poly").mouseleave(function(bD){bD.preventDefault();return au=false});$("#poly").mousemove(function(bG){var bE,bD,bF;bG.preventDefault();if(au){bE=bG.clientX-$(this).offset().left;bD=bG.clientY-($(this).offset().top-$(window).scrollTop());bF=aQ(bE,bD,r,aA,E,bv,Q,Y);if(bF[0]*bF[1]*bF[2]*0===0&&aL[0]*aL[1]*aL[2]*0===0){m=aK(aI(aL,bF),ap)}return aG()}});$("#strokeonly").click(function(bD){i="stroke";return aG()});$("#fillonly").click(function(bD){i="fill";return aG()});$("#fillandstroke").click(function(bD){i="fillstroke";return aG()});$("#siderot").click(function(bD){m=a0(aO/2,0,1,0);return aG()});$("#toprot").click(function(bD){m=a0(aO/2,1,0,0);return aG()});$("#frontrot").click(function(bD){m=l(0,0,0);return aG()});$("#pngsavebutton").click(function(bG){var bF,bE,bD;s(P(T[0]));bF=$("#poly")[0];bD=$("#spec").val().split(/\s+/g)[0];bE="polyhedronisme-"+bD.replace(/\([^\)]+\)/g,"")+".png";return bF.toBlob(function(bH){return saveAs(bH,bE)})});$("#objsavebutton").click(function(bG){var bE,bF,bD;bF=T[0].toOBJ();bD=$("#spec").val().split(/\s+/g)[0];bE="polyhedronisme-"+bD.replace(/\([^\)]+\)/g,"")+".obj";return aJ(bF,bE)});return $("#x3dsavebutton").click(function(bG){var bE,bD,bF,bH;bF=af(T[0],true);bH=bF.toVRML();bD=$("#spec").val().split(/\s+/g)[0];bE="polyhedronisme-"+bD.replace(/\([^\)]+\)/g,"")+".wrl";return aJ(bH,bE)})});b=function(bG,bR){var bB,bI,bH,bF,bN,bE,bO,bP,bQ,bM,bL,bK,bC,bS,bT,bJ,bD;bR||(bR=[3,3,3]);bG.xyz=_.map(bG.xyz,function(bU){return v(m,bU)});bO=_.map(bG.normals(),function(bU){return v(m,bU)});aX(bG);bG.face=bG.face.reverse();bQ=[];bF=[];bJ=bG.face;for(bN=0,bS=bJ.length;bN<bS;bN++){bI=bJ[bN];bP=[];for(bC=0,bT=bI.length;bC<bT;bC++){bM=bI[bC];bD=B(D(bR,bG.xyz[bM]),E,bv,Q,Y),bL=bD[0],bK=bD[1];bP.push([bL+r,bK+aA])}bQ.push(bP);console.log("twoDface",_.map(bP,function(bU){return" ["+bU[0]+","+bU[1]+"] "}));bB=ak(bG.face_class[bN]);bH=(function(){var bV,bW,bU;bU=[];for(bV=0,bW=bI.length;bV<bW;bV++){bM=bI[bV];bU.push(bG.xyz[bM])}return bU})();bE=H(ao(bH),bt([1,-1,0]));bB=e((bE/2+0.5)*0.7+0.3,bB);bF.push(bB)}return[bQ,bF]};bp=function(bC,bB,bD){return(bC[0]-bD[0])*(bB[1]-bD[1])-(bC[1]-bD[1])*(bB[0]-bD[0])};aE=function(bI,bH,bG,bF){var bE,bC,bB,bK,bD,bJ;bE=bp(bI,bH,bF);bC=bp(bI,bH,bG);if(bE!==0&&bC!==0&&bE*bC<0){bB=bp(bG,bF,bI);bK=bp(bG,bF,bH);if(bB*bK<0){bJ=bB/(bB-bK);bD=[bI[0]+bJ*(bH[0]-bI[0]),bI[1]+bJ*(bH[1]-bI[1])];return bD}}return false};aT=function(bG){var bC,bH,bF,bE,bB,bD;bC=0;bH=bG[0];bD=bG.slice(1);for(bE=0,bB=bD.length;bE<bB;bE++){bF=bD[bE];bC+=(bH[0]+bF[0])*(bH[1]-bF[1]);bH=bF}return bC*0.5};k=function(bB){return aT(bB)>0};ar=function(bB,bE){var bF,bD,bC;for(bF=0,bC=bB.length;bF<bC;bF++){bD=bB[bF];if(aj(bD[0]-bE[0])+aj(bD[1]-bE[1])<0.000001){return bF}}return -1};j=function(cb,ca){var bP,bO,bC,bB,b6,b9,b0,bT,b4,b2,bJ,bH,bS,bR,bZ,bV,bY,bX,b8,b7,b5,b3,b1,bQ,bU,bM,bL,bK,bI,bG,bF,bE,bD,bW,bN;b8=[];for(b7=0,bQ=cb.length;b7<bQ;b7++){bV=cb[b7];if(ar(b8,bV)===-1){b8.push(bV)}}for(b5=0,bM=ca.length;b5<bM;b5++){bV=ca[b5];if(ar(b8,bV)===-1){b8.push(bV)}}bC=[];b0=ar(b8,cb[cb.length-1]);for(b3=0,bL=cb.length;b3<bL;b3++){bV=cb[b3];b9=ar(b8,bV);bC.push([b0,b9]);b0=b9}bB=[];b0=ar(b8,ca[ca.length-1]);for(b1=0,bK=ca.length;b1<bK;b1++){bV=ca[b1];b9=ar(b8,bV);bB.push([b0,b9]);b0=b9}bS=(function(){var cd,cc;cc=[];for(b6=0,cd=bC.length-1;0<=cd?b6<=cd:b6>=cd;0<=cd?b6++:b6--){cc.push([])}return cc})();bR=(function(){var cd,cc;cc=[];for(b6=0,cd=bB.length-1;0<=cd?b6<=cd:b6>=cd;0<=cd?b6++:b6--){cc.push([])}return cc})();bT=[];for(b6=0,bI=bC.length;b6<bI;b6++){bP=bC[b6];for(b4=0,bG=bB.length;b4<bG;b4++){bO=bB[b4];if(bZ=aE(b8[bP[0]],b8[bP[1]],b8[bO[0]],b8[bO[1]])){bS[b6].push(bZ);bR[b4].push(bZ);if(ar(b8,bZ)===-1){b8.push(bZ)}bT.push(ar(b8,bZ))}}}bJ=[];for(b6=0,bF=bS.length;b6<bF;b6++){bY=bS[b6];if(bS[b6].length>0){bS[b6].sort(function(cd,cc){return O(cd-b8[bC[b6][0]])-O(cc-b8[bC[b6][0]])});bJ.push([bC[b6][0],ar(b8,bS[b6][0])]);bW=bS[b6].slice(1);for(b2=0,bE=bW.length;b2<bE;b2++){bV=bW[b2];bJ.push([ar(b8,bS[b6][b2]),ar(b8,bS[b6][b2+1])])}bJ.push([ar(b8,bS[b6][bS[b6].length-1]),bC[b6][1]])}else{bJ.push(bC[b6])}}bH=[];for(b6=0,bD=bR.length;b6<bD;b6++){bX=bR[b6];if(bR[b6].length>0){bR[b6].sort(function(cd,cc){return O(cd-b8[bB[b6][0]])-O(cc-b8[bB[b6][0]])});bH.push([bB[b6][0],ar(b8,bR[b6][0])]);bN=bR[b6].slice(1);for(b2=0,bU=bN.length;b2<bU;b2++){bV=bN[b2];bH.push([ar(b8,bR[b6][b2]),ar(b8,bR[b6][b2+1])])}bH.push([ar(b8,bR[b6][bR[b6].length-1]),bB[b6][1]])}else{bH.push(bB[b6])}}return[b8,bJ,bH,bT]};bs=function(bF,bP){var bC,bK,bN,bJ,bD,bO,bM,bI,bH,bG,bL,bE,bB;bM=[];for(bI=0,bL=bF.length;bI<bL;bI++){bO=bF[bI];if(ar(bM,bO)===-1){bM.push(bO)}}bK=[];bJ=ar(bM,bF[bF.length-1]);for(bH=0,bE=bF.length;bH<bE;bH++){bO=bF[bH];bN=ar(bM,bO);bK.push([bJ,bN]);bJ=bN}bD=0;for(bG=0,bB=bK.length;bG<bB;bG++){bC=bK[bG];if(aE(bM[bC[0]],bM[bC[1]],bP,[bP[0],10000])){bD++}}console.log("pointInpoly called : "+bD,bD%2!==0);if(bD%2===0){return false}else{return true}};a7=function(bP,bO){var bJ,bM,bS,bN,bT,bI,bE,bG,bF,bL,bR,bQ,bH,bY,bX,bD,bC,bB,bV,bW,bU,bK;bK=j(bP,bO.reverse()),bX=bK[0],bG=bK[1],bF=bK[2],bT=bK[3];bJ={};for(bD=0,bV=bG.length;bD<bV;bD++){bS=bG[bD];bJ[bS[0]]=bS[1]}bM={};for(bC=0,bW=bF.length;bC<bW;bC++){bS=bF[bC];bM[bS[0]]=bS[1]}bY={};if(bT.length===0){if(bs(bO,bP[0])){return[]}else{return[bP]}}bR=[];for(bB=0,bU=bT.length;bB<bU;bB++){bQ=bT[bB];bH="B";if(bY[bQ+bH]){continue}bL=[];bE=bQ;bY[bE+bH]=true;bI=0;while(bE!==bQ&&bI<1000){if(bJ[bQ]&&bM[bQ]){bH=bH==="A"?"B":"A"}if(bH==="A"){bE=bJ[bE]}else{bE=bM[bE]}bL.push(bE);bY[bE+bH]=true}bR.push((function(){var b0,b1,bZ;bZ=[];for(b0=0,b1=bL.length;b0<b1;b0++){bN=bL[b0];bZ.push(bX[bN])}return bZ})())}return _.filter(bR,k)};s=function(bK){var bT,bM,bL,bJ,bQ,bP,bV,bR,bE,bU,bS,bO,bH,bF,bD,bC,bZ,b0,bY,bX,bW,bB,bN,bI,bG;console.log(bK.data());bN=b(bK),bS=bN[0],bJ=bN[1];bQ=[];bQ.push(bS[0]);bI=bS.slice(1);for(bH=0,bZ=bI.length;bH<bZ;bH++){bM=bI[bH];bP=[bM];for(bF=0,b0=bQ.length;bF<b0;bF++){bL=bQ[bF];bV=[];for(bD=0,bY=bP.length;bD<bY;bD++){bT=bP[bD];bV=bV.concat(a7(bT,bL))}bP=bV}bQ=bQ.concat(bP)}bQ=bQ.reverse();console.log(bQ.length,bQ);bE='<?xml version="1.0" encoding="utf-8"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1 Tiny//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11-tiny.dtd">\n<svg version="1.1" baseProfile="tiny" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n         x="0px" y="0px" width="1024px" height="768px" viewBox="0 0 1024 768" overflow="inherit" xml:space="preserve">\n';bR="</svg>";bU=bE;for(bC=0,bX=bQ.length;bC<bX;bC++){bT=bQ[bC];bU+='<path fill="#25DF00" stroke="#000000" d="';bU+="M"+bT[0][0]+","+bT[0][1];bG=bT.slice(1);for(bB=0,bW=bG.length;bB<bW;bB++){bO=bG[bB];bU+="L"+bO[0]+","+bO[1]}bU+='z"/>\n'}bU+=bR;return console.log(bU)}}).call(this);