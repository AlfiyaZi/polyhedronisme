(function(){var s,a0,aE,bu,au,m,bc,ab,aa,aK,av,a8,aO,h,aj,ba,C,B,aM,bq,a4,bz,S,aD,bs,g,o,aR,P,a5,br,bd,M,aC,bg,aT,aW,ai,bm,ap,ay,w,ax,G,aF,W,aN,aA,aL,a,Q,ag,y,bi,I,at,al,N,a9,aH,U,j,ar,z,bb,bB,bh,aP,H,J,aQ,x,ah,O,be,ao,a2,aJ,e,t,aq,aw,L,by,az,a3,V,ak,bx,A,R,D,bv,Y,bo,bw,an,aV,bj,X,ad,u,bA,aS,bl,bk,aG,T,K,v,E,i,ac,aX,l,aI,a7,aZ,aU,Z,a6,bp,c,k,ae,F,f,am,b,af,n,bf,bn,bt,aY,a1,d,q,p,aB,r;aS=Math.random;ac=Math.round;at=Math.floor;Z=Math.sqrt;a7=Math.sin;M=Math.cos;c=Math.tan;S=Math.asin;ba=Math.acos;aD=Math.atan;bj=Math.pow;aj=Math.abs;aO=Math.PI;Q=function(bD){var bE,bF,bC;bC=[];for(bE=0,bF=bD.length-1;0<=bF?bE<=bF:bE>=bF;0<=bF?bE++:bE--){bC.push([bE,bD[bE]])}return bC};P=function(bE){var bD,bC;if(!(bE!=null)||typeof bE!=="object"){return bE}bC=new bE.constructor();for(bD in bE){bC[bD]=P(bE[bD])}return bC};bl=function(bD){var bC;bC=at(aS()*bD.length);return bD[bC]};e=function(bD,bC){return[bD*bC[0],bD*bC[1],bD*bC[2]]};r=function(bD,bC){return[bD[0]*bC[0],bD[1]*bC[1],bD[2]*bC[2]]};C=function(bD,bC){return[bD[0]+bC[0],bD[1]+bC[1],bD[2]+bC[2]]};bp=function(bD,bC){return[bD[0]-bC[0],bD[1]-bC[1],bD[2]-bC[2]]};G=function(bD,bC){return bD[0]*bC[0]+bD[1]*bC[1]+bD[2]*bC[2]};aC=function(bD,bC){return[bD[1]*bC[2]-bD[2]*bC[1],bD[2]*bC[0]-bD[0]*bC[2],bD[0]*bC[1]-bD[1]*bC[0]]};O=function(bC){return Z(G(bC,bC))};be=function(bC){return G(bC,bC)};bt=function(bC){return e(1/Z(be(bC)),bC)};a2=function(bD,bC){return e(1/2,C(bD,bC))};n=function(bE,bD,bC){return[(1-bC)*bE[0]+bC*bD[0],(1-bC)*bE[1]+bC*bD[1],(1-bC)*bE[2]+bC*bD[2]]};az=function(bD,bC){return n(bD,bC,1/3)};aG=function(bC){return e(1/be(bC),bC)};k=function(bE,bD){var bC;bC=bp(bD,bE);return bp(bE,e(G(bC,bE)/be(bC),bC))};aA=function(bD,bC){return Z(be(k(bD,bC)))};a3=function(bG,bF,bE){var bD,bC;bD=bp(bF,bG);bC=bp(bE,bF);return aC(bD,bC)};J=function(bJ,bI,bH){var bN,bM,bL,bG,bF,bE,bK,bD,bC;for(bG=0,bK=bJ.length;bG<bK;bG++){bN=bJ[bG];for(bF=0,bD=bI.length;bF<bD;bF++){bM=bI[bF];if(bN===bM){for(bE=0,bC=bH.length;bE<bC;bE++){bL=bH[bE];if(bN===bL){return bN}}}}}return null};bs=function(bG){var bE,bD,bF,bC;bE=[0,0,0];for(bF=0,bC=bG.length;bF<bC;bF++){bD=bG[bF];bE=C(bE,bD)}return e(1/bG.length,bE)};aq=function(bG){var bC,bK,bI,bH,bE,bJ,bF,bD;bC=[0,0,0];bF=bG.slice(-2),bK=bF[0],bI=bF[1];for(bE=0,bJ=bG.length;bE<bJ;bE++){bH=bG[bE];bC=C(bC,a3(bK,bI,bH));bD=[bI,bH],bK=bD[0],bI=bD[1]}return bt(bC)};br=function(bG){var bC,bK,bI,bH,bE,bJ,bF,bD;bC=0;bF=bG.slice(0,2),bK=bF[0],bI=bF[1];bD=bG.slice(2);for(bE=0,bJ=bD.length;bE<bJ;bE++){bH=bD[bE];bC+=O(aC(bp(bI,bK),bp(bH,bK)));bI=bH}return bC};ad=function(bJ){var bH,bD,bC,bG,bK,bL,bF,bI,bE;bG=P(bJ);bL=bJ[0];bG=_.map(bG,function(bM){return bM-bL});bD=aq(bJ);bH=bt(bs(bJ));bC=aC(bD,bH);bE=[];for(bF=0,bI=bG.length;bF<bI;bF++){bK=bG[bF];bE.push([G(bD,bK),G(bC,bK)])}return bE};bd=function(bE){var bD,bC,bF;bC=new Array(bE.length);for(bD=0,bF=bE.length-1;0<=bF?bD<=bF:bD>=bF;0<=bF?bD++:bD--){bC[bD]=bE[bD].slice(0)}return bC};t=function(bD,bC){return[bD[0][0]*bC[0]+bD[0][1]*bC[1]+bD[0][2]*bC[2],bD[1][0]*bC[0]+bD[1][1]*bC[1]+bD[1][2]*bC[2],bD[2][0]*bC[0]+bD[2][1]*bC[1]+bD[2][2]*bC[2]]};aJ=function(bC,bD){return[[bC[0][0]*bD[0][0]+bC[0][1]*bD[1][0]+bC[0][2]*bD[2][0],bC[0][0]*bD[0][1]+bC[0][1]*bD[1][1]+bC[0][2]*bD[2][1],bC[0][0]*bD[0][2]+bC[0][1]*bD[1][2]+bC[0][2]*bD[2][2]],[bC[1][0]*bD[0][0]+bC[1][1]*bD[1][0]+bC[1][2]*bD[2][0],bC[1][0]*bD[0][1]+bC[1][1]*bD[1][1]+bC[1][2]*bD[2][1],bC[1][0]*bD[0][2]+bC[1][1]*bD[1][2]+bC[1][2]*bD[2][2]],[bC[2][0]*bD[0][0]+bC[2][1]*bD[1][0]+bC[2][2]*bD[2][0],bC[2][0]*bD[0][1]+bC[2][1]*bD[1][1]+bC[2][2]*bD[2][1],bC[2][0]*bD[0][2]+bC[2][1]*bD[1][2]+bC[2][2]*bD[2][2]]]};y=[[1,0,0],[0,1,0],[0,0,1]];i=function(bG,bE,bF){var bH,bD,bC;bH=[[M(bG),-1*a7(bG),0],[a7(bG),M(bG),0],[0,0,1]];bC=[[M(bE),0,-1*a7(bE)],[0,1,0],[a7(bE),0,M(bE)]];bD=[[1,0,0],[0,M(bF),-1*a7(bF)],[0,a7(bF),M(bF)]];return aJ(bD,aJ(bC,bH))};a1=function(bG,bP,bN,bK){var bJ,bD,bE,bO,bM,bC,bL,bH,bI,bF;bG/=2;bO=a7(bG);bJ=M(bG);bM=bO*bO;bD=O([bP,bN,bK]);if(bD===0){bI=[0,0,1],bP=bI[0],bN=bI[1],bK=bI[2]}if(bD!==1){bF=bt([bP,bN,bK]),bP=bF[0],bN=bF[1],bK=bF[2]}if(bP===1&&bN===0&&bK===0){bE=[[1,0,0],[0,1-2*bM,2*bO*bJ],[0,-2*bO*bJ,1-2*bM]]}else{if(bP===0&&bN===1&&bK===0){bE=[[1-2*bM,0,-2*bO*bJ],[0,1,0],[2*bO*bJ,0,1-2*bM]]}else{if(bP===0&&bN===0&&bK===1){bE=[[1-2*bM,2*bO*bJ,0],[-2*bO*bJ,1-2*bM,0],[0,0,1]]}else{bC=bP*bP;bL=bN*bN;bH=bK*bK;bE=[[1-2*(bL+bH)*bM,2*(bP*bN*bM+bK*bO*bJ),2*(bP*bK*bM-bN*bO*bJ)],[2*(bN*bP*bM-bK*bO*bJ),1-2*(bH+bC)*bM,2*(bN*bK*bM+bP*bO*bJ)],[2*(bK*bP*bM+bN*bO*bJ),2*(bK*bN*bM-bP*bO*bJ),1-2*(bC+bL)*bM]]}}}return bE};A=function(bE,bD,bF,bI,bC){var bG,bH;bH=(bD*bI-bF)/(1-bI);bG=bC*bI/(1-bI);return[bG*bE[0]/(bE[2]+bH),bG*bE[1]/(bE[2]+bH)]};aQ=function(bJ,bG,bM,bK,bQ,bF,bE,bD){var bP,bC,bL,bH,bN,bS,bU,bI,bO,bR,bT;bO=(bQ*bE-bF)/(1-bE);bP=bD*bE/(1-bE);bL=bJ-bM;bS=bG-bK;bC=bP*bP;bR=bO*bO;bH=bL*bL;bU=bS*bS;bN=(2*bP*bL*bO+Z(4*bC*bH*bR+4*bH*(bC+bH+bU)*(1-bR)))/(2*(bC+bH+bU));bI=(bP*bS*bO)/(bC+bH+bU)+(bS*Z(4*bC*bR+4*(bC+bH+bU)*(1-bR)))/(2*(bC+bH+bU));bT=Z(1-bN*bN-bI*bI);return[bN,bI,bT]};aH=function(bE,bD){var bF,bC;bC=aC(bE,bD);bF=ba(G(bE,bD));return a1(-1*bF,bC[0],bC[1],bC[2])};bi=function(bF){var bD,bH,bG,bE,bC;bD=[];bH=bF.slice(-1)[0];for(bE=0,bC=bF.length;bE<bC;bE++){bG=bF[bE];bD.push([bH,bG]);bH=bG}return bD};d=function(bD){var bJ,bI,bM,bK,bG,bF,bL,bC,bH,bE;bK=[];bH=Q(bD.face);for(bG=0,bL=bH.length;bG<bL;bG++){bE=bH[bG],bI=bE[0],bJ=bE[1];for(bF=0,bC=bJ.length;bF<bC;bF++){bM=bJ[bF];bK[bM]=bD.face_colors[bI]}}return bK};aV=(function(){function bC(){this.face=new Array();this.xyz=new Array();this.name="null polyhedron"}bC.prototype.data=function(){var bD;bD=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bD+" edges, "+this.xyz.length+" vertices)"};bC.prototype.getEdges=function(){var bN,bJ,bL,bK,bE,bI,bH,bO,bG,bF,bM,bD;bI={};bO=[];bJ=_.map(this.face,bi);for(bG=0,bM=bJ.length;bG<bM;bG++){bE=bJ[bG];for(bF=0,bD=bE.length;bF<bD;bF++){bK=bE[bF];if(bK[0]<bK[1]){bN=bK[0],bL=bK[1]}else{bL=bK[0],bN=bK[1]}bI[bN+"~"+bL]=bK}}for(bH in bI){bK=bI[bH];bO.push(bK)}return bO};bC.prototype.centers=function(){var bI,bJ,bF,bL,bG,bE,bK,bD,bH;bI=[];bH=this.face;for(bG=0,bK=bH.length;bG<bK;bG++){bJ=bH[bG];bF=[0,0,0];for(bE=0,bD=bJ.length;bE<bD;bE++){bL=bJ[bE];bF=C(bF,this.xyz[bL])}bI.push(e(1/bJ.length,bF))}return bI};bC.prototype.normals=function(){var bH,bI,bE,bG,bD,bF;bI=[];bF=this.face;for(bG=0,bD=bF.length;bG<bD;bG++){bH=bF[bG];bI.push(aq((function(){var bL,bJ,bK;bK=[];for(bL=0,bJ=bH.length;bL<bJ;bL++){bE=bH[bL];bK.push(this.xyz[bE])}return bK}).call(this)))}return bI};bC.prototype.rescale=function(bD){this.xyz=E(this.xyz,bD);return this};bC.prototype.translate=function(bD){this.xyz=_.map(this.xyz,function(bE){return[bE[0]+bD[0],bE[1]+bD[1],bE[2]+bD[2]]});return this};bC.prototype.toOBJ=function(){var bP,bO,bE,bQ,bS,bM,bL,bK,bI,bR,bF,bD,bT,bN,bJ,bH,bG;bQ="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bQ+="group "+this.name+"\n";bQ+="#vertices\n";bN=this.xyz;for(bM=0,bR=bN.length;bM<bR;bM++){bS=bN[bM];bQ+="v "+bS[0]+" "+bS[1]+" "+bS[2]+"\n"}bQ+="#normal vector defs \n";bJ=this.face;for(bL=0,bF=bJ.length;bL<bF;bL++){bP=bJ[bL];bE=aq((function(){var bV,bW,bU;bU=[];for(bV=0,bW=bP.length;bV<bW;bV++){bS=bP[bV];bU.push(this.xyz[bS])}return bU}).call(this));bQ+="vn "+bE[0]+" "+bE[1]+" "+bE[2]+"\n"}bQ+="#face defs \n";bH=Q(this.face);for(bK=0,bD=bH.length;bK<bD;bK++){bG=bH[bK],bO=bG[0],bP=bG[1];bQ+="f ";for(bI=0,bT=bP.length;bI<bT;bI++){bS=bP[bI];bQ+=""+(bS+1)+"//"+(bO+1)+" "}bQ+="\n"}return bQ};bC.prototype.toX3D=function(){var bH,bS,bN,bP,bQ,bL,bK,bJ,bG,bO,bE,bD,bR,bM,bI,bF;bH=0.01;bQ='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bM=this.face;for(bL=0,bO=bM.length;bL<bO;bL++){bN=bM[bL];for(bK=0,bE=bN.length;bK<bE;bK++){bP=bN[bK];bQ+=""+bP+" "}bQ+="-1\n"}bQ+='">\n';bQ+='<Color color="';bI=d(this);for(bJ=0,bD=bI.length;bJ<bD;bJ++){bS=bI[bJ];bQ+=""+bS[0]+" "+bS[1]+" "+bS[2]+" "}bQ+='"/>';bQ+='<Coordinate point="';bF=this.xyz;for(bG=0,bR=bF.length;bG<bR;bG++){bP=bF[bG];bQ+=""+(bP[0]*bH)+" "+(bP[1]*bH)+" "+(bP[2]*bH)+" "}bQ+='"/>\n';bQ+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bQ};bC.prototype.toVRML=function(){var bH,bS,bN,bP,bQ,bL,bK,bJ,bG,bO,bE,bD,bR,bM,bI,bF;bH=0.01;bQ='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bM=this.xyz;for(bL=0,bO=bM.length;bL<bO;bL++){bP=bM[bL];bQ+=""+(bP[0]*bH)+" "+(bP[1]*bH)+" "+(bP[2]*bH)+","}bQ=bQ.slice(0,-1);bQ+="    ]\n}\ncolor Color\n{\n  color\n  [";bI=this.face_colors;for(bK=0,bE=bI.length;bK<bE;bK++){bS=bI[bK];bQ+=""+bS[0]+" "+bS[1]+" "+bS[2]+" ,"}bQ=bQ.slice(0,-1);bQ+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bF=this.face;for(bJ=0,bD=bF.length;bJ<bD;bJ++){bN=bF[bJ];for(bG=0,bR=bN.length;bG<bR;bG++){bP=bN[bG];bQ+=""+bP+", "}bQ+="-1,"}bQ=bQ.slice(0,-1);bQ+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bQ};return bC})();f=function(){var bC;bC=new aV();bC.name="T";bC.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bC.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bC};aw=function(){var bC;bC=new aV();bC.name="O";bC.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bC.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bC};ap=function(){var bC;bC=new aV();bC.name="C";bC.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bC.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bC};bh=function(){var bC;bC=new aV();bC.name="I";bC.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bC.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bC};ax=function(){var bC;bC=new aV();bC.name="D";bC.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bC.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bC};X=function(bG){var bP,bO,bC,bE,bM,bL,bN,bJ,bH,bF,bD,bK,bI;bE=2*aO/bG;bP=Math.sin(bE/2);bC=new aV();bC.name="P"+bG;for(bO=0,bN=bG-1;0<=bN?bO<=bN:bO>=bN;0<=bN?bO++:bO--){bC.xyz.push([-M(bO*bE),-a7(bO*bE),-bP])}for(bO=0,bJ=bG-1;0<=bJ?bO<=bJ:bO>=bJ;0<=bJ?bO++:bO--){bC.xyz.push([-M(bO*bE),-a7(bO*bE),bP])}bC.face.push((function(){bK=[];for(var bQ=bH=bG-1;bH<=0?bQ<=0:bQ>=0;bH<=0?bQ++:bQ--){bK.push(bQ)}return bK}).apply(this));bC.face.push((function(){bI=[];for(var bQ=bG,bR=2*bG-1;bG<=bR?bQ<=bR:bQ>=bR;bG<=bR?bQ++:bQ--){bI.push(bQ)}return bI}).apply(this));for(bO=0,bD=bG-1;0<=bD?bO<=bD:bO>=bD;0<=bD?bO++:bO--){bC.face.push([bO,(bO+1)%bG,(bO+1)%bG+bG,bO+bG])}bC.xyz=B(bC,1);return bC};a4=function(bH){var bR,bQ,bP,bD,bC,bF,bN,bM,bO,bK,bI,bG,bE,bL,bJ;bF=2*aO/bH;bQ=Z(1-4/(4+2*M(bF/2)-2*M(bF)));bC=Z(1-bQ*bQ);bR=Z(bQ*bQ+bj(bC*M(bF/2),2));bC=-bC/bR;bQ=-bQ/bR;bD=new aV();bD.name="A"+bH;for(bP=0,bO=bH-1;0<=bO?bP<=bO:bP>=bO;0<=bO?bP++:bP--){bD.xyz.push([bC*M(bP*bF),bC*a7(bP*bF),bQ])}for(bP=0,bK=bH-1;0<=bK?bP<=bK:bP>=bK;0<=bK?bP++:bP--){bD.xyz.push([bC*M((bP+0.5)*bF),bC*a7((bP+0.5)*bF),-bQ])}bD.face.push((function(){bL=[];for(var bS=bI=bH-1;bI<=0?bS<=0:bS>=0;bI<=0?bS++:bS--){bL.push(bS)}return bL}).apply(this));bD.face.push((function(){bJ=[];for(var bS=bH,bT=2*bH-1;bH<=bT?bS<=bT:bS>=bT;bH<=bT?bS++:bS--){bJ.push(bS)}return bJ}).apply(this));for(bP=0,bE=bH-1;0<=bE?bP<=bE:bP>=bE;0<=bE?bP++:bP--){bD.face.push([bP,(bP+1)%bH,bP+bH]);bD.face.push([bP,bP+bH,(bH+bP-1)%bH+bH])}bD.xyz=B(bD,1);return bD};bA=function(bE){var bL,bK,bC,bD,bI,bJ,bG,bF,bH;bD=2*aO/bE;bL=1;bC=new aV();bC.name="Y"+bE;for(bK=0,bJ=bE-1;0<=bJ?bK<=bJ:bK>=bJ;0<=bJ?bK++:bK--){bC.xyz.push([-M(bK*bD),-a7(bK*bD),-0.2])}bC.xyz.push([0,0,bL]);bC.face.push((function(){bH=[];for(var bM=bG=bE-1;bG<=0?bM<=0:bM>=0;bG<=0?bM++:bM--){bH.push(bM)}return bH}).apply(this));for(bK=0,bF=bE-1;0<=bF?bK<=bF:bK>=bF;0<=bF?bK++:bK--){bC.face.push([bK,(bK+1)%bE,bE])}bC.xyz=g(bC,3);return bC};an=(function(){function bC(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bC.prototype.newV=function(bE,bD){if(this.verts[bE]===void 0){this.verts[bE]=0;return this.xyzs[bE]=bD}};bC.prototype.newFlag=function(bD,bF,bE){if(this.flags[bD]===void 0){this.flags[bD]={}}return this.flags[bD][bF]=bE};bC.prototype.topoly=function(){var bE,bJ,bM,bI,bG,bD,bK,bL,bH,bF;bD=new aV();bE=0;bH=this.verts;for(bI in bH){bK=bH[bI];bD.xyz[bE]=this.xyzs[bI];this.verts[bI]=bE;bE++}bE=0;bF=this.flags;for(bI in bF){bJ=bF[bI];bD.face[bE]=[];for(bG in bJ){bK=bJ[bG];bL=bK;break}bK=bL;bD.face[bE].push(this.verts[bK]);bK=this.flags[bI][bK];bM=0;while(bK!==bL){bD.face[bE].push(this.verts[bK]);bK=this.flags[bI][bK];bM++;if(bM>1000){console.log("Bad flag spec, have a neverending face:",bI,this.flags[bI]);break}}bE++}bD.name="unknown polyhedron";return bD};return bC})();ah=function(bM,bS){var bL,bW,bV,bT,bZ,bK,bU,bO,bQ,bR,bP,bJ,bG,bH,bE,bC,bY,b0,bX,bN,bI,bF,bD;console.log("Taking kis of "+(bS===0?"":bS)+"-sided faces of "+bM.name+"...");bT=new an();bN=Q(bM.xyz);for(bH=0,bY=bN.length;bH<bY;bH++){bI=bN[bH],bU=bI[0],bR=bI[1];bT.newV("v"+bU,bR)}bQ=bM.normals();bW=bM.centers();bK=false;bF=Q(bM.face);for(bE=0,b0=bF.length;bE<b0;bE++){bD=bF[bE],bU=bD[0],bV=bD[1];bJ="v"+bV[bV.length-1];for(bC=0,bX=bV.length;bC<bX;bC++){bP=bV[bC];bG="v"+bP;if(bV.length===bS||bS===0){bK=true;bL="apex"+bU;bZ=""+bU+bJ;bT.newV(bL,C(bW[bU],e(0.2,bQ[bU])));bT.newFlag(bZ,bJ,bG);bT.newFlag(bZ,bG,bL);bT.newFlag(bZ,bL,bJ)}else{bT.newFlag(""+bU,bJ,bG)}bJ=bG}}if(!bK){console.log("No "+bS+"-fold components were found.")}bO=bT.topoly();bO.name="k"+(bS===0?"":bS)+bM.name;return bO};aM=function(bD){var bN,bO,bM,bE,bI,bS,bR,bP,bK,bJ,bQ,bC,bL,bH,bG,bF;console.log("Taking ambo of "+bD.name+"...");bE=function(bU,bT){if(bU<bT){return bU+"_"+bT}else{return bT+"_"+bU}};bO=new an();bL=Q(bD.face);for(bK=0,bQ=bL.length;bK<bQ;bK++){bH=bL[bK],bM=bH[0],bN=bH[1];bG=bN.slice(-2),bS=bG[0],bR=bG[1];for(bJ=0,bC=bN.length;bJ<bC;bJ++){bP=bN[bJ];if(bS<bR){bO.newV(bE(bS,bR),a2(bD.xyz[bS],bD.xyz[bR]))}bO.newFlag("orig"+bM,bE(bS,bR),bE(bR,bP));bO.newFlag("dual"+bR,bE(bR,bP),bE(bS,bR));bF=[bR,bP],bS=bF[0],bR=bF[1]}}bI=bO.topoly();bI.name="a"+bD.name;return bI};bb=function(bQ){var bY,bX,bV,b2,bW,bU,bS,bT,bP,bM,bJ,bN,bK,bH,bF,b1,b3,b0,bZ,bR,bE,bO,bL,bI,bG,bD,bC,b5,b4;console.log("Taking gyro of "+bQ.name+"...");bV=new an();bR=Q(bQ.xyz);for(bN=0,b1=bR.length;bN<b1;bN++){bO=bR[bN],bW=bO[0],bT=bO[1];bV.newV("v"+bW,bt(bT))}bY=bQ.centers();bL=Q(bQ.face);for(bK=0,b3=bL.length;bK<b3;bK++){bI=bL[bK],bW=bI[0],bX=bI[1];bV.newV("center"+bW,bt(bY[bW]))}bG=Q(bQ.face);for(bH=0,b0=bG.length;bH<b0;bH++){bD=bG[bH],bW=bD[0],bX=bD[1];bC=bX.slice(-2),bP=bC[0],bM=bC[1];b5=Q(bX);for(bF=0,bZ=b5.length;bF<bZ;bF++){b4=b5[bF],bU=b4[0],bT=b4[1];bJ=bT;bV.newV(bP+"~"+bM,az(bQ.xyz[bP],bQ.xyz[bM]));b2=bW+"f"+bP;bV.newFlag(b2,"center"+bW,bP+"~"+bM);bV.newFlag(b2,bP+"~"+bM,bM+"~"+bP);bV.newFlag(b2,bM+"~"+bP,"v"+bM);bV.newFlag(b2,"v"+bM,bM+"~"+bJ);bV.newFlag(b2,bM+"~"+bJ,"center"+bW);bE=[bM,bJ],bP=bE[0],bM=bE[1]}}bS=bV.topoly();bS.name="g"+bQ.name;return bS};u=function(bN){var bT,bR,bV,bS,bP,bQ,bM,bJ,bG,bK,bH,bE,bU,bX,bW,bO,bL,bI,bF,bD,bC;console.log("Taking propellor of "+bN.name+"...");bR=new an();bO=Q(bN.xyz);for(bK=0,bU=bO.length;bK<bU;bK++){bL=bO[bK],bS=bL[0],bQ=bL[1];bR.newV("v"+bS,bt(bQ))}bI=Q(bN.face);for(bH=0,bX=bI.length;bH<bX;bH++){bF=bI[bH],bS=bF[0],bT=bF[1];bD=bT.slice(-2),bM=bD[0],bJ=bD[1];for(bE=0,bW=bT.length;bE<bW;bE++){bQ=bT[bE];bG=""+bQ;bR.newV(bM+"~"+bJ,az(bN.xyz[bM],bN.xyz[bJ]));bV=""+bS+"f"+bJ;bR.newFlag("v"+bS,bM+"~"+bJ,bJ+"~"+bG);bR.newFlag(bV,bM+"~"+bJ,bJ+"~"+bM);bR.newFlag(bV,bJ+"~"+bM,"v"+bJ);bR.newFlag(bV,"v"+bJ,bJ+"~"+bG);bR.newFlag(bV,bJ+"~"+bG,bM+"~"+bJ);bC=[bJ,bG],bM=bC[0],bJ=bC[1]}}bP=bR.topoly();bP.name="p"+bN.name;return bP};v=function(bE){var bC,bD,bF;console.log("Taking reflection of "+bE.name+"...");for(bC=0,bD=bE.xyz.length-1;0<=bD?bC<=bD:bC>=bD;0<=bD?bC++:bC--){bE.xyz[bC]=e(-1,bE.xyz[bC])}for(bC=0,bF=bE.face.length-1;0<=bF?bC<=bF:bC>=bF;0<=bF?bC++:bC--){bE.face[bC]=bE.face[bC].reverse()}bE.name="r"+bE.name;return bE};aN=function(bP){var bX,b3,bW,bQ,bU,bV,bT,bS,bO,bL,bM,bJ,bH,bF,b1,b2,b0,bZ,bY,bD,bR,bN,bK,bI,bG,bE,bC;console.log("Taking dual of "+bP.name+"...");bU=new an();bQ=[];for(bV=0,bR=bP.xyz.length-1;0<=bR?bV<=bR:bV>=bR;0<=bR?bV++:bV--){bQ[bV]={}}bN=Q(bP.face);for(bM=0,b1=bN.length;bM<b1;bM++){bK=bN[bM],bV=bK[0],bW=bK[1];bO=bW[bW.length-1];for(bJ=0,b2=bW.length;bJ<b2;bJ++){bL=bW[bJ];bQ[bO]["v"+bL]=""+bV;bO=bL}}bX=bP.centers();for(bV=0,bI=bP.face.length-1;0<=bI?bV<=bI:bV>=bI;0<=bI?bV++:bV--){bU.newV(""+bV,bX[bV])}bG=Q(bP.face);for(bH=0,b0=bG.length;bH<b0;bH++){bE=bG[bH],bV=bE[0],bW=bE[1];bO=bW[bW.length-1];for(bF=0,bZ=bW.length;bF<bZ;bF++){bL=bW[bF];bU.newFlag(bO,bQ[bL]["v"+bO],""+bV);bO=bL}}console.log("dual flag:",bU);b3=bU.topoly();bS=[];bC=b3.face;for(bD=0,bY=bC.length;bD<bY;bD++){bW=bC[bD];bT=J(bP.face[bW[0]],bP.face[bW[1]],bP.face[bW[2]]);bS[bT]=bW}b3.face=bS;if(bP.name[0]!=="d"){b3.name="d"+bP.name}else{b3.name=bP.name.slice(1)}return b3};H=function(bP,bV){var bZ,bY,bW,b4,bO,bX,bR,bT,bU,bS,bN,bK,bL,bI,bG,bE,b3,b5,b2,b1,b0,bC,bQ,bM,bJ,bH,bF,bD;console.log("Taking inset of "+(bV===0?"":bV)+"-sided faces of "+bP.name+"...");bW=new an();bQ=Q(bP.xyz);for(bL=0,b3=bQ.length;bL<b3;bL++){bM=bQ[bL],bX=bM[0],bU=bM[1];bW.newV("v"+bX,bU)}bT=bP.normals();bZ=bP.centers();bJ=Q(bP.face);for(bI=0,b5=bJ.length;bI<b5;bI++){bH=bJ[bI],bX=bH[0],bY=bH[1];if(bY.length===bV||bV===0){for(bG=0,b2=bY.length;bG<b2;bG++){bS=bY[bG];bW.newV("f"+bX+"v"+bS,C(a2(bP.xyz[bS],bZ[bX]),e(-0.2,bT[bX])))}}}bO=false;bF=Q(bP.face);for(bE=0,b1=bF.length;bE<b1;bE++){bD=bF[bE],bX=bD[0],bY=bD[1];bN="v"+bY[bY.length-1];for(bC=0,b0=bY.length;bC<b0;bC++){bS=bY[bC];bK="v"+bS;if(bY.length===bV||bV===0){bO=true;b4=bX+bN;bW.newFlag(b4,bN,bK);bW.newFlag(b4,bK,"f"+bX+bK);bW.newFlag(b4,"f"+bX+bK,"f"+bX+bN);bW.newFlag(b4,"f"+bX+bN,bN);bW.newFlag("ex"+bX,"f"+bX+bN,"f"+bX+bK)}else{bW.newFlag(bX,bN,bK)}bN=bK}}if(!bO){console.log("No "+bV+"-fold components were found.")}bR=bW.topoly();bR.name="n"+(bV===0?"":bV)+bP.name;return bR};ag=function(bP,bV){var bZ,bY,bW,bO,bX,bR,bT,bU,bS,bN,bK,bL,bI,bG,bE,b3,b4,b2,b1,b0,bC,bQ,bM,bJ,bH,bF,bD;console.log("Taking extrusion of "+(bV===0?"":bV)+"-sided faces of "+bP.name+"...");bW=new an();bQ=Q(bP.xyz);for(bL=0,b3=bQ.length;bL<b3;bL++){bM=bQ[bL],bX=bM[0],bU=bM[1];bW.newV("v"+bX,bU)}bT=bP.normals();bZ=bP.centers();bJ=Q(bP.face);for(bI=0,b4=bJ.length;bI<b4;bI++){bH=bJ[bI],bX=bH[0],bY=bH[1];if(bY.length===bV||bV===0){for(bG=0,b2=bY.length;bG<b2;bG++){bS=bY[bG];bW.newV("f"+bX+"v"+bS,C(bP.xyz[bS],e(0.3,bT[bX])))}}}bO=false;bF=Q(bP.face);for(bE=0,b1=bF.length;bE<b1;bE++){bD=bF[bE],bX=bD[0],bY=bD[1];bN="v"+bY[bY.length-1];for(bC=0,b0=bY.length;bC<b0;bC++){bS=bY[bC];bK="v"+bS;if(bY.length===bV||bV===0){bO=true;bW.newFlag(bX+bN,bN,bK);bW.newFlag(bX+bN,bK,"f"+bX+bK);bW.newFlag(bX+bN,"f"+bX+bK,"f"+bX+bN);bW.newFlag(bX+bN,"f"+bX+bN,bN);bW.newFlag("ex"+bX,"f"+bX+bN,"f"+bX+bK)}else{bW.newFlag(bX,bN,bK)}bN=bK}}if(!bO){console.log("No "+bV+"-fold components were found.")}bR=bW.topoly();bR.name="x"+(bV===0?"":bV)+bP.name;console.log(bR);return bR};a6=function(bP){var b0,bZ,bX,bY,bU,bW,bV,bM,b1,bK,bO,bN,bH,bS,bR,bQ,bJ,bG,bE,b3,b4,b2,bT,bL,bI,bF,bD,bC;console.log("Taking stella of "+bP.name+"...");b0=bP.centers();bX=new an();bT=Q(bP.xyz);for(bJ=0,b3=bT.length;bJ<b3;bJ++){bL=bT[bJ],bY=bL[0],bW=bL[1];bX.newV("v"+bY,bW)}bI=Q(bP.face);for(bG=0,b4=bI.length;bG<b4;bG++){bF=bI[bG],bY=bF[0],bZ=bF[1];bM="v"+bZ[bZ.length-2];bK="v"+bZ[bZ.length-1];bS=bP.xyz[bZ[bZ.length-2]];bR=bP.xyz[bZ[bZ.length-1]];for(bE=0,b2=bZ.length;bE<b2;bE++){bV=bZ[bE];bH="v"+bV;bQ=bP.xyz[bV];b1=bM+"~"+bK;bO=bK+"~"+bM;bN=bK+"~"+bH;bX.newV(b1,a2(a2(bS,bR),b0[bY]));bX.newFlag("in"+bY,b1,bN);bX.newFlag("f"+bY+bK,bN,b1);bX.newFlag("f"+bY+bK,b1,bK);bX.newFlag("f"+bY+bK,bK,bN);bX.newFlag("f"+b1,bM,bO);bX.newFlag("f"+b1,bO,b1);bX.newFlag("f"+b1,b1,bM);bD=[bK,bH],bM=bD[0],bK=bD[1];bC=[bR,bQ],bS=bC[0],bR=bC[1]}}bU=bX.topoly();bU.name="*"+bP.name;return bU};ae=function(bF,bE){var bJ,bH,bG,bC,bK,bD,bI;bJ=0.1;bC=bd(bF);for(bD=0,bI=bE.length;bD<bI;bD++){bG=bE[bD];bK=k(bC[bG[0]],bC[bG[1]]);bH=e(bJ*1/2*(1-Z(G(bK,bK))),bK);bC[bG[0]]=C(bC[bG[0]],bH);bC[bG[1]]=C(bC[bG[1]],bH)}return bC};bk=function(bG,bF){var bJ,bH,bC,bD,bK,bE,bI;bC=(function(){var bO,bM,bN,bL;bL=[];for(bO=0,bM=bF.length;bO<bM;bO++){bN=bF[bO],bJ=bN[0],bH=bN[1];bL.push(k(bG[bJ],bG[bH]))}return bL})();bD=[0,0,0];for(bE=0,bI=bC.length;bE<bI;bE++){bK=bC[bE];bD=C(bD,bK)}bD=e(1/bF.length,bD);return _.map(bG,function(bL){return bp(bL,bD)})};E=function(bG,bF){var bC,bE,bD;bE=[0,0,0];bC=_.max(_.map(bG,function(bH){return O(bH)}));bD=1/bC;bF||(bF=bD);return _.map(bG,function(bH){return[bF*bH[0],bF*bH[1],bF*bH[2]]})};bo=function(bI,bF){var bN,bK,bM,bJ,bE,bC,bO,bH,bG,bL,bD;bN=0.1;bC=bd(bI);for(bH=0,bL=bF.length;bH<bL;bH++){bJ=bF[bH];bM=(function(){var bR,bP,bQ;bQ=[];for(bR=0,bP=bJ.length;bR<bP;bR++){bO=bJ[bR];bQ.push(bI[bO])}return bQ})();bE=aq(bM);bK=bs(bM);if(G(bE,bK)<0){bE=e(-1,bE)}for(bG=0,bD=bJ.length;bG<bD;bG++){bO=bJ[bG];bC[bO]=C(bC[bO],e(G(e(bN,bE),bp(bK,bI[bO])),bE))}}return bC};o=function(bI,bH){var bD,bC,bF,bG,bE,bJ;console.log("Canonicalizing "+bI.name+"...");bC=bI.face;bD=bI.getEdges();bE=bI.xyz;bG=1;for(bF=0;0<=bH?bF<=bH:bF>=bH;0<=bH?bF++:bF--){bJ=bd(bE);bE=ae(bE,bD);bE=bk(bE,bD);bE=bo(bE,bC);bG=_.max(_.map(_.zip(bE,bJ),function(bL){var bK,bM;bK=bL[0],bM=bL[1];return O(bp(bK,bM))}));if(bG<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bG+"]");return bE};T=function(bF){var bG,bD,bE,bC;bD=bF.centers();for(bE=0,bC=bD.length;bE<bC;bE++){bG=bD[bE];bG=e(1/G(bG,bG),bG)}return bD};K=function(bE){var bS,bM,bF,bN,bC,bL,bR,bQ,bO,bJ,bI,bP,bD,bK,bH,bG;bS=[];bK=bE.face;for(bJ=0,bP=bK.length;bJ<bP;bJ++){bN=bK[bJ];bF=[0,0,0];bC=[0,0,0];bM=0;bH=bN.slice(-2),bR=bH[0],bQ=bH[1];for(bI=0,bD=bN.length;bI<bD;bI++){bO=bN[bI];bF=C(bF,bE.xyz[bO]);bC=C(bC,a3(bE.xyz[bR],bE.xyz[bQ],bE.xyz[bO]));bM+=aA(bE.xyz[bR],bE.xyz[bQ]);bG=[bQ,bO],bR=bG[0],bQ=bG[1]}bF=e(1/bN.length,bF);bC=bt(bC);bM=bM/bN.length;bL=aG(e(G(bF,bC),bC));bS.push(e((1+bM)/2,bL))}return bS};g=function(bG,bD){var bE,bC,bF;bC=aN(bG);console.log("Pseudo-canonicalizing "+bG.name+"...");for(bE=0,bF=bD-1;0<=bF?bE<=bF:bE>=bF;0<=bF?bE++:bE--){bC.xyz=K(bG);bG.xyz=K(bC)}return bG.xyz};B=function(bG,bD){var bE,bC,bF;bC=aN(bG);console.log("Planarizing "+bG.name+"...");for(bE=0,bF=bD-1;0<=bF?bE<=bF:bE>=bF;0<=bF?bE++:bE--){bC.xyz=T(bG);bG.xyz=T(bC)}return bG.xyz};N=function(b4){var b3,bZ,bU,bX,b2,bM,b5,bW,bS,bO,b1,bI,bY,bT,bK,bL,bN,bV,b0,bJ,bH,bG,bD,bC,bR,bP,bF,bQ,bE;bN=999;bY=[];bT=[];bK=b4.length;b1=function(b6,b7){return(b6||b7)&&!(b6&&b7)};b3=function(b8,b7,b6){return(b7[0]-b8[0])*(b6[1]-b8[1])-(b6[0]-b8[0])*(b7[1]-b8[1])};bS=function(b8,b7,b6){return b3(b8,b7,b6)>0};bO=function(b8,b7,b6){return b3(b8,b7,b6)>=0};bU=function(b8,b7,b6){return b3(b8,b7,b6)===0};bZ=function(b8,b7,b6){if(bU(b8,b7,b6)){return false}if(b8[0]!==b7[0]){return(b8[0]<=b6[0])&&(b6[0]<=b7[0])||(b8[0]>=b6[0])&&(b6[0]>=b7[0])}else{return(b8[1]<=b6[1])&&(b6[1]<=b7[1])||(b8[1]>=b6[1])&&(b6[1]>=b7[1])}};bW=function(b9,b8,b7,b6){if(bU(b9,b8,b7)||bU(b9,b8,b6)||bU(b7,b6,b9)||bU(b7,b6,b8)){return false}return b1(bS(b9,b8,b7),bS(b9,b8,b6))&&b1(bS(b7,b6,b9),bS(b7,b6,b8))};b5=function(b9,b8,b7,b6){if(bW(b9,b8,b7,b6)){return true}else{if(bZ(b9,b8,b7)||bZ(b9,b8,b6)||bZ(b7,b6,b9)||bZ(b7,b6,b8)){return true}else{return false}}};bM=function(b8,b6){var b9,b7;b7=(b8+1+bK)%bK;b9=(b8-1+bK)%bK;if(bO(b4[b8],b4[b7],b4[b9])){return bS(b4[b8],b4[b6],b4[b9])&&bS(b4[b6],b4[b8],b4[b7])}return !(bO(b4[b8],b4[b6],b4[b7])&&bO(b4[b6],b4[b8],b4[b9]))};b2=function(b7,b6){var b9,b8;b9=0;while(true){b8=(b9+1+bK)%bK;if((b9!==b7)&&(b8!==b7)&&(b9!==b6)&&(b8!==b6)&&bW(b4[b7],b4[b6],b4[b9],b4[b8])){return false}b9=(b9+1+bK)%bK;if(b9===0){break}}return true};bX=function(b7,b6){return bM(b7,b6)&&bM(b6,b7)&&b2(b7,b6)};bH=0;while(true){bG=(bH+1+bK)%bK;bJ=(bH-1+bK)%bK;bT[bH]=bX(bJ,bG);bH=(bH+1+bK)%bK;if(bH===0){break}}b0=(function(){bE=[];for(var b7=0,b6=bK-1;0<=b6?b7<=b6:b7>=b6;0<=b6?b7++:b7--){bE.push(b7)}return bE}).apply(this);bV=bK;bP=bN;bL=0;while(bP>0&&bV>3){bP-=1;bG=bL;bR=bN;while(true){bR-=1;bI=false;if(bT[bG]){bD=(bG+1+bK)%bK;bC=(bD+1+bK)%bK;bH=(bG-1+bK)%bK;bJ=(bH-1+bK)%bK;bY.push([b0[bH],b0[bD]]);bT[bH]=bX(bJ,bD);bT[bD]=bX(bH,bC);b4=b4.slice(0,(bG+1)||9000000000).concat(b4.slice(bD));b0=b0.slice(0,(bG+1)||9000000000).concat(b0.slice(bD));if(bJ>bG){bJ-=1}if(bH>bG){bH-=1}if(bD>bG){bD-=1}if(bC>bG){bC-=1}bK--;bL=bD;bV--;bI=true}bG=(bG+1+bK)%bK;if(!(bR>0&&!bI&&bG!==bL)){break}}}return bY};b=function(bD,bC){if(((bD[0]===bC[0])&&(bD[1]===bC[1])&&(bD[2]===bC[2]))||(bD[0]===bC[1])&&(bD[1]===bC[2])&&(bD[2]===bC[0])||(bD[0]===bC[2])&&(bD[1]===bC[0])&&(bD[2]===bC[1])){return true}else{return false}};w=function(b9,bW){var bT,ca,bV,bU,bR,bX,b7,bD,bN,cb,ce,cd,cc,b8,b6,b5,b4,bS,bK,bJ,bI,bH,bG,bF,bE,bC,b3,b2,b1,b0,bZ,bY,bQ,bP,bO,bM,bL;bR=[];bD=[];bY=(function(){var cg,cf;cf=[];for(b7=0,cg=b9.length-1;0<=cg?b7<=cg:b7>=cg;0<=cg?b7++:b7--){cf.push([b7,(b7+1)%b9.length])}return cf})();for(b8=0,bS=bY.length;b8<bS;b8++){bQ=bY[b8],cd=bQ[0],cc=bQ[1];bR[cd]=[cc];bD[cc]=[cd]}for(b6=0,bK=bW.length;b6<bK;b6++){ca=bW[b6];bR[ca[0]].push(ca[1]);bR[ca[1]].push(ca[0]);bD[ca[0]].push(ca[1]);bD[ca[1]].push(ca[0])}cb=[];for(b5=0,bJ=bW.length;b5<bJ;b5++){ca=bW[b5];bP=bR[ca[1]];for(b4=0,bI=bP.length;b4<bI;b4++){bV=bP[b4];bO=bD[ca[0]];for(b3=0,bH=bO.length;b3<bH;b3++){bU=bO[b3];if(bV===bU){cb.push([ca[0],ca[1],bV])}}}bM=bR[ca[0]];for(b2=0,bG=bM.length;b2<bG;b2++){bV=bM[b2];bL=bD[ca[1]];for(b1=0,bF=bL.length;b1<bF;b1++){bU=bL[b1];if(bV===bU){cb.push([ca[1],ca[0],bV])}}}}ce=[cb.pop()];for(b0=0,bE=cb.length;b0<bE;b0++){bN=cb[b0];bT=false;for(bZ=0,bC=ce.length;bZ<bC;bZ++){bX=ce[bZ];if(b(bN,bX)){bT=true;break}}if(!bT){ce.push(bN)}}return ce};af=function(bH,bJ){var bR,bM,bS,bQ,bP,bK,bO,bN,bL,bF,bD,bT,bU,bI,bG,bE,bC;bJ=bJ||false;console.log("Triangulating faces of "+bH.name+"...");bK=new aV();bK.xyz=P(bH.xyz);bK.face_colors=[];bI=Q(bH.face);for(bF=0,bT=bI.length;bF<bT;bF++){bG=bI[bF],bQ=bG[0],bS=bG[1];if(bS.length>3){bR=ad((function(){var bX,bV,bW;bW=[];for(bX=0,bV=bS.length;bX<bV;bX++){bL=bS[bX];bW.push(bH.xyz[bL])}return bW})());bM=N(bR);bN=w(bS,bM);bE=Q(bN);for(bD=0,bU=bE.length;bD<bU;bD++){bC=bE[bD],bP=bC[0],bO=bC[1];bK.face.push([bS[bO[0]],bS[bO[1]],bS[bO[2]]]);if(bJ){bK.face_colors.push(bH.face_colors[bQ])}}}else{bK.face.push([bS[0],bS[1],bS[2]]);if(bJ){bK.face_colors.push(bH.face_colors[bQ])}}}bK.name=bH.name;return bK};am=function(bC){var bH,bI,bK,bF,bE,bJ,bD,bG;bI="";bG=bC.face;for(bF=0,bJ=bG.length;bF<bJ;bF++){bH=bG[bF];for(bE=0,bD=bH.length;bE<bD;bE++){bK=bH[bE];bI+=""+bK+"->"}bI+="\n"}return console.log(bI)};F=function(){var bJ,bG,bF,bE,bI,bH,bD,bC;bE=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bG=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bI=0,bD=bG.length;bI<bD;bI++){bJ=bG[bI];console.log("Operator "+bJ);for(bH=0,bC=bE.length;bH<bC;bH++){bF=bE[bH];console.log(bJ+bF+":",al(bJ+bF))}}return console.log("===== Done Testing Basic Ops =====")};bz=function(bE,bD){var bC;bE||(bE=[0,0,0]);bD||(bD=bt(bE));bC=new CSG.Vertex(new CSG.Vector(bE[0],bE[1],bE[2]),new CSG.Vector(bD[0],bD[1],bD[2]));return bC};bw=function(bJ){var bE,bF,bI,bD,bH,bC,bG;bE=[];bG=bJ.face;for(bH=0,bC=bG.length;bH<bC;bH++){bI=bG[bH];bE.push(new CSG.Polygon((function(){var bM,bK,bL;bL=[];for(bM=0,bK=bI.length;bM<bK;bM++){bD=bI[bM];bL.push(bz(bJ.xyz[bD]))}return bL})(),{}))}bF=CSG.fromPolygons(bE);return bF};q=function(bI,bE){var bF,bD,bH,bC,bG,bJ;bG=Q(bI);for(bH=0,bC=bG.length;bH<bC;bH++){bJ=bG[bH],bF=bJ[0],bD=bJ[1];if(O(bp(bE,bD))<0.000001){return bF}}return -1};bn=function(bD){var bJ,bK,bE,bI,bG,bF,bH,bC;bE=[];bE.push(bD[0]);for(bG=0,bH=bD.length;bG<bH;bG++){bI=bD[bG];bJ=false;for(bF=0,bC=bE.length;bF<bC;bF++){bK=bE[bF];if(O(bp(bI,bK))<0.000001){bJ=true}}if(!bJ){bE.push(bI)}}return bE};aL=function(bJ,bI,bE){var bD,bC,bG,bF,bH;bF=bp(bI,bJ);bG=bp(bE,bJ);bD=G(bt(bF),bG);bC=O(bp(bt(bF),bt(bG)));if(bC<0.000001&&(0<(bH=O(bG))&&bH<O(bF))){return true}else{return false}};ao=function(bI){var bO,bN,bR,bE,bP,bQ,bL,bH,bM,bU,bJ,bF,bD,bC,bT,bV,bS,bK,bG;bE=bI.face;bU=bI.xyz;bQ=[];for(bF=0,bT=bE.length;bF<bT;bF++){bR=bE[bF];bP=[];bO=bU[bR[bR.length-1]];for(bD=0,bV=bR.length;bD<bV;bD++){bM=bR[bD];bN=bU[bM];bK=Q(bU);for(bC=0,bS=bK.length;bC<bS;bC++){bG=bK[bC],bJ=bG[0],bH=bG[1];if(aL(bO,bN,bH)){bP.push(bJ)}}bP.push(bM);bO=bN}bQ.push(bP)}bL=new aV();bL.face=bQ;bL.xyz=P(bU);return bL};m=function(bG){var bD,bH,bF,bQ,bP,bM,bL,bK,bO,bE,bC,bN,bJ,bI;bH=[];bP=[];bN=bG.toPolygons();for(bM=0,bO=bN.length;bM<bO;bM++){bD=bN[bM];bJ=bD.vertices;for(bL=0,bE=bJ.length;bL<bE;bL++){bQ=bJ[bL];bP.push([bQ.pos.x,bQ.pos.y,bQ.pos.z])}}bP=bn(bP);bI=bG.toPolygons();for(bK=0,bC=bI.length;bK<bC;bK++){bD=bI[bK];bH.push((function(){var bS,bU,bT,bR;bT=bD.vertices;bR=[];for(bS=0,bU=bT.length;bS<bU;bS++){bQ=bT[bS];bR.push(q(bP,[bQ.pos.x,bQ.pos.y,bQ.pos.z]))}return bR})())}bF=new aV();bF.face=bH;bF.xyz=bP;return ao(bF)};aW=function(bE,bD){var bG,bF,bC;bG=bw(bE);bF=bw(bD);bC=bG.union(bF);return m(bC)};bg=function(bE,bD){var bG,bF,bC;bG=bw(bE);bF=bw(bD);bC=bG.intersect(bF);return m(bC)};aT=function(bE,bD){var bG,bF,bC;bG=bw(bE);bF=bw(bD);bC=bG.subtract(bF);return m(bC)};a=function(bD){var bG,bF,bH,bE,bJ,bK,bC,bI;bH=[];bF={};for(bC=0,bI=bD.length;bC<bI;bC++){bG=bD[bC];bF[bG[0]]=bG[1]}bK=bD[0][0];bJ=bD[0][1];bH.push(bJ);bE=0;while(bJ!==bK){bJ=bF[bJ];bH.push(bJ);bE++;if(bE>1000){console.log("Bad edges to face join, have a neverending face:",bD);break}}return bH};bf=function(bG){var bJ,bK,bD,bI,bF,bE,bH,bC;bD=[];bD.push(vertlist[0]);for(bF=0,bH=vertlist.length;bF<bH;bF++){bI=vertlist[bF];bJ=false;for(bE=0,bC=bD.length;bE<bC;bE++){bK=bD[bE];if(O(bp(bI,bK))<0.000001){bJ=true}}if(!bJ){bD.push(bI)}}return bD};I=function(bF){var bG,bD,bE,bC;bG="";for(bE=0,bC=bF.length;bE<bC;bE++){bD=bF[bE];bG+=""+bD+"->"}return bG.slice(0,(bG.length-3+1)||9000000000)};x=function(bC){var bH,bI,bJ,bG,bM,bK,bE,bL,bF,bD;bH=[];bH=(_.reduce(_.map(bC,bi),(function(bO,bN){return bO.concat(bN)}),bH)).slice(0);bM=[];while(bH.length>0){bI=bH.pop();bK=false;if(bH.length>0){bF=Q(bH);for(bE=0,bL=bF.length;bE<bL;bE++){bD=bF[bE],bG=bD[0],bJ=bD[1];if(bI[0]===bJ[1]&&bI[1]===bJ[0]){bK=true;bH.splice(bG,1)}}if(!bK){bM.push(bI)}}else{bM.push(bI)}}return a(bM)};aY=function(bI){var bQ,bL,bX,bS,bO,bJ,bV,bK,bY,bR,bN,bP,bW,bG,bD,bC,bT,bU,bM,bH,bF,bE;bJ=(function(){bE=[];for(var b0=0,bZ=bI.face.length-1;0<=bZ?b0<=bZ:b0>=bZ;0<=bZ?b0++:b0--){bE.push(b0)}return bE}).apply(this);bX=aN(bI);bO={};bH=bX.getEdges();for(bD=0,bT=bH.length;bD<bT;bD++){bS=bH[bD];bO[bS[0]]=[]}bF=bX.getEdges();for(bC=0,bU=bF.length;bC<bU;bC++){bS=bF[bC];bO[bS[0]].push(bS[1]);bO[bS[1]].push(bS[0])}bP=bI.normals();bK=[];bV=[];bQ=bJ.pop();bV.push(bQ);bW=[];bY=0;while(bJ.length>0&&bY<1000000){bY++;bL=bJ.pop();if(O(bp(bt(bP[bQ]),bt(bP[bL])))<0.000001&&(bO[bQ].indexOf(bL)!==-1)){bV.push(bL)}else{bW.unshift(bL)}if(bJ.length===0&&bW.length>0){bJ=bW;bW=[];console.log(bQ,"pile",bV.length);bK.push(_.map(bV,function(bZ){return bI.face[bZ]}));bV=[];bQ=bJ.pop();bV.push(bQ)}}bR=_.map(bK,x);bN=new aV();bN.xyz=P(bI.xyz);bN.face=bR;return bN};ai={};bu=500;aE=400;U={};j=P(y);ar=P(y);Y=800;D=5;bv=0;R=0.8;p=bu/2;aB=aE/2;z=new Date();s=true;a0="rgba(255,255,255,1.0)";au="area";h="fillstroke";bm=0.5;av=false;ab=0;aa=0;aK=[1,0,0];bc=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];aI=function(bE,bC){var bF,bD;bF=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bD=new bF();bD.append(bE);return saveAs(bD.getBlob("text/plain;charset="+document.characterSet),bC)};L=[];by=[];ay=["#ff3333","#33ff33","#3333ff","#ffff33","#ff33ff","#33ffff","#dddddd","#555555","#dd0000","#00dd00","#0000dd"];aX=["#ff8888","#dddddd","#777777","#aa3333","#ff0000","#ffffff","#aaaaaa"];l=["#ff8888","#ffeeee","#88ff88","#dd7777","#ff2222","#22ff22","#ee4422","#aaaaaa"];bB=function(bD){var bC;if(bD[0]==="#"){bD=bD.slice(1)}if(bD.length===3){bC=bD.split("").map(function(bE){return parseInt(bE+bE,16)/255})}else{bC=bD.match(/.{2}/g).map(function(bE){return parseInt(bE,16)/255})}return bC};a8=aX;ak=function(bC){if(bC<a8.length){return bB(a8[bC])}else{return bB(a8[a8.length-1])}};a5=function(bC,bF){var bD,bE;bE=ac(100*bC);if(bE in bF){return bF[bE]}else{bD=ak(_.toArray(bF).length);bF[bE]=bD;return bD}};V=function(bC){var bK,bG,bF,bI,bJ,bD,bH,bE;bC.face_colors=[];bG={};bE=bC.face;for(bD=0,bH=bE.length;bD<bH;bD++){bF=bE[bD];if(au==="area"){bI=(function(){var bN,bL,bM;bM=[];for(bN=0,bL=bF.length;bN<bL;bN++){bJ=bF[bN];bM.push(bC.xyz[bJ])}return bM})();bK=a5(br(bI),bG)}else{bK=ak(bF.length-3)}bC.face_colors.push(bK)}return bC};aU=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];a9=function(bF){var bC,bE,bI,bH,bD,bG;bE=bF;for(bH=0,bD=aU.length;bH<bD;bH++){bG=aU[bH],bI=bG[0],bC=bG[1];bE=bE.replace(bI,bC)}console.log(""+bF+" executed as "+bE);return bE};al=function(bD){var bF,bC,bE;bE=new aV();bF=0;bC=a9(bD);if(bC.search(/([0-9]+)$/)!==-1){bF=1*RegExp.lastParen;bC=bC.slice(0,-RegExp.lastParen.length)}switch(bC.slice(-1)){case"T":bE=f();break;case"O":bE=aw();break;case"C":bE=ap();break;case"I":bE=bh();break;case"D":bE=ax();break;case"P":bE=X(bF);break;case"A":bE=a4(bF);break;case"Y":bE=bA(bF);break;default:return}while(bC!==""){bF=0;if(bC.search(/([0-9]+)$/)!==-1){bF=1*RegExp.lastParen;bC=bC.slice(0,-RegExp.lastParen.length)}switch(bC.slice(-1)){case"d":bE=aN(bE);break;case"k":bE=ah(bE,bF);break;case"a":bE=aM(bE);break;case"g":bE=bb(bE);break;case"p":bE=u(bE);break;case"r":bE=v(bE);break;case"K":bE.xyz=g(bE,bF===0?1:bF);break;case"C":bE.xyz=o(bE,bF===0?1:bF);break;case"A":bE.xyz=B(bE,bF===0?1:bF);break;case"n":bE=H(bE,bF);break;case"x":bE=ag(bE,bF);break;case"l":bE=a6(bE,bF);break;case"z":bE=af(bE,false)}bC=bC.slice(0,-1)}bE.xyz=bk(bE.xyz,bE.getEdges());bE.xyz=E(bE.xyz);bE=V(bE);return bE};bx=function(){var bC,bH,bG,bF,bE,bD;bD={};bC=/\+/g;bE=/([^&=]+)=?([^&]*)/g;bH=function(bI){return decodeURIComponent(bI.replace(bC," "))};bF=window.location.search.substring(1);while(bG=bE.exec(bF)){bD[bH(bG[1])]=bH(bG[2])}return bD};aP=function(){var bC;bC=$("#poly");bC.width(bu);bC.height(aE);ai=bC[0].getContext("2d");ai.lineWidth=bm;if(s){return ai.clearRect(0,0,bu,aE)}else{ai.clearRect(0,0,bu,aE);ai.fillStyle=a0;return ai.fillRect(0,0,bu,aE)}};aR=function(){if(s){return ai.clearRect(0,0,bu,aE)}else{ai.clearRect(0,0,bu,aE);ai.fillStyle=a0;return ai.fillRect(0,0,bu,aE)}};aZ=function(bC){var bD,bL,bK,bM,bG,bE,bJ,bH,bI,bF;bD=bC.centers();bK=bC.normals();bG=[0,0,(D*R-bv)/(1-R)];bM=function(bO,bN){return -G(bp(bG,bO[0]),bO[1])*G(bp(bN[0],bO[0]),bO[1])};bE=function(bO,bN){return bO[0][2]-bN[0][2]};bJ=_.zip(bD,bK,(function(){bF=[];for(var bO=0,bN=bC.face.length-1;0<=bN?bO<=bN:bO>=bN;0<=bN?bO++:bO--){bF.push(bO)}return bF}).apply(this)).sort(bE).map(function(bN){return bN[2]});bC.face=(function(){var bP,bN,bO;bO=[];for(bP=0,bN=bJ.length;bP<bN;bP++){bL=bJ[bP];bO.push(bC.face[bL])}return bO})();return bC.face_colors=(function(){var bP,bN,bO;bO=[];for(bP=0,bN=bJ.length;bP<bN;bP++){bL=bJ[bP];bO.push(bC.face_colors[bL])}return bO})()};W=function(bY,cd){var b5,bC,bP,bT,bX,bE,b4,bW,bD,b2,cg,bU,bZ,bQ,b1,b0,ca,b9,b8,b7,bV,bJ,bH,bG,bF,b6,b3,ch,cf,ce,cc,cb,bS,bR,bO,bN,bM,bL,bK,bI;cd||(cd=[3,3,3]);bD=_.map(bY.xyz,function(ci){return ci});bY.xyz=_.map(bY.xyz,function(ci){return t(j,ci)});aZ(bY);b3=Q(bY.face);for(ca=0,bV=b3.length;ca<bV;ca++){bS=b3[ca],bE=bS[0],bP=bS[1];ai.beginPath();cg=bP[bP.length-1];bR=A(C(cd,bY.xyz[cg]),D,bv,R,Y),b1=bR[0],b0=bR[1];ai.moveTo(b1+p,b0+aB);for(b9=0,bJ=bP.length;b9<bJ;b9++){b2=bP[b9];bO=A(C(cd,bY.xyz[b2]),D,bv,R,Y),b1=bO[0],b0=bO[1];ai.lineTo(b1+p,b0+aB)}bC=bY.face_colors[bE];bX=(function(){var cj,ck,ci;ci=[];for(cj=0,ck=bP.length;cj<ck;cj++){b2=bP[cj];ci.push(bY.xyz[b2])}return ci})();b4=G(aq(bX),bt([1,-1,0]));bC=e((b4/2+0.5)*0.7+0.3,bC);if(h==="fill"||h==="fillstroke"){ai.fillStyle="rgba("+(ac(bC[0]*255))+", "+(ac(bC[1]*255))+", "+(ac(bC[2]*255))+", "+1+")";ai.fill();ai.strokeStyle="rgba("+(ac(bC[0]*255))+", "+(ac(bC[1]*255))+", "+(ac(bC[2]*255))+", "+1+")";ai.stroke()}if(h==="fillstroke"){ai.fillStyle="rgba("+(ac(bC[0]*255))+", "+(ac(bC[1]*255))+", "+(ac(bC[2]*255))+", "+1+")";ai.fill();ai.strokeStyle="rgba(0,0,0, .3)";ai.stroke()}if(h==="stroke"){ai.strokeStyle="rgba(0,0,0, .8)";ai.stroke()}}b5=_.map(L,function(ci){return t(j,ci)});bW=_.map(by,function(ci){return t(j,ci)});bT=(function(){var cj,ci;ci=[];for(bE=0,cj=b5.length-1;0<=cj?bE<=cj:bE>=cj;0<=cj?bE++:bE--){ci.push(""+bE)}return ci})();bZ=(function(){var cj,ci;ci=[];for(bQ=0,cj=bY.xyz.length-1;0<=cj?bQ<=cj:bQ>=cj;0<=cj?bQ++:bQ--){ci.push(""+bQ)}return ci})();bN=Q(bY.face);for(b8=0,bH=bN.length;b8<bH;b8++){bM=bN[b8],bE=bM[0],bP=bM[1];ai.textAlign="center";ai.fillStyle="rgba(0,0,0,1)";bL=A(C(cd,b5[bE]),D,bv,R,Y),b1=bL[0],b0=bL[1];ai.fillText(bT[bE],b1+p,b0+aB)}bK=Q(bY.face);for(b7=0,bG=bK.length;b7<bG;b7++){bI=bK[b7],bE=bI[0],bP=bI[1];ai.strokeStyle="rgba(0,0,0,1)";ai.beginPath();ch=A(C(cd,b5[bE]),D,bv,R,Y),b1=ch[0],b0=ch[1];ai.moveTo(b1+p,b0+aB);cf=A(C(cd,C(b5[bE],e(0.1,bW[bE]))),D,bv,R,Y),b1=cf[0],b0=cf[1];ai.lineTo(b1+p,b0+aB);ai.stroke()}ce=Q(bY.xyz);for(b6=0,bF=ce.length;b6<bF;b6++){cc=ce[b6],bQ=cc[0],bU=cc[1];cb=A(C(cd,bY.xyz[bQ]),D,bv,R,Y),b1=cb[0],b0=cb[1]}return bY.xyz=bD};aF=function(){var bE,bH,bG,bD,bF,bI,bC;aR();bF=Q(U);bC=[];for(bG=0,bD=bF.length;bG<bD;bG++){bI=bF[bG],bE=bI[0],bH=bI[1];bC.push(W(bH,[0+3*bE,0,3]))}return bC};bq=function(){var bD,bE,bH,bG,bC,bF,bI;aR();bD=(2*Math.PI)/180*z.getSeconds()*0.1;bF=Q(U);for(bG=0,bC=bF.length;bG<bC;bG++){bI=bF[bG],bE=bI[0],bH=bI[1];W(bH,[0+3*bE,0,3])}return setTimeout(bq,100)};$(function(){var bJ,bI,bG,bE,bD,bC,bL,bF,bK,bH;aP();bC=bx();if("recipe" in bC){bD=[bC.recipe];$("#spec").val(bD)}else{bD=[bl(bc)];$("#spec").val(bD)}bJ=ap();bI=ap();bG=ap().rescale(0.5);bH=bJ.xyz;for(bF=0,bK=bH.length;bF<bK;bF++){bL=bH[bF];bG.translate(e(1,bL));bI=aW(bI,bG);bG.translate(e(-1,bL))}bE=bI;U=[V(bE)];console.log("face count from ",bE.face.length,"to",aY(bE).face.length,"should be",6*8+6);L=_.map(U[0].centers(),function(bM){return bM});by=_.map(U[0].normals(),function(bM){return bM});aF();$("#spec").change(function(bM){bD=$("#spec").val().split(/\s+/g).slice(0,2);U=_.map(bD,function(bN){return al(bN)});return aF()});$("#poly").mousewheel(function(bO,bP,bN,bM){bO.preventDefault();Y*=(10+bP)/10;return aF()});$("#poly").mousedown(function(bM){var bN;bM.preventDefault();av=true;ab=bM.clientX-$(this).offset().left;aa=bM.clientY-$(this).offset().top;bN=aQ(ab,aa,p,aB,D,bv,R,Y);if(bN[0]*bN[1]*bN[2]*0===0){aK=bN}return ar=P(j)});$("#poly").mouseup(function(bM){bM.preventDefault();return av=false});$("#poly").mouseleave(function(bM){bM.preventDefault();return av=false});$("#poly").mousemove(function(bP){var bN,bM,bO;bP.preventDefault();if(av){bN=bP.clientX-$(this).offset().left;bM=bP.clientY-$(this).offset().top;bO=aQ(bN,bM,p,aB,D,bv,R,Y);if(bO[0]*bO[1]*bO[2]*0===0&&aK[0]*aK[1]*aK[2]*0===0){j=aJ(aH(aK,bO),ar)}return aF()}});$("#strokeonly").click(function(bM){h="stroke";return aF()});$("#fillonly").click(function(bM){h="fill";return aF()});$("#fillandstroke").click(function(bM){h="fillstroke";return aF()});$("#siderot").click(function(bM){j=a1(aO/2,0,1,0);return aF()});$("#toprot").click(function(bM){j=a1(aO/2,1,0,0);return aF()});$("#frontrot").click(function(bM){j=i(0,0,0);return aF()});$("#pngsavebutton").click(function(bP){var bO,bN,bM;bO=$("#poly")[0];bM=$("#spec").val().split(/\s+/g)[0];bN="polyhedronisme-"+bM+".png";return bO.toBlob(function(bQ){return saveAs(bQ,bN)})});$("#objsavebutton").click(function(bP){var bN,bO,bM;bO=U[0].toOBJ();bM=$("#spec").val().split(/\s+/g)[0];bN="polyhedronisme-"+bM+".obj";return aI(bO,bN)});return $("#x3dsavebutton").click(function(bP){var bN,bM,bO,bQ;bO=af(U[0],true);bQ=bO.toVRML();bM=$("#spec").val().split(/\s+/g)[0];bN="polyhedronisme-"+bM+".wrl";return aI(bQ,bN)})})}).call(this);