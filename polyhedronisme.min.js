(function(){var o,aN,au,bf,ak,aY,U,T,aA,al,aU,aM,aD,g,ac,aW,x,w,aB,ba,aR,L,at,bb,bd,f,l,aG,J,bc,aZ,G,ar,ab,a6,ag,s,bl,an,B,av,P,aC,ap,Z,t,a2,aj,H,aV,ax,N,i,ai,u,aX,bk,a1,aE,C,D,aF,aa,I,a0,aP,az,d,p,bj,ah,am,ao,a9,E,aQ,O,ad,bh,v,K,y,bg,R,a7,af,aJ,a3,Q,W,q,bi,aH,a5,a4,aw,M,F,r,z,h,V,aK,ay,aT,aL,aI,S,aS,a8,b,j,X,A,e,ae,a,Y,k,be,aO,c,m,aq,n;aH=Math.random;V=Math.round;aj=Math.floor;S=Math.sqrt;aT=Math.sin;G=Math.cos;b=Math.tan;L=Math.asin;aW=Math.acos;at=Math.atan;a3=Math.pow;ac=Math.abs;aD=Math.PI;J=function(bo){var bn,bm;if(!(bo!=null)||typeof bo!=="object"){return bo}bm=new bo.constructor();for(bn in bo){bm[bn]=J(bo[bn])}return bm};a5=function(bn){var bm;bm=aj(aH()*bn.length);return bn[bm]};d=function(bn,bm){return[bn*bm[0],bn*bm[1],bn*bm[2]]};n=function(bn,bm){return[bn[0]*bm[0],bn[1]*bm[1],bn[2]*bm[2]]};x=function(bn,bm){return[bn[0]+bm[0],bn[1]+bm[1],bn[2]+bm[2]]};a8=function(bn,bm){return[bn[0]-bm[0],bn[1]-bm[1],bn[2]-bm[2]]};B=function(bn,bm){return bn[0]*bm[0]+bn[1]*bm[1]+bn[2]*bm[2]};ar=function(bn,bm){return[bn[1]*bm[2]-bn[2]*bm[1],bn[2]*bm[0]-bn[0]*bm[2],bn[0]*bm[1]-bn[1]*bm[0]]};I=function(bm){return S(B(bm,bm))};a0=function(bm){return B(bm,bm)};be=function(bm){return d(1/S(a0(bm)),bm)};aP=function(bn,bm){return d(1/2,x(bn,bm))};k=function(bo,bn,bm){return[(1-bm)*bo[0]+bm*bn[0],(1-bm)*bo[1]+bm*bn[1],(1-bm)*bo[2]+bm*bn[2]]};ao=function(bn,bm){return k(bn,bm,1/3)};aw=function(bm){return d(1/a0(bm),bm)};j=function(bo,bn){var bm;bm=a8(bn,bo);return a8(bo,d(B(bm,bo)/a0(bm),bm))};ap=function(bn,bm){return S(a0(j(bn,bm)))};aQ=function(bq,bp,bo){var bn,bm;bn=a8(bp,bq);bm=a8(bo,bp);return ar(bn,bm)};D=function(bt,bs,br){var bx,bw,bv,bq,bp,bo,bu,bn,bm;for(bq=0,bu=bt.length;bq<bu;bq++){bx=bt[bq];for(bp=0,bn=bs.length;bp<bn;bp++){bw=bs[bp];if(bx===bw){for(bo=0,bm=br.length;bo<bm;bo++){bv=br[bo];if(bx===bv){return bx}}}}}return null};bd=function(bq){var bo,bn,bp,bm;bo=[0,0,0];for(bp=0,bm=bq.length;bp<bm;bp++){bn=bq[bp];bo=x(bo,bn)}return d(1/bq.length,bo)};ah=function(bq){var bm,bu,bs,br,bo,bt,bp,bn;bm=[0,0,0];bp=bq.slice(-2),bu=bp[0],bs=bp[1];for(bo=0,bt=bq.length;bo<bt;bo++){br=bq[bo];bm=x(bm,aQ(bu,bs,br));bn=[bs,br],bu=bn[0],bs=bn[1]}return be(bm)};bc=function(bq){var bm,bu,bs,br,bo,bt,bp,bn;bm=0;bp=bq.slice(0,2),bu=bp[0],bs=bp[1];bn=bq.slice(2);for(bo=0,bt=bn.length;bo<bt;bo++){br=bn[bo];bm+=I(ar(a8(bs,bu),a8(br,bu)));bs=br}return bm};W=function(bt){var br,bn,bm,bq,bu,bv,bp,bs,bo;bq=J(bt);bv=bt[0];bq=_.map(bq,function(bw){return bw-bv});bn=ah(bt);br=be(bd(bt));bm=ar(bn,br);bo=[];for(bp=0,bs=bq.length;bp<bs;bp++){bu=bq[bp];bo.push([B(bn,bu),B(bm,bu)])}return bo};aZ=function(bo){var bn,bm,bp;bm=new Array(bo.length);for(bn=0,bp=bo.length-1;0<=bp?bn<=bp:bn>=bp;0<=bp?bn++:bn--){bm[bn]=bo[bn].slice(0)}return bm};p=function(bn,bm){return[bn[0][0]*bm[0]+bn[0][1]*bm[1]+bn[0][2]*bm[2],bn[1][0]*bm[0]+bn[1][1]*bm[1]+bn[1][2]*bm[2],bn[2][0]*bm[0]+bn[2][1]*bm[1]+bn[2][2]*bm[2]]};az=function(bm,bn){return[[bm[0][0]*bn[0][0]+bm[0][1]*bn[1][0]+bm[0][2]*bn[2][0],bm[0][0]*bn[0][1]+bm[0][1]*bn[1][1]+bm[0][2]*bn[2][1],bm[0][0]*bn[0][2]+bm[0][1]*bn[1][2]+bm[0][2]*bn[2][2]],[bm[1][0]*bn[0][0]+bm[1][1]*bn[1][0]+bm[1][2]*bn[2][0],bm[1][0]*bn[0][1]+bm[1][1]*bn[1][1]+bm[1][2]*bn[2][1],bm[1][0]*bn[0][2]+bm[1][1]*bn[1][2]+bm[1][2]*bn[2][2]],[bm[2][0]*bn[0][0]+bm[2][1]*bn[1][0]+bm[2][2]*bn[2][0],bm[2][0]*bn[0][1]+bm[2][1]*bn[1][1]+bm[2][2]*bn[2][1],bm[2][0]*bn[0][2]+bm[2][1]*bn[1][2]+bm[2][2]*bn[2][2]]]};t=[[1,0,0],[0,1,0],[0,0,1]];h=function(bq,bo,bp){var br,bn,bm;br=[[G(bq),-1*aT(bq),0],[aT(bq),G(bq),0],[0,0,1]];bm=[[G(bo),0,-1*aT(bo)],[0,1,0],[aT(bo),0,G(bo)]];bn=[[1,0,0],[0,G(bp),-1*aT(bp)],[0,aT(bp),G(bp)]];return az(bn,az(bm,br))};aO=function(bq,bz,bx,bu){var bt,bn,bo,by,bw,bm,bv,br,bs,bp;bq/=2;by=aT(bq);bt=G(bq);bw=by*by;bn=I([bz,bx,bu]);if(bn===0){bs=[0,0,1],bz=bs[0],bx=bs[1],bu=bs[2]}if(bn!==1){bp=be([bz,bx,bu]),bz=bp[0],bx=bp[1],bu=bp[2]}if(bz===1&&bx===0&&bu===0){bo=[[1,0,0],[0,1-2*bw,2*by*bt],[0,-2*by*bt,1-2*bw]]}else{if(bz===0&&bx===1&&bu===0){bo=[[1-2*bw,0,-2*by*bt],[0,1,0],[2*by*bt,0,1-2*bw]]}else{if(bz===0&&bx===0&&bu===1){bo=[[1-2*bw,2*by*bt,0],[-2*by*bt,1-2*bw,0],[0,0,1]]}else{bm=bz*bz;bv=bx*bx;br=bu*bu;bo=[[1-2*(bv+br)*bw,2*(bz*bx*bw+bu*by*bt),2*(bz*bu*bw-bx*by*bt)],[2*(bx*bz*bw-bu*by*bt),1-2*(br+bm)*bw,2*(bx*bu*bw+bz*by*bt)],[2*(bu*bz*bw+bx*by*bt),2*(bu*bx*bw-bz*by*bt),1-2*(bm+bv)*bw]]}}}return bo};v=function(bo,bn,bp,bs,bm){var bq,br;br=(bn*bs-bp)/(1-bs);bq=bm*bs/(1-bs);return[bq*bo[0]/(bo[2]+br),bq*bo[1]/(bo[2]+br)]};aF=function(bt,bq,bw,bu,bA,bp,bo,bn){var bz,bm,bv,br,bx,bC,bE,bs,by,bB,bD;by=(bA*bo-bp)/(1-bo);bz=bn*bo/(1-bo);bv=bt-bw;bC=bq-bu;bm=bz*bz;bB=by*by;br=bv*bv;bE=bC*bC;bx=(2*bz*bv*by+S(4*bm*br*bB+4*br*(bm+br+bE)*(1-bB)))/(2*(bm+br+bE));bs=(bz*bC*by)/(bm+br+bE)+(bC*S(4*bm*bB+4*(bm+br+bE)*(1-bB)))/(2*(bm+br+bE));bD=S(1-bx*bx-bs*bs);return[bx,bs,bD]};ax=function(bo,bn){var bp,bm;bm=ar(bo,bn);bp=aW(B(bo,bn));return aO(-1*bp,bm[0],bm[1],bm[2])};a2=function(bp){var bn,br,bq,bo,bm;bn=[];br=bp.slice(-1)[0];for(bo=0,bm=bp.length;bo<bm;bo++){bq=bp[bo];bn.push([br,bq]);br=bq}return bn};c=function(bm){var br,bq,bu,bs,bo,bt,bn,bp;bs=[];bp=bm.face;for(bq=0,bt=bp.length;bq<bt;bq++){br=bp[bq];for(bo=0,bn=br.length;bo<bn;bo++){bu=br[bo];bs[bu]=bm.face_class[bq]}}return bs};aK=["#ff7777","#dddddd","#889999","#fff0e5","#aa3333","#ff0000","#ffffff","#aaaaaa"];bk=function(bn){var bm;if(bn[0]==="#"){bn=bn.slice(1)}if(bn.length===3){bm=bn.split("").map(function(bo){return parseInt(bo+bo,16)/255})}else{bm=bn.match(/.{2}/g).map(function(bo){return parseInt(bo,16)/255})}return bm};aU=aK;ad=function(bm){if(bm<aU.length){return bk(aU[bm])}else{return bk(aU[aU.length-1])}};O=function(bm){var bv,bn,br,bq,bt,bu,bo,bs,bp;bm.face_class=[];br={};bn=function(bw,bz){var bx,by;by=V(100*bw);if(by in bz){return bz[by]}else{bx=_.toArray(bz).length;bz[by]=bx;return bx}};bp=bm.face;for(bo=0,bs=bp.length;bo<bs;bo++){bq=bp[bo];if(ak==="area"){bt=(function(){var by,bw,bx;bx=[];for(by=0,bw=bq.length;by<bw;by++){bu=bq[by];bx.push(bm.xyz[bu])}return bx})();bv=bn(bc(bt),br)}else{bv=bq.length-3}bm.face_class.push(bv)}console.log(_.toArray(br).length+" face classes");return bm};aL=function(bm){var bn,bv,bu,bw,bq,bo,bt,br,bs,bp;bn=bm.centers();bu=bm.normals();bq=[0,0,(y*K-bg)/(1-K)];bw=function(by,bx){return -B(a8(bq,by[0]),by[1])*B(a8(bx[0],by[0]),by[1])};bo=function(by,bx){return by[0][2]-bx[0][2]};bt=_.zip(bn,bu,(function(){bp=[];for(var by=0,bx=bm.face.length-1;0<=bx?by<=bx:by>=bx;0<=bx?by++:by--){bp.push(by)}return bp}).apply(this)).sort(bo).map(function(bx){return bx[2]});bm.face=(function(){var bz,bx,by;by=[];for(bz=0,bx=bt.length;bz<bx;bz++){bv=bt[bz];by.push(bm.face[bv])}return by})();return bm.face_class=(function(){var bz,bx,by;by=[];for(bz=0,bx=bt.length;bz<bx;bz++){bv=bt[bz];by.push(bm.face_class[bv])}return by})()};aJ=(function(){function bm(bp,bn,bo){this.face=bn||new Array();this.xyz=bp||new Array();this.name=bo||"null polyhedron"}bm.prototype.data=function(){var bn;bn=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bn+" edges, "+this.xyz.length+" vertices)"};bm.prototype.getEdges=function(){var bx,bt,bv,bu,bo,bs,br,by,bq,bp,bw,bn;bs={};by=[];bt=_.map(this.face,a2);for(bq=0,bw=bt.length;bq<bw;bq++){bo=bt[bq];for(bp=0,bn=bo.length;bp<bn;bp++){bu=bo[bp];if(bu[0]<bu[1]){bx=bu[0],bv=bu[1]}else{bv=bu[0],bx=bu[1]}bs[bx+"~"+bv]=bu}}for(br in bs){bu=bs[br];by.push(bu)}return by};bm.prototype.centers=function(){var bs,bt,bp,bv,bq,bo,bu,bn,br;bs=[];br=this.face;for(bq=0,bu=br.length;bq<bu;bq++){bt=br[bq];bp=[0,0,0];for(bo=0,bn=bt.length;bo<bn;bo++){bv=bt[bo];bp=x(bp,this.xyz[bv])}bs.push(d(1/bt.length,bp))}return bs};bm.prototype.normals=function(){var br,bs,bo,bq,bn,bp;bs=[];bp=this.face;for(bq=0,bn=bp.length;bq<bn;bq++){br=bp[bq];bs.push(ah((function(){var bv,bt,bu;bu=[];for(bv=0,bt=br.length;bv<bt;bv++){bo=br[bv];bu.push(this.xyz[bo])}return bu}).call(this)))}return bs};bm.prototype.toOBJ=function(){var bx,bw,bo,by,bA,bu,bt,bs,bz,bp,bn,bB,bv,br,bq;by="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";by+="group "+this.name+"\n";by+="#vertices\n";bv=this.xyz;for(bu=0,bz=bv.length;bu<bz;bu++){bA=bv[bu];by+="v "+bA[0]+" "+bA[1]+" "+bA[2]+"\n"}by+="#normal vector defs \n";br=this.face;for(bt=0,bp=br.length;bt<bp;bt++){bx=br[bt];bo=ah((function(){var bD,bE,bC;bC=[];for(bD=0,bE=bx.length;bD<bE;bD++){bA=bx[bD];bC.push(this.xyz[bA])}return bC}).call(this));by+="vn "+bo[0]+" "+bo[1]+" "+bo[2]+"\n"}by+="#face defs \n";bq=this.face;for(bw=0,bn=bq.length;bw<bn;bw++){bx=bq[bw];by+="f ";for(bs=0,bB=bx.length;bs<bB;bs++){bA=bx[bs];by+=""+(bA+1)+"//"+(bw+1)+" "}by+="\n"}return by};bm.prototype.toX3D=function(){var br,bA,bD,bx,bz,bB,bv,bu,bt,bq,by,bo,bn,bC,bw,bs,bp;br=0.01;bB='<?xml version="1.0" encoding ="UTF-8"?>\n<X3D profile="Interchange" version="3.0">\n<head>\n<component name="Rendering" level="3"/>\n<meta name="generator" content="Polyhedronisme"/>\n<meta name="version" content="0.1.0"/>\n</head>\n<Scene>\n<Shape>\n<IndexedFaceSet normalPerVertex="false" coordIndex="';bw=this.face;for(bv=0,by=bw.length;bv<by;bv++){bx=bw[bv];for(bu=0,bo=bx.length;bu<bo;bu++){bz=bx[bu];bB+=""+bz+" "}bB+="-1\n"}bB+='">\n';bB+='<Color color="';bs=c(this);for(bt=0,bn=bs.length;bt<bn;bt++){bA=bs[bt];bD=ad(bA);bB+=""+bD[0]+" "+bD[1]+" "+bD[2]+" "}bB+='"/>';bB+='<Coordinate point="';bp=this.xyz;for(bq=0,bC=bp.length;bq<bC;bq++){bz=bp[bq];bB+=""+(bz[0]*br)+" "+(bz[1]*br)+" "+(bz[2]*br)+" "}bB+='"/>\n';bB+="</IndexedFaceSet>\n</Shape>\n</Scene>\n</X3D>";return bB};bm.prototype.toVRML=function(){var br,bA,bD,bx,bz,bB,bv,bu,bt,bq,by,bo,bn,bC,bw,bs,bp;br=0.01;bB='#VRML V2.0 utf8\n#Generated by Polyhedronisme\nNavigationInfo {\n	type [ "EXAMINE", "ANY" ]\n}\nTransform {\n  scale 1 1 1\n  translation 0 0 0\n  children\n  [\n    Shape\n    {\n      geometry IndexedFaceSet\n      {\n        creaseAngle .5\n        solid FALSE\n        coord Coordinate\n        {\n          point\n          [';bw=this.xyz;for(bv=0,by=bw.length;bv<by;bv++){bz=bw[bv];bB+=""+(bz[0]*br)+" "+(bz[1]*br)+" "+(bz[2]*br)+","}bB=bB.slice(0,-1);bB+="    ]\n}\ncolor Color\n{\n  color\n  [";bs=this.face_class;for(bu=0,bo=bs.length;bu<bo;bu++){bA=bs[bu];bD=ad(bA);bB+=""+bD[0]+" "+bD[1]+" "+bD[2]+" ,"}bB=bB.slice(0,-1);bB+="  ]\n}\ncolorPerVertex FALSE\ncoordIndex\n[";bp=this.face;for(bt=0,bn=bp.length;bt<bn;bt++){bx=bp[bt];for(bq=0,bC=bx.length;bq<bC;bq++){bz=bx[bq];bB+=""+bz+", "}bB+="-1,"}bB=bB.slice(0,-1);bB+="          ]\n      }\n      appearance Appearance\n      {\n        material Material\n        {\n	       ambientIntensity 0.2\n	       diffuseColor 0.9 0.9 0.9\n	       specularColor .1 .1 .1\n	       shininess .5\n        }\n      }\n    }\n  ]\n}";return bB};return bm})();e=function(){var bm;bm=new aJ();bm.name="T";bm.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bm.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bm};am=function(){var bm;bm=new aJ();bm.name="O";bm.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bm.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bm};ag=function(){var bm;bm=new aJ();bm.name="C";bm.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bm.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bm};a1=function(){var bm;bm=new aJ();bm.name="I";bm.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bm.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bm};an=function(){var bm;bm=new aJ();bm.name="D";bm.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bm.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bm};Q=function(bq){var bz,by,bm,bo,bw,bv,bx,bt,br,bp,bn,bu,bs;bo=2*aD/bq;bz=Math.sin(bo/2);bm=new aJ();bm.name="P"+bq;for(by=0,bx=bq-1;0<=bx?by<=bx:by>=bx;0<=bx?by++:by--){bm.xyz.push([-G(by*bo),-aT(by*bo),-bz])}for(by=0,bt=bq-1;0<=bt?by<=bt:by>=bt;0<=bt?by++:by--){bm.xyz.push([-G(by*bo),-aT(by*bo),bz])}bm.face.push((function(){bu=[];for(var bA=br=bq-1;br<=0?bA<=0:bA>=0;br<=0?bA++:bA--){bu.push(bA)}return bu}).apply(this));bm.face.push((function(){bs=[];for(var bA=bq,bB=2*bq-1;bq<=bB?bA<=bB:bA>=bB;bq<=bB?bA++:bA--){bs.push(bA)}return bs}).apply(this));for(by=0,bn=bq-1;0<=bn?by<=bn:by>=bn;0<=bn?by++:by--){bm.face.push([by,(by+1)%bq,(by+1)%bq+bq,by+bq])}bm=w(bm,1);return bm};aR=function(br){var bB,bA,bz,bn,bm,bp,bx,bw,by,bu,bs,bq,bo,bv,bt;bp=2*aD/br;bA=S(1-4/(4+2*G(bp/2)-2*G(bp)));bm=S(1-bA*bA);bB=S(bA*bA+a3(bm*G(bp/2),2));bm=-bm/bB;bA=-bA/bB;bn=new aJ();bn.name="A"+br;for(bz=0,by=br-1;0<=by?bz<=by:bz>=by;0<=by?bz++:bz--){bn.xyz.push([bm*G(bz*bp),bm*aT(bz*bp),bA])}for(bz=0,bu=br-1;0<=bu?bz<=bu:bz>=bu;0<=bu?bz++:bz--){bn.xyz.push([bm*G((bz+0.5)*bp),bm*aT((bz+0.5)*bp),-bA])}bn.face.push((function(){bv=[];for(var bC=bs=br-1;bs<=0?bC<=0:bC>=0;bs<=0?bC++:bC--){bv.push(bC)}return bv}).apply(this));bn.face.push((function(){bt=[];for(var bC=br,bD=2*br-1;br<=bD?bC<=bD:bC>=bD;br<=bD?bC++:bC--){bt.push(bC)}return bt}).apply(this));for(bz=0,bo=br-1;0<=bo?bz<=bo:bz>=bo;0<=bo?bz++:bz--){bn.face.push([bz,(bz+1)%br,bz+br]);bn.face.push([bz,bz+br,(br+bz-1)%br+br])}bn=w(bn,1);return bn};bi=function(bo){var bv,bu,bm,bn,bs,bt,bq,bp,br;bn=2*aD/bo;bv=1;bm=new aJ();bm.name="Y"+bo;for(bu=0,bt=bo-1;0<=bt?bu<=bt:bu>=bt;0<=bt?bu++:bu--){bm.xyz.push([-G(bu*bn),-aT(bu*bn),-0.2])}bm.xyz.push([0,0,bv]);bm.face.push((function(){br=[];for(var bw=bq=bo-1;bq<=0?bw<=0:bw>=0;bq<=0?bw++:bw--){br.push(bw)}return br}).apply(this));for(bu=0,bp=bo-1;0<=bp?bu<=bp:bu>=bp;0<=bp?bu++:bu--){bm.face.push([bu,(bu+1)%bo,bo])}bm=f(bm,3);return bm};af=(function(){function bm(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bm.prototype.newV=function(bo,bn){if(this.verts[bo]===void 0){this.verts[bo]=0;return this.xyzs[bo]=bn}};bm.prototype.newFlag=function(bn,bp,bo){if(this.flags[bn]===void 0){this.flags[bn]={}}return this.flags[bn][bp]=bo};bm.prototype.topoly=function(){var bo,bt,bw,bs,bq,bn,bu,bv,br,bp;bn=new aJ();bo=0;br=this.verts;for(bs in br){bu=br[bs];bn.xyz[bo]=this.xyzs[bs];this.verts[bs]=bo;bo++}bo=0;bp=this.flags;for(bs in bp){bt=bp[bs];bn.face[bo]=[];for(bq in bt){bu=bt[bq];bv=bu;break}bu=bv;bn.face[bo].push(this.verts[bu]);bu=this.flags[bs][bu];bw=0;while(bu!==bv){bn.face[bo].push(this.verts[bu]);bu=this.flags[bs][bu];bw++;if(bw>1000){console.log("Bad flag spec, have a neverending face:",bs,this.flags[bs]);break}}bo++}bn.name="unknown polyhedron";return bn};return bm})();aa=function(bt,bz,bs){var br,bD,bC,bA,bG,bq,bB,bv,bx,by,bw,bp,bm,bn,bF,bH,bE,bu,bo;bz||(bz=0);bs||(bs=0.1);console.log("Taking kis of "+(bz===0?"":bz)+"-sided faces of "+bt.name+"...");bA=new af();bu=bt.xyz;for(bB=0,bF=bu.length;bB<bF;bB++){by=bu[bB];bA.newV("v"+bB,by)}bx=bt.normals();bD=bt.centers();bq=false;bo=bt.face;for(bB=0,bH=bo.length;bB<bH;bB++){bC=bo[bB];bp="v"+bC[bC.length-1];for(bn=0,bE=bC.length;bn<bE;bn++){bw=bC[bn];bm="v"+bw;if(bC.length===bz||bz===0){bq=true;br="apex"+bB;bG=""+bB+bp;bA.newV(br,x(bD[bB],d(bs,bx[bB])));bA.newFlag(bG,bp,bm);bA.newFlag(bG,bm,br);bA.newFlag(bG,br,bp)}else{bA.newFlag(""+bB,bp,bm)}bp=bm}}if(!bq){console.log("No "+bz+"-fold components were found.")}bv=bA.topoly();bv.name="k"+(bz===0?"":bz)+bt.name;return bv};aB=function(bn){var bv,bw,bu,bo,br,bA,bz,bx,bs,by,bm,bt,bq,bp;console.log("Taking ambo of "+bn.name+"...");bo=function(bC,bB){if(bC<bB){return bC+"_"+bB}else{return bB+"_"+bC}};bw=new af();bt=bn.face;for(bu=0,by=bt.length;bu<by;bu++){bv=bt[bu];bq=bv.slice(-2),bA=bq[0],bz=bq[1];for(bs=0,bm=bv.length;bs<bm;bs++){bx=bv[bs];if(bA<bz){bw.newV(bo(bA,bz),aP(bn.xyz[bA],bn.xyz[bz]))}bw.newFlag("orig"+bu,bo(bA,bz),bo(bz,bx));bw.newFlag("dual"+bz,bo(bz,bx),bo(bA,bz));bp=[bz,bx],bA=bp[0],bz=bp[1]}}br=bw.topoly();br.name="a"+bn.name;return br};aX=function(bt){var bB,bA,by,bE,bz,bx,bv,bw,bs,bq,bo,bD,bG,bF,bC,bu,br,bp,bn,bm;console.log("Taking gyro of "+bt.name+"...");by=new af();bu=bt.xyz;for(bz=0,bD=bu.length;bz<bD;bz++){bw=bu[bz];by.newV("v"+bz,be(bw))}bB=bt.centers();br=bt.face;for(bz=0,bG=br.length;bz<bG;bz++){bA=br[bz];by.newV("center"+bz,be(bB[bz]))}bp=bt.face;for(bz=0,bF=bp.length;bz<bF;bz++){bA=bp[bz];bn=bA.slice(-2),bs=bn[0],bq=bn[1];for(bx=0,bC=bA.length;bx<bC;bx++){bw=bA[bx];bo=bw;by.newV(bs+"~"+bq,ao(bt.xyz[bs],bt.xyz[bq]));bE=bz+"f"+bs;by.newFlag(bE,"center"+bz,bs+"~"+bq);by.newFlag(bE,bs+"~"+bq,bq+"~"+bs);by.newFlag(bE,bq+"~"+bs,"v"+bq);by.newFlag(bE,"v"+bq,bq+"~"+bo);by.newFlag(bE,bq+"~"+bo,"center"+bz);bm=[bq,bo],bs=bm[0],bq=bm[1]}}bv=by.topoly();bv.name="g"+bt.name;return bv};q=function(bt){var bz,bx,bB,by,bv,bw,br,bo,bn,bp,bA,bD,bC,bu,bs,bq,bm;console.log("Taking propellor of "+bt.name+"...");bx=new af();bu=bt.xyz;for(by=0,bA=bu.length;by<bA;by++){bw=bu[by];bx.newV("v"+by,be(bw))}bs=bt.face;for(by=0,bD=bs.length;by<bD;by++){bz=bs[by];bq=bz.slice(-2),br=bq[0],bo=bq[1];for(bp=0,bC=bz.length;bp<bC;bp++){bw=bz[bp];bn=""+bw;bx.newV(br+"~"+bo,ao(bt.xyz[br],bt.xyz[bo]));bB=""+by+"f"+bo;bx.newFlag("v"+by,br+"~"+bo,bo+"~"+bn);bx.newFlag(bB,br+"~"+bo,bo+"~"+br);bx.newFlag(bB,bo+"~"+br,"v"+bo);bx.newFlag(bB,"v"+bo,bo+"~"+bn);bx.newFlag(bB,bo+"~"+bn,br+"~"+bo);bm=[bo,bn],br=bm[0],bo=bm[1]}}bv=bx.topoly();bv.name="p"+bt.name;return bv};r=function(bo){var bm,bn,bp;console.log("Taking reflection of "+bo.name+"...");for(bm=0,bn=bo.xyz.length-1;0<=bn?bm<=bn:bm>=bn;0<=bn?bm++:bm--){bo.xyz[bm]=d(-1,bo.xyz[bm])}for(bm=0,bp=bo.face.length-1;0<=bp?bm<=bp:bm>=bp;0<=bp?bm++:bm--){bo.face[bm]=bo.face[bm].reverse()}bo.name="r"+bo.name;return bo};aC=function(bv){var bD,bJ,bC,bw,bA,bB,bz,by,bu,br,bs,bp,bn,bG,bI,bH,bF,bE,bx,bt,bq,bo,bm;console.log("Taking dual of "+bv.name+"...");bA=new af();bw=[];for(bB=0,bx=bv.xyz.length-1;0<=bx?bB<=bx:bB>=bx;0<=bx?bB++:bB--){bw[bB]={}}bt=bv.face;for(bB=0,bG=bt.length;bB<bG;bB++){bC=bt[bB];bu=bC[bC.length-1];for(bs=0,bI=bC.length;bs<bI;bs++){br=bC[bs];bw[bu]["v"+br]=""+bB;bu=br}}bD=bv.centers();for(bB=0,bq=bv.face.length-1;0<=bq?bB<=bq:bB>=bq;0<=bq?bB++:bB--){bA.newV(""+bB,bD[bB])}bo=bv.face;for(bB=0,bH=bo.length;bB<bH;bB++){bC=bo[bB];bu=bC[bC.length-1];for(bp=0,bF=bC.length;bp<bF;bp++){br=bC[bp];bA.newFlag(bu,bw[br]["v"+bu],""+bB);bu=br}}bJ=bA.topoly();by=[];bm=bJ.face;for(bn=0,bE=bm.length;bn<bE;bn++){bC=bm[bn];bz=D(bv.face[bC[0]],bv.face[bC[1]],bv.face[bC[2]]);by[bz]=bC}bJ.face=by;if(bv.name[0]!=="d"){bJ.name="d"+bv.name}else{bJ.name=bv.name.slice(1)}return bJ};C=function(bt,bA,bu,bB){var bF,bE,bC,bK,bs,bD,bw,by,bz,bx,br,bo,bp,bm,bJ,bL,bI,bH,bG,bv,bq,bn;bA||(bA=0);bu||(bu=0.5);bB||(bB=-0.2);console.log("Taking inset of "+(bA===0?"":bA)+"-sided faces of "+bt.name+"...");bC=new af();bv=bt.xyz;for(bD=0,bJ=bv.length;bD<bJ;bD++){bz=bv[bD];bC.newV("v"+bD,bz)}by=bt.normals();bF=bt.centers();bq=bt.face;for(bD=0,bL=bq.length;bD<bL;bD++){bE=bq[bD];if(bE.length===bA||bA===0){for(bp=0,bI=bE.length;bp<bI;bp++){bx=bE[bp];bC.newV("f"+bD+"v"+bx,x(k(bt.xyz[bx],bF[bD],bu),d(bB,by[bD])))}}}bs=false;bn=bt.face;for(bD=0,bH=bn.length;bD<bH;bD++){bE=bn[bD];br="v"+bE[bE.length-1];for(bm=0,bG=bE.length;bm<bG;bm++){bx=bE[bm];bo="v"+bx;if(bE.length===bA||bA===0){bs=true;bK=bD+br;bC.newFlag(bK,br,bo);bC.newFlag(bK,bo,"f"+bD+bo);bC.newFlag(bK,"f"+bD+bo,"f"+bD+br);bC.newFlag(bK,"f"+bD+br,br);bC.newFlag("ex"+bD,"f"+bD+br,"f"+bD+bo)}else{bC.newFlag(bD,br,bo)}br=bo}}if(!bs){console.log("No "+bA+"-fold components were found.")}bw=bC.topoly();bw.name="n"+(bA===0?"":bA)+bt.name;return bw};Z=function(bt,bz){var bD,bC,bA,bs,bB,bv,bx,by,bw,br,bo,bp,bm,bH,bI,bG,bF,bE,bu,bq,bn;bz||(bz=0);console.log("Taking extrusion of "+(bz===0?"":bz)+"-sided faces of "+bt.name+"...");bA=new af();bu=bt.xyz;for(bB=0,bH=bu.length;bB<bH;bB++){by=bu[bB];bA.newV("v"+bB,by)}bx=bt.normals();bD=bt.centers();bq=bt.face;for(bB=0,bI=bq.length;bB<bI;bB++){bC=bq[bB];if(bC.length===bz||bz===0){for(bp=0,bG=bC.length;bp<bG;bp++){bw=bC[bp];bA.newV("f"+bB+"v"+bw,x(bt.xyz[bw],d(0.3,bx[bB])))}}}bs=false;bn=bt.face;for(bB=0,bF=bn.length;bB<bF;bB++){bC=bn[bB];br="v"+bC[bC.length-1];for(bm=0,bE=bC.length;bm<bE;bm++){bw=bC[bm];bo="v"+bw;if(bC.length===bz||bz===0){bs=true;bA.newFlag(bB+br,br,bo);bA.newFlag(bB+br,bo,"f"+bB+bo);bA.newFlag(bB+br,"f"+bB+bo,"f"+bB+br);bA.newFlag(bB+br,"f"+bB+br,br);bA.newFlag("ex"+bB,"f"+bB+br,"f"+bB+bo)}else{bA.newFlag(bB,br,bo)}br=bo}}if(!bs){console.log("No "+bz+"-fold components were found.")}bv=bA.topoly();bv.name="x"+(bz===0?"":bz)+bt.name;return bv};aS=function(bv){var bG,bF,bD,bE,bA,bC,bB,bs,bH,bq,bu,bt,bn,by,bx,bw,bp,bJ,bK,bI,bz,br,bo,bm;console.log("Taking stella of "+bv.name+"...");bG=bv.centers();bD=new af();bz=bv.xyz;for(bE=0,bJ=bz.length;bE<bJ;bE++){bC=bz[bE];bD.newV("v"+bE,bC)}br=bv.face;for(bE=0,bK=br.length;bE<bK;bE++){bF=br[bE];bs="v"+bF[bF.length-2];bq="v"+bF[bF.length-1];by=bv.xyz[bF[bF.length-2]];bx=bv.xyz[bF[bF.length-1]];for(bp=0,bI=bF.length;bp<bI;bp++){bB=bF[bp];bn="v"+bB;bw=bv.xyz[bB];bH=bs+"~"+bq;bu=bq+"~"+bs;bt=bq+"~"+bn;bD.newV(bH,aP(aP(by,bx),bG[bE]));bD.newFlag("in"+bE,bH,bt);bD.newFlag("f"+bE+bq,bt,bH);bD.newFlag("f"+bE+bq,bH,bq);bD.newFlag("f"+bE+bq,bq,bt);bD.newFlag("f"+bH,bs,bu);bD.newFlag("f"+bH,bu,bH);bD.newFlag("f"+bH,bH,bs);bo=[bq,bn],bs=bo[0],bq=bo[1];bm=[bx,bw],by=bm[0],bx=bm[1]}}bA=bD.topoly();bA.name="*"+bv.name;return bA};X=function(bp,bo){var bt,br,bq,bm,bu,bn,bs;bt=0.1;bm=aZ(bp);for(bn=0,bs=bo.length;bn<bs;bn++){bq=bo[bn];bu=j(bm[bq[0]],bm[bq[1]]);br=d(bt*1/2*(1-S(B(bu,bu))),bu);bm[bq[0]]=x(bm[bq[0]],br);bm[bq[1]]=x(bm[bq[1]],br)}return bm};a4=function(bq,bp){var bt,br,bm,bn,bu,bo,bs;bm=(function(){var by,bw,bx,bv;bv=[];for(by=0,bw=bp.length;by<bw;by++){bx=bp[by],bt=bx[0],br=bx[1];bv.push(j(bq[bt],bq[br]))}return bv})();bn=[0,0,0];for(bo=0,bs=bm.length;bo<bs;bo++){bu=bm[bo];bn=x(bn,bu)}bn=d(1/bp.length,bn);return _.map(bq,function(bv){return a8(bv,bn)})};z=function(bp){var bm,bo,bn;bo=[0,0,0];bm=_.max(_.map(bp,function(bq){return I(bq)}));bn=1/bm;return _.map(bp,function(bq){return[bn*bq[0],bn*bq[1],bn*bq[2]]})};a7=function(bs,bp){var bx,bu,bw,bt,bo,bm,by,br,bq,bv,bn;bx=0.1;bm=aZ(bs);for(br=0,bv=bp.length;br<bv;br++){bt=bp[br];bw=(function(){var bB,bz,bA;bA=[];for(bB=0,bz=bt.length;bB<bz;bB++){by=bt[bB];bA.push(bs[by])}return bA})();bo=ah(bw);bu=bd(bw);if(B(bo,bu)<0){bo=d(-1,bo)}for(bq=0,bn=bt.length;bq<bn;bq++){by=bt[bq];bm[by]=x(bm[by],d(B(d(bx,bo),a8(bu,bs[by])),bo))}}return bm};l=function(bn,bt){var bq,bo,br,bs,bm,bp,bu;bt||(bt=1);console.log("Canonicalizing "+bn.name+"...");bo=bn.face;bq=bn.getEdges();bm=bn.xyz;bs=1;for(br=0;0<=bt?br<=bt:br>=bt;0<=bt?br++:br--){bu=aZ(bm);bm=X(bm,bq);bm=a4(bm,bq);bm=a7(bm,bo);bs=_.max(_.map(_.zip(bm,bu),function(bw){var bv,bx;bv=bw[0],bx=bw[1];return I(a8(bv,bx))}));if(bs<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bs+"]");bp=new aJ(bm,bn.face,bn.name);console.log("canonicalize",bp);return bp};M=function(bp){var bq,bn,bo,bm;bn=bp.centers();for(bo=0,bm=bn.length;bo<bm;bo++){bq=bn[bo];bq=d(1/B(bq,bq),bq)}return bn};F=function(bo){var bC,bw,bp,bx,bm,bv,bB,bA,by,bt,bs,bz,bn,bu,br,bq;bC=[];bu=bo.face;for(bt=0,bz=bu.length;bt<bz;bt++){bx=bu[bt];bp=[0,0,0];bm=[0,0,0];bw=0;br=bx.slice(-2),bB=br[0],bA=br[1];for(bs=0,bn=bx.length;bs<bn;bs++){by=bx[bs];bp=x(bp,bo.xyz[by]);bm=x(bm,aQ(bo.xyz[bB],bo.xyz[bA],bo.xyz[by]));bw+=ap(bo.xyz[bB],bo.xyz[bA]);bq=[bA,by],bB=bq[0],bA=bq[1]}bp=d(1/bx.length,bp);bm=be(bm);bw=bw/bx.length;bv=aw(d(B(bp,bm),bm));bC.push(d((1+bw)/2,bv))}return bC};f=function(bq,bn){var bo,bm,bp;bn||(bn=1);bm=aC(bq);console.log("Pseudo-canonicalizing "+bq.name+"...");for(bo=0,bp=bn-1;0<=bp?bo<=bp:bo>=bp;0<=bp?bo++:bo--){bm.xyz=F(bq);bq.xyz=F(bm)}return new aJ(bq.xyz,bq.face,bq.name)};w=function(bq,bn){var bo,bm,bp;bn||(bn=1);bm=aC(bq);console.log("Planarizing "+bq.name+"...");for(bo=0,bp=bn-1;0<=bp?bo<=bp:bo>=bp;0<=bp?bo++:bo--){bm.xyz=M(bq);bq.xyz=M(bm)}return new aJ(bq.xyz,bq.face,bq.name)};H=function(bO){var bN,bJ,bE,bH,bM,bw,bP,bG,bC,by,bL,bs,bI,bD,bu,bv,bx,bF,bK,bt,br,bq,bn,bm,bB,bz,bp,bA,bo;bx=999;bI=[];bD=[];bu=bO.length;bL=function(bQ,bR){return(bQ||bR)&&!(bQ&&bR)};bN=function(bS,bR,bQ){return(bR[0]-bS[0])*(bQ[1]-bS[1])-(bQ[0]-bS[0])*(bR[1]-bS[1])};bC=function(bS,bR,bQ){return bN(bS,bR,bQ)>0};by=function(bS,bR,bQ){return bN(bS,bR,bQ)>=0};bE=function(bS,bR,bQ){return bN(bS,bR,bQ)===0};bJ=function(bS,bR,bQ){if(bE(bS,bR,bQ)){return false}if(bS[0]!==bR[0]){return(bS[0]<=bQ[0])&&(bQ[0]<=bR[0])||(bS[0]>=bQ[0])&&(bQ[0]>=bR[0])}else{return(bS[1]<=bQ[1])&&(bQ[1]<=bR[1])||(bS[1]>=bQ[1])&&(bQ[1]>=bR[1])}};bG=function(bT,bS,bR,bQ){if(bE(bT,bS,bR)||bE(bT,bS,bQ)||bE(bR,bQ,bT)||bE(bR,bQ,bS)){return false}return bL(bC(bT,bS,bR),bC(bT,bS,bQ))&&bL(bC(bR,bQ,bT),bC(bR,bQ,bS))};bP=function(bT,bS,bR,bQ){if(bG(bT,bS,bR,bQ)){return true}else{if(bJ(bT,bS,bR)||bJ(bT,bS,bQ)||bJ(bR,bQ,bT)||bJ(bR,bQ,bS)){return true}else{return false}}};bw=function(bS,bQ){var bT,bR;bR=(bS+1+bu)%bu;bT=(bS-1+bu)%bu;if(by(bO[bS],bO[bR],bO[bT])){return bC(bO[bS],bO[bQ],bO[bT])&&bC(bO[bQ],bO[bS],bO[bR])}return !(by(bO[bS],bO[bQ],bO[bR])&&by(bO[bQ],bO[bS],bO[bT]))};bM=function(bR,bQ){var bT,bS;bT=0;while(true){bS=(bT+1+bu)%bu;if((bT!==bR)&&(bS!==bR)&&(bT!==bQ)&&(bS!==bQ)&&bG(bO[bR],bO[bQ],bO[bT],bO[bS])){return false}bT=(bT+1+bu)%bu;if(bT===0){break}}return true};bH=function(bR,bQ){return bw(bR,bQ)&&bw(bQ,bR)&&bM(bR,bQ)};br=0;while(true){bq=(br+1+bu)%bu;bt=(br-1+bu)%bu;bD[br]=bH(bt,bq);br=(br+1+bu)%bu;if(br===0){break}}bK=(function(){bo=[];for(var bR=0,bQ=bu-1;0<=bQ?bR<=bQ:bR>=bQ;0<=bQ?bR++:bR--){bo.push(bR)}return bo}).apply(this);bF=bu;bz=bx;bv=0;while(bz>0&&bF>3){bz-=1;bq=bv;bB=bx;while(true){bB-=1;bs=false;if(bD[bq]){bn=(bq+1+bu)%bu;bm=(bn+1+bu)%bu;br=(bq-1+bu)%bu;bt=(br-1+bu)%bu;bI.push([bK[br],bK[bn]]);bD[br]=bH(bt,bn);bD[bn]=bH(br,bm);bO=bO.slice(0,bq+1||9000000000).concat(bO.slice(bn));bK=bK.slice(0,bq+1||9000000000).concat(bK.slice(bn));if(bt>bq){bt-=1}if(br>bq){br-=1}if(bn>bq){bn-=1}if(bm>bq){bm-=1}bu--;bv=bn;bF--;bs=true}bq=(bq+1+bu)%bu;if(!(bB>0&&!bs&&bq!==bv)){break}}}return bI};a=function(bn,bm){if(((bn[0]===bm[0])&&(bn[1]===bm[1])&&(bn[2]===bm[2]))||(bn[0]===bm[1])&&(bn[1]===bm[2])&&(bn[2]===bm[0])||(bn[0]===bm[2])&&(bn[1]===bm[0])&&(bn[2]===bm[1])){return true}else{return false}};s=function(bT,bG){var bD,bU,bF,bE,bB,bH,bR,bn,bx,bV,bY,bX,bW,bS,bQ,bP,bO,bC,bu,bt,bs,br,bq,bp,bo,bm,bN,bM,bL,bK,bJ,bI,bA,bz,by,bw,bv;bB=[];bn=[];bI=(function(){var b0,bZ;bZ=[];for(bR=0,b0=bT.length-1;0<=b0?bR<=b0:bR>=b0;0<=b0?bR++:bR--){bZ.push([bR,(bR+1)%bT.length])}return bZ})();for(bS=0,bC=bI.length;bS<bC;bS++){bA=bI[bS],bX=bA[0],bW=bA[1];bB[bX]=[bW];bn[bW]=[bX]}for(bQ=0,bu=bG.length;bQ<bu;bQ++){bU=bG[bQ];bB[bU[0]].push(bU[1]);bB[bU[1]].push(bU[0]);bn[bU[0]].push(bU[1]);bn[bU[1]].push(bU[0])}bV=[];for(bP=0,bt=bG.length;bP<bt;bP++){bU=bG[bP];bz=bB[bU[1]];for(bO=0,bs=bz.length;bO<bs;bO++){bF=bz[bO];by=bn[bU[0]];for(bN=0,br=by.length;bN<br;bN++){bE=by[bN];if(bF===bE){bV.push([bU[0],bU[1],bF])}}}bw=bB[bU[0]];for(bM=0,bq=bw.length;bM<bq;bM++){bF=bw[bM];bv=bn[bU[1]];for(bL=0,bp=bv.length;bL<bp;bL++){bE=bv[bL];if(bF===bE){bV.push([bU[1],bU[0],bF])}}}}bY=[bV.pop()];for(bK=0,bo=bV.length;bK<bo;bK++){bx=bV[bK];bD=false;for(bJ=0,bm=bY.length;bJ<bm;bJ++){bH=bY[bJ];if(a(bx,bH)){bD=true;break}}if(!bD){bY.push(bx)}}return bY};Y=function(bo,bm){var bq,bp,bv,bu,bs,br,bz,by,bx,bw,bn,bt;bm=bm||false;console.log("Triangulating faces of "+bo.name+"...");br=new aJ();br.xyz=J(bo.xyz);br.face_class=[];bt=bo.face;for(bu=0,bw=bt.length;bu<bw;bu++){bv=bt[bu];if(bv.length>3){bq=W((function(){var bC,bA,bB;bB=[];for(bC=0,bA=bv.length;bC<bA;bC++){bx=bv[bC];bB.push(bo.xyz[bx])}return bB})());bp=H(bq);by=s(bv,bp);for(bs=0,bn=by.length;bs<bn;bs++){bz=by[bs];br.face.push([bv[bz[0]],bv[bz[1]],bv[bz[2]]]);if(bm){br.face_class.push(bo.face_class[bu])}}}else{br.face.push([bv[0],bv[1],bv[2]]);if(bm){br.face_class.push(bo.face_class[bu])}}}br.name=bo.name;return br};ae=function(bm){var br,bs,bu,bp,bo,bt,bn,bq;bs="";bq=bm.face;for(bp=0,bt=bq.length;bp<bt;bp++){br=bq[bp];for(bo=0,bn=br.length;bo<bn;bo++){bu=br[bo];bs+=""+bu+"->"}bs+="\n"}return console.log(bs)};A=function(){var bt,bq,bp,bo,bs,br,bn,bm;bo=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bq=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bs=0,bn=bq.length;bs<bn;bs++){bt=bq[bs];console.log("Operator "+bt);for(br=0,bm=bo.length;br<bm;br++){bp=bo[br];console.log(bt+bp+":",generatePoly(bt+bp))}}return console.log("===== Done Testing Basic Ops =====")};aM='/* series of opspecs */\nstart  = opspec+\n\n/* opspec one of:\n A  - single letter\n A3 - single letter and float\n B(5,4.3,3) - function call format w. float args\n*/\nopspec =\n   let:opcode args:opargs {return {"op":let,"args":args};}\n/ let:opcode float:float     {return {"op":let,"args":[float]};}\n/ let:opcode                     {return {"op":let,"args":[]};}\n\n/*\nparentheses surrounding comma-delimited list of floats i.e.\n( 1 , 3.2, 4 ) or (1) or (2,3)\n*/\nopargs = "("\n           num:( float:float ","? {return float} )+\n         ")" {return num;}\n\n/* just a letter */\nopcode = op:[a-zA-Z] {return op;}\n\n/* standard numerical types */\nint   = digits:[0-9-]+   { return parseInt(digits.join(""), 10);  }\nfloat = digits:[0-9.-]+  { return parseFloat(digits.join(""), 10); }';a9=PEG.buildParser(aM);bl=function(bn,bm){return bn.apply(this,bm||[])};bb={T:e,O:am,C:ag,I:a1,D:an,P:Q,A:aR,Y:bi};E={d:aC,k:aa,a:aB,g:aX,p:q,r:r,n:C,x:Z,l:aS,z:Y,K:f,C:l,A:w};aI=[[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];aV=function(bp){var bm,bo,bs,br,bn,bq;bo=bp;for(br=0,bn=aI.length;br<bn;br++){bq=aI[br],bs=bq[0],bm=bq[1];bo=bo.replace(bs,bm)}console.log(""+bp+" executed as "+bo);return bo};bj=function(bs){var bn,bu,bp,bw,bq,bv,br,bm,bo,bt;br=aV(bs);bv=a9.parse(br).reverse();bp=bv.shift();bu=bb[bp.op];bn=bp.args;bm=bl(bu,bn);for(bo=0,bt=bv.length;bo<bt;bo++){bp=bv[bo];bq=E[bp.op];bw=[bm].concat(bp.args);bm=bl(bq,bw)}bm.xyz=a4(bm.xyz,bm.getEdges());bm.xyz=z(bm.xyz);bm=O(bm);return bm};ab={};bf=500;au=400;N={};i=J(t);ai=J(t);R=800;y=5;bg=0;K=0.8;m=bf/2;aq=au/2;u=new Date();o=true;aN="rgba(255,255,255,1.0)";ak="area";g="fillstroke";a6=0.5;al=false;U=0;T=0;aA=[1,0,0];aY=["C2dakD","oC20kkkT","kn4C40A0dA4","opD","lT","lK5oC","knD","dn6x4K5bT","oox4P7","n18n18n9n9n9soxY9"];ay=function(bo,bm){var bp,bn;bp=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;bn=new bp();bn.append(bo);return saveAs(bn.getBlob("text/plain;charset="+document.characterSet),bm)};bh=function(){var bm,br,bq,bp,bo,bn;bn={};bm=/\+/g;bo=/([^&=]+)=?([^&]*)/g;br=function(bs){return decodeURIComponent(bs.replace(bm," "))};bp=window.location.search.substring(1);while(bq=bo.exec(bp)){bn[br(bq[1])]=br(bq[2])}return bn};aE=function(){var bm;bm=$("#poly");bm.width(bf);bm.height(au);ab=bm[0].getContext("2d");ab.lineWidth=a6;if(o){return ab.clearRect(0,0,bf,au)}else{ab.clearRect(0,0,bf,au);ab.fillStyle=aN;return ab.fillRect(0,0,bf,au)}};aG=function(){if(o){return ab.clearRect(0,0,bf,au)}else{ab.clearRect(0,0,bf,au);ab.fillStyle=aN;return ab.fillRect(0,0,bf,au)}};P=function(bt,bB){var bn,bv,bu,bA,bp,br,bz,bs,by,bw,bo,bC,bD,bx,bq,bm;bB||(bB=[3,3,3]);br=_.map(bt.xyz,function(bE){return bE});bt.xyz=_.map(bt.xyz,function(bE){return p(i,bE)});aL(bt);bx=bt.face;for(bA=0,bC=bx.length;bA<bC;bA++){bv=bx[bA];ab.beginPath();bs=bv[bv.length-1];bq=v(x(bB,bt.xyz[bs]),y,bg,K,R),by=bq[0],bw=bq[1];ab.moveTo(by+m,bw+aq);for(bo=0,bD=bv.length;bo<bD;bo++){bz=bv[bo];bm=v(x(bB,bt.xyz[bz]),y,bg,K,R),by=bm[0],bw=bm[1];ab.lineTo(by+m,bw+aq)}bn=ad(bt.face_class[bA]);bu=(function(){var bF,bG,bE;bE=[];for(bF=0,bG=bv.length;bF<bG;bF++){bz=bv[bF];bE.push(bt.xyz[bz])}return bE})();bp=B(ah(bu),be([1,-1,0]));bn=d((bp/2+0.5)*0.7+0.3,bn);if(g==="fill"||g==="fillstroke"){ab.fillStyle="rgba("+(V(bn[0]*255))+", "+(V(bn[1]*255))+", "+(V(bn[2]*255))+", "+1+")";ab.fill();ab.strokeStyle="rgba("+(V(bn[0]*255))+", "+(V(bn[1]*255))+", "+(V(bn[2]*255))+", "+1+")";ab.stroke()}if(g==="fillstroke"){ab.fillStyle="rgba("+(V(bn[0]*255))+", "+(V(bn[1]*255))+", "+(V(bn[2]*255))+", "+1+")";ab.fill();ab.strokeStyle="rgba(0,0,0, .3)";ab.stroke()}if(g==="stroke"){ab.strokeStyle="rgba(0,0,0, .8)";ab.stroke()}}return bt.xyz=br};av=function(){var bo,bp,bn,bm;aG();bm=[];for(bo=0,bn=N.length;bo<bn;bo++){bp=N[bo];bm.push(P(bp,[0+3*bo,0,3]))}return bm};ba=function(){var bn,bo,bp,bm;aG();bn=(2*Math.PI)/180*u.getSeconds()*0.1;for(bo=0,bm=N.length;bo<bm;bo++){bp=N[bo];P(bp,[0+3*bo,0,3])}return setTimeout(ba,100)};$(function(){var bn,bm;aE();bm=bh();if("recipe" in bm){bn=[bm.recipe];$("#spec").val(bn)}else{bn=[a5(aY)];$("#spec").val(bn)}$("#palette").val(aU.reduce(function(bo,bp){return bo+" "+bp}));N=_.map(bn,function(bo){return bj(bo)});av();$("#spec").change(function(bo){bn=$("#spec").val().split(/\s+/g).slice(0,2);N=_.map(bn,function(bp){return bj(bp)});return av()});$("#palette").change(function(bo){aU=$(this).val().split(/\s+/g);return av()});$("#poly").mousewheel(function(bq,br,bp,bo){bq.preventDefault();R*=(10+br)/10;return av()});$("#poly").mousedown(function(bo){var bp;bo.preventDefault();al=true;U=bo.clientX-$(this).offset().left;T=bo.clientY-($(this).offset().top-$(window).scrollTop());bp=aF(U,T,m,aq,y,bg,K,R);if(bp[0]*bp[1]*bp[2]*0===0){aA=bp}return ai=J(i)});$("#poly").mouseup(function(bo){bo.preventDefault();return al=false});$("#poly").mouseleave(function(bo){bo.preventDefault();return al=false});$("#poly").mousemove(function(br){var bp,bo,bq;br.preventDefault();if(al){bp=br.clientX-$(this).offset().left;bo=br.clientY-($(this).offset().top-$(window).scrollTop());bq=aF(bp,bo,m,aq,y,bg,K,R);if(bq[0]*bq[1]*bq[2]*0===0&&aA[0]*aA[1]*aA[2]*0===0){i=az(ax(aA,bq),ai)}return av()}});$("#strokeonly").click(function(bo){g="stroke";return av()});$("#fillonly").click(function(bo){g="fill";return av()});$("#fillandstroke").click(function(bo){g="fillstroke";return av()});$("#siderot").click(function(bo){i=aO(aD/2,0,1,0);return av()});$("#toprot").click(function(bo){i=aO(aD/2,1,0,0);return av()});$("#frontrot").click(function(bo){i=h(0,0,0);return av()});$("#pngsavebutton").click(function(br){var bq,bp,bo;bq=$("#poly")[0];bo=$("#spec").val().split(/\s+/g)[0];bp="polyhedronisme-"+bo+".png";return bq.toBlob(function(bs){return saveAs(bs,bp)})});$("#objsavebutton").click(function(br){var bp,bq,bo;bq=N[0].toOBJ();bo=$("#spec").val().split(/\s+/g)[0];bp="polyhedronisme-"+bo+".obj";return ay(bq,bp)});return $("#x3dsavebutton").click(function(br){var bp,bo,bq,bs;bq=Y(N[0],true);bs=bq.toVRML();bo=$("#spec").val().split(/\s+/g)[0];bp="polyhedronisme-"+bo+".wrl";return ay(bs,bp)})})}).call(this);