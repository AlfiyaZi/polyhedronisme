(function(){var m,aI,ap,bc,af,aV,Q,P,av,ag,aQ,ay,W,aT,u,t,aw,a7,aM,H,ao,a9,d,j,aB,E,aN,a8,aW,C,an,V,a4,ab,aj,ai,y,aq,L,ax,al,F,T,q,ba,aC,aZ,ae,Y,aS,at,J,f,ad,r,aU,bg,aY,az,z,A,aA,U,D,aX,a2,aK,au,b,n,ac,ah,ak,aL,K,X,be,s,G,v,bd,N,a5,aa,aF,a0,M,o,bf,aD,a3,a1,ar,I,B,p,w,e,R,aG,h,aP,aH,aE,O,aO,a6,a,g,S,x,c,Z,i,bb,aJ,k,am,l;var aR=function(bh,bi){return function(){return bh.apply(bi,arguments)}};aD=Math.random;R=Math.round;ae=Math.floor;O=Math.sqrt;aP=Math.sin;C=Math.cos;a=Math.tan;H=Math.asin;aT=Math.acos;ao=Math.atan;a0=Math.pow;W=Math.abs;ay=Math.PI;F=function(bi){var bj,bk,bh;bh=[];for(bj=0,bk=bi.length-1;0<=bk?bj<=bk:bj>=bk;0<=bk?bj++:bj--){bh.push([bj,bi[bj]])}return bh};E=function(bj){var bi,bh;if(!(bj!=null)||typeof bj!=="object"){return bj}bh=new bj.constructor();for(bi in bj){bh[bi]=E(bj[bi])}return bh};a3=function(bi){var bh;bh=ae(aD()*bi.length);return bi[bh]};b=function(bi,bh){return[bi*bh[0],bi*bh[1],bi*bh[2]]};l=function(bi,bh){return[bi[0]*bh[0],bi[1]*bh[1],bi[2]*bh[2]]};u=function(bi,bh){return[bi[0]+bh[0],bi[1]+bh[1],bi[2]+bh[2]]};a6=function(bi,bh){return[bi[0]-bh[0],bi[1]-bh[1],bi[2]-bh[2]]};y=function(bi,bh){return bi[0]*bh[0]+bi[1]*bh[1]+bi[2]*bh[2]};an=function(bi,bh){return[bi[1]*bh[2]-bi[2]*bh[1],bi[2]*bh[0]-bi[0]*bh[2],bi[0]*bh[1]-bi[1]*bh[0]]};D=function(bh){return O(y(bh,bh))};aX=function(bh){return y(bh,bh)};bb=function(bh){return b(1/O(aX(bh)),bh)};aK=function(bi,bh){return b(1/2,u(bi,bh))};i=function(bj,bi,bh){return[(1-bh)*bj[0]+bh*bi[0],(1-bh)*bj[1]+bh*bi[1],(1-bh)*bj[2]+bh*bi[2]]};ak=function(bi,bh){return i(bi,bh,1/3)};ar=function(bh){return b(1/aX(bh),bh)};g=function(bj,bi){var bh;bh=a6(bi,bj);return a6(bj,b(y(bh,bj)/aX(bh),bh))};al=function(bi,bh){return O(aX(g(bi,bh)))};aL=function(bl,bk,bj){var bi,bh;bi=a6(bk,bl);bh=a6(bj,bk);return an(bi,bh)};A=function(bo,bn,bm){var bs,br,bq,bl,bk,bj,bp,bi,bh;for(bl=0,bp=bo.length;bl<bp;bl++){bs=bo[bl];for(bk=0,bi=bn.length;bk<bi;bk++){br=bn[bk];if(bs===br){for(bj=0,bh=bm.length;bj<bh;bj++){bq=bm[bj];if(bs===bq){return bs}}}}}return null};aW=function(bj){var bi,bh,bk;bh=new Array(bj.length);for(bi=0,bk=bj.length-1;0<=bk?bi<=bk:bi>=bk;0<=bk?bi++:bi--){bh[bi]=bj[bi].slice(0)}return bh};n=function(bi,bh){return[bi[0][0]*bh[0]+bi[0][1]*bh[1]+bi[0][2]*bh[2],bi[1][0]*bh[0]+bi[1][1]*bh[1]+bi[1][2]*bh[2],bi[2][0]*bh[0]+bi[2][1]*bh[1]+bi[2][2]*bh[2]]};au=function(bh,bi){return[[bh[0][0]*bi[0][0]+bh[0][1]*bi[1][0]+bh[0][2]*bi[2][0],bh[0][0]*bi[0][1]+bh[0][1]*bi[1][1]+bh[0][2]*bi[2][1],bh[0][0]*bi[0][2]+bh[0][1]*bi[1][2]+bh[0][2]*bi[2][2]],[bh[1][0]*bi[0][0]+bh[1][1]*bi[1][0]+bh[1][2]*bi[2][0],bh[1][0]*bi[0][1]+bh[1][1]*bi[1][1]+bh[1][2]*bi[2][1],bh[1][0]*bi[0][2]+bh[1][1]*bi[1][2]+bh[1][2]*bi[2][2]],[bh[2][0]*bi[0][0]+bh[2][1]*bi[1][0]+bh[2][2]*bi[2][0],bh[2][0]*bi[0][1]+bh[2][1]*bi[1][1]+bh[2][2]*bi[2][1],bh[2][0]*bi[0][2]+bh[2][1]*bi[1][2]+bh[2][2]*bi[2][2]]]};q=[[1,0,0],[0,1,0],[0,0,1]];e=function(bl,bj,bk){var bm,bi,bh;bm=[[C(bl),-1*aP(bl),0],[aP(bl),C(bl),0],[0,0,1]];bh=[[C(bj),0,-1*aP(bj)],[0,1,0],[aP(bj),0,C(bj)]];bi=[[1,0,0],[0,C(bk),-1*aP(bk)],[0,aP(bk),C(bk)]];return au(bi,au(bh,bm))};aJ=function(bl,bu,bs,bp){var bo,bi,bj,bt,br,bh,bq,bm,bn,bk;bl/=2;bt=aP(bl);bo=C(bl);br=bt*bt;bi=D([bu,bs,bp]);if(bi===0){bn=[0,0,1],bu=bn[0],bs=bn[1],bp=bn[2]}if(bi!==1){bk=bb([bu,bs,bp]),bu=bk[0],bs=bk[1],bp=bk[2]}if(bu===1&&bs===0&&bp===0){bj=[[1,0,0],[0,1-2*br,2*bt*bo],[0,-2*bt*bo,1-2*br]]}else{if(bu===0&&bs===1&&bp===0){bj=[[1-2*br,0,-2*bt*bo],[0,1,0],[2*bt*bo,0,1-2*br]]}else{if(bu===0&&bs===0&&bp===1){bj=[[1-2*br,2*bt*bo,0],[-2*bt*bo,1-2*br,0],[0,0,1]]}else{bh=bu*bu;bq=bs*bs;bm=bp*bp;bj=[[1-2*(bq+bm)*br,2*(bu*bs*br+bp*bt*bo),2*(bu*bp*br-bs*bt*bo)],[2*(bs*bu*br-bp*bt*bo),1-2*(bm+bh)*br,2*(bs*bp*br+bu*bt*bo)],[2*(bp*bu*br+bs*bt*bo),2*(bp*bs*br-bu*bt*bo),1-2*(bh+bq)*br]]}}}return bj};s=function(bj,bi,bk,bn,bh){var bl,bm;bm=(bi*bn-bk)/(1-bn);bl=bh*bn/(1-bn);return[bl*bj[0]/(bj[2]+bm),bl*bj[1]/(bj[2]+bm)]};aA=function(bo,bl,br,bp,bv,bk,bj,bi){var bu,bh,bq,bm,bs,bx,bz,bn,bt,bw,by;bt=(bv*bj-bk)/(1-bj);bu=bi*bj/(1-bj);bq=bo-br;bx=bl-bp;bh=bu*bu;bw=bt*bt;bm=bq*bq;bz=bx*bx;bs=(2*bu*bq*bt+O(4*bh*bm*bw+4*bm*(bh+bm+bz)*(1-bw)))/(2*(bh+bm+bz));bn=(bu*bx*bt)/(bh+bm+bz)+(bx*O(4*bh*bw+4*(bh+bm+bz)*(1-bw)))/(2*(bh+bm+bz));by=O(1-bs*bs-bn*bn);return[bs,bn,by]};at=function(bj,bi){var bk,bh;bh=an(bj,bi);bk=aT(y(bj,bi));return aJ(-1*bk,bh[0],bh[1],bh[2])};aZ=function(bk){var bi,bm,bl,bj,bh;bi=[];bm=bk.slice(-1)[0];for(bj=0,bh=bk.length;bj<bh;bj++){bl=bk[bj];bi.push([bm,bl]);bm=bl}return bi};aF=(function(){function bh(){this.face=new Array();this.xyz=new Array();this.name="null polyhedron"}bh.prototype.data=function(){var bi;bi=this.face.length+this.xyz.length-2;return"("+this.face.length+" faces, "+bi+" edges, "+this.xyz.length+" vertices)"};bh.prototype.getEdges=function(){var bs,bo,bq,bp,bj,bn,bm,bt,bl,bk,br,bi;bn={};bt=[];bo=_(this.face).map(aZ);for(bl=0,br=bo.length;bl<br;bl++){bj=bo[bl];for(bk=0,bi=bj.length;bk<bi;bk++){bp=bj[bk];if(bp[0]<bp[1]){bs=bp[0],bq=bp[1]}else{bq=bp[0],bs=bp[1]}bn[bs+"~"+bq]=bp}}for(bm in bn){bp=bn[bm];bt.push(bp)}return bt};bh.prototype.toOBJ=function(){var bu,bt,bj,bv,bx,br,bq,bp,bn,bw,bk,bi,by,bs,bo,bm,bl;bv="#Produced by polyHÃ©dronisme http://levskaya.github.com/polyhedronisme\n";bv+="group "+this.name+"\n";bv+="#vertices\n";bs=this.xyz;for(br=0,bw=bs.length;br<bw;br++){bx=bs[br];bv+="v "+bx[0]+" "+bx[1]+" "+bx[2]+"\n"}bv+="#normal vector defs \n";bo=this.face;for(bq=0,bk=bo.length;bq<bk;bq++){bu=bo[bq];bj=ac((function(){var bA,bB,bz;bz=[];for(bA=0,bB=bu.length;bA<bB;bA++){bx=bu[bA];bz.push(this.xyz[bx])}return bz}).call(this));bv+="vn "+bj[0]+" "+bj[1]+" "+bj[2]+"\n"}bv+="#face defs \n";bm=F(this.face);for(bp=0,bi=bm.length;bp<bi;bp++){bl=bm[bp],bt=bl[0],bu=bl[1];bv+="f ";for(bn=0,by=bu.length;bn<by;bn++){bx=bu[bn];bv+=""+(bx+1)+"//"+(bt+1)+" "}bv+="\n"}return bv};return bh})();ba=function(bl){var bi,bj,bh,bk,bm;bi=[];for(bj=0,bk=bl.face.length-1;0<=bk?bj<=bk:bj>=bk;0<=bk?bj++:bj--){bi[bj]=[0,0,0];for(bh=0,bm=bl.face[bj].length-1;0<=bm?bh<=bm:bh>=bm;0<=bm?bh++:bh--){bi[bj]=u(bi[bj],bl.xyz[bl.face[bj][bh]])}bi[bj]=b(1/bl.face[bj].length,bi[bj])}return bi};aC=function(bn){var bm,bj,bi,bl,bh,bk;bj=[];bk=bn.face;for(bl=0,bh=bk.length;bl<bh;bl++){bm=bk[bl];bj.push(ac((function(){var bq,bo,bp;bp=[];for(bq=0,bo=bm.length;bq<bo;bq++){bi=bm[bq];bp.push(bn.xyz[bi])}return bp})()))}return bj};a9=function(bl){var bj,bi,bk,bh;bj=[0,0,0];for(bk=0,bh=bl.length;bk<bh;bk++){bi=bl[bk];bj=u(bj,bi)}return b(1/bl.length,bj)};ac=function(bl){var bh,bp,bn,bm,bj,bo,bk,bi;bh=[0,0,0];bk=bl.slice(-2),bp=bk[0],bn=bk[1];for(bj=0,bo=bl.length;bj<bo;bj++){bm=bl[bj];bh=u(bh,aL(bp,bn,bm));bi=[bn,bm],bp=bi[0],bn=bi[1]}return bb(bh)};a8=function(bl){var bh,bp,bn,bm,bj,bo,bk,bi;bh=0;bk=bl.slice(0,2),bp=bk[0],bn=bk[1];bi=bl.slice(2);for(bj=0,bo=bi.length;bj<bo;bj++){bm=bi[bj];bh+=D(an(a6(bn,bp),a6(bm,bp)));bn=bm}return bh};c=function(){var bh;bh=new aF();bh.name="T";bh.face=[[0,1,2],[0,2,3],[0,3,1],[1,3,2]];bh.xyz=[[1,1,1],[1,-1,-1],[-1,1,-1],[-1,-1,1]];return bh};ah=function(){var bh;bh=new aF();bh.name="O";bh.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]];bh.xyz=[[0,0,1.414],[1.414,0,0],[0,1.414,0],[-1.414,0,0],[0,-1.414,0],[0,0,-1.414]];return bh};ab=function(){var bh;bh=new aF();bh.name="C";bh.face=[[3,0,1,2],[3,4,5,0],[0,5,6,1],[1,6,7,2],[2,7,4,3],[5,4,7,6]];bh.xyz=[[0.707,0.707,0.707],[-0.707,0.707,0.707],[-0.707,-0.707,0.707],[0.707,-0.707,0.707],[0.707,-0.707,-0.707],[0.707,0.707,-0.707],[-0.707,0.707,-0.707],[-0.707,-0.707,-0.707]];return bh};aY=function(){var bh;bh=new aF();bh.name="I";bh.face=[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]];bh.xyz=[[0,0,1.176],[1.051,0,0.526],[0.324,1,0.525],[-0.851,0.618,0.526],[-0.851,-0.618,0.526],[0.325,-1,0.526],[0.851,0.618,-0.526],[0.851,-0.618,-0.526],[-0.325,1,-0.526],[-1.051,0,-0.526],[-0.325,-1,-0.526],[0,0,-1.176]];return bh};ai=function(){var bh;bh=new aF();bh.name="D";bh.face=[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]];bh.xyz=[[0,0,1.07047],[0.713644,0,0.797878],[-0.356822,0.618,0.797878],[-0.356822,-0.618,0.797878],[0.797878,0.618034,0.356822],[0.797878,-0.618,0.356822],[-0.934172,0.381966,0.356822],[0.136294,1,0.356822],[0.136294,-1,0.356822],[-0.934172,-0.381966,0.356822],[0.934172,0.381966,-0.356822],[0.934172,-0.381966,-0.356822],[-0.797878,0.618,-0.356822],[-0.136294,1,-0.356822],[-0.136294,-1,-0.356822],[-0.797878,-0.618034,-0.356822],[0.356822,0.618,-0.797878],[0.356822,-0.618,-0.797878],[-0.713644,0,-0.797878],[0,0,-1.07047]];return bh};M=function(bl){var bu,bt,bh,bj,br,bq,bs,bo,bm,bk,bi,bp,bn;bj=2*ay/bl;bu=Math.sin(bj/2);bh=new aF();bh.name="P"+bl;for(bt=0,bs=bl-1;0<=bs?bt<=bs:bt>=bs;0<=bs?bt++:bt--){bh.xyz.push([C(bt*bj),aP(bt*bj),bu])}for(bt=0,bo=bl-1;0<=bo?bt<=bo:bt>=bo;0<=bo?bt++:bt--){bh.xyz.push([C(bt*bj),aP(bt*bj),-bu])}bh.face.push((function(){bp=[];for(var bv=bm=bl-1;bm<=0?bv<=0:bv>=0;bm<=0?bv++:bv--){bp.push(bv)}return bp}).apply(this));bh.face.push((function(){bn=[];for(var bv=bl,bw=2*bl-1;bl<=bw?bv<=bw:bv>=bw;bl<=bw?bv++:bv--){bn.push(bv)}return bn}).apply(this));for(bt=0,bi=bl-1;0<=bi?bt<=bi:bt>=bi;0<=bi?bt++:bt--){bh.face.push([bt,(bt+1)%bl,(bt+1)%bl+bl,bt+bl])}bh.xyz=t(bh,1);return bh};aM=function(bm){var bw,bv,bu,bi,bh,bk,bs,br,bt,bp,bn,bl,bj,bq,bo;bk=2*ay/bm;bv=O(1-4/(4+2*C(bk/2)-2*C(bk)));bh=O(1-bv*bv);bw=O(bv*bv+a0(bh*C(bk/2),2));bh=bh/bw;bv=bv/bw;bi=new aF();bi.name="A"+bm;for(bu=0,bt=bm-1;0<=bt?bu<=bt:bu>=bt;0<=bt?bu++:bu--){bi.xyz.push([bh*C(bu*bk),bh*aP(bu*bk),bv])}for(bu=0,bp=bm-1;0<=bp?bu<=bp:bu>=bp;0<=bp?bu++:bu--){bi.xyz.push([bh*C((bu+0.5)*bk),bh*aP((bu+0.5)*bk),-bv])}bi.face.push((function(){bq=[];for(var bx=bn=bm-1;bn<=0?bx<=0:bx>=0;bn<=0?bx++:bx--){bq.push(bx)}return bq}).apply(this));bi.face.push((function(){bo=[];for(var bx=bm,by=2*bm-1;bm<=by?bx<=by:bx>=by;bm<=by?bx++:bx--){bo.push(bx)}return bo}).apply(this));for(bu=0,bj=bm-1;0<=bj?bu<=bj:bu>=bj;0<=bj?bu++:bu--){bi.face.push([bu,(bu+1)%bm,bu+bm]);bi.face.push([bu,bu+bm,(bm+bu-1)%bm+bm])}bi.xyz=t(bi,1);return bi};bf=function(bj){var bq,bp,bh,bi,bn,bo,bl,bk,bm;bi=2*ay/bj;bq=1;bh=new aF();bh.name="Y"+bj;for(bp=0,bo=bj-1;0<=bo?bp<=bo:bp>=bo;0<=bo?bp++:bp--){bh.xyz.push([C(bp*bi),aP(bp*bi),0.2])}bh.xyz.push([0,0,-1*bq]);bh.face.push((function(){bm=[];for(var br=bl=bj-1;bl<=0?br<=0:br>=0;bl<=0?br++:br--){bm.push(br)}return bm}).apply(this));for(bp=0,bk=bj-1;0<=bk?bp<=bk:bp>=bk;0<=bk?bp++:bp--){bh.face.push([bp,(bp+1)%bj,bj])}bh.xyz=d(bh,3);return bh};aa=(function(){function bh(){this.flags=new Object();this.verts=new Object();this.xyzs=new Object()}bh.prototype.newV=function(bj,bi){if(this.verts[bj]===void 0){this.verts[bj]=0;return this.xyzs[bj]=bi}};bh.prototype.newFlag=function(bi,bk,bj){if(this.flags[bi]===void 0){this.flags[bi]={}}return this.flags[bi][bk]=bj};bh.prototype.topoly=function(){var bj,bo,br,bn,bl,bi,bp,bq,bm,bk;bi=new aF();bj=0;bm=this.verts;for(bn in bm){bp=bm[bn];bi.xyz[bj]=this.xyzs[bn];this.verts[bn]=bj;bj++}bj=0;bk=this.flags;for(bn in bk){bo=bk[bn];bi.face[bj]=[];for(bl in bo){bp=bo[bl];bq=bp;break}bp=bq;bi.face[bj].push(this.verts[bp]);bp=this.flags[bn][bp];br=0;while(bp!==bq){bi.face[bj].push(this.verts[bp]);bp=this.flags[bn][bp];br++;if(br>1000){console.log("Bad flag spec, have a neverending face:",bn,this.flags[bn]);break}}bj++}bi.name="unknown polyhedron";return bi};return bh})();U=function(bq,bw){var bA,bz,bx,bD,bp,by,bs,bu,bv,bt,bo,bl,bm,bj,bh,bC,bE,bB,br,bn,bk,bi;console.log("Taking kis of "+(bw===0?"":bw)+"-sided faces of "+bq.name+"...");bx=new aa();br=F(bq.xyz);for(bm=0,bC=br.length;bm<bC;bm++){bn=br[bm],by=bn[0],bv=bn[1];bx.newV("v"+by,bv)}bu=aC(bq);bA=ba(bq);bp=false;bk=F(bq.face);for(bj=0,bE=bk.length;bj<bE;bj++){bi=bk[bj],by=bi[0],bz=bi[1];bo="v"+bz.slice(-1)[0];for(bh=0,bB=bz.length;bh<bB;bh++){bt=bz[bh];bl="v"+bt;if(bz.length===bw||bw===0){bp=true;bx.newV("f"+by,u(bA[by],b(0.1,bu[by])));bD=by+bo;bx.newFlag(bD,bo,bl);bx.newFlag(bD,bl,"f"+by);bx.newFlag(bD,"f"+by,bo)}else{bx.newFlag(by,bo,bl)}bo=bl}}if(!bp){console.log("No "+bw+"-fold components were found.")}bs=bx.topoly();bs.name="k"+(bw===0?"":bw)+bq.name;return bs};a2=function(bi,bh){if(bi<bh){return bi+"_"+bh}else{return bh+"_"+bi}};aw=function(bi){var br,bs,bq,bm,bw,bv,bt,bo,bn,bu,bh,bp,bl,bk,bj;console.log("Taking ambo of "+bi.name+"...");bs=new aa();bp=F(bi.face);for(bo=0,bu=bp.length;bo<bu;bo++){bl=bp[bo],bq=bl[0],br=bl[1];bk=br.slice(-2),bw=bk[0],bv=bk[1];for(bn=0,bh=br.length;bn<bh;bn++){bt=br[bn];if(bw<bv){bs.newV(a2(bw,bv),aK(bi.xyz[bw],bi.xyz[bv]))}bs.newFlag("f"+bq,a2(bw,bv),a2(bv,bt));bs.newFlag("v"+bv,a2(bv,bt),a2(bw,bv));bj=[bv,bt],bw=bj[0],bv=bj[1]}}bm=bs.topoly();bm.name="a"+bi.name;bm.xyz=t(bm,2);return bm};aU=function(bv){var bD,bC,bA,bH,bB,bz,bx,by,bu,br,bo,bs,bp,bm,bk,bG,bI,bF,bE,bw,bj,bt,bq,bn,bl,bi,bh,bK,bJ;console.log("Taking gyro of "+bv.name+"...");bA=new aa();bw=F(bv.xyz);for(bs=0,bG=bw.length;bs<bG;bs++){bt=bw[bs],bB=bt[0],by=bt[1];bA.newV("v"+bB,bb(by))}bD=ba(bv);bq=F(bv.face);for(bp=0,bI=bq.length;bp<bI;bp++){bn=bq[bp],bB=bn[0],bC=bn[1];bA.newV("f"+bB,bb(bD[bB]))}bl=F(bv.face);for(bm=0,bF=bl.length;bm<bF;bm++){bi=bl[bm],bB=bi[0],bC=bi[1];bh=bC.slice(-2),bu=bh[0],br=bh[1];bK=F(bC);for(bk=0,bE=bK.length;bk<bE;bk++){bJ=bK[bk],bz=bJ[0],by=bJ[1];bo=by;bA.newV(bu+"~"+br,ak(bv.xyz[bu],bv.xyz[br]));bH=bB+"f"+bu;bA.newFlag(bH,"f"+bB,bu+"~"+br);bA.newFlag(bH,bu+"~"+br,br+"~"+bu);bA.newFlag(bH,br+"~"+bu,"v"+br);bA.newFlag(bH,"v"+br,br+"~"+bo);bA.newFlag(bH,br+"~"+bo,"f"+bB);bj=[br,bo],bu=bj[0],br=bj[1]}}bx=bA.topoly();bx.name="g"+bv.name;bx.xyz=t(bx,3);return bx};o=function(bs){var by,bw,bA,bx,bu,bv,br,bo,bl,bp,bm,bj,bz,bC,bB,bt,bq,bn,bk,bi,bh;console.log("Taking propellor of "+bs.name+"...");bw=new aa();bt=F(bs.xyz);for(bp=0,bz=bt.length;bp<bz;bp++){bq=bt[bp],bx=bq[0],bv=bq[1];bw.newV("v"+bx,bb(bv))}bn=F(bs.face);for(bm=0,bC=bn.length;bm<bC;bm++){bk=bn[bm],bx=bk[0],by=bk[1];bi=by.slice(-2),br=bi[0],bo=bi[1];for(bj=0,bB=by.length;bj<bB;bj++){bv=by[bj];bl=""+bv;bw.newV(br+"~"+bo,ak(bs.xyz[br],bs.xyz[bo]));bA=""+bx+"f"+bo;bw.newFlag("v"+bx,br+"~"+bo,bo+"~"+bl);bw.newFlag(bA,br+"~"+bo,bo+"~"+br);bw.newFlag(bA,bo+"~"+br,"v"+bo);bw.newFlag(bA,"v"+bo,bo+"~"+bl);bw.newFlag(bA,bo+"~"+bl,br+"~"+bo);bh=[bo,bl],br=bh[0],bo=bh[1]}}bu=bw.topoly();bu.name="p"+bs.name;bu.xyz=t(bu,3);return bu};p=function(bj){var bh,bi,bk;console.log("Taking reflection of "+bj.name+"...");for(bh=0,bi=bj.xyz.length-1;0<=bi?bh<=bi:bh>=bi;0<=bi?bh++:bh--){bj.xyz[bh]=b(-1,bj.xyz[bh])}for(bh=0,bk=bj.face.length-1;0<=bk?bh<=bk:bh>=bk;0<=bk?bh++:bh--){bj.face[bh]=bj.face[bh].reverse()}bj.name="r"+bj.name;bj.xyz=t(bj,1);return bj};ax=function(bs){var by,bD,bx,bt,bv,bw,br,bo,bp,bm,bk,bi,bA,bC,bB,bz,bu,bq,bn,bl,bj,bh;console.log("Taking dual of "+bs.name+"...");bv=new aa();bt=[];for(bw=0,bu=bs.xyz.length-1;0<=bu?bw<=bu:bw>=bu;0<=bu?bw++:bw--){bt[bw]={}}bq=F(bs.face);for(bp=0,bA=bq.length;bp<bA;bp++){bn=bq[bp],bw=bn[0],bx=bn[1];br=bx[bx.length-1];for(bm=0,bC=bx.length;bm<bC;bm++){bo=bx[bm];bt[br]["v"+bo]=""+bw;br=bo}}by=ba(bs);for(bw=0,bl=bs.face.length-1;0<=bl?bw<=bl:bw>=bl;0<=bl?bw++:bw--){bv.newV(""+bw,by[bw])}bj=F(bs.face);for(bk=0,bB=bj.length;bk<bB;bk++){bh=bj[bk],bw=bh[0],bx=bh[1];br=bx[bx.length-1];for(bi=0,bz=bx.length;bi<bz;bi++){bo=bx[bi];bv.newFlag(br,bt[bo]["v"+br],""+bw);br=bo}}bD=bv.topoly();if(bs.name[0]!=="d"){bD.name="d"+bs.name}else{bD.name=bs.name.slice(1)}return bD};z=function(bu,bA){var bE,bD,bB,bJ,bt,bC,bw,by,bz,bx,bs,bp,bq,bn,bl,bj,bI,bK,bH,bG,bF,bh,bv,br,bo,bm,bk,bi;console.log("Taking inset of "+(bA===0?"":bA)+"-sided faces of "+bu.name+"...");bB=new aa();bv=F(bu.xyz);for(bq=0,bI=bv.length;bq<bI;bq++){br=bv[bq],bC=br[0],bz=br[1];bB.newV("v"+bC,bz)}by=aC(bu);bE=ba(bu);bo=F(bu.face);for(bn=0,bK=bo.length;bn<bK;bn++){bm=bo[bn],bC=bm[0],bD=bm[1];if(bD.length===bA||bA===0){for(bl=0,bH=bD.length;bl<bH;bl++){bx=bD[bl];bB.newV("f"+bC+"v"+bx,u(aK(bu.xyz[bx],bE[bC]),b(-0.2,by[bC])))}}}bt=false;bk=F(bu.face);for(bj=0,bG=bk.length;bj<bG;bj++){bi=bk[bj],bC=bi[0],bD=bi[1];bs="v"+bD[bD.length-1];for(bh=0,bF=bD.length;bh<bF;bh++){bx=bD[bh];bp="v"+bx;if(bD.length===bA||bA===0){bt=true;bJ=bC+bs;bB.newFlag(bJ,bs,bp);bB.newFlag(bJ,bp,"f"+bC+bp);bB.newFlag(bJ,"f"+bC+bp,"f"+bC+bs);bB.newFlag(bJ,"f"+bC+bs,bs);bB.newFlag("ex"+bC,"f"+bC+bs,"f"+bC+bp)}else{bB.newFlag(bC,bs,bp)}bs=bp}}if(!bt){console.log("No "+bA+"-fold components were found.")}bw=bB.topoly();bw.name="n"+(bA===0?"":bA)+bu.name;return bw};T=function(bu,bA){var bE,bD,bB,bt,bC,bw,by,bz,bx,bs,bp,bq,bn,bl,bj,bI,bJ,bH,bG,bF,bh,bv,br,bo,bm,bk,bi;console.log("Taking extrusion of "+(bA===0?"":bA)+"-sided faces of "+bu.name+"...");bB=new aa();bv=F(bu.xyz);for(bq=0,bI=bv.length;bq<bI;bq++){br=bv[bq],bC=br[0],bz=br[1];bB.newV("v"+bC,bz)}by=aC(bu);bE=ba(bu);bo=F(bu.face);for(bn=0,bJ=bo.length;bn<bJ;bn++){bm=bo[bn],bC=bm[0],bD=bm[1];if(bD.length===bA||bA===0){for(bl=0,bH=bD.length;bl<bH;bl++){bx=bD[bl];bB.newV("f"+bC+"v"+bx,u(bu.xyz[bx],b(0.3,by[bC])))}}}bt=false;bk=F(bu.face);for(bj=0,bG=bk.length;bj<bG;bj++){bi=bk[bj],bC=bi[0],bD=bi[1];bs="v"+bD[bD.length-1];for(bh=0,bF=bD.length;bh<bF;bh++){bx=bD[bh];bp="v"+bx;if(bD.length===bA||bA===0){bt=true;bB.newFlag(bC+bs,bs,bp);bB.newFlag(bC+bs,bp,"f"+bC+bp);bB.newFlag(bC+bs,"f"+bC+bp,"f"+bC+bs);bB.newFlag(bC+bs,"f"+bC+bs,bs);bB.newFlag("ex"+bC,"f"+bC+bs,"f"+bC+bp)}else{bB.newFlag(bC,bs,bp)}bs=bp}}if(!bt){console.log("No "+bA+"-fold components were found.")}bw=bB.topoly();bw.name="x"+(bA===0?"":bA)+bu.name;console.log(bw);return bw};aO=function(bu){var bF,bE,bC,bD,bz,bB,bA,br,bG,bp,bt,bs,bm,bx,bw,bv,bo,bl,bj,bI,bJ,bH,by,bq,bn,bk,bi,bh;console.log("Taking stella of "+bu.name+"...");bF=ba(bu);bC=new aa();by=F(bu.xyz);for(bo=0,bI=by.length;bo<bI;bo++){bq=by[bo],bD=bq[0],bB=bq[1];bC.newV("v"+bD,bB)}bn=F(bu.face);for(bl=0,bJ=bn.length;bl<bJ;bl++){bk=bn[bl],bD=bk[0],bE=bk[1];br="v"+bE[bE.length-2];bp="v"+bE[bE.length-1];bx=bu.xyz[bE[bE.length-2]];bw=bu.xyz[bE[bE.length-1]];for(bj=0,bH=bE.length;bj<bH;bj++){bA=bE[bj];bm="v"+bA;bv=bu.xyz[bA];bG=br+"~"+bp;bt=bp+"~"+br;bs=bp+"~"+bm;bC.newV(bG,aK(aK(bx,bw),bF[bD]));bC.newFlag("in"+bD,bG,bs);bC.newFlag("f"+bD+bp,bs,bG);bC.newFlag("f"+bD+bp,bG,bp);bC.newFlag("f"+bD+bp,bp,bs);bC.newFlag("f"+bG,br,bt);bC.newFlag("f"+bG,bt,bG);bC.newFlag("f"+bG,bG,br);bi=[bp,bm],br=bi[0],bp=bi[1];bh=[bw,bv],bx=bh[0],bw=bh[1]}}bz=bC.topoly();bz.name="*"+bu.name;return bz};S=function(bk,bj){var bo,bm,bl,bh,bp,bi,bn;bo=0.1;bh=aW(bk);for(bi=0,bn=bj.length;bi<bn;bi++){bl=bj[bi];bp=g(bh[bl[0]],bh[bl[1]]);bm=b(bo*1/2*(1-O(y(bp,bp))),bp);bh[bl[0]]=u(bh[bl[0]],bm);bh[bl[1]]=u(bh[bl[1]],bm)}return bh};a1=function(bl,bk){var bo,bm,bh,bi,bp,bj,bn;bh=(function(){var bt,br,bs,bq;bq=[];for(bt=0,br=bk.length;bt<br;bt++){bs=bk[bt],bo=bs[0],bm=bs[1];bq.push(g(bl[bo],bl[bm]))}return bq})();bi=[0,0,0];for(bj=0,bn=bh.length;bj<bn;bj++){bp=bh[bj];bi=u(bi,bp)}bi=b(1/bk.length,bi);return _.map(bl,function(bq){return a6(bq,bi)})};w=function(bk){var bh,bj,bi;bj=[0,0,0];bh=_.max(_.map(bk,function(bl){return D(bl)}));bi=1/bh;return _.map(bk,function(bl){return[bi*bl[0],bi*bl[1],bi*bl[2]]})};a5=function(bn,bk){var bs,bp,br,bo,bj,bh,bt,bm,bl,bq,bi;bs=0.1;bh=aW(bn);for(bm=0,bq=bk.length;bm<bq;bm++){bo=bk[bm];br=(function(){var bw,bu,bv;bv=[];for(bw=0,bu=bo.length;bw<bu;bw++){bt=bo[bw];bv.push(bn[bt])}return bv})();bj=ac(br);bp=a9(br);if(y(bj,bp)<0){bj=b(-1,bj)}for(bl=0,bi=bo.length;bl<bi;bl++){bt=bo[bl];bh[bt]=u(bh[bt],b(y(b(bs,bj),a6(bp,bn[bt])),bj))}}return bh};j=function(bn,bm){var bi,bh,bk,bl,bj,bo;console.log("Canonicalizing "+bn.name+"...");bh=bn.face;bi=bn.getEdges();bj=bn.xyz;bl=1;for(bk=0;0<=bm?bk<=bm:bk>=bm;0<=bm?bk++:bk--){bo=aW(bj);bj=S(bj,bi);bj=a1(bj,bi);bj=a5(bj,bh);bl=_.max(_.map(_.zip(bj,bo),function(bq){var bp,br;bp=bq[0],br=bq[1];return D(a6(bp,br))}));if(bl<1e-8){break}}console.log("[canonicalization done, last |deltaV|="+bl+"]");return bj};I=function(bk){var bl,bi,bj,bh;bi=ba(bk);for(bj=0,bh=bi.length;bj<bh;bj++){bl=bi[bj];bl=b(1/y(bl,bl),bl)}return bi};B=function(bj){var bx,br,bk,bs,bh,bq,bw,bv,bt,bo,bn,bu,bi,bp,bm,bl;bx=[];bp=bj.face;for(bo=0,bu=bp.length;bo<bu;bo++){bs=bp[bo];bk=[0,0,0];bh=[0,0,0];br=0;bm=bs.slice(-2),bw=bm[0],bv=bm[1];for(bn=0,bi=bs.length;bn<bi;bn++){bt=bs[bn];bk=u(bk,bj.xyz[bt]);bh=u(bh,aL(bj.xyz[bw],bj.xyz[bv],bj.xyz[bt]));br+=al(bj.xyz[bw],bj.xyz[bv]);bl=[bv,bt],bw=bl[0],bv=bl[1]}bk=b(1/bs.length,bk);bh=bb(bh);br=br/bs.length;bq=ar(b(y(bk,bh),bh));bx.push(b((1+br)/2,bq))}return bx};d=function(bl,bi){var bj,bh,bk;bh=ax(bl);console.log("Pseudo-canonicalizing "+bl.name+"...");for(bj=0,bk=bi-1;0<=bk?bj<=bk:bj>=bk;0<=bk?bj++:bj--){bh.xyz=B(bl);bl.xyz=B(bh)}return bl.xyz};t=function(bl,bi){var bj,bh,bk;bh=ax(bl);console.log("Planarizing "+bl.name+"...");for(bj=0,bk=bi-1;0<=bk?bj<=bk:bj>=bk;0<=bk?bj++:bj--){bh.xyz=I(bl);bl.xyz=I(bh)}return bl.xyz};Z=function(bh){var bm,bn,bp,bk,bj,bo,bi,bl;bn="";bl=bh.face;for(bk=0,bo=bl.length;bk<bo;bk++){bm=bl[bk];for(bj=0,bi=bm.length;bj<bi;bj++){bp=bm[bj];bn+=""+bp+"->"}bn+="\n"}return console.log(bn)};x=function(){var bo,bl,bk,bj,bn,bm,bi,bh;bj=["T","O","C","I","D","P3","P4","A4","A5","Y3","Y4"];bl=["k","a","g","p","d","n","x","*"];console.log("===== Test Basic Ops =====");for(bn=0,bi=bl.length;bn<bi;bn++){bo=bl[bn];console.log("Operator "+bo);for(bm=0,bh=bj.length;bm<bh;bm++){bk=bj[bm];console.log(bo+bk+":",Y(bo+bk))}}return console.log("===== Done Testing Basic Ops =====")};V={};bc=600;ap=300;J={};f=E(q);ad=E(q);N=500;v=5;bd=0;G=0.8;k=bc/2;am=ap/2;r=new Date();m=true;aI="rgba(255,255,255,1.0)";af="area";a4=0.5;ag=false;Q=0;P=0;av=[1,0,0];aV=["dakD","opD","*T","*.oC","knD","dn6x4.bT"];aj=["#ff3333","#33ff33","#3333ff","#ffff33","#ff33ff","#33ffff","#dddddd","#555555","#dd0000","#00dd00","#0000dd"];aG=["#ff8888","#dddddd","#777777","#aa3333","#ff0000","#ffffff","#aaaaaa"];h=["#ff8888","#ffeeee","#88ff88","#dd7777","#ff2222","#22ff22","#ee4422","#aaaaaa"];bg=function(bi){var bh;if(bi[0]==="#"){bi=bi.slice(1)}if(bi.length===3){bh=bi.split("").map(function(bj){return parseInt(bj+bj,16)/255})}else{bh=bi.match(/.{2}/g).map(function(bj){return parseInt(bj,16)/255})}return bh};aQ=aG;X=function(bh){if(bh<aQ.length){return bg(aQ[bh])}else{return bg(aQ[aQ.length-1])}};aN=function(bh,bk){var bi,bj;bj=R(100*bh);if(bj in bk){return bk[bj]}else{bi=X(_.toArray(bk).length);bk[bj]=bi;return bi}};K=function(bh){var bp,bl,bk,bn,bo,bi,bm,bj;bh.face_colors=[];bl={};bj=bh.face;for(bi=0,bm=bj.length;bi<bm;bi++){bk=bj[bi];if(af==="area"){bn=(function(){var bs,bq,br;br=[];for(bs=0,bq=bk.length;bs<bq;bs++){bo=bk[bs];br.push(bh.xyz[bo])}return br})();bp=aN(a8(bn),bl)}else{bp=X(bk.length-3)}bh.face_colors.push(bp)}return bh};aE=[[/P4$/g,"C"],[/e/g,"aa"],[/b/g,"ta"],[/o/g,"jj"],[/m/g,"kj"],[/t(\d*)/g,"dk$1d"],[/j/g,"dad"],[/s/g,"dgd"],[/dd/g,""],[/ad/g,"a"],[/gd/g,"g"],[/aO/g,"aC"],[/aI/g,"aD"],[/gO/g,"gC"],[/gI/g,"gD"]];aS=function(bk){var bh,bj,bn,bm,bi,bl;bj=bk;for(bm=0,bi=aE.length;bm<bi;bm++){bl=aE[bm],bn=bl[0],bh=bl[1];bj=bj.replace(bn,bh)}console.log(""+bk+" executed as "+bj);return bj};Y=function(bi){var bk,bh,bj;bj=new aF();bk=0;bh=aS(bi);if(bh.search(/([0-9]+)$/)!==-1){bk=1*RegExp.lastParen;bh=bh.slice(0,-RegExp.lastParen.length)}switch(bh.slice(-1)){case"T":bj=c();break;case"O":bj=ah();break;case"C":bj=ab();break;case"I":bj=aY();break;case"D":bj=ai();break;case"P":bj=M(bk);break;case"A":bj=aM(bk);break;case"Y":bj=bf(bk);break;default:return}while(bh!==""){bk=0;if(bh.search(/([0-9]+)$/)!==-1){bk=1*RegExp.lastParen;bh=bh.slice(0,-RegExp.lastParen.length)}switch(bh.slice(-1)){case"d":bj=ax(bj);break;case"k":bj=U(bj,bk);break;case"a":bj=aw(bj);break;case"g":bj=aU(bj);break;case"p":bj=o(bj);break;case"r":bj=p(bj);break;case".":bj.xyz=d(bj,bk===0?5:bk*5);break;case"!":bj.xyz=j(bj,bk===0?5:bk*80);break;case"_":bj.xyz=t(bj,bk===0?5:bk*3);break;case"n":bj=z(bj,bk);break;case"x":bj=T(bj,bk);break;case"*":bj=aO(bj,bk)}bh=bh.slice(0,-1)}bj.xyz=a1(bj.xyz,bj.getEdges());bj.xyz=w(bj.xyz);bj=K(bj);return bj};be=function(){var bh,bm,bl,bk,bj,bi;bi={};bh=/\+/g;bj=/([^&=]+)=?([^&]*)/g;bm=function(bn){return decodeURIComponent(bn.replace(bh," "))};bk=window.location.search.substring(1);while(bl=bj.exec(bk)){bi[bm(bl[1])]=bm(bl[2])}return bi};az=function(){var bh;bh=$("#poly");bh.width(bc);bh.height(ap);V=bh[0].getContext("2d");V.lineWidth=a4;if(m){return V.clearRect(0,0,bc,ap)}else{V.clearRect(0,0,bc,ap);V.fillStyle=aI;return V.fillRect(0,0,bc,ap)}};aB=function(){if(m){return V.clearRect(0,0,bc,ap)}else{V.clearRect(0,0,bc,ap);V.fillStyle=aI;return V.fillRect(0,0,bc,ap)}};aH=function(bm){var bl,bh,bn,bk,bj,bi;bl=ba(bm);bn=_.zip(bl,(function(){bi=[];for(var bp=0,bo=bm.face.length-1;0<=bo?bp<=bo:bp>=bo;0<=bo?bp++:bp--){bi.push(bp)}return bi}).apply(this)).sort(function(bp,bo){return bp[0][2]-bo[0][2]}).map(function(bo){return bo[1]});bm.face=(function(){var bq,bo,bp;bp=[];for(bq=0,bo=bn.length;bq<bo;bq++){bh=bn[bq];bp.push(bm.face[bh])}return bp})();return bm.face_colors=(function(){var bq,bo,bp;bp=[];for(bq=0,bo=bn.length;bq<bo;bq++){bh=bn[bq];bp.push(bm.face_colors[bh])}return bp})()};L=function(bq,bz,bs){var bk,bt,br,by,bn,bo,bx,bp,bw,bv,bl,bi,bA,bB,bu,bm,bj,bh;bz||(bz=[3,3,3]);bs||(bs=[1,0,1]);bo=_.map(bq.xyz,function(bC){return bC});bq.xyz=_.map(bq.xyz,function(bC){return n(f,bC)});aH(bq);bu=F(bq.face);for(bl=0,bA=bu.length;bl<bA;bl++){bm=bu[bl],by=bm[0],bt=bm[1];V.beginPath();bp=bt[bt.length-1];bj=s(u(bz,bq.xyz[bp]),v,bd,G,N),bw=bj[0],bv=bj[1];V.moveTo(bw+k,bv+am);for(bi=0,bB=bt.length;bi<bB;bi++){bx=bt[bi];bh=s(u(bz,bq.xyz[bx]),v,bd,G,N),bw=bh[0],bv=bh[1];V.lineTo(bw+k,bv+am)}bk=bq.face_colors[by];br=(function(){var bD,bE,bC;bC=[];for(bD=0,bE=bt.length;bD<bE;bD++){bx=bt[bD];bC.push(bq.xyz[bx])}return bC})();bn=y(ac(br),bb([-1,1,0]));bk=b((bn/2+0.5)*0.7+0.3,bk);V.fillStyle="rgba("+(R(bk[0]*255))+", "+(R(bk[1]*255))+", "+(R(bk[2]*255))+", "+1+")";V.fill();V.stroke()}return bq.xyz=bo};$(function(){var bi,bh;az();bh=be();if("recipe" in bh){bi=[bh.recipe];$("#spec").val(bi)}else{bi=[a3(aV)];$("#spec").val(bi)}J=_.map(bi,function(bj){return Y(bj)});aq();$("#spec").change(aR(function(bj){bi=$("#spec").val().split(/\s+/g);J=_.map(bi,function(bk){return Y(bk)});return aq()},this));$("#poly").mousewheel(function(bl,bm,bk,bj){event.preventDefault();N*=(10+bm)/10;return aq()});$("#poly").mousedown(function(bj){var bk;event.preventDefault();ag=true;Q=bj.clientX-$(this).offset().left;P=bj.clientY-$(this).offset().top;bk=aA(Q,P,k,am,v,bd,G,N);if(bk[0]*bk[1]*bk[2]*0===0){av=bk}return ad=E(f)});$("#poly").mouseup(function(bj){event.preventDefault();return ag=false});$("#poly").mouseleave(function(bj){event.preventDefault();return ag=false});return $("#poly").mousemove(function(bm){var bk,bj,bl;event.preventDefault();if(ag){bk=bm.clientX-$(this).offset().left;bj=bm.clientY-$(this).offset().top;bl=aA(bk,bj,k,am,v,bd,G,N);if(bl[0]*bl[1]*bl[2]*0===0&&av[0]*av[1]*av[2]*0===0){f=au(at(av,bl),ad)}return aq()}})});a7=function(){var bi,bj,bm,bl,bh,bk,bn;aB();bi=(2*Math.PI)/180*r.getSeconds()*0.1;bk=F(J);for(bl=0,bh=bk.length;bl<bh;bl++){bn=bk[bl],bj=bn[0],bm=bn[1];L(bm,[0+3*bj,0,3],[0,bi,globphi])}return setTimeout(a7,100)};aq=function(){var bj,bm,bl,bi,bk,bn,bh;aB();bk=F(J);bh=[];for(bl=0,bi=bk.length;bl<bi;bl++){bn=bk[bl],bj=bn[0],bm=bn[1];bh.push(L(bm,[0+3*bj,0,3],[0,0,0]))}return bh}}).call(this);